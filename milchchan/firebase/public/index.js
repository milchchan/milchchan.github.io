var zA=Object.defineProperty;var by=Object.getOwnPropertySymbols;var VA=Object.prototype.hasOwnProperty,GA=Object.prototype.propertyIsEnumerable;var Ty=(n,e,t)=>e in n?zA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,wy=(n,e)=>{for(var t in e||(e={}))VA.call(e,t)&&Ty(n,t,e[t]);if(by)for(var t of by(e))GA.call(e,t)&&Ty(n,t,e[t]);return n};const WA=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};WA();function Gn(n,e){const t=Object.create(null),i=n.split(",");for(let s=0;s<i.length;s++)t[i[s]]=!0;return e?s=>!!t[s.toLowerCase()]:s=>!!t[s]}const XA="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt",qA=Gn(XA),YA="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",jA=Gn(YA);function Sy(n){return!!n||n===""}function dl(n){if(Te(n)){const e={};for(let t=0;t<n.length;t++){const i=n[t],s=Ue(i)?Ey(i):dl(i);if(s)for(const r in s)e[r]=s[r]}return e}else{if(Ue(n))return n;if(wt(n))return n}}const $A=/;(?![^(]*\))/g,QA=/:(.+)/;function Ey(n){const e={};return n.split($A).forEach(t=>{if(t){const i=t.split(QA);i.length>1&&(e[i[0].trim()]=i[1].trim())}}),e}function fl(n){let e="";if(Ue(n))e=n;else if(Te(n))for(let t=0;t<n.length;t++){const i=fl(n[t]);i&&(e+=i+" ")}else if(wt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}function KA(n){if(!n)return null;let{class:e,style:t}=n;return e&&!Ue(e)&&(n.class=fl(e)),t&&(n.style=dl(t)),n}const JA="html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot",ZA="svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistanceLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view",eC="area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr",tC=Gn(JA),nC=Gn(ZA),iC=Gn(eC);function sC(n,e){if(n.length!==e.length)return!1;let t=!0;for(let i=0;t&&i<n.length;i++)t=Ps(n[i],e[i]);return t}function Ps(n,e){if(n===e)return!0;let t=Cy(n),i=Cy(e);if(t||i)return t&&i?n.getTime()===e.getTime():!1;if(t=Te(n),i=Te(e),t||i)return t&&i?sC(n,e):!1;if(t=wt(n),i=wt(e),t||i){if(!t||!i)return!1;const s=Object.keys(n).length,r=Object.keys(e).length;if(s!==r)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Ps(n[o],e[o]))return!1}}return String(n)===String(e)}function _u(n,e){return n.findIndex(t=>Ps(t,e))}const rC=n=>n==null?"":Te(n)||wt(n)&&(n.toString===Iy||!Pe(n.toString))?JSON.stringify(n,My,2):String(n),My=(n,e)=>e&&e.__v_isRef?My(n,e.value):So(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[i,s])=>(t[`${i} =>`]=s,t),{})}:Ir(e)?{[`Set(${e.size})`]:[...e.values()]}:wt(e)&&!Te(e)&&!Ry(e)?String(e):e,et={},wo=[],Sn=()=>{},yu=()=>!1,oC=/^on[^a-z]/,Cr=n=>oC.test(n),Uf=n=>n.startsWith("onUpdate:"),tt=Object.assign,Ay=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},aC=Object.prototype.hasOwnProperty,Je=(n,e)=>aC.call(n,e),Te=Array.isArray,So=n=>vu(n)==="[object Map]",Ir=n=>vu(n)==="[object Set]",Cy=n=>n instanceof Date,Pe=n=>typeof n=="function",Ue=n=>typeof n=="string",Eo=n=>typeof n=="symbol",wt=n=>n!==null&&typeof n=="object",Bf=n=>wt(n)&&Pe(n.then)&&Pe(n.catch),Iy=Object.prototype.toString,vu=n=>Iy.call(n),lC=n=>vu(n).slice(8,-1),Ry=n=>vu(n)==="[object Object]",Hf=n=>Ue(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Rr=Gn(",key,ref,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),xu=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},cC=/-(\w)/g,pn=xu(n=>n.replace(cC,(e,t)=>t?t.toUpperCase():"")),uC=/\B([A-Z])/g,_i=xu(n=>n.replace(uC,"-$1").toLowerCase()),Lr=xu(n=>n.charAt(0).toUpperCase()+n.slice(1)),Mo=xu(n=>n?`on${Lr(n)}`:""),pl=(n,e)=>!Object.is(n,e),Ao=(n,e)=>{for(let t=0;t<n.length;t++)n[t](e)},bu=(n,e,t)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value:t})},Ns=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Ly;const hC=()=>Ly||(Ly=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let Ni;const Tu=[];class zf{constructor(e=!1){this.active=!0,this.effects=[],this.cleanups=[],!e&&Ni&&(this.parent=Ni,this.index=(Ni.scopes||(Ni.scopes=[])).push(this)-1)}run(e){if(this.active)try{return this.on(),e()}finally{this.off()}}on(){this.active&&(Tu.push(this),Ni=this)}off(){this.active&&(Tu.pop(),Ni=Tu[Tu.length-1])}stop(e){if(this.active){if(this.effects.forEach(t=>t.stop()),this.cleanups.forEach(t=>t()),this.scopes&&this.scopes.forEach(t=>t.stop(!0)),this.parent&&!e){const t=this.parent.scopes.pop();t&&t!==this&&(this.parent.scopes[this.index]=t,t.index=this.index)}this.active=!1}}}function dC(n){return new zf(n)}function Py(n,e){e=e||Ni,e&&e.active&&e.effects.push(n)}function fC(){return Ni}function pC(n){Ni&&Ni.cleanups.push(n)}const Vf=n=>{const e=new Set(n);return e.w=0,e.n=0,e},Ny=n=>(n.w&Fs)>0,Fy=n=>(n.n&Fs)>0,mC=({deps:n})=>{if(n.length)for(let e=0;e<n.length;e++)n[e].w|=Fs},gC=n=>{const{deps:e}=n;if(e.length){let t=0;for(let i=0;i<e.length;i++){const s=e[i];Ny(s)&&!Fy(s)?s.delete(n):e[t++]=s,s.w&=~Fs,s.n&=~Fs}e.length=t}},Gf=new WeakMap;let ml=0,Fs=1;const Wf=30,gl=[];let Pr;const Nr=Symbol(""),Xf=Symbol("");class _l{constructor(e,t=null,i){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],Py(this,i)}run(){if(!this.active)return this.fn();if(!gl.includes(this))try{return gl.push(Pr=this),vC(),Fs=1<<++ml,ml<=Wf?mC(this):Dy(this),this.fn()}finally{ml<=Wf&&gC(this),Fs=1<<--ml,Ds(),gl.pop();const e=gl.length;Pr=e>0?gl[e-1]:void 0}}stop(){this.active&&(Dy(this),this.onStop&&this.onStop(),this.active=!1)}}function Dy(n){const{deps:e}=n;if(e.length){for(let t=0;t<e.length;t++)e[t].delete(n);e.length=0}}function _C(n,e){n.effect&&(n=n.effect.fn);const t=new _l(n);e&&(tt(t,e),e.scope&&Py(t,e.scope)),(!e||!e.lazy)&&t.run();const i=t.run.bind(t);return i.effect=t,i}function yC(n){n.effect.stop()}let Co=!0;const qf=[];function Fr(){qf.push(Co),Co=!1}function vC(){qf.push(Co),Co=!0}function Ds(){const n=qf.pop();Co=n===void 0?!0:n}function Wn(n,e,t){if(!Oy())return;let i=Gf.get(n);i||Gf.set(n,i=new Map);let s=i.get(t);s||i.set(t,s=Vf()),ky(s)}function Oy(){return Co&&Pr!==void 0}function ky(n,e){let t=!1;ml<=Wf?Fy(n)||(n.n|=Fs,t=!Ny(n)):t=!n.has(Pr),t&&(n.add(Pr),Pr.deps.push(n))}function ss(n,e,t,i,s,r){const o=Gf.get(n);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(t==="length"&&Te(n))o.forEach((l,c)=>{(c==="length"||c>=i)&&a.push(l)});else switch(t!==void 0&&a.push(o.get(t)),e){case"add":Te(n)?Hf(t)&&a.push(o.get("length")):(a.push(o.get(Nr)),So(n)&&a.push(o.get(Xf)));break;case"delete":Te(n)||(a.push(o.get(Nr)),So(n)&&a.push(o.get(Xf)));break;case"set":So(n)&&a.push(o.get(Nr));break}if(a.length===1)a[0]&&Yf(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);Yf(Vf(l))}}function Yf(n,e){for(const t of Te(n)?n:[...n])(t!==Pr||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const xC=Gn("__proto__,__v_isRef,__isVue"),Uy=new Set(Object.getOwnPropertyNames(Symbol).map(n=>Symbol[n]).filter(Eo)),bC=wu(),TC=wu(!1,!0),wC=wu(!0),SC=wu(!0,!0),By=EC();function EC(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...t){const i=je(this);for(let r=0,o=this.length;r<o;r++)Wn(i,"get",r+"");const s=i[e](...t);return s===-1||s===!1?i[e](...t.map(je)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...t){Fr();const i=je(this)[e].apply(this,t);return Ds(),i}}),n}function wu(n=!1,e=!1){return function(i,s,r){if(s==="__v_isReactive")return!n;if(s==="__v_isReadonly")return n;if(s==="__v_raw"&&r===(n?e?Qy:$y:e?jy:Yy).get(i))return i;const o=Te(i);if(!n&&o&&Je(By,s))return Reflect.get(By,s,r);const a=Reflect.get(i,s,r);return(Eo(s)?Uy.has(s):xC(s))||(n||Wn(i,"get",s),e)?a:ln(a)?!o||!Hf(s)?a.value:a:wt(a)?n?$f(a):Lu(a):a}}const MC=Hy(),AC=Hy(!0);function Hy(n=!1){return function(t,i,s,r){let o=t[i];if(!n&&!Nu(s)&&(s=je(s),o=je(o),!Te(t)&&ln(o)&&!ln(s)))return o.value=s,!0;const a=Te(t)&&Hf(i)?Number(i)<t.length:Je(t,i),l=Reflect.set(t,i,s,r);return t===je(r)&&(a?pl(s,o)&&ss(t,"set",i,s):ss(t,"add",i,s)),l}}function CC(n,e){const t=Je(n,e);n[e];const i=Reflect.deleteProperty(n,e);return i&&t&&ss(n,"delete",e,void 0),i}function IC(n,e){const t=Reflect.has(n,e);return(!Eo(e)||!Uy.has(e))&&Wn(n,"has",e),t}function RC(n){return Wn(n,"iterate",Te(n)?"length":Nr),Reflect.ownKeys(n)}const zy={get:bC,set:MC,deleteProperty:CC,has:IC,ownKeys:RC},Vy={get:wC,set(n,e){return!0},deleteProperty(n,e){return!0}},LC=tt({},zy,{get:TC,set:AC}),PC=tt({},Vy,{get:SC}),jf=n=>n,Su=n=>Reflect.getPrototypeOf(n);function Eu(n,e,t=!1,i=!1){n=n.__v_raw;const s=je(n),r=je(e);e!==r&&!t&&Wn(s,"get",e),!t&&Wn(s,"get",r);const{has:o}=Su(s),a=i?jf:t?Jf:yl;if(o.call(s,e))return a(n.get(e));if(o.call(s,r))return a(n.get(r));n!==s&&n.get(e)}function Mu(n,e=!1){const t=this.__v_raw,i=je(t),s=je(n);return n!==s&&!e&&Wn(i,"has",n),!e&&Wn(i,"has",s),n===s?t.has(n):t.has(n)||t.has(s)}function Au(n,e=!1){return n=n.__v_raw,!e&&Wn(je(n),"iterate",Nr),Reflect.get(n,"size",n)}function Gy(n){n=je(n);const e=je(this);return Su(e).has.call(e,n)||(e.add(n),ss(e,"add",n,n)),this}function Wy(n,e){e=je(e);const t=je(this),{has:i,get:s}=Su(t);let r=i.call(t,n);r||(n=je(n),r=i.call(t,n));const o=s.call(t,n);return t.set(n,e),r?pl(e,o)&&ss(t,"set",n,e):ss(t,"add",n,e),this}function Xy(n){const e=je(this),{has:t,get:i}=Su(e);let s=t.call(e,n);s||(n=je(n),s=t.call(e,n)),i&&i.call(e,n);const r=e.delete(n);return s&&ss(e,"delete",n,void 0),r}function qy(){const n=je(this),e=n.size!==0,t=n.clear();return e&&ss(n,"clear",void 0,void 0),t}function Cu(n,e){return function(i,s){const r=this,o=r.__v_raw,a=je(o),l=e?jf:n?Jf:yl;return!n&&Wn(a,"iterate",Nr),o.forEach((c,h)=>i.call(s,l(c),l(h),r))}}function Iu(n,e,t){return function(...i){const s=this.__v_raw,r=je(s),o=So(r),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...i),h=t?jf:e?Jf:yl;return!e&&Wn(r,"iterate",l?Xf:Nr),{next(){const{value:u,done:d}=c.next();return d?{value:u,done:d}:{value:a?[h(u[0]),h(u[1])]:h(u),done:d}},[Symbol.iterator](){return this}}}}function Os(n){return function(...e){return n==="delete"?!1:this}}function NC(){const n={get(r){return Eu(this,r)},get size(){return Au(this)},has:Mu,add:Gy,set:Wy,delete:Xy,clear:qy,forEach:Cu(!1,!1)},e={get(r){return Eu(this,r,!1,!0)},get size(){return Au(this)},has:Mu,add:Gy,set:Wy,delete:Xy,clear:qy,forEach:Cu(!1,!0)},t={get(r){return Eu(this,r,!0)},get size(){return Au(this,!0)},has(r){return Mu.call(this,r,!0)},add:Os("add"),set:Os("set"),delete:Os("delete"),clear:Os("clear"),forEach:Cu(!0,!1)},i={get(r){return Eu(this,r,!0,!0)},get size(){return Au(this,!0)},has(r){return Mu.call(this,r,!0)},add:Os("add"),set:Os("set"),delete:Os("delete"),clear:Os("clear"),forEach:Cu(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{n[r]=Iu(r,!1,!1),t[r]=Iu(r,!0,!1),e[r]=Iu(r,!1,!0),i[r]=Iu(r,!0,!0)}),[n,t,e,i]}const[FC,DC,OC,kC]=NC();function Ru(n,e){const t=e?n?kC:OC:n?DC:FC;return(i,s,r)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?i:Reflect.get(Je(t,s)&&s in i?t:i,s,r)}const UC={get:Ru(!1,!1)},BC={get:Ru(!1,!0)},HC={get:Ru(!0,!1)},zC={get:Ru(!0,!0)},Yy=new WeakMap,jy=new WeakMap,$y=new WeakMap,Qy=new WeakMap;function VC(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function GC(n){return n.__v_skip||!Object.isExtensible(n)?0:VC(lC(n))}function Lu(n){return n&&n.__v_isReadonly?n:Pu(n,!1,zy,UC,Yy)}function Ky(n){return Pu(n,!1,LC,BC,jy)}function $f(n){return Pu(n,!0,Vy,HC,$y)}function WC(n){return Pu(n,!0,PC,zC,Qy)}function Pu(n,e,t,i,s){if(!wt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const r=s.get(n);if(r)return r;const o=GC(n);if(o===0)return n;const a=new Proxy(n,o===2?i:t);return s.set(n,a),a}function Dr(n){return Nu(n)?Dr(n.__v_raw):!!(n&&n.__v_isReactive)}function Nu(n){return!!(n&&n.__v_isReadonly)}function Qf(n){return Dr(n)||Nu(n)}function je(n){const e=n&&n.__v_raw;return e?je(e):n}function Kf(n){return bu(n,"__v_skip",!0),n}const yl=n=>wt(n)?Lu(n):n,Jf=n=>wt(n)?$f(n):n;function Zf(n){Oy()&&(n=je(n),n.dep||(n.dep=Vf()),ky(n.dep))}function Fu(n,e){n=je(n),n.dep&&Yf(n.dep)}function ln(n){return Boolean(n&&n.__v_isRef===!0)}function Du(n){return Jy(n,!1)}function XC(n){return Jy(n,!0)}function Jy(n,e){return ln(n)?n:new qC(n,e)}class qC{constructor(e,t){this._shallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:je(e),this._value=t?e:yl(e)}get value(){return Zf(this),this._value}set value(e){e=this._shallow?e:je(e),pl(e,this._rawValue)&&(this._rawValue=e,this._value=this._shallow?e:yl(e),Fu(this))}}function YC(n){Fu(n)}function Zy(n){return ln(n)?n.value:n}const jC={get:(n,e,t)=>Zy(Reflect.get(n,e,t)),set:(n,e,t,i)=>{const s=n[e];return ln(s)&&!ln(t)?(s.value=t,!0):Reflect.set(n,e,t,i)}};function ep(n){return Dr(n)?n:new Proxy(n,jC)}class $C{constructor(e){this.dep=void 0,this.__v_isRef=!0;const{get:t,set:i}=e(()=>Zf(this),()=>Fu(this));this._get=t,this._set=i}get value(){return this._get()}set value(e){this._set(e)}}function QC(n){return new $C(n)}function KC(n){const e=Te(n)?new Array(n.length):{};for(const t in n)e[t]=ev(n,t);return e}class JC{constructor(e,t){this._object=e,this._key=t,this.__v_isRef=!0}get value(){return this._object[this._key]}set value(e){this._object[this._key]=e}}function ev(n,e){const t=n[e];return ln(t)?t:new JC(n,e)}class ZC{constructor(e,t,i){this._setter=t,this.dep=void 0,this._dirty=!0,this.__v_isRef=!0,this.effect=new _l(e,()=>{this._dirty||(this._dirty=!0,Fu(this))}),this.__v_isReadonly=i}get value(){const e=je(this);return Zf(e),e._dirty&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function tv(n,e){let t,i;const s=Pe(n);return s?(t=n,i=Sn):(t=n.get,i=n.set),new ZC(t,i,s||!i)}Promise.resolve();let Io,Ou=[];function nv(n,e){var t,i;Io=n,Io?(Io.enabled=!0,Ou.forEach(({event:s,args:r})=>Io.emit(s,...r)),Ou=[]):typeof window!="undefined"&&window.HTMLElement&&!((i=(t=window.navigator)===null||t===void 0?void 0:t.userAgent)===null||i===void 0?void 0:i.includes("jsdom"))?((e.__VUE_DEVTOOLS_HOOK_REPLAY__=e.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(r=>{nv(r,e)}),setTimeout(()=>{Io||(e.__VUE_DEVTOOLS_HOOK_REPLAY__=null,Ou=[])},3e3)):Ou=[]}function eI(n,e,...t){const i=n.vnode.props||et;let s=t;const r=e.startsWith("update:"),o=r&&e.slice(7);if(o&&o in i){const h=`${o==="modelValue"?"model":o}Modifiers`,{number:u,trim:d}=i[h]||et;d?s=t.map(f=>f.trim()):u&&(s=t.map(Ns))}let a,l=i[a=Mo(e)]||i[a=Mo(pn(e))];!l&&r&&(l=i[a=Mo(_i(e))]),l&&Yn(l,n,6,s);const c=i[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Yn(c,n,6,s)}}function iv(n,e,t=!1){const i=e.emitsCache,s=i.get(n);if(s!==void 0)return s;const r=n.emits;let o={},a=!1;if(!Pe(n)){const l=c=>{const h=iv(c,e,!0);h&&(a=!0,tt(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!r&&!a?(i.set(n,null),null):(Te(r)?r.forEach(l=>o[l]=null):tt(o,r),i.set(n,o),o)}function tp(n,e){return!n||!Cr(e)?!1:(e=e.slice(2).replace(/Once$/,""),Je(n,e[0].toLowerCase()+e.slice(1))||Je(n,_i(e))||Je(n,e))}let Xn=null,ku=null;function vl(n){const e=Xn;return Xn=n,ku=n&&n.type.__scopeId||null,e}function tI(n){ku=n}function nI(){ku=null}const iI=n=>np;function np(n,e=Xn,t){if(!e||n._n)return n;const i=(...s)=>{i._d&&bp(-1);const r=vl(e),o=n(...s);return vl(r),i._d&&bp(1),o};return i._n=!0,i._c=!0,i._d=!0,i}function Uu(n){const{type:e,vnode:t,proxy:i,withProxy:s,props:r,propsOptions:[o],slots:a,attrs:l,emit:c,render:h,renderCache:u,data:d,setupState:f,ctx:p,inheritAttrs:_}=n;let y,m;const g=vl(n);try{if(t.shapeFlag&4){const x=s||i;y=qn(h.call(x,x,u,r,f,d,p)),m=l}else{const x=e;y=qn(x.length>1?x(r,{attrs:l,slots:a,emit:c}):x(r,null)),m=e.props?l:rI(l)}}catch(x){Al.length=0,Br(x,n,1),y=mt(Mn)}let v=y;if(m&&_!==!1){const x=Object.keys(m),{shapeFlag:T}=v;x.length&&T&(1|6)&&(o&&x.some(Uf)&&(m=oI(m,o)),v=Bs(v,m))}return t.dirs&&(v.dirs=v.dirs?v.dirs.concat(t.dirs):t.dirs),t.transition&&(v.transition=t.transition),y=v,vl(g),y}function sI(n){let e;for(let t=0;t<n.length;t++){const i=n[t];if(Us(i)){if(i.type!==Mn||i.children==="v-if"){if(e)return;e=i}}else return}return e}const rI=n=>{let e;for(const t in n)(t==="class"||t==="style"||Cr(t))&&((e||(e={}))[t]=n[t]);return e},oI=(n,e)=>{const t={};for(const i in n)(!Uf(i)||!(i.slice(9)in e))&&(t[i]=n[i]);return t};function aI(n,e,t){const{props:i,children:s,component:r}=n,{props:o,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return i?sv(i,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let u=0;u<h.length;u++){const d=h[u];if(o[d]!==i[d]&&!tp(c,d))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:i===o?!1:i?o?sv(i,o,c):!0:!!o;return!1}function sv(n,e,t){const i=Object.keys(e);if(i.length!==Object.keys(n).length)return!0;for(let s=0;s<i.length;s++){const r=i[s];if(e[r]!==n[r]&&!tp(t,r))return!0}return!1}function ip({vnode:n,parent:e},t){for(;e&&e.subTree===n;)(n=e.vnode).el=t,e=e.parent}const lI=n=>n.__isSuspense,cI={name:"Suspense",__isSuspense:!0,process(n,e,t,i,s,r,o,a,l,c){n==null?hI(e,t,i,s,r,o,a,l,c):dI(n,e,t,i,s,o,a,l,c)},hydrate:fI,create:sp,normalize:pI},uI=cI;function xl(n,e){const t=n.props&&n.props[e];Pe(t)&&t()}function hI(n,e,t,i,s,r,o,a,l){const{p:c,o:{createElement:h}}=l,u=h("div"),d=n.suspense=sp(n,s,i,e,u,t,r,o,a,l);c(null,d.pendingBranch=n.ssContent,u,null,i,d,r,o),d.deps>0?(xl(n,"onPending"),xl(n,"onFallback"),c(null,n.ssFallback,e,t,i,null,r,o),Ro(d,n.ssFallback)):d.resolve()}function dI(n,e,t,i,s,r,o,a,{p:l,um:c,o:{createElement:h}}){const u=e.suspense=n.suspense;u.vnode=e,e.el=n.el;const d=e.ssContent,f=e.ssFallback,{activeBranch:p,pendingBranch:_,isInFallback:y,isHydrating:m}=u;if(_)u.pendingBranch=d,Oi(d,_)?(l(_,d,u.hiddenContainer,null,s,u,r,o,a),u.deps<=0?u.resolve():y&&(l(p,f,t,i,s,null,r,o,a),Ro(u,f))):(u.pendingId++,m?(u.isHydrating=!1,u.activeBranch=_):c(_,s,u),u.deps=0,u.effects.length=0,u.hiddenContainer=h("div"),y?(l(null,d,u.hiddenContainer,null,s,u,r,o,a),u.deps<=0?u.resolve():(l(p,f,t,i,s,null,r,o,a),Ro(u,f))):p&&Oi(d,p)?(l(p,d,t,i,s,u,r,o,a),u.resolve(!0)):(l(null,d,u.hiddenContainer,null,s,u,r,o,a),u.deps<=0&&u.resolve()));else if(p&&Oi(d,p))l(p,d,t,i,s,u,r,o,a),Ro(u,d);else if(xl(e,"onPending"),u.pendingBranch=d,u.pendingId++,l(null,d,u.hiddenContainer,null,s,u,r,o,a),u.deps<=0)u.resolve();else{const{timeout:g,pendingId:v}=u;g>0?setTimeout(()=>{u.pendingId===v&&u.fallback(f)},g):g===0&&u.fallback(f)}}function sp(n,e,t,i,s,r,o,a,l,c,h=!1){const{p:u,m:d,um:f,n:p,o:{parentNode:_,remove:y}}=c,m=Ns(n.props&&n.props.timeout),g={vnode:n,parent:e,parentComponent:t,isSVG:o,container:i,hiddenContainer:s,anchor:r,deps:0,pendingId:0,timeout:typeof m=="number"?m:-1,activeBranch:null,pendingBranch:null,isInFallback:!0,isHydrating:h,isUnmounted:!1,effects:[],resolve(v=!1){const{vnode:x,activeBranch:T,pendingBranch:S,pendingId:b,effects:M,parentComponent:N,container:P}=g;if(g.isHydrating)g.isHydrating=!1;else if(!v){const O=T&&S.transition&&S.transition.mode==="out-in";O&&(T.transition.afterLeave=()=>{b===g.pendingId&&d(S,P,H,0)});let{anchor:H}=g;T&&(H=p(T),f(T,N,g,!0)),O||d(S,P,H,0)}Ro(g,S),g.pendingBranch=null,g.isInFallback=!1;let L=g.parent,V=!1;for(;L;){if(L.pendingBranch){L.effects.push(...M),V=!0;break}L=L.parent}V||Op(M),g.effects=[],xl(x,"onResolve")},fallback(v){if(!g.pendingBranch)return;const{vnode:x,activeBranch:T,parentComponent:S,container:b,isSVG:M}=g;xl(x,"onFallback");const N=p(T),P=()=>{!g.isInFallback||(u(null,v,b,N,S,null,M,a,l),Ro(g,v))},L=v.transition&&v.transition.mode==="out-in";L&&(T.transition.afterLeave=P),g.isInFallback=!0,f(T,S,null,!0),L||P()},move(v,x,T){g.activeBranch&&d(g.activeBranch,v,x,T),g.container=v},next(){return g.activeBranch&&p(g.activeBranch)},registerDep(v,x){const T=!!g.pendingBranch;T&&g.deps++;const S=v.vnode.el;v.asyncDep.catch(b=>{Br(b,v,0)}).then(b=>{if(v.isUnmounted||g.isUnmounted||g.pendingId!==v.suspenseId)return;v.asyncResolved=!0;const{vnode:M}=v;Cp(v,b,!1),S&&(M.el=S);const N=!S&&v.subTree.el;x(v,M,_(S||v.subTree.el),S?null:p(v.subTree),g,o,l),N&&y(N),ip(v,M.el),T&&--g.deps==0&&g.resolve()})},unmount(v,x){g.isUnmounted=!0,g.activeBranch&&f(g.activeBranch,t,v,x),g.pendingBranch&&f(g.pendingBranch,t,v,x)}};return g}function fI(n,e,t,i,s,r,o,a,l){const c=e.suspense=sp(e,i,t,n.parentNode,document.createElement("div"),null,s,r,o,a,!0),h=l(n,c.pendingBranch=e.ssContent,t,c,r,o);return c.deps===0&&c.resolve(),h}function pI(n){const{shapeFlag:e,children:t}=n,i=e&32;n.ssContent=rv(i?t.default:t),n.ssFallback=i?rv(t.fallback):mt(Mn)}function rv(n){let e;if(Pe(n)){const t=No&&n._c;t&&(n._d=!1,ju()),n=n(),t&&(n._d=!0,e=Di,Bv())}return Te(n)&&(n=sI(n)),n=qn(n),e&&!n.dynamicChildren&&(n.dynamicChildren=e.filter(t=>t!==n)),n}function ov(n,e){e&&e.pendingBranch?Te(n)?e.effects.push(...n):e.effects.push(n):Op(n)}function Ro(n,e){n.activeBranch=e;const{vnode:t,parentComponent:i}=n,s=t.el=e.el;i&&i.subTree===t&&(i.vnode.el=s,ip(i,s))}function av(n,e){if(Bt){let t=Bt.provides;const i=Bt.parent&&Bt.parent.provides;i===t&&(t=Bt.provides=Object.create(i)),t[n]=e}}function bl(n,e,t=!1){const i=Bt||Xn;if(i){const s=i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides;if(s&&n in s)return s[n];if(arguments.length>1)return t&&Pe(e)?e.call(i.proxy):e}}function rp(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return El(()=>{n.isMounted=!0}),Vu(()=>{n.isUnmounting=!0}),n}const ei=[Function,Array],mI={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ei,onEnter:ei,onAfterEnter:ei,onEnterCancelled:ei,onBeforeLeave:ei,onLeave:ei,onAfterLeave:ei,onLeaveCancelled:ei,onBeforeAppear:ei,onAppear:ei,onAfterAppear:ei,onAppearCancelled:ei},setup(n,{slots:e}){const t=zs(),i=rp();let s;return()=>{const r=e.default&&Bu(e.default(),!0);if(!r||!r.length)return;const o=je(n),{mode:a}=o,l=r[0];if(i.isLeaving)return ap(l);const c=cv(l);if(!c)return ap(l);const h=Lo(c,o,i,t);Or(c,h);const u=t.subTree,d=u&&cv(u);let f=!1;const{getTransitionKey:p}=c.type;if(p){const _=p();s===void 0?s=_:_!==s&&(s=_,f=!0)}if(d&&d.type!==Mn&&(!Oi(c,d)||f)){const _=Lo(d,o,i,t);if(Or(d,_),a==="out-in")return i.isLeaving=!0,_.afterLeave=()=>{i.isLeaving=!1,t.update()},ap(l);a==="in-out"&&c.type!==Mn&&(_.delayLeave=(y,m,g)=>{const v=lv(i,d);v[String(d.key)]=d,y._leaveCb=()=>{m(),y._leaveCb=void 0,delete h.delayedLeave},h.delayedLeave=g})}return l}}},op=mI;function lv(n,e){const{leavingVNodes:t}=n;let i=t.get(e.type);return i||(i=Object.create(null),t.set(e.type,i)),i}function Lo(n,e,t,i){const{appear:s,mode:r,persisted:o=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:c,onEnterCancelled:h,onBeforeLeave:u,onLeave:d,onAfterLeave:f,onLeaveCancelled:p,onBeforeAppear:_,onAppear:y,onAfterAppear:m,onAppearCancelled:g}=e,v=String(n.key),x=lv(t,n),T=(b,M)=>{b&&Yn(b,i,9,M)},S={mode:r,persisted:o,beforeEnter(b){let M=a;if(!t.isMounted)if(s)M=_||a;else return;b._leaveCb&&b._leaveCb(!0);const N=x[v];N&&Oi(n,N)&&N.el._leaveCb&&N.el._leaveCb(),T(M,[b])},enter(b){let M=l,N=c,P=h;if(!t.isMounted)if(s)M=y||l,N=m||c,P=g||h;else return;let L=!1;const V=b._enterCb=O=>{L||(L=!0,O?T(P,[b]):T(N,[b]),S.delayedLeave&&S.delayedLeave(),b._enterCb=void 0)};M?(M(b,V),M.length<=1&&V()):V()},leave(b,M){const N=String(n.key);if(b._enterCb&&b._enterCb(!0),t.isUnmounting)return M();T(u,[b]);let P=!1;const L=b._leaveCb=V=>{P||(P=!0,M(),V?T(p,[b]):T(f,[b]),b._leaveCb=void 0,x[N]===n&&delete x[N])};x[N]=n,d?(d(b,L),d.length<=1&&L()):L()},clone(b){return Lo(b,e,t,i)}};return S}function ap(n){if(wl(n))return n=Bs(n),n.children=null,n}function cv(n){return wl(n)?n.children?n.children[0]:void 0:n}function Or(n,e){n.shapeFlag&6&&n.component?Or(n.component.subTree,e):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function Bu(n,e=!1){let t=[],i=0;for(let s=0;s<n.length;s++){const r=n[s];r.type===cn?(r.patchFlag&128&&i++,t=t.concat(Bu(r.children,e))):(e||r.type!==Mn)&&t.push(r)}if(i>1)for(let s=0;s<t.length;s++)t[s].patchFlag=-2;return t}function lp(n){return Pe(n)?{setup:n,name:n.name}:n}const Tl=n=>!!n.type.__asyncLoader;function gI(n){Pe(n)&&(n={loader:n});const{loader:e,loadingComponent:t,errorComponent:i,delay:s=200,timeout:r,suspensible:o=!0,onError:a}=n;let l=null,c,h=0;const u=()=>(h++,l=null,d()),d=()=>{let f;return l||(f=l=e().catch(p=>{if(p=p instanceof Error?p:new Error(String(p)),a)return new Promise((_,y)=>{a(p,()=>_(u()),()=>y(p),h+1)});throw p}).then(p=>f!==l&&l?l:(p&&(p.__esModule||p[Symbol.toStringTag]==="Module")&&(p=p.default),c=p,p)))};return lp({name:"AsyncComponentWrapper",__asyncLoader:d,get __asyncResolved(){return c},setup(){const f=Bt;if(c)return()=>cp(c,f);const p=g=>{l=null,Br(g,f,13,!i)};if(o&&f.suspense||Cl)return d().then(g=>()=>cp(g,f)).catch(g=>(p(g),()=>i?mt(i,{error:g}):null));const _=Du(!1),y=Du(),m=Du(!!s);return s&&setTimeout(()=>{m.value=!1},s),r!=null&&setTimeout(()=>{if(!_.value&&!y.value){const g=new Error(`Async component timed out after ${r}ms.`);p(g),y.value=g}},r),d().then(()=>{_.value=!0,f.parent&&wl(f.parent.vnode)&&Dp(f.parent.update)}).catch(g=>{p(g),y.value=g}),()=>{if(_.value&&c)return cp(c,f);if(y.value&&i)return mt(i,{error:y.value});if(t&&!m.value)return mt(t)}}})}function cp(n,{vnode:{ref:e,props:t,children:i}}){const s=mt(n,t,i);return s.ref=e,s}const wl=n=>n.type.__isKeepAlive,_I={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(n,{slots:e}){const t=zs(),i=t.ctx;if(!i.renderer)return e.default;const s=new Map,r=new Set;let o=null;const a=t.suspense,{renderer:{p:l,m:c,um:h,o:{createElement:u}}}=i,d=u("div");i.activate=(g,v,x,T,S)=>{const b=g.component;c(g,v,x,0,a),l(b.vnode,g,v,x,b,a,T,g.slotScopeIds,S),jt(()=>{b.isDeactivated=!1,b.a&&Ao(b.a);const M=g.props&&g.props.onVnodeMounted;M&&Pn(M,b.parent,g)},a)},i.deactivate=g=>{const v=g.component;c(g,d,null,1,a),jt(()=>{v.da&&Ao(v.da);const x=g.props&&g.props.onVnodeUnmounted;x&&Pn(x,v.parent,g),v.isDeactivated=!0},a)};function f(g){up(g),h(g,t,a)}function p(g){s.forEach((v,x)=>{const T=Zu(v.type);T&&(!g||!g(T))&&_(x)})}function _(g){const v=s.get(g);!o||v.type!==o.type?f(v):o&&up(o),s.delete(g),r.delete(g)}Fl(()=>[n.include,n.exclude],([g,v])=>{g&&p(x=>Sl(g,x)),v&&p(x=>!Sl(v,x))},{flush:"post",deep:!0});let y=null;const m=()=>{y!=null&&s.set(y,hp(t.subTree))};return El(m),zu(m),Vu(()=>{s.forEach(g=>{const{subTree:v,suspense:x}=t,T=hp(v);if(g.type===T.type){up(T);const S=T.component.da;S&&jt(S,x);return}f(g)})}),()=>{if(y=null,!e.default)return null;const g=e.default(),v=g[0];if(g.length>1)return o=null,g;if(!Us(v)||!(v.shapeFlag&4)&&!(v.shapeFlag&128))return o=null,v;let x=hp(v);const T=x.type,S=Zu(Tl(x)?x.type.__asyncResolved||{}:T),{include:b,exclude:M,max:N}=n;if(b&&(!S||!Sl(b,S))||M&&S&&Sl(M,S))return o=x,v;const P=x.key==null?T:x.key,L=s.get(P);return x.el&&(x=Bs(x),v.shapeFlag&128&&(v.ssContent=x)),y=P,L?(x.el=L.el,x.component=L.component,x.transition&&Or(x,x.transition),x.shapeFlag|=512,r.delete(P),r.add(P)):(r.add(P),N&&r.size>parseInt(N,10)&&_(r.values().next().value)),x.shapeFlag|=256,o=x,v}}},yI=_I;function Sl(n,e){return Te(n)?n.some(t=>Sl(t,e)):Ue(n)?n.split(",").indexOf(e)>-1:n.test?n.test(e):!1}function uv(n,e){dv(n,"a",e)}function hv(n,e){dv(n,"da",e)}function dv(n,e,t=Bt){const i=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Hu(e,i,t),t){let s=t.parent;for(;s&&s.parent;)wl(s.parent.vnode)&&vI(i,e,t,s),s=s.parent}}function vI(n,e,t,i){const s=Hu(e,n,i,!0);Gu(()=>{Ay(i[e],s)},t)}function up(n){let e=n.shapeFlag;e&256&&(e-=256),e&512&&(e-=512),n.shapeFlag=e}function hp(n){return n.shapeFlag&128?n.ssContent:n}function Hu(n,e,t=Bt,i=!1){if(t){const s=t[n]||(t[n]=[]),r=e.__weh||(e.__weh=(...o)=>{if(t.isUnmounted)return;Fr(),Vs(t);const a=Yn(e,t,n,o);return Gs(),Ds(),a});return i?s.unshift(r):s.push(r),r}}const rs=n=>(e,t=Bt)=>(!Cl||n==="sp")&&Hu(n,e,t),fv=rs("bm"),El=rs("m"),pv=rs("bu"),zu=rs("u"),Vu=rs("bum"),Gu=rs("um"),mv=rs("sp"),gv=rs("rtg"),_v=rs("rtc");function yv(n,e=Bt){Hu("ec",n,e)}let dp=!0;function xI(n){const e=bv(n),t=n.proxy,i=n.ctx;dp=!1,e.beforeCreate&&vv(e.beforeCreate,n,"bc");const{data:s,computed:r,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:u,mounted:d,beforeUpdate:f,updated:p,activated:_,deactivated:y,beforeDestroy:m,beforeUnmount:g,destroyed:v,unmounted:x,render:T,renderTracked:S,renderTriggered:b,errorCaptured:M,serverPrefetch:N,expose:P,inheritAttrs:L,components:V,directives:O,filters:H}=e;if(c&&bI(c,i,null,n.appContext.config.unwrapInjectedRef),o)for(const Y in o){const te=o[Y];Pe(te)&&(i[Y]=te.bind(t))}if(s){const Y=s.call(t,t);wt(Y)&&(n.data=Lu(Y))}if(dp=!0,r)for(const Y in r){const te=r[Y],me=Pe(te)?te.bind(t,t):Pe(te.get)?te.get.bind(t,t):Sn,we=!Pe(te)&&Pe(te.set)?te.set.bind(t):Sn,pe=tv({get:me,set:we});Object.defineProperty(i,Y,{enumerable:!0,configurable:!0,get:()=>pe.value,set:Se=>pe.value=Se})}if(a)for(const Y in a)xv(a[Y],i,t,Y);if(l){const Y=Pe(l)?l.call(t):l;Reflect.ownKeys(Y).forEach(te=>{av(te,Y[te])})}h&&vv(h,n,"c");function q(Y,te){Te(te)?te.forEach(me=>Y(me.bind(t))):te&&Y(te.bind(t))}if(q(fv,u),q(El,d),q(pv,f),q(zu,p),q(uv,_),q(hv,y),q(yv,M),q(_v,S),q(gv,b),q(Vu,g),q(Gu,x),q(mv,N),Te(P))if(P.length){const Y=n.exposed||(n.exposed={});P.forEach(te=>{Object.defineProperty(Y,te,{get:()=>t[te],set:me=>t[te]=me})})}else n.exposed||(n.exposed={});T&&n.render===Sn&&(n.render=T),L!=null&&(n.inheritAttrs=L),V&&(n.components=V),O&&(n.directives=O)}function bI(n,e,t=Sn,i=!1){Te(n)&&(n=fp(n));for(const s in n){const r=n[s];let o;wt(r)?"default"in r?o=bl(r.from||s,r.default,!0):o=bl(r.from||s):o=bl(r),ln(o)&&i?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):e[s]=o}}function vv(n,e,t){Yn(Te(n)?n.map(i=>i.bind(e.proxy)):n.bind(e.proxy),e,t)}function xv(n,e,t,i){const s=i.includes(".")?ox(t,i):()=>t[i];if(Ue(n)){const r=e[n];Pe(r)&&Fl(s,r)}else if(Pe(n))Fl(s,n.bind(t));else if(wt(n))if(Te(n))n.forEach(r=>xv(r,e,t,i));else{const r=Pe(n.handler)?n.handler.bind(t):e[n.handler];Pe(r)&&Fl(s,r,n)}}function bv(n){const e=n.type,{mixins:t,extends:i}=e,{mixins:s,optionsCache:r,config:{optionMergeStrategies:o}}=n.appContext,a=r.get(e);let l;return a?l=a:!s.length&&!t&&!i?l=e:(l={},s.length&&s.forEach(c=>Wu(l,c,o,!0)),Wu(l,e,o)),r.set(e,l),l}function Wu(n,e,t,i=!1){const{mixins:s,extends:r}=e;r&&Wu(n,r,t,!0),s&&s.forEach(o=>Wu(n,o,t,!0));for(const o in e)if(!(i&&o==="expose")){const a=TI[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const TI={data:Tv,props:kr,emits:kr,methods:kr,computed:kr,beforeCreate:En,created:En,beforeMount:En,mounted:En,beforeUpdate:En,updated:En,beforeDestroy:En,beforeUnmount:En,destroyed:En,unmounted:En,activated:En,deactivated:En,errorCaptured:En,serverPrefetch:En,components:kr,directives:kr,watch:SI,provide:Tv,inject:wI};function Tv(n,e){return e?n?function(){return tt(Pe(n)?n.call(this,this):n,Pe(e)?e.call(this,this):e)}:e:n}function wI(n,e){return kr(fp(n),fp(e))}function fp(n){if(Te(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function En(n,e){return n?[...new Set([].concat(n,e))]:e}function kr(n,e){return n?tt(tt(Object.create(null),n),e):e}function SI(n,e){if(!n)return e;if(!e)return n;const t=tt(Object.create(null),n);for(const i in e)t[i]=En(n[i],e[i]);return t}function EI(n,e,t,i=!1){const s={},r={};bu(r,$u,1),n.propsDefaults=Object.create(null),wv(n,e,s,r);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=i?s:Ky(s):n.type.props?n.props=s:n.props=r,n.attrs=r}function MI(n,e,t,i){const{props:s,attrs:r,vnode:{patchFlag:o}}=n,a=je(s),[l]=n.propsOptions;let c=!1;if((i||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let u=0;u<h.length;u++){let d=h[u];const f=e[d];if(l)if(Je(r,d))f!==r[d]&&(r[d]=f,c=!0);else{const p=pn(d);s[p]=pp(l,a,p,f,n,!1)}else f!==r[d]&&(r[d]=f,c=!0)}}}else{wv(n,e,s,r)&&(c=!0);let h;for(const u in a)(!e||!Je(e,u)&&((h=_i(u))===u||!Je(e,h)))&&(l?t&&(t[u]!==void 0||t[h]!==void 0)&&(s[u]=pp(l,a,u,void 0,n,!0)):delete s[u]);if(r!==a)for(const u in r)(!e||!Je(e,u))&&(delete r[u],c=!0)}c&&ss(n,"set","$attrs")}function wv(n,e,t,i){const[s,r]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Rr(l))continue;const c=e[l];let h;s&&Je(s,h=pn(l))?!r||!r.includes(h)?t[h]=c:(a||(a={}))[h]=c:tp(n.emitsOptions,l)||(!(l in i)||c!==i[l])&&(i[l]=c,o=!0)}if(r){const l=je(t),c=a||et;for(let h=0;h<r.length;h++){const u=r[h];t[u]=pp(s,l,u,c[u],n,!Je(c,u))}}return o}function pp(n,e,t,i,s,r){const o=n[t];if(o!=null){const a=Je(o,"default");if(a&&i===void 0){const l=o.default;if(o.type!==Function&&Pe(l)){const{propsDefaults:c}=s;t in c?i=c[t]:(Vs(s),i=c[t]=l.call(null,e),Gs())}else i=l}o[0]&&(r&&!a?i=!1:o[1]&&(i===""||i===_i(t))&&(i=!0))}return i}function Sv(n,e,t=!1){const i=e.propsCache,s=i.get(n);if(s)return s;const r=n.props,o={},a=[];let l=!1;if(!Pe(n)){const h=u=>{l=!0;const[d,f]=Sv(u,e,!0);tt(o,d),f&&a.push(...f)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!r&&!l)return i.set(n,wo),wo;if(Te(r))for(let h=0;h<r.length;h++){const u=pn(r[h]);Ev(u)&&(o[u]=et)}else if(r)for(const h in r){const u=pn(h);if(Ev(u)){const d=r[h],f=o[u]=Te(d)||Pe(d)?{type:d}:d;if(f){const p=Cv(Boolean,f.type),_=Cv(String,f.type);f[0]=p>-1,f[1]=_<0||p<_,(p>-1||Je(f,"default"))&&a.push(u)}}}const c=[o,a];return i.set(n,c),c}function Ev(n){return n[0]!=="$"}function Mv(n){const e=n&&n.toString().match(/^\s*function (\w+)/);return e?e[1]:n===null?"null":""}function Av(n,e){return Mv(n)===Mv(e)}function Cv(n,e){return Te(e)?e.findIndex(t=>Av(t,n)):Pe(e)&&Av(e,n)?0:-1}const Iv=n=>n[0]==="_"||n==="$stable",mp=n=>Te(n)?n.map(qn):[qn(n)],AI=(n,e,t)=>{const i=np((...s)=>mp(e(...s)),t);return i._c=!1,i},Rv=(n,e,t)=>{const i=n._ctx;for(const s in n){if(Iv(s))continue;const r=n[s];if(Pe(r))e[s]=AI(s,r,i);else if(r!=null){const o=mp(r);e[s]=()=>o}}},Lv=(n,e)=>{const t=mp(e);n.slots.default=()=>t},CI=(n,e)=>{if(n.vnode.shapeFlag&32){const t=e._;t?(n.slots=je(e),bu(e,"_",t)):Rv(e,n.slots={})}else n.slots={},e&&Lv(n,e);bu(n.slots,$u,1)},II=(n,e,t)=>{const{vnode:i,slots:s}=n;let r=!0,o=et;if(i.shapeFlag&32){const a=e._;a?t&&a===1?r=!1:(tt(s,e),!t&&a===1&&delete s._):(r=!e.$stable,Rv(e,s)),o=e}else e&&(Lv(n,e),o={default:1});if(r)for(const a in s)!Iv(a)&&!(a in o)&&delete s[a]};function RI(n,e){const t=Xn;if(t===null)return n;const i=t.proxy,s=n.dirs||(n.dirs=[]);for(let r=0;r<e.length;r++){let[o,a,l,c=et]=e[r];Pe(o)&&(o={mounted:o,updated:o}),o.deep&&Hr(a),s.push({dir:o,instance:i,value:a,oldValue:void 0,arg:l,modifiers:c})}return n}function Fi(n,e,t,i){const s=n.dirs,r=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];r&&(a.oldValue=r[o].value);let l=a.dir[i];l&&(Fr(),Yn(l,t,8,[n.el,a,n,e]),Ds())}}function Pv(){return{app:null,config:{isNativeTag:yu,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let LI=0;function PI(n,e){return function(i,s=null){s!=null&&!wt(s)&&(s=null);const r=Pv(),o=new Set;let a=!1;const l=r.app={_uid:LI++,_component:i,_props:s,_container:null,_context:r,_instance:null,version:hx,get config(){return r.config},set config(c){},use(c,...h){return o.has(c)||(c&&Pe(c.install)?(o.add(c),c.install(l,...h)):Pe(c)&&(o.add(c),c(l,...h))),l},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),l},component(c,h){return h?(r.components[c]=h,l):r.components[c]},directive(c,h){return h?(r.directives[c]=h,l):r.directives[c]},mount(c,h,u){if(!a){const d=mt(i,s);return d.appContext=r,h&&e?e(d,c):n(d,c,u),a=!0,l._container=c,c.__vue_app__=l,Rp(d.component)||d.component.proxy}},unmount(){a&&(n(null,l._container),delete l._container.__vue_app__)},provide(c,h){return r.provides[c]=h,l}};return l}}let ks=!1;const Xu=n=>/svg/.test(n.namespaceURI)&&n.tagName!=="foreignObject",gp=n=>n.nodeType===8;function NI(n){const{mt:e,p:t,o:{patchProp:i,nextSibling:s,parentNode:r,remove:o,insert:a,createComment:l}}=n,c=(y,m)=>{if(!m.hasChildNodes()){t(null,y,m),th();return}ks=!1,h(m.firstChild,y,null,null,null),th(),ks&&console.error("Hydration completed but contains mismatches.")},h=(y,m,g,v,x,T=!1)=>{const S=gp(y)&&y.data==="[",b=()=>p(y,m,g,v,x,S),{type:M,ref:N,shapeFlag:P}=m,L=y.nodeType;m.el=y;let V=null;switch(M){case Po:L!==3?V=b():(y.data!==m.children&&(ks=!0,y.data=m.children),V=s(y));break;case Mn:L!==8||S?V=b():V=s(y);break;case Ur:if(L!==1)V=b();else{V=y;const O=!m.children.length;for(let H=0;H<m.staticCount;H++)O&&(m.children+=V.outerHTML),H===m.staticCount-1&&(m.anchor=V),V=s(V);return V}break;case cn:S?V=f(y,m,g,v,x,T):V=b();break;default:if(P&1)L!==1||m.type.toLowerCase()!==y.tagName.toLowerCase()?V=b():V=u(y,m,g,v,x,T);else if(P&6){m.slotScopeIds=x;const O=r(y);if(e(m,O,null,g,v,Xu(O),T),V=S?_(y):s(y),Tl(m)){let H;S?(H=mt(cn),H.anchor=V?V.previousSibling:O.lastChild):H=y.nodeType===3?Sp(""):mt("div"),H.el=y,m.component.subTree=H}}else P&64?L!==8?V=b():V=m.type.hydrate(y,m,g,v,x,T,n,d):P&128&&(V=m.type.hydrate(y,m,g,v,Xu(r(y)),x,T,n,h))}return N!=null&&qu(N,null,v,m),V},u=(y,m,g,v,x,T)=>{T=T||!!m.dynamicChildren;const{type:S,props:b,patchFlag:M,shapeFlag:N,dirs:P}=m,L=S==="input"&&P||S==="option";if(L||M!==-1){if(P&&Fi(m,null,g,"created"),b)if(L||!T||M&(16|32))for(const O in b)(L&&O.endsWith("value")||Cr(O)&&!Rr(O))&&i(y,O,null,b[O],!1,void 0,g);else b.onClick&&i(y,"onClick",null,b.onClick,!1,void 0,g);let V;if((V=b&&b.onVnodeBeforeMount)&&Pn(V,g,m),P&&Fi(m,null,g,"beforeMount"),((V=b&&b.onVnodeMounted)||P)&&ov(()=>{V&&Pn(V,g,m),P&&Fi(m,null,g,"mounted")},v),N&16&&!(b&&(b.innerHTML||b.textContent))){let O=d(y.firstChild,m,y,g,v,x,T);for(;O;){ks=!0;const H=O;O=O.nextSibling,o(H)}}else N&8&&y.textContent!==m.children&&(ks=!0,y.textContent=m.children)}return y.nextSibling},d=(y,m,g,v,x,T,S)=>{S=S||!!m.dynamicChildren;const b=m.children,M=b.length;for(let N=0;N<M;N++){const P=S?b[N]:b[N]=qn(b[N]);if(y)y=h(y,P,v,x,T,S);else{if(P.type===Po&&!P.children)continue;ks=!0,t(null,P,g,null,v,x,Xu(g),T)}}return y},f=(y,m,g,v,x,T)=>{const{slotScopeIds:S}=m;S&&(x=x?x.concat(S):S);const b=r(y),M=d(s(y),m,b,g,v,x,T);return M&&gp(M)&&M.data==="]"?s(m.anchor=M):(ks=!0,a(m.anchor=l("]"),b,M),M)},p=(y,m,g,v,x,T)=>{if(ks=!0,m.el=null,T){const M=_(y);for(;;){const N=s(y);if(N&&N!==M)o(N);else break}}const S=s(y),b=r(y);return o(y),t(null,m,b,S,g,v,Xu(b),x),S},_=y=>{let m=0;for(;y;)if(y=s(y),y&&gp(y)&&(y.data==="["&&m++,y.data==="]")){if(m===0)return s(y);m--}return y};return[c,h]}const jt=ov;function Nv(n){return Dv(n)}function Fv(n){return Dv(n,NI)}function Dv(n,e){const t=hC();t.__VUE__=!0;const{insert:i,remove:s,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:u,nextSibling:d,setScopeId:f=Sn,cloneNode:p,insertStaticContent:_}=n,y=(A,R,B,z=null,E=null,w=null,k=!1,U=null,X=!!R.dynamicChildren)=>{if(A===R)return;A&&!Oi(A,R)&&(z=Me(A),ne(A,E,w,!0),A=null),R.patchFlag===-2&&(X=!1,R.dynamicChildren=null);const{type:W,ref:re,shapeFlag:ee}=R;switch(W){case Po:m(A,R,B,z);break;case Mn:g(A,R,B,z);break;case Ur:A==null&&v(R,B,z,k);break;case cn:O(A,R,B,z,E,w,k,U,X);break;default:ee&1?S(A,R,B,z,E,w,k,U,X):ee&6?H(A,R,B,z,E,w,k,U,X):(ee&64||ee&128)&&W.process(A,R,B,z,E,w,k,U,X,_e)}re!=null&&E&&qu(re,A&&A.ref,w,R||A,!R)},m=(A,R,B,z)=>{if(A==null)i(R.el=a(R.children),B,z);else{const E=R.el=A.el;R.children!==A.children&&c(E,R.children)}},g=(A,R,B,z)=>{A==null?i(R.el=l(R.children||""),B,z):R.el=A.el},v=(A,R,B,z)=>{[A.el,A.anchor]=_(A.children,R,B,z)},x=({el:A,anchor:R},B,z)=>{let E;for(;A&&A!==R;)E=d(A),i(A,B,z),A=E;i(R,B,z)},T=({el:A,anchor:R})=>{let B;for(;A&&A!==R;)B=d(A),s(A),A=B;s(R)},S=(A,R,B,z,E,w,k,U,X)=>{k=k||R.type==="svg",A==null?b(R,B,z,E,w,k,U,X):P(A,R,E,w,k,U,X)},b=(A,R,B,z,E,w,k,U)=>{let X,W;const{type:re,props:ee,shapeFlag:oe,transition:se,patchFlag:D,dirs:ae}=A;if(A.el&&p!==void 0&&D===-1)X=A.el=p(A.el);else{if(X=A.el=o(A.type,w,ee&&ee.is,ee),oe&8?h(X,A.children):oe&16&&N(A.children,X,null,z,E,w&&re!=="foreignObject",k,U),ae&&Fi(A,null,z,"created"),ee){for(const le in ee)le!=="value"&&!Rr(le)&&r(X,le,null,ee[le],w,A.children,z,E,xe);"value"in ee&&r(X,"value",null,ee.value),(W=ee.onVnodeBeforeMount)&&Pn(W,z,A)}M(X,A,A.scopeId,k,z)}ae&&Fi(A,null,z,"beforeMount");const K=(!E||E&&!E.pendingBranch)&&se&&!se.persisted;K&&se.beforeEnter(X),i(X,R,B),((W=ee&&ee.onVnodeMounted)||K||ae)&&jt(()=>{W&&Pn(W,z,A),K&&se.enter(X),ae&&Fi(A,null,z,"mounted")},E)},M=(A,R,B,z,E)=>{if(B&&f(A,B),z)for(let w=0;w<z.length;w++)f(A,z[w]);if(E){let w=E.subTree;if(R===w){const k=E.vnode;M(A,k,k.scopeId,k.slotScopeIds,E.parent)}}},N=(A,R,B,z,E,w,k,U,X=0)=>{for(let W=X;W<A.length;W++){const re=A[W]=U?Hs(A[W]):qn(A[W]);y(null,re,R,B,z,E,w,k,U)}},P=(A,R,B,z,E,w,k)=>{const U=R.el=A.el;let{patchFlag:X,dynamicChildren:W,dirs:re}=R;X|=A.patchFlag&16;const ee=A.props||et,oe=R.props||et;let se;(se=oe.onVnodeBeforeUpdate)&&Pn(se,B,R,A),re&&Fi(R,A,B,"beforeUpdate");const D=E&&R.type!=="foreignObject";if(W?L(A.dynamicChildren,W,U,B,z,D,w):k||me(A,R,U,null,B,z,D,w,!1),X>0){if(X&16)V(U,R,ee,oe,B,z,E);else if(X&2&&ee.class!==oe.class&&r(U,"class",null,oe.class,E),X&4&&r(U,"style",ee.style,oe.style,E),X&8){const ae=R.dynamicProps;for(let K=0;K<ae.length;K++){const le=ae[K],F=ee[le],ue=oe[le];(ue!==F||le==="value")&&r(U,le,F,ue,E,A.children,B,z,xe)}}X&1&&A.children!==R.children&&h(U,R.children)}else!k&&W==null&&V(U,R,ee,oe,B,z,E);((se=oe.onVnodeUpdated)||re)&&jt(()=>{se&&Pn(se,B,R,A),re&&Fi(R,A,B,"updated")},z)},L=(A,R,B,z,E,w,k)=>{for(let U=0;U<R.length;U++){const X=A[U],W=R[U],re=X.el&&(X.type===cn||!Oi(X,W)||X.shapeFlag&(6|64))?u(X.el):B;y(X,W,re,null,z,E,w,k,!0)}},V=(A,R,B,z,E,w,k)=>{if(B!==z){for(const U in z){if(Rr(U))continue;const X=z[U],W=B[U];X!==W&&U!=="value"&&r(A,U,W,X,k,R.children,E,w,xe)}if(B!==et)for(const U in B)!Rr(U)&&!(U in z)&&r(A,U,B[U],null,k,R.children,E,w,xe);"value"in z&&r(A,"value",B.value,z.value)}},O=(A,R,B,z,E,w,k,U,X)=>{const W=R.el=A?A.el:a(""),re=R.anchor=A?A.anchor:a("");let{patchFlag:ee,dynamicChildren:oe,slotScopeIds:se}=R;se&&(U=U?U.concat(se):se),A==null?(i(W,B,z),i(re,B,z),N(R.children,B,re,E,w,k,U,X)):ee>0&&ee&64&&oe&&A.dynamicChildren?(L(A.dynamicChildren,oe,B,E,w,k,U),(R.key!=null||E&&R===E.subTree)&&_p(A,R,!0)):me(A,R,B,re,E,w,k,U,X)},H=(A,R,B,z,E,w,k,U,X)=>{R.slotScopeIds=U,A==null?R.shapeFlag&512?E.ctx.activate(R,B,z,k,X):Q(R,B,z,E,w,k,X):q(A,R,X)},Q=(A,R,B,z,E,w,k)=>{const U=A.component=Xv(A,z,E);if(wl(A)&&(U.ctx.renderer=_e),Yv(U),U.asyncDep){if(E&&E.registerDep(U,Y),!A.el){const X=U.subTree=mt(Mn);g(null,X,R,B)}return}Y(U,A,R,B,E,w,k)},q=(A,R,B)=>{const z=R.component=A.component;if(aI(A,R,B))if(z.asyncDep&&!z.asyncResolved){te(z,R,B);return}else z.next=R,fR(z.update),z.update();else R.component=A.component,R.el=A.el,z.vnode=R},Y=(A,R,B,z,E,w,k)=>{const U=()=>{if(A.isMounted){let{next:re,bu:ee,u:oe,parent:se,vnode:D}=A,ae=re,K;X.allowRecurse=!1,re?(re.el=D.el,te(A,re,k)):re=D,ee&&Ao(ee),(K=re.props&&re.props.onVnodeBeforeUpdate)&&Pn(K,se,re,D),X.allowRecurse=!0;const le=Uu(A),F=A.subTree;A.subTree=le,y(F,le,u(F.el),Me(F),A,E,w),re.el=le.el,ae===null&&ip(A,le.el),oe&&jt(oe,E),(K=re.props&&re.props.onVnodeUpdated)&&jt(()=>Pn(K,se,re,D),E)}else{let re;const{el:ee,props:oe}=R,{bm:se,m:D,parent:ae}=A,K=Tl(R);if(X.allowRecurse=!1,se&&Ao(se),!K&&(re=oe&&oe.onVnodeBeforeMount)&&Pn(re,ae,R),X.allowRecurse=!0,ee&&Z){const le=()=>{A.subTree=Uu(A),Z(ee,A.subTree,A,E,null)};K?R.type.__asyncLoader().then(()=>!A.isUnmounted&&le()):le()}else{const le=A.subTree=Uu(A);y(null,le,B,z,A,E,w),R.el=le.el}if(D&&jt(D,E),!K&&(re=oe&&oe.onVnodeMounted)){const le=R;jt(()=>Pn(re,ae,le),E)}R.shapeFlag&256&&A.a&&jt(A.a,E),A.isMounted=!0,R=B=z=null}},X=new _l(U,()=>Dp(A.update),A.scope),W=A.update=X.run.bind(X);W.id=A.uid,X.allowRecurse=W.allowRecurse=!0,W()},te=(A,R,B)=>{R.component=A;const z=A.vnode.props;A.vnode=R,A.next=null,MI(A,R.props,z,B),II(A,R.children,B),Fr(),kp(void 0,A.update),Ds()},me=(A,R,B,z,E,w,k,U,X=!1)=>{const W=A&&A.children,re=A?A.shapeFlag:0,ee=R.children,{patchFlag:oe,shapeFlag:se}=R;if(oe>0){if(oe&128){pe(W,ee,B,z,E,w,k,U,X);return}else if(oe&256){we(W,ee,B,z,E,w,k,U,X);return}}se&8?(re&16&&xe(W,E,w),ee!==W&&h(B,ee)):re&16?se&16?pe(W,ee,B,z,E,w,k,U,X):xe(W,E,w,!0):(re&8&&h(B,""),se&16&&N(ee,B,z,E,w,k,U,X))},we=(A,R,B,z,E,w,k,U,X)=>{A=A||wo,R=R||wo;const W=A.length,re=R.length,ee=Math.min(W,re);let oe;for(oe=0;oe<ee;oe++){const se=R[oe]=X?Hs(R[oe]):qn(R[oe]);y(A[oe],se,B,null,E,w,k,U,X)}W>re?xe(A,E,w,!0,!1,ee):N(R,B,z,E,w,k,U,X,ee)},pe=(A,R,B,z,E,w,k,U,X)=>{let W=0;const re=R.length;let ee=A.length-1,oe=re-1;for(;W<=ee&&W<=oe;){const se=A[W],D=R[W]=X?Hs(R[W]):qn(R[W]);if(Oi(se,D))y(se,D,B,null,E,w,k,U,X);else break;W++}for(;W<=ee&&W<=oe;){const se=A[ee],D=R[oe]=X?Hs(R[oe]):qn(R[oe]);if(Oi(se,D))y(se,D,B,null,E,w,k,U,X);else break;ee--,oe--}if(W>ee){if(W<=oe){const se=oe+1,D=se<re?R[se].el:z;for(;W<=oe;)y(null,R[W]=X?Hs(R[W]):qn(R[W]),B,D,E,w,k,U,X),W++}}else if(W>oe)for(;W<=ee;)ne(A[W],E,w,!0),W++;else{const se=W,D=W,ae=new Map;for(W=D;W<=oe;W++){const De=R[W]=X?Hs(R[W]):qn(R[W]);De.key!=null&&ae.set(De.key,W)}let K,le=0;const F=oe-D+1;let ue=!1,He=0;const ke=new Array(F);for(W=0;W<F;W++)ke[W]=0;for(W=se;W<=ee;W++){const De=A[W];if(le>=F){ne(De,E,w,!0);continue}let pt;if(De.key!=null)pt=ae.get(De.key);else for(K=D;K<=oe;K++)if(ke[K-D]===0&&Oi(De,R[K])){pt=K;break}pt===void 0?ne(De,E,w,!0):(ke[pt-D]=W+1,pt>=He?He=pt:ue=!0,y(De,R[pt],B,null,E,w,k,U,X),le++)}const Tt=ue?FI(ke):wo;for(K=Tt.length-1,W=F-1;W>=0;W--){const De=D+W,pt=R[De],wn=De+1<re?R[De+1].el:z;ke[W]===0?y(null,pt,B,wn,E,w,k,U,X):ue&&(K<0||W!==Tt[K]?Se(pt,B,wn,2):K--)}}},Se=(A,R,B,z,E=null)=>{const{el:w,type:k,transition:U,children:X,shapeFlag:W}=A;if(W&6){Se(A.component.subTree,R,B,z);return}if(W&128){A.suspense.move(R,B,z);return}if(W&64){k.move(A,R,B,_e);return}if(k===cn){i(w,R,B);for(let ee=0;ee<X.length;ee++)Se(X[ee],R,B,z);i(A.anchor,R,B);return}if(k===Ur){x(A,R,B);return}if(z!==2&&W&1&&U)if(z===0)U.beforeEnter(w),i(w,R,B),jt(()=>U.enter(w),E);else{const{leave:ee,delayLeave:oe,afterLeave:se}=U,D=()=>i(w,R,B),ae=()=>{ee(w,()=>{D(),se&&se()})};oe?oe(w,D,ae):ae()}else i(w,R,B)},ne=(A,R,B,z=!1,E=!1)=>{const{type:w,props:k,ref:U,children:X,dynamicChildren:W,shapeFlag:re,patchFlag:ee,dirs:oe}=A;if(U!=null&&qu(U,null,B,A,!0),re&256){R.ctx.deactivate(A);return}const se=re&1&&oe,D=!Tl(A);let ae;if(D&&(ae=k&&k.onVnodeBeforeUnmount)&&Pn(ae,R,A),re&6)$(A.component,B,z);else{if(re&128){A.suspense.unmount(B,z);return}se&&Fi(A,null,R,"beforeUnmount"),re&64?A.type.remove(A,R,B,E,_e,z):W&&(w!==cn||ee>0&&ee&64)?xe(W,R,B,!1,!0):(w===cn&&ee&(128|256)||!E&&re&16)&&xe(X,R,B),z&&he(A)}(D&&(ae=k&&k.onVnodeUnmounted)||se)&&jt(()=>{ae&&Pn(ae,R,A),se&&Fi(A,null,R,"unmounted")},B)},he=A=>{const{type:R,el:B,anchor:z,transition:E}=A;if(R===cn){ve(B,z);return}if(R===Ur){T(A);return}const w=()=>{s(B),E&&!E.persisted&&E.afterLeave&&E.afterLeave()};if(A.shapeFlag&1&&E&&!E.persisted){const{leave:k,delayLeave:U}=E,X=()=>k(B,w);U?U(A.el,w,X):X()}else w()},ve=(A,R)=>{let B;for(;A!==R;)B=d(A),s(A),A=B;s(R)},$=(A,R,B)=>{const{bum:z,scope:E,update:w,subTree:k,um:U}=A;z&&Ao(z),E.stop(),w&&(w.active=!1,ne(k,A,R,B)),U&&jt(U,R),jt(()=>{A.isUnmounted=!0},R),R&&R.pendingBranch&&!R.isUnmounted&&A.asyncDep&&!A.asyncResolved&&A.suspenseId===R.pendingId&&(R.deps--,R.deps===0&&R.resolve())},xe=(A,R,B,z=!1,E=!1,w=0)=>{for(let k=w;k<A.length;k++)ne(A[k],R,B,z,E)},Me=A=>A.shapeFlag&6?Me(A.component.subTree):A.shapeFlag&128?A.suspense.next():d(A.anchor||A.el),ye=(A,R,B)=>{A==null?R._vnode&&ne(R._vnode,null,null,!0):y(R._vnode||null,A,R,null,null,null,B),th(),R._vnode=A},_e={p:y,um:ne,m:Se,r:he,mt:Q,mc:N,pc:me,pbc:L,n:Me,o:n};let Ie,Z;return e&&([Ie,Z]=e(_e)),{render:ye,hydrate:Ie,createApp:PI(ye,Ie)}}function qu(n,e,t,i,s=!1){if(Te(n)){n.forEach((d,f)=>qu(d,e&&(Te(e)?e[f]:e),t,i,s));return}if(Tl(i)&&!s)return;const r=i.shapeFlag&4?Rp(i.component)||i.component.proxy:i.el,o=s?null:r,{i:a,r:l}=n,c=e&&e.r,h=a.refs===et?a.refs={}:a.refs,u=a.setupState;if(c!=null&&c!==l&&(Ue(c)?(h[c]=null,Je(u,c)&&(u[c]=null)):ln(c)&&(c.value=null)),Ue(l)){const d=()=>{h[l]=o,Je(u,l)&&(u[l]=o)};o?(d.id=-1,jt(d,t)):d()}else if(ln(l)){const d=()=>{l.value=o};o?(d.id=-1,jt(d,t)):d()}else Pe(l)&&ki(l,a,12,[o,h])}function Pn(n,e,t,i=null){Yn(n,e,7,[t,i])}function _p(n,e,t=!1){const i=n.children,s=e.children;if(Te(i)&&Te(s))for(let r=0;r<i.length;r++){const o=i[r];let a=s[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[r]=Hs(s[r]),a.el=o.el),t||_p(o,a))}}function FI(n){const e=n.slice(),t=[0];let i,s,r,o,a;const l=n.length;for(i=0;i<l;i++){const c=n[i];if(c!==0){if(s=t[t.length-1],n[s]<c){e[i]=s,t.push(i);continue}for(r=0,o=t.length-1;r<o;)a=r+o>>1,n[t[a]]<c?r=a+1:o=a;c<n[t[r]]&&(r>0&&(e[i]=t[r-1]),t[r]=i)}}for(r=t.length,o=t[r-1];r-- >0;)t[r]=o,o=e[o];return t}const DI=n=>n.__isTeleport,Ml=n=>n&&(n.disabled||n.disabled===""),Ov=n=>typeof SVGElement!="undefined"&&n instanceof SVGElement,yp=(n,e)=>{const t=n&&n.to;return Ue(t)?e?e(t):null:t},OI={__isTeleport:!0,process(n,e,t,i,s,r,o,a,l,c){const{mc:h,pc:u,pbc:d,o:{insert:f,querySelector:p,createText:_,createComment:y}}=c,m=Ml(e.props);let{shapeFlag:g,children:v,dynamicChildren:x}=e;if(n==null){const T=e.el=_(""),S=e.anchor=_("");f(T,t,i),f(S,t,i);const b=e.target=yp(e.props,p),M=e.targetAnchor=_("");b&&(f(M,b),o=o||Ov(b));const N=(P,L)=>{g&16&&h(v,P,L,s,r,o,a,l)};m?N(t,S):b&&N(b,M)}else{e.el=n.el;const T=e.anchor=n.anchor,S=e.target=n.target,b=e.targetAnchor=n.targetAnchor,M=Ml(n.props),N=M?t:S,P=M?T:b;if(o=o||Ov(S),x?(d(n.dynamicChildren,x,N,s,r,o,a),_p(n,e,!0)):l||u(n,e,N,P,s,r,o,a,!1),m)M||Yu(e,t,T,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const L=e.target=yp(e.props,p);L&&Yu(e,L,null,c,0)}else M&&Yu(e,S,b,c,1)}},remove(n,e,t,i,{um:s,o:{remove:r}},o){const{shapeFlag:a,children:l,anchor:c,targetAnchor:h,target:u,props:d}=n;if(u&&r(h),(o||!Ml(d))&&(r(c),a&16))for(let f=0;f<l.length;f++){const p=l[f];s(p,e,t,!0,!!p.dynamicChildren)}},move:Yu,hydrate:kI};function Yu(n,e,t,{o:{insert:i},m:s},r=2){r===0&&i(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,u=r===2;if(u&&i(o,e,t),(!u||Ml(h))&&l&16)for(let d=0;d<c.length;d++)s(c[d],e,t,2);u&&i(a,e,t)}function kI(n,e,t,i,s,r,{o:{nextSibling:o,parentNode:a,querySelector:l}},c){const h=e.target=yp(e.props,l);if(h){const u=h._lpa||h.firstChild;e.shapeFlag&16&&(Ml(e.props)?(e.anchor=c(o(n),e,a(n),t,i,s,r),e.targetAnchor=u):(e.anchor=o(n),e.targetAnchor=c(u,e,h,t,i,s,r)),h._lpa=e.targetAnchor&&o(e.targetAnchor))}return e.anchor&&o(e.anchor)}const UI=OI,vp="components",BI="directives";function HI(n,e){return xp(vp,n,!0,e)||n}const kv=Symbol();function zI(n){return Ue(n)?xp(vp,n,!1)||n:n||kv}function VI(n){return xp(BI,n)}function xp(n,e,t=!0,i=!1){const s=Xn||Bt;if(s){const r=s.type;if(n===vp){const a=Zu(r);if(a&&(a===e||a===pn(e)||a===Lr(pn(e))))return r}const o=Uv(s[n]||r[n],e)||Uv(s.appContext[n],e);return!o&&i?r:o}}function Uv(n,e){return n&&(n[e]||n[pn(e)]||n[Lr(pn(e))])}const cn=Symbol(void 0),Po=Symbol(void 0),Mn=Symbol(void 0),Ur=Symbol(void 0),Al=[];let Di=null;function ju(n=!1){Al.push(Di=n?null:[])}function Bv(){Al.pop(),Di=Al[Al.length-1]||null}let No=1;function bp(n){No+=n}function Hv(n){return n.dynamicChildren=No>0?Di||wo:null,Bv(),No>0&&Di&&Di.push(n),n}function GI(n,e,t,i,s,r){return Hv(wp(n,e,t,i,s,r,!0))}function Tp(n,e,t,i,s){return Hv(mt(n,e,t,i,s,!0))}function Us(n){return n?n.__v_isVNode===!0:!1}function Oi(n,e){return n.type===e.type&&n.key===e.key}function WI(n){}const $u="__vInternal",zv=({key:n})=>n!=null?n:null,Qu=({ref:n})=>n!=null?Ue(n)||ln(n)||Pe(n)?{i:Xn,r:n}:n:null;function wp(n,e=null,t=null,i=0,s=null,r=n===cn?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&zv(e),ref:e&&Qu(e),scopeId:ku,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:i,dynamicProps:s,dynamicChildren:null,appContext:null};return a?(Ep(l,t),r&128&&n.normalize(l)):t&&(l.shapeFlag|=Ue(t)?8:16),No>0&&!o&&Di&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&Di.push(l),l}const mt=XI;function XI(n,e=null,t=null,i=0,s=null,r=!1){if((!n||n===kv)&&(n=Mn),Us(n)){const a=Bs(n,e,!0);return t&&Ep(a,t),a}if(oR(n)&&(n=n.__vccOpts),e){e=Vv(e);let{class:a,style:l}=e;a&&!Ue(a)&&(e.class=fl(a)),wt(l)&&(Qf(l)&&!Te(l)&&(l=tt({},l)),e.style=dl(l))}const o=Ue(n)?1:lI(n)?128:DI(n)?64:wt(n)?4:Pe(n)?2:0;return wp(n,e,t,i,s,o,r,!0)}function Vv(n){return n?Qf(n)||$u in n?tt({},n):n:null}function Bs(n,e,t=!1){const{props:i,ref:s,patchFlag:r,children:o}=n,a=e?Gv(i||{},e):i;return{__v_isVNode:!0,__v_skip:!0,type:n.type,props:a,key:a&&zv(a),ref:e&&e.ref?t&&s?Te(s)?s.concat(Qu(e)):[s,Qu(e)]:Qu(e):s,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:o,target:n.target,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==cn?r===-1?16:r|16:r,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:n.transition,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Bs(n.ssContent),ssFallback:n.ssFallback&&Bs(n.ssFallback),el:n.el,anchor:n.anchor}}function Sp(n=" ",e=0){return mt(Po,null,n,e)}function qI(n,e){const t=mt(Ur,null,n);return t.staticCount=e,t}function YI(n="",e=!1){return e?(ju(),Tp(Mn,null,n)):mt(Mn,null,n)}function qn(n){return n==null||typeof n=="boolean"?mt(Mn):Te(n)?mt(cn,null,n.slice()):typeof n=="object"?Hs(n):mt(Po,null,String(n))}function Hs(n){return n.el===null||n.memo?n:Bs(n)}function Ep(n,e){let t=0;const{shapeFlag:i}=n;if(e==null)e=null;else if(Te(e))t=16;else if(typeof e=="object")if(i&(1|64)){const s=e.default;s&&(s._c&&(s._d=!1),Ep(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!($u in e)?e._ctx=Xn:s===3&&Xn&&(Xn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Pe(e)?(e={default:e,_ctx:Xn},t=32):(e=String(e),i&64?(t=16,e=[Sp(e)]):t=8);n.children=e,n.shapeFlag|=t}function Gv(...n){const e={};for(let t=0;t<n.length;t++){const i=n[t];for(const s in i)if(s==="class")e.class!==i.class&&(e.class=fl([e.class,i.class]));else if(s==="style")e.style=dl([e.style,i.style]);else if(Cr(s)){const r=e[s],o=i[s];r!==o&&!(Te(r)&&r.includes(o))&&(e[s]=r?[].concat(r,o):o)}else s!==""&&(e[s]=i[s])}return e}function jI(n,e,t,i){let s;const r=t&&t[i];if(Te(n)||Ue(n)){s=new Array(n.length);for(let o=0,a=n.length;o<a;o++)s[o]=e(n[o],o,void 0,r&&r[o])}else if(typeof n=="number"){s=new Array(n);for(let o=0;o<n;o++)s[o]=e(o+1,o,void 0,r&&r[o])}else if(wt(n))if(n[Symbol.iterator])s=Array.from(n,(o,a)=>e(o,a,void 0,r&&r[a]));else{const o=Object.keys(n);s=new Array(o.length);for(let a=0,l=o.length;a<l;a++){const c=o[a];s[a]=e(n[c],c,a,r&&r[a])}}else s=[];return t&&(t[i]=s),s}function $I(n,e){for(let t=0;t<e.length;t++){const i=e[t];if(Te(i))for(let s=0;s<i.length;s++)n[i[s].name]=i[s].fn;else i&&(n[i.name]=i.fn)}return n}function QI(n,e,t={},i,s){if(Xn.isCE)return mt("slot",e==="default"?null:{name:e},i&&i());let r=n[e];r&&r._c&&(r._d=!1),ju();const o=r&&Wv(r(t)),a=Tp(cn,{key:t.key||`_${e}`},o||(i?i():[]),o&&n._===1?64:-2);return!s&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}function Wv(n){return n.some(e=>Us(e)?!(e.type===Mn||e.type===cn&&!Wv(e.children)):!0)?n:null}function KI(n){const e={};for(const t in n)e[Mo(t)]=n[t];return e}const Mp=n=>n?qv(n)?Rp(n)||n.proxy:Mp(n.parent):null,Ku=tt(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Mp(n.parent),$root:n=>Mp(n.root),$emit:n=>n.emit,$options:n=>bv(n),$forceUpdate:n=>()=>Dp(n.update),$nextTick:n=>Fp.bind(n.proxy),$watch:n=>_R.bind(n)}),Ap={get({_:n},e){const{ctx:t,setupState:i,data:s,props:r,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const f=o[e];if(f!==void 0)switch(f){case 1:return i[e];case 2:return s[e];case 4:return t[e];case 3:return r[e]}else{if(i!==et&&Je(i,e))return o[e]=1,i[e];if(s!==et&&Je(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&Je(c,e))return o[e]=3,r[e];if(t!==et&&Je(t,e))return o[e]=4,t[e];dp&&(o[e]=0)}}const h=Ku[e];let u,d;if(h)return e==="$attrs"&&Wn(n,"get",e),h(n);if((u=a.__cssModules)&&(u=u[e]))return u;if(t!==et&&Je(t,e))return o[e]=4,t[e];if(d=l.config.globalProperties,Je(d,e))return d[e]},set({_:n},e,t){const{data:i,setupState:s,ctx:r}=n;if(s!==et&&Je(s,e))s[e]=t;else if(i!==et&&Je(i,e))i[e]=t;else if(Je(n.props,e))return!1;return e[0]==="$"&&e.slice(1)in n?!1:(r[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:i,appContext:s,propsOptions:r}},o){let a;return!!t[o]||n!==et&&Je(n,o)||e!==et&&Je(e,o)||(a=r[0])&&Je(a,o)||Je(i,o)||Je(Ku,o)||Je(s.config.globalProperties,o)}},JI=tt({},Ap,{get(n,e){if(e!==Symbol.unscopables)return Ap.get(n,e,n)},has(n,e){return e[0]!=="_"&&!qA(e)}}),ZI=Pv();let eR=0;function Xv(n,e,t){const i=n.type,s=(e?e.appContext:n.appContext)||ZI,r={uid:eR++,vnode:n,type:i,parent:e,appContext:s,root:null,next:null,subTree:null,update:null,scope:new zf(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Sv(i,s),emitsOptions:iv(i,s),emit:null,emitted:null,propsDefaults:et,inheritAttrs:i.inheritAttrs,ctx:et,data:et,props:et,attrs:et,slots:et,refs:et,setupState:et,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=eI.bind(null,r),n.ce&&n.ce(r),r}let Bt=null;const zs=()=>Bt||Xn,Vs=n=>{Bt=n,n.scope.on()},Gs=()=>{Bt&&Bt.scope.off(),Bt=null};function qv(n){return n.vnode.shapeFlag&4}let Cl=!1;function Yv(n,e=!1){Cl=e;const{props:t,children:i}=n.vnode,s=qv(n);EI(n,t,s,e),CI(n,i);const r=s?tR(n,e):void 0;return Cl=!1,r}function tR(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=Kf(new Proxy(n.ctx,Ap));const{setup:i}=t;if(i){const s=n.setupContext=i.length>1?Qv(n):null;Vs(n),Fr();const r=ki(i,n,0,[n.props,s]);if(Ds(),Gs(),Bf(r)){if(r.then(Gs,Gs),e)return r.then(o=>{Cp(n,o,e)}).catch(o=>{Br(o,n,0)});n.asyncDep=r}else Cp(n,r,e)}else $v(n,e)}function Cp(n,e,t){Pe(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:wt(e)&&(n.setupState=ep(e)),$v(n,t)}let Ju,Ip;function jv(n){Ju=n,Ip=e=>{e.render._rc&&(e.withProxy=new Proxy(e.ctx,JI))}}const nR=()=>!Ju;function $v(n,e,t){const i=n.type;if(!n.render){if(!e&&Ju&&!i.render){const s=i.template;if(s){const{isCustomElement:r,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=i,c=tt(tt({isCustomElement:r,delimiters:a},o),l);i.render=Ju(s,c)}}n.render=i.render||Sn,Ip&&Ip(n)}Vs(n),Fr(),xI(n),Ds(),Gs()}function iR(n){return new Proxy(n.attrs,{get(e,t){return Wn(n,"get","$attrs"),e[t]}})}function Qv(n){const e=i=>{n.exposed=i||{}};let t;return{get attrs(){return t||(t=iR(n))},slots:n.slots,emit:n.emit,expose:e}}function Rp(n){if(n.exposed)return n.exposeProxy||(n.exposeProxy=new Proxy(ep(Kf(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Ku)return Ku[t](n)}}))}const sR=/(?:^|[-_])(\w)/g,rR=n=>n.replace(sR,e=>e.toUpperCase()).replace(/[-_]/g,"");function Zu(n){return Pe(n)&&n.displayName||n.name}function Kv(n,e,t=!1){let i=Zu(e);if(!i&&e.__file){const s=e.__file.match(/([^/\\]+)\.\w+$/);s&&(i=s[1])}if(!i&&n&&n.parent){const s=r=>{for(const o in r)if(r[o]===e)return o};i=s(n.components||n.parent.type.components)||s(n.appContext.components)}return i?rR(i):t?"App":"Anonymous"}function oR(n){return Pe(n)&&"__vccOpts"in n}const Il=[];function Jv(n,...e){Fr();const t=Il.length?Il[Il.length-1].component:null,i=t&&t.appContext.config.warnHandler,s=aR();if(i)ki(i,t,11,[n+e.join(""),t&&t.proxy,s.map(({vnode:r})=>`at <${Kv(t,r.type)}>`).join(`
`),s]);else{const r=[`[Vue warn]: ${n}`,...e];s.length&&r.push(`
`,...lR(s)),console.warn(...r)}Ds()}function aR(){let n=Il[Il.length-1];if(!n)return[];const e=[];for(;n;){const t=e[0];t&&t.vnode===n?t.recurseCount++:e.push({vnode:n,recurseCount:0});const i=n.component&&n.component.parent;n=i&&i.vnode}return e}function lR(n){const e=[];return n.forEach((t,i)=>{e.push(...i===0?[]:[`
`],...cR(t))}),e}function cR({vnode:n,recurseCount:e}){const t=e>0?`... (${e} recursive calls)`:"",i=n.component?n.component.parent==null:!1,s=` at <${Kv(n.component,n.type,i)}`,r=">"+t;return n.props?[s,...uR(n.props),r]:[s+r]}function uR(n){const e=[],t=Object.keys(n);return t.slice(0,3).forEach(i=>{e.push(...Zv(i,n[i]))}),t.length>3&&e.push(" ..."),e}function Zv(n,e,t){return Ue(e)?(e=JSON.stringify(e),t?e:[`${n}=${e}`]):typeof e=="number"||typeof e=="boolean"||e==null?t?e:[`${n}=${e}`]:ln(e)?(e=Zv(n,je(e.value),!0),t?e:[`${n}=Ref<`,e,">"]):Pe(e)?[`${n}=fn${e.name?`<${e.name}>`:""}`]:(e=je(e),t?e:[`${n}=`,e])}function ki(n,e,t,i){let s;try{s=i?n(...i):n()}catch(r){Br(r,e,t)}return s}function Yn(n,e,t,i){if(Pe(n)){const r=ki(n,e,t,i);return r&&Bf(r)&&r.catch(o=>{Br(o,e,t)}),r}const s=[];for(let r=0;r<n.length;r++)s.push(Yn(n[r],e,t,i));return s}function Br(n,e,t,i=!0){const s=e?e.vnode:null;if(e){let r=e.parent;const o=e.proxy,a=t;for(;r;){const c=r.ec;if(c){for(let h=0;h<c.length;h++)if(c[h](n,o,a)===!1)return}r=r.parent}const l=e.appContext.config.errorHandler;if(l){ki(l,null,10,[n,o,a]);return}}hR(n,t,s,i)}function hR(n,e,t,i=!0){console.error(n)}let eh=!1,Lp=!1;const jn=[];let os=0;const Rl=[];let Ll=null,Fo=0;const Pl=[];let Ws=null,Do=0;const ex=Promise.resolve();let Pp=null,Np=null;function Fp(n){const e=Pp||ex;return n?e.then(this?n.bind(this):n):e}function dR(n){let e=os+1,t=jn.length;for(;e<t;){const i=e+t>>>1;Nl(jn[i])<n?e=i+1:t=i}return e}function Dp(n){(!jn.length||!jn.includes(n,eh&&n.allowRecurse?os+1:os))&&n!==Np&&(n.id==null?jn.push(n):jn.splice(dR(n.id),0,n),tx())}function tx(){!eh&&!Lp&&(Lp=!0,Pp=ex.then(ix))}function fR(n){const e=jn.indexOf(n);e>os&&jn.splice(e,1)}function nx(n,e,t,i){Te(n)?t.push(...n):(!e||!e.includes(n,n.allowRecurse?i+1:i))&&t.push(n),tx()}function pR(n){nx(n,Ll,Rl,Fo)}function Op(n){nx(n,Ws,Pl,Do)}function kp(n,e=null){if(Rl.length){for(Np=e,Ll=[...new Set(Rl)],Rl.length=0,Fo=0;Fo<Ll.length;Fo++)Ll[Fo]();Ll=null,Fo=0,Np=null,kp(n,e)}}function th(n){if(Pl.length){const e=[...new Set(Pl)];if(Pl.length=0,Ws){Ws.push(...e);return}for(Ws=e,Ws.sort((t,i)=>Nl(t)-Nl(i)),Do=0;Do<Ws.length;Do++)Ws[Do]();Ws=null,Do=0}}const Nl=n=>n.id==null?1/0:n.id;function ix(n){Lp=!1,eh=!0,kp(n),jn.sort((t,i)=>Nl(t)-Nl(i));const e=Sn;try{for(os=0;os<jn.length;os++){const t=jn[os];t&&t.active!==!1&&ki(t,null,14)}}finally{os=0,jn.length=0,th(),eh=!1,Pp=null,(jn.length||Rl.length||Pl.length)&&ix(n)}}function mR(n,e){return Dl(n,null,e)}function sx(n,e){return Dl(n,null,{flush:"post"})}function gR(n,e){return Dl(n,null,{flush:"sync"})}const rx={};function Fl(n,e,t){return Dl(n,e,t)}function Dl(n,e,{immediate:t,deep:i,flush:s,onTrack:r,onTrigger:o}=et){const a=Bt;let l,c=!1,h=!1;if(ln(n)?(l=()=>n.value,c=!!n._shallow):Dr(n)?(l=()=>n,i=!0):Te(n)?(h=!0,c=n.some(Dr),l=()=>n.map(m=>{if(ln(m))return m.value;if(Dr(m))return Hr(m);if(Pe(m))return ki(m,a,2)})):Pe(n)?e?l=()=>ki(n,a,2):l=()=>{if(!(a&&a.isUnmounted))return u&&u(),Yn(n,a,3,[d])}:l=Sn,e&&i){const m=l;l=()=>Hr(m())}let u,d=m=>{u=y.onStop=()=>{ki(m,a,4)}};if(Cl)return d=Sn,e?t&&Yn(e,a,3,[l(),h?[]:void 0,d]):l(),Sn;let f=h?[]:rx;const p=()=>{if(!!y.active)if(e){const m=y.run();(i||c||(h?m.some((g,v)=>pl(g,f[v])):pl(m,f)))&&(u&&u(),Yn(e,a,3,[m,f===rx?void 0:f,d]),f=m)}else y.run()};p.allowRecurse=!!e;let _;s==="sync"?_=p:s==="post"?_=()=>jt(p,a&&a.suspense):_=()=>{!a||a.isMounted?pR(p):p()};const y=new _l(l,_);return e?t?p():f=y.run():s==="post"?jt(y.run.bind(y),a&&a.suspense):y.run(),()=>{y.stop(),a&&a.scope&&Ay(a.scope.effects,y)}}function _R(n,e,t){const i=this.proxy,s=Ue(n)?n.includes(".")?ox(i,n):()=>i[n]:n.bind(i,i);let r;Pe(e)?r=e:(r=e.handler,t=e);const o=Bt;Vs(this);const a=Dl(s,r.bind(i),t);return o?Vs(o):Gs(),a}function ox(n,e){const t=e.split(".");return()=>{let i=n;for(let s=0;s<t.length&&i;s++)i=i[t[s]];return i}}function Hr(n,e){if(!wt(n)||n.__v_skip||(e=e||new Set,e.has(n)))return n;if(e.add(n),ln(n))Hr(n.value,e);else if(Te(n))for(let t=0;t<n.length;t++)Hr(n[t],e);else if(Ir(n)||So(n))n.forEach(t=>{Hr(t,e)});else if(Ry(n))for(const t in n)Hr(n[t],e);return n}function yR(){return null}function vR(){return null}function xR(n){}function bR(n,e){return null}function TR(){return ax().slots}function wR(){return ax().attrs}function ax(){const n=zs();return n.setupContext||(n.setupContext=Qv(n))}function SR(n,e){const t=Te(n)?n.reduce((i,s)=>(i[s]={},i),{}):n;for(const i in e){const s=t[i];s?Te(s)||Pe(s)?t[i]={type:s,default:e[i]}:s.default=e[i]:s===null&&(t[i]={default:e[i]})}return t}function ER(n,e){const t={};for(const i in n)e.includes(i)||Object.defineProperty(t,i,{enumerable:!0,get:()=>n[i]});return t}function MR(n){const e=zs();let t=n();return Gs(),Bf(t)&&(t=t.catch(i=>{throw Vs(e),i})),[t,()=>Vs(e)]}function lx(n,e,t){const i=arguments.length;return i===2?wt(e)&&!Te(e)?Us(e)?mt(n,null,[e]):mt(n,e):mt(n,null,e):(i>3?t=Array.prototype.slice.call(arguments,2):i===3&&Us(t)&&(t=[t]),mt(n,e,t))}const cx=Symbol(""),AR=()=>{{const n=bl(cx);return n||Jv("Server rendering context not provided. Make sure to only call useSSRContext() conditionally in the server build."),n}};function CR(){}function IR(n,e,t,i){const s=t[i];if(s&&ux(s,n))return s;const r=e();return r.memo=n.slice(),t[i]=r}function ux(n,e){const t=n.memo;if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return No>0&&Di&&Di.push(n),!0}const hx="3.2.24",RR={createComponentInstance:Xv,setupComponent:Yv,renderComponentRoot:Uu,setCurrentRenderingInstance:vl,isVNode:Us,normalizeVNode:qn},LR=RR,PR=null,NR=null,FR="http://www.w3.org/2000/svg",Oo=typeof document!="undefined"?document:null,dx=new Map,DR={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,i)=>{const s=e?Oo.createElementNS(FR,n):Oo.createElement(n,t?{is:t}:void 0);return n==="select"&&i&&i.multiple!=null&&s.setAttribute("multiple",i.multiple),s},createText:n=>Oo.createTextNode(n),createComment:n=>Oo.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Oo.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},cloneNode(n){const e=n.cloneNode(!0);return"_value"in n&&(e._value=n._value),e},insertStaticContent(n,e,t,i){const s=t?t.previousSibling:e.lastChild;let r=dx.get(n);if(!r){const o=Oo.createElement("template");if(o.innerHTML=i?`<svg>${n}</svg>`:n,r=o.content,i){const a=r.firstChild;for(;a.firstChild;)r.appendChild(a.firstChild);r.removeChild(a)}dx.set(n,r)}return e.insertBefore(r.cloneNode(!0),t),[s?s.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}};function OR(n,e,t){const i=n._vtc;i&&(e=(e?[e,...i]:[...i]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}function kR(n,e,t){const i=n.style,s=Ue(t);if(t&&!s){for(const r in t)Up(i,r,t[r]);if(e&&!Ue(e))for(const r in e)t[r]==null&&Up(i,r,"")}else{const r=i.display;s?e!==t&&(i.cssText=t):e&&n.removeAttribute("style"),"_vod"in n&&(i.display=r)}}const fx=/\s*!important$/;function Up(n,e,t){if(Te(t))t.forEach(i=>Up(n,e,i));else if(e.startsWith("--"))n.setProperty(e,t);else{const i=UR(n,e);fx.test(t)?n.setProperty(_i(i),t.replace(fx,""),"important"):n[i]=t}}const px=["Webkit","Moz","ms"],Bp={};function UR(n,e){const t=Bp[e];if(t)return t;let i=pn(e);if(i!=="filter"&&i in n)return Bp[e]=i;i=Lr(i);for(let s=0;s<px.length;s++){const r=px[s]+i;if(r in n)return Bp[e]=r}return e}const mx="http://www.w3.org/1999/xlink";function BR(n,e,t,i,s){if(i&&e.startsWith("xlink:"))t==null?n.removeAttributeNS(mx,e.slice(6,e.length)):n.setAttributeNS(mx,e,t);else{const r=jA(e);t==null||r&&!Sy(t)?n.removeAttribute(e):n.setAttribute(e,r?"":t)}}function HR(n,e,t,i,s,r,o){if(e==="innerHTML"||e==="textContent"){i&&o(i,s,r),n[e]=t==null?"":t;return}if(e==="value"&&n.tagName!=="PROGRESS"&&!n.tagName.includes("-")){n._value=t;const a=t==null?"":t;(n.value!==a||n.tagName==="OPTION")&&(n.value=a),t==null&&n.removeAttribute(e);return}if(t===""||t==null){const a=typeof n[e];if(a==="boolean"){n[e]=Sy(t);return}else if(t==null&&a==="string"){n[e]="",n.removeAttribute(e);return}else if(a==="number"){try{n[e]=0}catch{}n.removeAttribute(e);return}}try{n[e]=t}catch{}}let nh=Date.now,gx=!1;if(typeof window!="undefined"){nh()>document.createEvent("Event").timeStamp&&(nh=()=>performance.now());const n=navigator.userAgent.match(/firefox\/(\d+)/i);gx=!!(n&&Number(n[1])<=53)}let Hp=0;const zR=Promise.resolve(),VR=()=>{Hp=0},GR=()=>Hp||(zR.then(VR),Hp=nh());function as(n,e,t,i){n.addEventListener(e,t,i)}function WR(n,e,t,i){n.removeEventListener(e,t,i)}function XR(n,e,t,i,s=null){const r=n._vei||(n._vei={}),o=r[e];if(i&&o)o.value=i;else{const[a,l]=qR(e);if(i){const c=r[e]=YR(i,s);as(n,a,c,l)}else o&&(WR(n,a,o,l),r[e]=void 0)}}const _x=/(?:Once|Passive|Capture)$/;function qR(n){let e;if(_x.test(n)){e={};let t;for(;t=n.match(_x);)n=n.slice(0,n.length-t[0].length),e[t[0].toLowerCase()]=!0}return[_i(n.slice(2)),e]}function YR(n,e){const t=i=>{const s=i.timeStamp||nh();(gx||s>=t.attached-1)&&Yn(jR(i,t.value),e,5,[i])};return t.value=n,t.attached=GR(),t}function jR(n,e){if(Te(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(i=>s=>!s._stopped&&i(s))}else return e}const yx=/^on[a-z]/,$R=(n,e,t,i,s=!1,r,o,a,l)=>{e==="class"?OR(n,i,s):e==="style"?kR(n,t,i):Cr(e)?Uf(e)||XR(n,e,t,i,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):QR(n,e,i,s))?HR(n,e,i,r,o,a,l):(e==="true-value"?n._trueValue=i:e==="false-value"&&(n._falseValue=i),BR(n,e,i,s))};function QR(n,e,t,i){return i?!!(e==="innerHTML"||e==="textContent"||e in n&&yx.test(e)&&Pe(t)):e==="spellcheck"||e==="draggable"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA"||yx.test(e)&&Ue(t)?!1:e in n}function vx(n,e){const t=lp(n);class i extends ih{constructor(r){super(t,r,e)}}return i.def=t,i}const KR=n=>vx(n,Vx),JR=typeof HTMLElement!="undefined"?HTMLElement:class{};class ih extends JR{constructor(e,t={},i){super();this._def=e,this._props=t,this._instance=null,this._connected=!1,this._resolved=!1,this._numberProps=null,this.shadowRoot&&i?i(this._createVNode(),this.shadowRoot):this.attachShadow({mode:"open"})}connectedCallback(){this._connected=!0,this._instance||this._resolveDef()}disconnectedCallback(){this._connected=!1,Fp(()=>{this._connected||(qp(null,this.shadowRoot),this._instance=null)})}_resolveDef(){if(this._resolved)return;this._resolved=!0;for(let i=0;i<this.attributes.length;i++)this._setAttr(this.attributes[i].name);new MutationObserver(i=>{for(const s of i)this._setAttr(s.attributeName)}).observe(this,{attributes:!0});const e=i=>{const{props:s,styles:r}=i,o=!Te(s),a=s?o?Object.keys(s):s:[];let l;if(o)for(const c in this._props){const h=s[c];(h===Number||h&&h.type===Number)&&(this._props[c]=Ns(this._props[c]),(l||(l=Object.create(null)))[c]=!0)}this._numberProps=l;for(const c of Object.keys(this))c[0]!=="_"&&this._setProp(c,this[c],!0,!1);for(const c of a.map(pn))Object.defineProperty(this,c,{get(){return this._getProp(c)},set(h){this._setProp(c,h)}});this._applyStyles(r),this._update()},t=this._def.__asyncLoader;t?t().then(e):e(this._def)}_setAttr(e){let t=this.getAttribute(e);this._numberProps&&this._numberProps[e]&&(t=Ns(t)),this._setProp(pn(e),t,!1)}_getProp(e){return this._props[e]}_setProp(e,t,i=!0,s=!0){t!==this._props[e]&&(this._props[e]=t,s&&this._instance&&this._update(),i&&(t===!0?this.setAttribute(_i(e),""):typeof t=="string"||typeof t=="number"?this.setAttribute(_i(e),t+""):t||this.removeAttribute(_i(e))))}_update(){qp(this._createVNode(),this.shadowRoot)}_createVNode(){const e=mt(this._def,tt({},this._props));return this._instance||(e.ce=t=>{this._instance=t,t.isCE=!0,t.emit=(s,...r)=>{this.dispatchEvent(new CustomEvent(s,{detail:r}))};let i=this;for(;i=i&&(i.parentNode||i.host);)if(i instanceof ih){t.parent=i._instance;break}}),e}_applyStyles(e){e&&e.forEach(t=>{const i=document.createElement("style");i.textContent=t,this.shadowRoot.appendChild(i)})}}function ZR(n="$style"){{const e=zs();if(!e)return et;const t=e.type.__cssModules;if(!t)return et;const i=t[n];return i||et}}function eL(n){const e=zs();if(!e)return;const t=()=>zp(e.subTree,n(e.proxy));sx(t),El(()=>{const i=new MutationObserver(t);i.observe(e.subTree.el.parentNode,{childList:!0}),Gu(()=>i.disconnect())})}function zp(n,e){if(n.shapeFlag&128){const t=n.suspense;n=t.activeBranch,t.pendingBranch&&!t.isHydrating&&t.effects.push(()=>{zp(t.activeBranch,e)})}for(;n.component;)n=n.component.subTree;if(n.shapeFlag&1&&n.el)xx(n.el,e);else if(n.type===cn)n.children.forEach(t=>zp(t,e));else if(n.type===Ur){let{el:t,anchor:i}=n;for(;t&&(xx(t,e),t!==i);)t=t.nextSibling}}function xx(n,e){if(n.nodeType===1){const t=n.style;for(const i in e)t.setProperty(`--${i}`,e[i])}}const Xs="transition",Ol="animation",Vp=(n,{slots:e})=>lx(op,wx(n),e);Vp.displayName="Transition";const bx={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},tL=Vp.props=tt({},op.props,bx),zr=(n,e=[])=>{Te(n)?n.forEach(t=>t(...e)):n&&n(...e)},Tx=n=>n?Te(n)?n.some(e=>e.length>1):n.length>1:!1;function wx(n){const e={};for(const V in n)V in bx||(e[V]=n[V]);if(n.css===!1)return e;const{name:t="v",type:i,duration:s,enterFromClass:r=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=r,appearActiveClass:c=o,appearToClass:h=a,leaveFromClass:u=`${t}-leave-from`,leaveActiveClass:d=`${t}-leave-active`,leaveToClass:f=`${t}-leave-to`}=n,p=nL(s),_=p&&p[0],y=p&&p[1],{onBeforeEnter:m,onEnter:g,onEnterCancelled:v,onLeave:x,onLeaveCancelled:T,onBeforeAppear:S=m,onAppear:b=g,onAppearCancelled:M=v}=e,N=(V,O,H)=>{Vr(V,O?h:a),Vr(V,O?c:o),H&&H()},P=(V,O)=>{Vr(V,f),Vr(V,d),O&&O()},L=V=>(O,H)=>{const Q=V?b:g,q=()=>N(O,V,H);zr(Q,[O,q]),Sx(()=>{Vr(O,V?l:r),ls(O,V?h:a),Tx(Q)||Ex(O,i,_,q)})};return tt(e,{onBeforeEnter(V){zr(m,[V]),ls(V,r),ls(V,o)},onBeforeAppear(V){zr(S,[V]),ls(V,l),ls(V,c)},onEnter:L(!1),onAppear:L(!0),onLeave(V,O){const H=()=>P(V,O);ls(V,u),Ix(),ls(V,d),Sx(()=>{Vr(V,u),ls(V,f),Tx(x)||Ex(V,i,y,H)}),zr(x,[V,H])},onEnterCancelled(V){N(V,!1),zr(v,[V])},onAppearCancelled(V){N(V,!0),zr(M,[V])},onLeaveCancelled(V){P(V),zr(T,[V])}})}function nL(n){if(n==null)return null;if(wt(n))return[Gp(n.enter),Gp(n.leave)];{const e=Gp(n);return[e,e]}}function Gp(n){return Ns(n)}function ls(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n._vtc||(n._vtc=new Set)).add(e)}function Vr(n,e){e.split(/\s+/).forEach(i=>i&&n.classList.remove(i));const{_vtc:t}=n;t&&(t.delete(e),t.size||(n._vtc=void 0))}function Sx(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let iL=0;function Ex(n,e,t,i){const s=n._endId=++iL,r=()=>{s===n._endId&&i()};if(t)return setTimeout(r,t);const{type:o,timeout:a,propCount:l}=Mx(n,e);if(!o)return i();const c=o+"end";let h=0;const u=()=>{n.removeEventListener(c,d),r()},d=f=>{f.target===n&&++h>=l&&u()};setTimeout(()=>{h<l&&u()},a+1),n.addEventListener(c,d)}function Mx(n,e){const t=window.getComputedStyle(n),i=p=>(t[p]||"").split(", "),s=i(Xs+"Delay"),r=i(Xs+"Duration"),o=Ax(s,r),a=i(Ol+"Delay"),l=i(Ol+"Duration"),c=Ax(a,l);let h=null,u=0,d=0;e===Xs?o>0&&(h=Xs,u=o,d=r.length):e===Ol?c>0&&(h=Ol,u=c,d=l.length):(u=Math.max(o,c),h=u>0?o>c?Xs:Ol:null,d=h?h===Xs?r.length:l.length:0);const f=h===Xs&&/\b(transform|all)(,|$)/.test(t[Xs+"Property"]);return{type:h,timeout:u,propCount:d,hasTransform:f}}function Ax(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,i)=>Cx(t)+Cx(n[i])))}function Cx(n){return Number(n.slice(0,-1).replace(",","."))*1e3}function Ix(){return document.body.offsetHeight}const Rx=new WeakMap,Lx=new WeakMap,sL={name:"TransitionGroup",props:tt({},tL,{tag:String,moveClass:String}),setup(n,{slots:e}){const t=zs(),i=rp();let s,r;return zu(()=>{if(!s.length)return;const o=n.moveClass||`${n.name||"v"}-move`;if(!cL(s[0].el,t.vnode.el,o))return;s.forEach(oL),s.forEach(aL);const a=s.filter(lL);Ix(),a.forEach(l=>{const c=l.el,h=c.style;ls(c,o),h.transform=h.webkitTransform=h.transitionDuration="";const u=c._moveCb=d=>{d&&d.target!==c||(!d||/transform$/.test(d.propertyName))&&(c.removeEventListener("transitionend",u),c._moveCb=null,Vr(c,o))};c.addEventListener("transitionend",u)})}),()=>{const o=je(n),a=wx(o);let l=o.tag||cn;s=r,r=e.default?Bu(e.default()):[];for(let c=0;c<r.length;c++){const h=r[c];h.key!=null&&Or(h,Lo(h,a,i,t))}if(s)for(let c=0;c<s.length;c++){const h=s[c];Or(h,Lo(h,a,i,t)),Rx.set(h,h.el.getBoundingClientRect())}return mt(l,null,r)}}},rL=sL;function oL(n){const e=n.el;e._moveCb&&e._moveCb(),e._enterCb&&e._enterCb()}function aL(n){Lx.set(n,n.el.getBoundingClientRect())}function lL(n){const e=Rx.get(n),t=Lx.get(n),i=e.left-t.left,s=e.top-t.top;if(i||s){const r=n.el.style;return r.transform=r.webkitTransform=`translate(${i}px,${s}px)`,r.transitionDuration="0s",n}}function cL(n,e,t){const i=n.cloneNode();n._vtc&&n._vtc.forEach(o=>{o.split(/\s+/).forEach(a=>a&&i.classList.remove(a))}),t.split(/\s+/).forEach(o=>o&&i.classList.add(o)),i.style.display="none";const s=e.nodeType===1?e:e.parentNode;s.appendChild(i);const{hasTransform:r}=Mx(i);return s.removeChild(i),r}const qs=n=>{const e=n.props["onUpdate:modelValue"];return Te(e)?t=>Ao(e,t):e};function uL(n){n.target.composing=!0}function Px(n){const e=n.target;e.composing&&(e.composing=!1,hL(e,"input"))}function hL(n,e){const t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}const sh={created(n,{modifiers:{lazy:e,trim:t,number:i}},s){n._assign=qs(s);const r=i||s.props&&s.props.type==="number";as(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t?a=a.trim():r&&(a=Ns(a)),n._assign(a)}),t&&as(n,"change",()=>{n.value=n.value.trim()}),e||(as(n,"compositionstart",uL),as(n,"compositionend",Px),as(n,"change",Px))},mounted(n,{value:e}){n.value=e==null?"":e},beforeUpdate(n,{value:e,modifiers:{lazy:t,trim:i,number:s}},r){if(n._assign=qs(r),n.composing||document.activeElement===n&&(t||i&&n.value.trim()===e||(s||n.type==="number")&&Ns(n.value)===e))return;const o=e==null?"":e;n.value!==o&&(n.value=o)}},Wp={deep:!0,created(n,e,t){n._assign=qs(t),as(n,"change",()=>{const i=n._modelValue,s=ko(n),r=n.checked,o=n._assign;if(Te(i)){const a=_u(i,s),l=a!==-1;if(r&&!l)o(i.concat(s));else if(!r&&l){const c=[...i];c.splice(a,1),o(c)}}else if(Ir(i)){const a=new Set(i);r?a.add(s):a.delete(s),o(a)}else o(Ox(n,r))})},mounted:Nx,beforeUpdate(n,e,t){n._assign=qs(t),Nx(n,e,t)}};function Nx(n,{value:e,oldValue:t},i){n._modelValue=e,Te(e)?n.checked=_u(e,i.props.value)>-1:Ir(e)?n.checked=e.has(i.props.value):e!==t&&(n.checked=Ps(e,Ox(n,!0)))}const Xp={created(n,{value:e},t){n.checked=Ps(e,t.props.value),n._assign=qs(t),as(n,"change",()=>{n._assign(ko(n))})},beforeUpdate(n,{value:e,oldValue:t},i){n._assign=qs(i),e!==t&&(n.checked=Ps(e,i.props.value))}},Fx={deep:!0,created(n,{value:e,modifiers:{number:t}},i){const s=Ir(e);as(n,"change",()=>{const r=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?Ns(ko(o)):ko(o));n._assign(n.multiple?s?new Set(r):r:r[0])}),n._assign=qs(i)},mounted(n,{value:e}){Dx(n,e)},beforeUpdate(n,e,t){n._assign=qs(t)},updated(n,{value:e}){Dx(n,e)}};function Dx(n,e){const t=n.multiple;if(!(t&&!Te(e)&&!Ir(e))){for(let i=0,s=n.options.length;i<s;i++){const r=n.options[i],o=ko(r);if(t)Te(e)?r.selected=_u(e,o)>-1:r.selected=e.has(o);else if(Ps(ko(r),e)){n.selectedIndex!==i&&(n.selectedIndex=i);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function ko(n){return"_value"in n?n._value:n.value}function Ox(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const dL={created(n,e,t){rh(n,e,t,null,"created")},mounted(n,e,t){rh(n,e,t,null,"mounted")},beforeUpdate(n,e,t,i){rh(n,e,t,i,"beforeUpdate")},updated(n,e,t,i){rh(n,e,t,i,"updated")}};function rh(n,e,t,i,s){let r;switch(n.tagName){case"SELECT":r=Fx;break;case"TEXTAREA":r=sh;break;default:switch(t.props&&t.props.type){case"checkbox":r=Wp;break;case"radio":r=Xp;break;default:r=sh}}const o=r[s];o&&o(n,e,t,i)}function fL(){sh.getSSRProps=({value:n})=>({value:n}),Xp.getSSRProps=({value:n},e)=>{if(e.props&&Ps(e.props.value,n))return{checked:!0}},Wp.getSSRProps=({value:n},e)=>{if(Te(n)){if(e.props&&_u(n,e.props.value)>-1)return{checked:!0}}else if(Ir(n)){if(e.props&&n.has(e.props.value))return{checked:!0}}else if(n)return{checked:!0}}}const pL=["ctrl","shift","alt","meta"],mL={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>pL.some(t=>n[`${t}Key`]&&!e.includes(t))},gL=(n,e)=>(t,...i)=>{for(let s=0;s<e.length;s++){const r=mL[e[s]];if(r&&r(t,e))return}return n(t,...i)},_L={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},yL=(n,e)=>t=>{if(!("key"in t))return;const i=_i(t.key);if(e.some(s=>s===i||_L[s]===i))return n(t)},kx={beforeMount(n,{value:e},{transition:t}){n._vod=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):kl(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:i}){!e!=!t&&(i?e?(i.beforeEnter(n),kl(n,!0),i.enter(n)):i.leave(n,()=>{kl(n,!1)}):kl(n,e))},beforeUnmount(n,{value:e}){kl(n,e)}};function kl(n,e){n.style.display=e?n._vod:"none"}function vL(){kx.getSSRProps=({value:n})=>{if(!n)return{style:{display:"none"}}}}const Ux=tt({patchProp:$R},DR);let Ul,Bx=!1;function Hx(){return Ul||(Ul=Nv(Ux))}function zx(){return Ul=Bx?Ul:Fv(Ux),Bx=!0,Ul}const qp=(...n)=>{Hx().render(...n)},Vx=(...n)=>{zx().hydrate(...n)},Gx=(...n)=>{const e=Hx().createApp(...n),{mount:t}=e;return e.mount=i=>{const s=Wx(i);if(!s)return;const r=e._component;!Pe(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.innerHTML="";const o=t(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e},xL=(...n)=>{const e=zx().createApp(...n),{mount:t}=e;return e.mount=i=>{const s=Wx(i);if(s)return t(s,!0,s instanceof SVGElement)},e};function Wx(n){return Ue(n)?document.querySelector(n):n}let Xx=!1;const bL=()=>{Xx||(Xx=!0,fL(),vL())};var TL=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Transition:Vp,TransitionGroup:rL,VueElement:ih,createApp:Gx,createSSRApp:xL,defineCustomElement:vx,defineSSRCustomElement:KR,hydrate:Vx,initDirectivesForSSR:bL,render:qp,useCssModule:ZR,useCssVars:eL,vModelCheckbox:Wp,vModelDynamic:dL,vModelRadio:Xp,vModelSelect:Fx,vModelText:sh,vShow:kx,withKeys:yL,withModifiers:gL,EffectScope:zf,ReactiveEffect:_l,computed:tv,customRef:QC,effect:_C,effectScope:dC,getCurrentScope:fC,isProxy:Qf,isReactive:Dr,isReadonly:Nu,isRef:ln,markRaw:Kf,onScopeDispose:pC,proxyRefs:ep,reactive:Lu,readonly:$f,ref:Du,shallowReactive:Ky,shallowReadonly:WC,shallowRef:XC,stop:yC,toRaw:je,toRef:ev,toRefs:KC,triggerRef:YC,unref:Zy,camelize:pn,capitalize:Lr,normalizeClass:fl,normalizeProps:KA,normalizeStyle:dl,toDisplayString:rC,toHandlerKey:Mo,BaseTransition:op,Comment:Mn,Fragment:cn,KeepAlive:yI,Static:Ur,Suspense:uI,Teleport:UI,Text:Po,callWithAsyncErrorHandling:Yn,callWithErrorHandling:ki,cloneVNode:Bs,compatUtils:NR,createBlock:Tp,createCommentVNode:YI,createElementBlock:GI,createElementVNode:wp,createHydrationRenderer:Fv,createPropsRestProxy:ER,createRenderer:Nv,createSlots:$I,createStaticVNode:qI,createTextVNode:Sp,createVNode:mt,defineAsyncComponent:gI,defineComponent:lp,defineEmits:vR,defineExpose:xR,defineProps:yR,get devtools(){return Io},getCurrentInstance:zs,getTransitionRawChildren:Bu,guardReactiveProps:Vv,h:lx,handleError:Br,initCustomFormatter:CR,inject:bl,isMemoSame:ux,isRuntimeOnly:nR,isVNode:Us,mergeDefaults:SR,mergeProps:Gv,nextTick:Fp,onActivated:uv,onBeforeMount:fv,onBeforeUnmount:Vu,onBeforeUpdate:pv,onDeactivated:hv,onErrorCaptured:yv,onMounted:El,onRenderTracked:_v,onRenderTriggered:gv,onServerPrefetch:mv,onUnmounted:Gu,onUpdated:zu,openBlock:ju,popScopeId:nI,provide:av,pushScopeId:tI,queuePostFlushCb:Op,registerRuntimeCompiler:jv,renderList:jI,renderSlot:QI,resolveComponent:HI,resolveDirective:VI,resolveDynamicComponent:zI,resolveFilter:PR,resolveTransitionHooks:Lo,setBlockTracking:bp,setDevtoolsHook:nv,setTransitionHooks:Or,ssrContextKey:cx,ssrUtils:LR,toHandlers:KI,transformVNodeArgs:WI,useAttrs:wR,useSSRContext:AR,useSlots:TR,useTransitionState:rp,version:hx,warn:Jv,watch:Fl,watchEffect:mR,watchPostEffect:sx,watchSyncEffect:gR,withAsyncContext:MR,withCtx:np,withDefaults:bR,withDirectives:RI,withMemo:IR,withScopeId:iI});function Yp(n){throw n}function qx(n){}function St(n,e,t,i){const s=n,r=new SyntaxError(String(s));return r.code=n,r.loc=e,r}const Bl=Symbol(""),Hl=Symbol(""),jp=Symbol(""),oh=Symbol(""),Yx=Symbol(""),Gr=Symbol(""),jx=Symbol(""),$x=Symbol(""),$p=Symbol(""),Qp=Symbol(""),zl=Symbol(""),Kp=Symbol(""),Qx=Symbol(""),Jp=Symbol(""),ah=Symbol(""),Zp=Symbol(""),em=Symbol(""),tm=Symbol(""),nm=Symbol(""),Kx=Symbol(""),Jx=Symbol(""),lh=Symbol(""),ch=Symbol(""),im=Symbol(""),sm=Symbol(""),Vl=Symbol(""),Gl=Symbol(""),rm=Symbol(""),om=Symbol(""),wL=Symbol(""),am=Symbol(""),uh=Symbol(""),SL=Symbol(""),EL=Symbol(""),lm=Symbol(""),ML=Symbol(""),AL=Symbol(""),cm=Symbol(""),Zx=Symbol(""),Ys={[Bl]:"Fragment",[Hl]:"Teleport",[jp]:"Suspense",[oh]:"KeepAlive",[Yx]:"BaseTransition",[Gr]:"openBlock",[jx]:"createBlock",[$x]:"createElementBlock",[$p]:"createVNode",[Qp]:"createElementVNode",[zl]:"createCommentVNode",[Kp]:"createTextVNode",[Qx]:"createStaticVNode",[Jp]:"resolveComponent",[ah]:"resolveDynamicComponent",[Zp]:"resolveDirective",[em]:"resolveFilter",[tm]:"withDirectives",[nm]:"renderList",[Kx]:"renderSlot",[Jx]:"createSlots",[lh]:"toDisplayString",[ch]:"mergeProps",[im]:"normalizeClass",[sm]:"normalizeStyle",[Vl]:"normalizeProps",[Gl]:"guardReactiveProps",[rm]:"toHandlers",[om]:"camelize",[wL]:"capitalize",[am]:"toHandlerKey",[uh]:"setBlockTracking",[SL]:"pushScopeId",[EL]:"popScopeId",[lm]:"withCtx",[ML]:"unref",[AL]:"isRef",[cm]:"withMemo",[Zx]:"isMemoSame"};function CL(n){Object.getOwnPropertySymbols(n).forEach(e=>{Ys[e]=n[e]})}const $n={source:"",start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0}};function IL(n,e=$n){return{type:0,children:n,helpers:[],components:[],directives:[],hoists:[],imports:[],cached:0,temps:0,codegenNode:void 0,loc:e}}function Wl(n,e,t,i,s,r,o,a=!1,l=!1,c=!1,h=$n){return n&&(a?(n.helper(Gr),n.helper(zo(n.inSSR,c))):n.helper(Ho(n.inSSR,c)),o&&n.helper(tm)),{type:13,tag:e,props:t,children:i,patchFlag:s,dynamicProps:r,directives:o,isBlock:a,disableTracking:l,isComponent:c,loc:h}}function Xl(n,e=$n){return{type:17,loc:e,elements:n}}function ti(n,e=$n){return{type:15,loc:e,properties:n}}function Dt(n,e){return{type:16,loc:$n,key:Ue(n)?qe(n,!0):n,value:e}}function qe(n,e=!1,t=$n,i=0){return{type:4,loc:t,content:n,isStatic:e,constType:e?3:i}}function Ui(n,e=$n){return{type:8,loc:e,children:n}}function Ot(n,e=[],t=$n){return{type:14,loc:t,callee:n,arguments:e}}function Uo(n,e=void 0,t=!1,i=!1,s=$n){return{type:18,params:n,returns:e,newline:t,isSlot:i,loc:s}}function um(n,e,t,i=!0){return{type:19,test:n,consequent:e,alternate:t,newline:i,loc:$n}}function RL(n,e,t=!1){return{type:20,index:n,value:e,isVNode:t,loc:$n}}function LL(n){return{type:21,body:n,loc:$n}}const Nn=n=>n.type===4&&n.isStatic,Bo=(n,e)=>n===e||n===_i(e);function eb(n){if(Bo(n,"Teleport"))return Hl;if(Bo(n,"Suspense"))return jp;if(Bo(n,"KeepAlive"))return oh;if(Bo(n,"BaseTransition"))return Yx}const PL=/^\d|[^\$\w]/,hm=n=>!PL.test(n),NL=/[A-Za-z_$\xA0-\uFFFF]/,FL=/[\.\?\w$\xA0-\uFFFF]/,DL=/\s+[.[]\s*|\s*[.[]\s+/g,OL=n=>{n=n.trim().replace(DL,o=>o.trim());let e=0,t=[],i=0,s=0,r=null;for(let o=0;o<n.length;o++){const a=n.charAt(o);switch(e){case 0:if(a==="[")t.push(e),e=1,i++;else if(a==="(")t.push(e),e=2,s++;else if(!(o===0?NL:FL).test(a))return!1;break;case 1:a==="'"||a==='"'||a==="`"?(t.push(e),e=3,r=a):a==="["?i++:a==="]"&&(--i||(e=t.pop()));break;case 2:if(a==="'"||a==='"'||a==="`")t.push(e),e=3,r=a;else if(a==="(")s++;else if(a===")"){if(o===n.length-1)return!1;--s||(e=t.pop())}break;case 3:a===r&&(e=t.pop(),r=null);break}}return!i&&!s},tb=OL;function nb(n,e,t){const s={source:n.source.slice(e,e+t),start:hh(n.start,n.source,e),end:n.end};return t!=null&&(s.end=hh(n.start,n.source,e+t)),s}function hh(n,e,t=e.length){return dh(tt({},n),e,t)}function dh(n,e,t=e.length){let i=0,s=-1;for(let r=0;r<t;r++)e.charCodeAt(r)===10&&(i++,s=r);return n.offset+=t,n.line+=i,n.column=s===-1?n.column+t:t-s,n}function ni(n,e,t=!1){for(let i=0;i<n.props.length;i++){const s=n.props[i];if(s.type===7&&(t||s.exp)&&(Ue(e)?s.name===e:e.test(s.name)))return s}}function ql(n,e,t=!1,i=!1){for(let s=0;s<n.props.length;s++){const r=n.props[s];if(r.type===6){if(t)continue;if(r.name===e&&(r.value||i))return r}else if(r.name==="bind"&&(r.exp||i)&&fh(r.arg,e))return r}}function fh(n,e){return!!(n&&Nn(n)&&n.content===e)}function kL(n){return n.props.some(e=>e.type===7&&e.name==="bind"&&(!e.arg||e.arg.type!==4||!e.arg.isStatic))}function dm(n){return n.type===5||n.type===2}function UL(n){return n.type===7&&n.name==="slot"}function ph(n){return n.type===1&&n.tagType===3}function mh(n){return n.type===1&&n.tagType===2}function Ho(n,e){return n||e?$p:Qp}function zo(n,e){return n||e?jx:$x}const BL=new Set([Vl,Gl]);function ib(n,e=[]){if(n&&!Ue(n)&&n.type===14){const t=n.callee;if(!Ue(t)&&BL.has(t))return ib(n.arguments[0],e.concat(n))}return[n,e]}function gh(n,e,t){let i,s=n.type===13?n.props:n.arguments[2],r=[],o;if(s&&!Ue(s)&&s.type===14){const a=ib(s);s=a[0],r=a[1],o=r[r.length-1]}if(s==null||Ue(s))i=ti([e]);else if(s.type===14){const a=s.arguments[0];!Ue(a)&&a.type===15?a.properties.unshift(e):s.callee===rm?i=Ot(t.helper(ch),[ti([e]),s]):s.arguments.unshift(ti([e])),!i&&(i=s)}else if(s.type===15){let a=!1;if(e.key.type===4){const l=e.key.content;a=s.properties.some(c=>c.key.type===4&&c.key.content===l)}a||s.properties.unshift(e),i=s}else i=Ot(t.helper(ch),[ti([e]),s]),o&&o.callee===Gl&&(o=r[r.length-2]);n.type===13?o?o.arguments[0]=i:n.props=i:o?o.arguments[0]=i:n.arguments[2]=i}function Yl(n,e){return`_${e}_${n.replace(/[^\w]/g,(t,i)=>t==="-"?"_":n.charCodeAt(i).toString())}`}function HL(n){return n.type===14&&n.callee===cm?n.arguments[1].returns:n}function fm(n,{helper:e,removeHelper:t,inSSR:i}){n.isBlock||(n.isBlock=!0,t(Ho(i,n.isComponent)),e(Gr),e(zo(i,n.isComponent)))}function sb(n,e){const t=e.options?e.options.compatConfig:e.compatConfig,i=t&&t[n];return n==="MODE"?i||3:i}function Wr(n,e){const t=sb("MODE",e),i=sb(n,e);return t===3?i===!0:i!==!1}function Vo(n,e,t,...i){return Wr(n,e)}const zL=/&(gt|lt|amp|apos|quot);/g,VL={gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},rb={delimiters:["{{","}}"],getNamespace:()=>0,getTextMode:()=>0,isVoidTag:yu,isPreTag:yu,isCustomElement:yu,decodeEntities:n=>n.replace(zL,(e,t)=>VL[t]),onError:Yp,onWarn:qx,comments:!1};function GL(n,e={}){const t=WL(n,e),i=Qn(t);return IL(pm(t,0,[]),ii(t,i))}function WL(n,e){const t=tt({},rb);let i;for(i in e)t[i]=e[i]===void 0?rb[i]:e[i];return{options:t,column:1,line:1,offset:0,originalSource:n,source:n,inPre:!1,inVPre:!1,onWarn:t.onWarn}}function pm(n,e,t){const i=_h(t),s=i?i.ns:0,r=[];for(;!ZL(n,e,t);){const a=n.source;let l;if(e===0||e===1){if(!n.inVPre&&mn(a,n.options.delimiters[0]))l=KL(n,e);else if(e===0&&a[0]==="<")if(a.length===1)rt(n,5,1);else if(a[1]==="!")mn(a,"<!--")?l=qL(n):mn(a,"<!DOCTYPE")?l=jl(n):mn(a,"<![CDATA[")?s!==0?l=XL(n,t):(rt(n,1),l=jl(n)):(rt(n,11),l=jl(n));else if(a[1]==="/")if(a.length===2)rt(n,5,2);else if(a[2]===">"){rt(n,14,2),Ht(n,3);continue}else if(/[a-z]/i.test(a[2])){rt(n,23),mm(n,1,i);continue}else rt(n,12,2),l=jl(n);else/[a-z]/i.test(a[1])?(l=YL(n,t),Wr("COMPILER_NATIVE_TEMPLATE",n)&&l&&l.tag==="template"&&!l.props.some(c=>c.type===7&&ab(c.name))&&(l=l.children)):a[1]==="?"?(rt(n,21,1),l=jl(n)):rt(n,12,1)}if(l||(l=JL(n,e)),Te(l))for(let c=0;c<l.length;c++)ob(r,l[c]);else ob(r,l)}let o=!1;if(e!==2&&e!==1){const a=n.options.whitespace!=="preserve";for(let l=0;l<r.length;l++){const c=r[l];if(!n.inPre&&c.type===2)if(/[^\t\r\n\f ]/.test(c.content))a&&(c.content=c.content.replace(/[\t\r\n\f ]+/g," "));else{const h=r[l-1],u=r[l+1];!h||!u||a&&(h.type===3||u.type===3||h.type===1&&u.type===1&&/[\r\n]/.test(c.content))?(o=!0,r[l]=null):c.content=" "}else c.type===3&&!n.options.comments&&(o=!0,r[l]=null)}if(n.inPre&&i&&n.options.isPreTag(i.tag)){const l=r[0];l&&l.type===2&&(l.content=l.content.replace(/^\r?\n/,""))}}return o?r.filter(Boolean):r}function ob(n,e){if(e.type===2){const t=_h(n);if(t&&t.type===2&&t.loc.end.offset===e.loc.start.offset){t.content+=e.content,t.loc.end=e.loc.end,t.loc.source+=e.loc.source;return}}n.push(e)}function XL(n,e){Ht(n,9);const t=pm(n,3,e);return n.source.length===0?rt(n,6):Ht(n,3),t}function qL(n){const e=Qn(n);let t;const i=/--(\!)?>/.exec(n.source);if(!i)t=n.source.slice(4),Ht(n,n.source.length),rt(n,7);else{i.index<=3&&rt(n,0),i[1]&&rt(n,10),t=n.source.slice(4,i.index);const s=n.source.slice(0,i.index);let r=1,o=0;for(;(o=s.indexOf("<!--",r))!==-1;)Ht(n,o-r+1),o+4<s.length&&rt(n,16),r=o+1;Ht(n,i.index+i[0].length-r+1)}return{type:3,content:t,loc:ii(n,e)}}function jl(n){const e=Qn(n),t=n.source[1]==="?"?1:2;let i;const s=n.source.indexOf(">");return s===-1?(i=n.source.slice(t),Ht(n,n.source.length)):(i=n.source.slice(t,s),Ht(n,s+1)),{type:3,content:i,loc:ii(n,e)}}function YL(n,e){const t=n.inPre,i=n.inVPre,s=_h(e),r=mm(n,0,s),o=n.inPre&&!t,a=n.inVPre&&!i;if(r.isSelfClosing||n.options.isVoidTag(r.tag))return o&&(n.inPre=!1),a&&(n.inVPre=!1),r;e.push(r);const l=n.options.getTextMode(r,s),c=pm(n,l,e);e.pop();{const h=r.props.find(u=>u.type===6&&u.name==="inline-template");if(h&&Vo("COMPILER_INLINE_TEMPLATE",n,h.loc)){const u=ii(n,r.loc.end);h.value={type:2,content:u.source,loc:u}}}if(r.children=c,gm(n.source,r.tag))mm(n,1,s);else if(rt(n,24,0,r.loc.start),n.source.length===0&&r.tag.toLowerCase()==="script"){const h=c[0];h&&mn(h.loc.source,"<!--")&&rt(n,8)}return r.loc=ii(n,r.loc.start),o&&(n.inPre=!1),a&&(n.inVPre=!1),r}const ab=Gn("if,else,else-if,for,slot");function mm(n,e,t){const i=Qn(n),s=/^<\/?([a-z][^\t\r\n\f />]*)/i.exec(n.source),r=s[1],o=n.options.getNamespace(r,t);Ht(n,s[0].length),Ql(n);const a=Qn(n),l=n.source;n.options.isPreTag(r)&&(n.inPre=!0);let c=lb(n,e);e===0&&!n.inVPre&&c.some(d=>d.type===7&&d.name==="pre")&&(n.inVPre=!0,tt(n,a),n.source=l,c=lb(n,e).filter(d=>d.name!=="v-pre"));let h=!1;if(n.source.length===0?rt(n,9):(h=mn(n.source,"/>"),e===1&&h&&rt(n,4),Ht(n,h?2:1)),e===1)return;let u=0;return n.inVPre||(r==="slot"?u=2:r==="template"?c.some(d=>d.type===7&&ab(d.name))&&(u=3):jL(r,c,n)&&(u=1)),{type:1,ns:o,tag:r,tagType:u,props:c,isSelfClosing:h,children:[],loc:ii(n,i),codegenNode:void 0}}function jL(n,e,t){const i=t.options;if(i.isCustomElement(n))return!1;if(n==="component"||/^[A-Z]/.test(n)||eb(n)||i.isBuiltInComponent&&i.isBuiltInComponent(n)||i.isNativeTag&&!i.isNativeTag(n))return!0;for(let s=0;s<e.length;s++){const r=e[s];if(r.type===6){if(r.name==="is"&&r.value){if(r.value.content.startsWith("vue:"))return!0;if(Vo("COMPILER_IS_ON_ELEMENT",t,r.loc))return!0}}else{if(r.name==="is")return!0;if(r.name==="bind"&&fh(r.arg,"is")&&!0&&Vo("COMPILER_IS_ON_ELEMENT",t,r.loc))return!0}}}function lb(n,e){const t=[],i=new Set;for(;n.source.length>0&&!mn(n.source,">")&&!mn(n.source,"/>");){if(mn(n.source,"/")){rt(n,22),Ht(n,1),Ql(n);continue}e===1&&rt(n,3);const s=$L(n,i);s.type===6&&s.value&&s.name==="class"&&(s.value.content=s.value.content.replace(/\s+/g," ").trim()),e===0&&t.push(s),/^[^\t\r\n\f />]/.test(n.source)&&rt(n,15),Ql(n)}return t}function $L(n,e){const t=Qn(n),s=/^[^\t\r\n\f />][^\t\r\n\f />=]*/.exec(n.source)[0];e.has(s)&&rt(n,2),e.add(s),s[0]==="="&&rt(n,19);{const a=/["'<]/g;let l;for(;l=a.exec(s);)rt(n,17,l.index)}Ht(n,s.length);let r;/^[\t\r\n\f ]*=/.test(n.source)&&(Ql(n),Ht(n,1),Ql(n),r=QL(n),r||rt(n,13));const o=ii(n,t);if(!n.inVPre&&/^(v-[A-Za-z0-9-]|:|\.|@|#)/.test(s)){const a=/(?:^v-([a-z0-9-]+))?(?:(?::|^\.|^@|^#)(\[[^\]]+\]|[^\.]+))?(.+)?$/i.exec(s);let l=mn(s,"."),c=a[1]||(l||mn(s,":")?"bind":mn(s,"@")?"on":"slot"),h;if(a[2]){const d=c==="slot",f=s.lastIndexOf(a[2]),p=ii(n,cb(n,t,f),cb(n,t,f+a[2].length+(d&&a[3]||"").length));let _=a[2],y=!0;_.startsWith("[")?(y=!1,_.endsWith("]")?_=_.slice(1,_.length-1):(rt(n,27),_=_.slice(1))):d&&(_+=a[3]||""),h={type:4,content:_,isStatic:y,constType:y?3:0,loc:p}}if(r&&r.isQuoted){const d=r.loc;d.start.offset++,d.start.column++,d.end=hh(d.start,r.content),d.source=d.source.slice(1,-1)}const u=a[3]?a[3].slice(1).split("."):[];return l&&u.push("prop"),c==="bind"&&h&&u.includes("sync")&&Vo("COMPILER_V_BIND_SYNC",n,o,h.loc.source)&&(c="model",u.splice(u.indexOf("sync"),1)),{type:7,name:c,exp:r&&{type:4,content:r.content,isStatic:!1,constType:0,loc:r.loc},arg:h,modifiers:u,loc:o}}return!n.inVPre&&mn(s,"v-")&&rt(n,26),{type:6,name:s,value:r&&{type:2,content:r.content,loc:r.loc},loc:o}}function QL(n){const e=Qn(n);let t;const i=n.source[0],s=i==='"'||i==="'";if(s){Ht(n,1);const r=n.source.indexOf(i);r===-1?t=$l(n,n.source.length,4):(t=$l(n,r,4),Ht(n,1))}else{const r=/^[^\t\r\n\f >]+/.exec(n.source);if(!r)return;const o=/["'<=`]/g;let a;for(;a=o.exec(r[0]);)rt(n,18,a.index);t=$l(n,r[0].length,4)}return{content:t,isQuoted:s,loc:ii(n,e)}}function KL(n,e){const[t,i]=n.options.delimiters,s=n.source.indexOf(i,t.length);if(s===-1){rt(n,25);return}const r=Qn(n);Ht(n,t.length);const o=Qn(n),a=Qn(n),l=s-t.length,c=n.source.slice(0,l),h=$l(n,l,e),u=h.trim(),d=h.indexOf(u);d>0&&dh(o,c,d);const f=l-(h.length-u.length-d);return dh(a,c,f),Ht(n,i.length),{type:5,content:{type:4,isStatic:!1,constType:0,content:u,loc:ii(n,o,a)},loc:ii(n,r)}}function JL(n,e){const t=e===3?["]]>"]:["<",n.options.delimiters[0]];let i=n.source.length;for(let o=0;o<t.length;o++){const a=n.source.indexOf(t[o],1);a!==-1&&i>a&&(i=a)}const s=Qn(n),r=$l(n,i,e);return{type:2,content:r,loc:ii(n,s)}}function $l(n,e,t){const i=n.source.slice(0,e);return Ht(n,e),t===2||t===3||i.indexOf("&")===-1?i:n.options.decodeEntities(i,t===4)}function Qn(n){const{column:e,line:t,offset:i}=n;return{column:e,line:t,offset:i}}function ii(n,e,t){return t=t||Qn(n),{start:e,end:t,source:n.originalSource.slice(e.offset,t.offset)}}function _h(n){return n[n.length-1]}function mn(n,e){return n.startsWith(e)}function Ht(n,e){const{source:t}=n;dh(n,t,e),n.source=t.slice(e)}function Ql(n){const e=/^[\t\r\n\f ]+/.exec(n.source);e&&Ht(n,e[0].length)}function cb(n,e,t){return hh(e,n.originalSource.slice(e.offset,t),t)}function rt(n,e,t,i=Qn(n)){t&&(i.offset+=t,i.column+=t),n.options.onError(St(e,{start:i,end:i,source:""}))}function ZL(n,e,t){const i=n.source;switch(e){case 0:if(mn(i,"</")){for(let s=t.length-1;s>=0;--s)if(gm(i,t[s].tag))return!0}break;case 1:case 2:{const s=_h(t);if(s&&gm(i,s.tag))return!0;break}case 3:if(mn(i,"]]>"))return!0;break}return!i}function gm(n,e){return mn(n,"</")&&n.slice(2,2+e.length).toLowerCase()===e.toLowerCase()&&/[\t\r\n\f />]/.test(n[2+e.length]||">")}function eP(n,e){yh(n,e,ub(n,n.children[0]))}function ub(n,e){const{children:t}=n;return t.length===1&&e.type===1&&!mh(e)}function yh(n,e,t=!1){const{children:i}=n,s=i.length;let r=0;for(let o=0;o<i.length;o++){const a=i[o];if(a.type===1&&a.tagType===0){const l=t?0:si(a,e);if(l>0){if(l>=2){a.codegenNode.patchFlag=-1+"",a.codegenNode=e.hoist(a.codegenNode),r++;continue}}else{const c=a.codegenNode;if(c.type===13){const h=pb(c);if((!h||h===512||h===1)&&db(a,e)>=2){const u=fb(a);u&&(c.props=e.hoist(u))}c.dynamicProps&&(c.dynamicProps=e.hoist(c.dynamicProps))}}}else a.type===12&&si(a.content,e)>=2&&(a.codegenNode=e.hoist(a.codegenNode),r++);if(a.type===1){const l=a.tagType===1;l&&e.scopes.vSlot++,yh(a,e),l&&e.scopes.vSlot--}else if(a.type===11)yh(a,e,a.children.length===1);else if(a.type===9)for(let l=0;l<a.branches.length;l++)yh(a.branches[l],e,a.branches[l].children.length===1)}r&&e.transformHoist&&e.transformHoist(i,e,n),r&&r===s&&n.type===1&&n.tagType===0&&n.codegenNode&&n.codegenNode.type===13&&Te(n.codegenNode.children)&&(n.codegenNode.children=e.hoist(Xl(n.codegenNode.children)))}function si(n,e){const{constantCache:t}=e;switch(n.type){case 1:if(n.tagType!==0)return 0;const i=t.get(n);if(i!==void 0)return i;const s=n.codegenNode;if(s.type!==13)return 0;if(pb(s))return t.set(n,0),0;{let a=3;const l=db(n,e);if(l===0)return t.set(n,0),0;l<a&&(a=l);for(let c=0;c<n.children.length;c++){const h=si(n.children[c],e);if(h===0)return t.set(n,0),0;h<a&&(a=h)}if(a>1)for(let c=0;c<n.props.length;c++){const h=n.props[c];if(h.type===7&&h.name==="bind"&&h.exp){const u=si(h.exp,e);if(u===0)return t.set(n,0),0;u<a&&(a=u)}}return s.isBlock&&(e.removeHelper(Gr),e.removeHelper(zo(e.inSSR,s.isComponent)),s.isBlock=!1,e.helper(Ho(e.inSSR,s.isComponent))),t.set(n,a),a}case 2:case 3:return 3;case 9:case 11:case 10:return 0;case 5:case 12:return si(n.content,e);case 4:return n.constType;case 8:let o=3;for(let a=0;a<n.children.length;a++){const l=n.children[a];if(Ue(l)||Eo(l))continue;const c=si(l,e);if(c===0)return 0;c<o&&(o=c)}return o;default:return 0}}const tP=new Set([im,sm,Vl,Gl]);function hb(n,e){if(n.type===14&&!Ue(n.callee)&&tP.has(n.callee)){const t=n.arguments[0];if(t.type===4)return si(t,e);if(t.type===14)return hb(t,e)}return 0}function db(n,e){let t=3;const i=fb(n);if(i&&i.type===15){const{properties:s}=i;for(let r=0;r<s.length;r++){const{key:o,value:a}=s[r],l=si(o,e);if(l===0)return l;l<t&&(t=l);let c;if(a.type===4?c=si(a,e):a.type===14?c=hb(a,e):c=0,c===0)return c;c<t&&(t=c)}}return t}function fb(n){const e=n.codegenNode;if(e.type===13)return e.props}function pb(n){const e=n.patchFlag;return e?parseInt(e,10):void 0}function nP(n,{filename:e="",prefixIdentifiers:t=!1,hoistStatic:i=!1,cacheHandlers:s=!1,nodeTransforms:r=[],directiveTransforms:o={},transformHoist:a=null,isBuiltInComponent:l=Sn,isCustomElement:c=Sn,expressionPlugins:h=[],scopeId:u=null,slotted:d=!0,ssr:f=!1,inSSR:p=!1,ssrCssVars:_="",bindingMetadata:y=et,inline:m=!1,isTS:g=!1,onError:v=Yp,onWarn:x=qx,compatConfig:T}){const S=e.replace(/\?.*$/,"").match(/([^/\\]+)\.\w+$/),b={selfName:S&&Lr(pn(S[1])),prefixIdentifiers:t,hoistStatic:i,cacheHandlers:s,nodeTransforms:r,directiveTransforms:o,transformHoist:a,isBuiltInComponent:l,isCustomElement:c,expressionPlugins:h,scopeId:u,slotted:d,ssr:f,inSSR:p,ssrCssVars:_,bindingMetadata:y,inline:m,isTS:g,onError:v,onWarn:x,compatConfig:T,root:n,helpers:new Map,components:new Set,directives:new Set,hoists:[],imports:[],constantCache:new Map,temps:0,cached:0,identifiers:Object.create(null),scopes:{vFor:0,vSlot:0,vPre:0,vOnce:0},parent:null,currentNode:n,childIndex:0,inVOnce:!1,helper(M){const N=b.helpers.get(M)||0;return b.helpers.set(M,N+1),M},removeHelper(M){const N=b.helpers.get(M);if(N){const P=N-1;P?b.helpers.set(M,P):b.helpers.delete(M)}},helperString(M){return`_${Ys[b.helper(M)]}`},replaceNode(M){b.parent.children[b.childIndex]=b.currentNode=M},removeNode(M){const N=b.parent.children,P=M?N.indexOf(M):b.currentNode?b.childIndex:-1;!M||M===b.currentNode?(b.currentNode=null,b.onNodeRemoved()):b.childIndex>P&&(b.childIndex--,b.onNodeRemoved()),b.parent.children.splice(P,1)},onNodeRemoved:()=>{},addIdentifiers(M){},removeIdentifiers(M){},hoist(M){Ue(M)&&(M=qe(M)),b.hoists.push(M);const N=qe(`_hoisted_${b.hoists.length}`,!1,M.loc,2);return N.hoisted=M,N},cache(M,N=!1){return RL(b.cached++,M,N)}};return b.filters=new Set,b}function iP(n,e){const t=nP(n,e);vh(n,t),e.hoistStatic&&eP(n,t),e.ssr||sP(n,t),n.helpers=[...t.helpers.keys()],n.components=[...t.components],n.directives=[...t.directives],n.imports=t.imports,n.hoists=t.hoists,n.temps=t.temps,n.cached=t.cached,n.filters=[...t.filters]}function sP(n,e){const{helper:t}=e,{children:i}=n;if(i.length===1){const s=i[0];if(ub(n,s)&&s.codegenNode){const r=s.codegenNode;r.type===13&&fm(r,e),n.codegenNode=r}else n.codegenNode=s}else if(i.length>1){let s=64;n.codegenNode=Wl(e,t(Bl),void 0,n.children,s+"",void 0,void 0,!0,void 0,!1)}}function rP(n,e){let t=0;const i=()=>{t--};for(;t<n.children.length;t++){const s=n.children[t];Ue(s)||(e.parent=n,e.childIndex=t,e.onNodeRemoved=i,vh(s,e))}}function vh(n,e){e.currentNode=n;const{nodeTransforms:t}=e,i=[];for(let r=0;r<t.length;r++){const o=t[r](n,e);if(o&&(Te(o)?i.push(...o):i.push(o)),e.currentNode)n=e.currentNode;else return}switch(n.type){case 3:e.ssr||e.helper(zl);break;case 5:e.ssr||e.helper(lh);break;case 9:for(let r=0;r<n.branches.length;r++)vh(n.branches[r],e);break;case 10:case 11:case 1:case 0:rP(n,e);break}e.currentNode=n;let s=i.length;for(;s--;)i[s]()}function mb(n,e){const t=Ue(n)?i=>i===n:i=>n.test(i);return(i,s)=>{if(i.type===1){const{props:r}=i;if(i.tagType===3&&r.some(UL))return;const o=[];for(let a=0;a<r.length;a++){const l=r[a];if(l.type===7&&t(l.name)){r.splice(a,1),a--;const c=e(i,l,s);c&&o.push(c)}}return o}}}const xh="/*#__PURE__*/";function oP(n,{mode:e="function",prefixIdentifiers:t=e==="module",sourceMap:i=!1,filename:s="template.vue.html",scopeId:r=null,optimizeImports:o=!1,runtimeGlobalName:a="Vue",runtimeModuleName:l="vue",ssrRuntimeModuleName:c="vue/server-renderer",ssr:h=!1,isTS:u=!1,inSSR:d=!1}){const f={mode:e,prefixIdentifiers:t,sourceMap:i,filename:s,scopeId:r,optimizeImports:o,runtimeGlobalName:a,runtimeModuleName:l,ssrRuntimeModuleName:c,ssr:h,isTS:u,inSSR:d,source:n.loc.source,code:"",column:1,line:1,offset:0,indentLevel:0,pure:!1,map:void 0,helper(_){return`_${Ys[_]}`},push(_,y){f.code+=_},indent(){p(++f.indentLevel)},deindent(_=!1){_?--f.indentLevel:p(--f.indentLevel)},newline(){p(f.indentLevel)}};function p(_){f.push(`
`+"  ".repeat(_))}return f}function aP(n,e={}){const t=oP(n,e);e.onContextCreated&&e.onContextCreated(t);const{mode:i,push:s,prefixIdentifiers:r,indent:o,deindent:a,newline:l,scopeId:c,ssr:h}=t,u=n.helpers.length>0,d=!r&&i!=="module";lP(n,t);const p=h?"ssrRender":"render",y=(h?["_ctx","_push","_parent","_attrs"]:["_ctx","_cache"]).join(", ");if(s(`function ${p}(${y}) {`),o(),d&&(s("with (_ctx) {"),o(),u&&(s(`const { ${n.helpers.map(m=>`${Ys[m]}: _${Ys[m]}`).join(", ")} } = _Vue`),s(`
`),l())),n.components.length&&(_m(n.components,"component",t),(n.directives.length||n.temps>0)&&l()),n.directives.length&&(_m(n.directives,"directive",t),n.temps>0&&l()),n.filters&&n.filters.length&&(l(),_m(n.filters,"filter",t),l()),n.temps>0){s("let ");for(let m=0;m<n.temps;m++)s(`${m>0?", ":""}_temp${m}`)}return(n.components.length||n.directives.length||n.temps)&&(s(`
`),l()),h||s("return "),n.codegenNode?gn(n.codegenNode,t):s("null"),d&&(a(),s("}")),a(),s("}"),{ast:n,code:t.code,preamble:"",map:t.map?t.map.toJSON():void 0}}function lP(n,e){const{ssr:t,prefixIdentifiers:i,push:s,newline:r,runtimeModuleName:o,runtimeGlobalName:a,ssrRuntimeModuleName:l}=e,c=a,h=u=>`${Ys[u]}: _${Ys[u]}`;if(n.helpers.length>0&&(s(`const _Vue = ${c}
`),n.hoists.length)){const u=[$p,Qp,zl,Kp,Qx].filter(d=>n.helpers.includes(d)).map(h).join(", ");s(`const { ${u} } = _Vue
`)}cP(n.hoists,e),r(),s("return ")}function _m(n,e,{helper:t,push:i,newline:s,isTS:r}){const o=t(e==="filter"?em:e==="component"?Jp:Zp);for(let a=0;a<n.length;a++){let l=n[a];const c=l.endsWith("__self");c&&(l=l.slice(0,-6)),i(`const ${Yl(l,e)} = ${o}(${JSON.stringify(l)}${c?", true":""})${r?"!":""}`),a<n.length-1&&s()}}function cP(n,e){if(!n.length)return;e.pure=!0;const{push:t,newline:i,helper:s,scopeId:r,mode:o}=e;i();for(let a=0;a<n.length;a++){const l=n[a];l&&(t(`const _hoisted_${a+1} = `),gn(l,e),i())}e.pure=!1}function ym(n,e){const t=n.length>3||!1;e.push("["),t&&e.indent(),Kl(n,e,t),t&&e.deindent(),e.push("]")}function Kl(n,e,t=!1,i=!0){const{push:s,newline:r}=e;for(let o=0;o<n.length;o++){const a=n[o];Ue(a)?s(a):Te(a)?ym(a,e):gn(a,e),o<n.length-1&&(t?(i&&s(","),r()):i&&s(", "))}}function gn(n,e){if(Ue(n)){e.push(n);return}if(Eo(n)){e.push(e.helper(n));return}switch(n.type){case 1:case 9:case 11:gn(n.codegenNode,e);break;case 2:uP(n,e);break;case 4:gb(n,e);break;case 5:hP(n,e);break;case 12:gn(n.codegenNode,e);break;case 8:_b(n,e);break;case 3:fP(n,e);break;case 13:pP(n,e);break;case 14:gP(n,e);break;case 15:_P(n,e);break;case 17:yP(n,e);break;case 18:vP(n,e);break;case 19:xP(n,e);break;case 20:bP(n,e);break;case 21:Kl(n.body,e,!0,!1);break}}function uP(n,e){e.push(JSON.stringify(n.content),n)}function gb(n,e){const{content:t,isStatic:i}=n;e.push(i?JSON.stringify(t):t,n)}function hP(n,e){const{push:t,helper:i,pure:s}=e;s&&t(xh),t(`${i(lh)}(`),gn(n.content,e),t(")")}function _b(n,e){for(let t=0;t<n.children.length;t++){const i=n.children[t];Ue(i)?e.push(i):gn(i,e)}}function dP(n,e){const{push:t}=e;if(n.type===8)t("["),_b(n,e),t("]");else if(n.isStatic){const i=hm(n.content)?n.content:JSON.stringify(n.content);t(i,n)}else t(`[${n.content}]`,n)}function fP(n,e){const{push:t,helper:i,pure:s}=e;s&&t(xh),t(`${i(zl)}(${JSON.stringify(n.content)})`,n)}function pP(n,e){const{push:t,helper:i,pure:s}=e,{tag:r,props:o,children:a,patchFlag:l,dynamicProps:c,directives:h,isBlock:u,disableTracking:d,isComponent:f}=n;h&&t(i(tm)+"("),u&&t(`(${i(Gr)}(${d?"true":""}), `),s&&t(xh);const p=u?zo(e.inSSR,f):Ho(e.inSSR,f);t(i(p)+"(",n),Kl(mP([r,o,a,l,c]),e),t(")"),u&&t(")"),h&&(t(", "),gn(h,e),t(")"))}function mP(n){let e=n.length;for(;e--&&n[e]==null;);return n.slice(0,e+1).map(t=>t||"null")}function gP(n,e){const{push:t,helper:i,pure:s}=e,r=Ue(n.callee)?n.callee:i(n.callee);s&&t(xh),t(r+"(",n),Kl(n.arguments,e),t(")")}function _P(n,e){const{push:t,indent:i,deindent:s,newline:r}=e,{properties:o}=n;if(!o.length){t("{}",n);return}const a=o.length>1||!1;t(a?"{":"{ "),a&&i();for(let l=0;l<o.length;l++){const{key:c,value:h}=o[l];dP(c,e),t(": "),gn(h,e),l<o.length-1&&(t(","),r())}a&&s(),t(a?"}":" }")}function yP(n,e){ym(n.elements,e)}function vP(n,e){const{push:t,indent:i,deindent:s}=e,{params:r,returns:o,body:a,newline:l,isSlot:c}=n;c&&t(`_${Ys[lm]}(`),t("(",n),Te(r)?Kl(r,e):r&&gn(r,e),t(") => "),(l||a)&&(t("{"),i()),o?(l&&t("return "),Te(o)?ym(o,e):gn(o,e)):a&&gn(a,e),(l||a)&&(s(),t("}")),c&&(n.isNonScopedSlot&&t(", undefined, true"),t(")"))}function xP(n,e){const{test:t,consequent:i,alternate:s,newline:r}=n,{push:o,indent:a,deindent:l,newline:c}=e;if(t.type===4){const u=!hm(t.content);u&&o("("),gb(t,e),u&&o(")")}else o("("),gn(t,e),o(")");r&&a(),e.indentLevel++,r||o(" "),o("? "),gn(i,e),e.indentLevel--,r&&c(),r||o(" "),o(": ");const h=s.type===19;h||e.indentLevel++,gn(s,e),h||e.indentLevel--,r&&l(!0)}function bP(n,e){const{push:t,helper:i,indent:s,deindent:r,newline:o}=e;t(`_cache[${n.index}] || (`),n.isVNode&&(s(),t(`${i(uh)}(-1),`),o()),t(`_cache[${n.index}] = `),gn(n.value,e),n.isVNode&&(t(","),o(),t(`${i(uh)}(1),`),o(),t(`_cache[${n.index}]`),r()),t(")")}new RegExp("\\b"+"do,if,for,let,new,try,var,case,else,with,await,break,catch,class,const,super,throw,while,yield,delete,export,import,return,switch,default,extends,finally,continue,debugger,function,arguments,typeof,void".split(",").join("\\b|\\b")+"\\b");const TP=mb(/^(if|else|else-if)$/,(n,e,t)=>wP(n,e,t,(i,s,r)=>{const o=t.parent.children;let a=o.indexOf(i),l=0;for(;a-->=0;){const c=o[a];c&&c.type===9&&(l+=c.branches.length)}return()=>{if(r)i.codegenNode=vb(s,l,t);else{const c=SP(i.codegenNode);c.alternate=vb(s,l+i.branches.length-1,t)}}}));function wP(n,e,t,i){if(e.name!=="else"&&(!e.exp||!e.exp.content.trim())){const s=e.exp?e.exp.loc:n.loc;t.onError(St(28,e.loc)),e.exp=qe("true",!1,s)}if(e.name==="if"){const s=yb(n,e),r={type:9,loc:n.loc,branches:[s]};if(t.replaceNode(r),i)return i(r,s,!0)}else{const s=t.parent.children;let r=s.indexOf(n);for(;r-->=-1;){const o=s[r];if(o&&o.type===2&&!o.content.trim().length){t.removeNode(o);continue}if(o&&o.type===9){e.name==="else-if"&&o.branches[o.branches.length-1].condition===void 0&&t.onError(St(30,n.loc)),t.removeNode();const a=yb(n,e);o.branches.push(a);const l=i&&i(o,a,!1);vh(a,t),l&&l(),t.currentNode=null}else t.onError(St(30,n.loc));break}}}function yb(n,e){return{type:10,loc:n.loc,condition:e.name==="else"?void 0:e.exp,children:n.tagType===3&&!ni(n,"for")?n.children:[n],userKey:ql(n,"key")}}function vb(n,e,t){return n.condition?um(n.condition,xb(n,e,t),Ot(t.helper(zl),['""',"true"])):xb(n,e,t)}function xb(n,e,t){const{helper:i}=t,s=Dt("key",qe(`${e}`,!1,$n,2)),{children:r}=n,o=r[0];if(r.length!==1||o.type!==1)if(r.length===1&&o.type===11){const l=o.codegenNode;return gh(l,s,t),l}else{let l=64;return Wl(t,i(Bl),ti([s]),r,l+"",void 0,void 0,!0,!1,!1,n.loc)}else{const l=o.codegenNode,c=HL(l);return c.type===13&&fm(c,t),gh(c,s,t),l}}function SP(n){for(;;)if(n.type===19)if(n.alternate.type===19)n=n.alternate;else return n;else n.type===20&&(n=n.value)}const EP=mb("for",(n,e,t)=>{const{helper:i,removeHelper:s}=t;return MP(n,e,t,r=>{const o=Ot(i(nm),[r.source]),a=ni(n,"memo"),l=ql(n,"key"),c=l&&(l.type===6?qe(l.value.content,!0):l.exp),h=l?Dt("key",c):null,u=r.source.type===4&&r.source.constType>0,d=u?64:l?128:256;return r.codegenNode=Wl(t,i(Bl),void 0,o,d+"",void 0,void 0,!0,!u,!1,n.loc),()=>{let f;const p=ph(n),{children:_}=r,y=_.length!==1||_[0].type!==1,m=mh(n)?n:p&&n.children.length===1&&mh(n.children[0])?n.children[0]:null;if(m?(f=m.codegenNode,p&&h&&gh(f,h,t)):y?f=Wl(t,i(Bl),h?ti([h]):void 0,n.children,64+"",void 0,void 0,!0,void 0,!1):(f=_[0].codegenNode,p&&h&&gh(f,h,t),f.isBlock!==!u&&(f.isBlock?(s(Gr),s(zo(t.inSSR,f.isComponent))):s(Ho(t.inSSR,f.isComponent))),f.isBlock=!u,f.isBlock?(i(Gr),i(zo(t.inSSR,f.isComponent))):i(Ho(t.inSSR,f.isComponent))),a){const g=Uo(vm(r.parseResult,[qe("_cached")]));g.body=LL([Ui(["const _memo = (",a.exp,")"]),Ui(["if (_cached",...c?[" && _cached.key === ",c]:[],` && ${t.helperString(Zx)}(_cached, _memo)) return _cached`]),Ui(["const _item = ",f]),qe("_item.memo = _memo"),qe("return _item")]),o.arguments.push(g,qe("_cache"),qe(String(t.cached++)))}else o.arguments.push(Uo(vm(r.parseResult),f,!0))}})});function MP(n,e,t,i){if(!e.exp){t.onError(St(31,e.loc));return}const s=Tb(e.exp);if(!s){t.onError(St(32,e.loc));return}const{addIdentifiers:r,removeIdentifiers:o,scopes:a}=t,{source:l,value:c,key:h,index:u}=s,d={type:11,loc:e.loc,source:l,valueAlias:c,keyAlias:h,objectIndexAlias:u,parseResult:s,children:ph(n)?n.children:[n]};t.replaceNode(d),a.vFor++;const f=i&&i(d);return()=>{a.vFor--,f&&f()}}const AP=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,bb=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,CP=/^\(|\)$/g;function Tb(n,e){const t=n.loc,i=n.content,s=i.match(AP);if(!s)return;const[,r,o]=s,a={source:bh(t,o.trim(),i.indexOf(o,r.length)),value:void 0,key:void 0,index:void 0};let l=r.trim().replace(CP,"").trim();const c=r.indexOf(l),h=l.match(bb);if(h){l=l.replace(bb,"").trim();const u=h[1].trim();let d;if(u&&(d=i.indexOf(u,c+l.length),a.key=bh(t,u,d)),h[2]){const f=h[2].trim();f&&(a.index=bh(t,f,i.indexOf(f,a.key?d+u.length:c+l.length)))}}return l&&(a.value=bh(t,l,c)),a}function bh(n,e,t){return qe(e,!1,nb(n,t,e.length))}function vm({value:n,key:e,index:t},i=[]){return IP([n,e,t,...i])}function IP(n){let e=n.length;for(;e--&&!n[e];);return n.slice(0,e+1).map((t,i)=>t||qe("_".repeat(i+1),!1))}const wb=qe("undefined",!1),RP=(n,e)=>{if(n.type===1&&(n.tagType===1||n.tagType===3)){const t=ni(n,"slot");if(t)return t.exp,e.scopes.vSlot++,()=>{e.scopes.vSlot--}}},LP=(n,e,t)=>Uo(n,e,!1,!0,e.length?e[0].loc:t);function PP(n,e,t=LP){e.helper(lm);const{children:i,loc:s}=n,r=[],o=[];let a=e.scopes.vSlot>0||e.scopes.vFor>0;const l=ni(n,"slot",!0);if(l){const{arg:_,exp:y}=l;_&&!Nn(_)&&(a=!0),r.push(Dt(_||qe("default",!0),t(y,i,s)))}let c=!1,h=!1;const u=[],d=new Set;for(let _=0;_<i.length;_++){const y=i[_];let m;if(!ph(y)||!(m=ni(y,"slot",!0))){y.type!==3&&u.push(y);continue}if(l){e.onError(St(37,m.loc));break}c=!0;const{children:g,loc:v}=y,{arg:x=qe("default",!0),exp:T,loc:S}=m;let b;Nn(x)?b=x?x.content:"default":a=!0;const M=t(T,g,v);let N,P,L;if(N=ni(y,"if"))a=!0,o.push(um(N.exp,Th(x,M),wb));else if(P=ni(y,/^else(-if)?$/,!0)){let V=_,O;for(;V--&&(O=i[V],O.type===3););if(O&&ph(O)&&ni(O,"if")){i.splice(_,1),_--;let H=o[o.length-1];for(;H.alternate.type===19;)H=H.alternate;H.alternate=P.exp?um(P.exp,Th(x,M),wb):Th(x,M)}else e.onError(St(30,P.loc))}else if(L=ni(y,"for")){a=!0;const V=L.parseResult||Tb(L.exp);V?o.push(Ot(e.helper(nm),[V.source,Uo(vm(V),Th(x,M),!0)])):e.onError(St(32,L.loc))}else{if(b){if(d.has(b)){e.onError(St(38,S));continue}d.add(b),b==="default"&&(h=!0)}r.push(Dt(x,M))}}if(!l){const _=(y,m)=>{const g=t(y,m,s);return e.compatConfig&&(g.isNonScopedSlot=!0),Dt("default",g)};c?u.length&&u.some(y=>Sb(y))&&(h?e.onError(St(39,u[0].loc)):r.push(_(void 0,u))):r.push(_(void 0,i))}const f=a?2:wh(n.children)?3:1;let p=ti(r.concat(Dt("_",qe(f+"",!1))),s);return o.length&&(p=Ot(e.helper(Jx),[p,Xl(o)])),{slots:p,hasDynamicSlots:a}}function Th(n,e){return ti([Dt("name",n),Dt("fn",e)])}function wh(n){for(let e=0;e<n.length;e++){const t=n[e];switch(t.type){case 1:if(t.tagType===2||wh(t.children))return!0;break;case 9:if(wh(t.branches))return!0;break;case 10:case 11:if(wh(t.children))return!0;break}}return!1}function Sb(n){return n.type!==2&&n.type!==12?!0:n.type===2?!!n.content.trim():Sb(n.content)}const Eb=new WeakMap,NP=(n,e)=>function(){if(n=e.currentNode,!(n.type===1&&(n.tagType===0||n.tagType===1)))return;const{tag:i,props:s}=n,r=n.tagType===1;let o=r?FP(n,e):`"${i}"`;const a=wt(o)&&o.callee===ah;let l,c,h,u=0,d,f,p,_=a||o===Hl||o===jp||!r&&(i==="svg"||i==="foreignObject"||ql(n,"key",!0));if(s.length>0){const y=Mb(n,e);l=y.props,u=y.patchFlag,f=y.dynamicPropNames;const m=y.directives;p=m&&m.length?Xl(m.map(g=>OP(g,e))):void 0}if(n.children.length>0)if(o===oh&&(_=!0,u|=1024),r&&o!==Hl&&o!==oh){const{slots:m,hasDynamicSlots:g}=PP(n,e);c=m,g&&(u|=1024)}else if(n.children.length===1&&o!==Hl){const m=n.children[0],g=m.type,v=g===5||g===8;v&&si(m,e)===0&&(u|=1),v||g===2?c=m:c=n.children}else c=n.children;u!==0&&(h=String(u),f&&f.length&&(d=kP(f))),n.codegenNode=Wl(e,o,l,c,h,d,p,!!_,!1,r,n.loc)};function FP(n,e,t=!1){let{tag:i}=n;const s=bm(i),r=ql(n,"is");if(r)if(s||Wr("COMPILER_IS_ON_ELEMENT",e)){const l=r.type===6?r.value&&qe(r.value.content,!0):r.exp;if(l)return Ot(e.helper(ah),[l])}else r.type===6&&r.value.content.startsWith("vue:")&&(i=r.value.content.slice(4));const o=!s&&ni(n,"is");if(o&&o.exp)return Ot(e.helper(ah),[o.exp]);const a=eb(i)||e.isBuiltInComponent(i);return a?(t||e.helper(a),a):(e.helper(Jp),e.components.add(i),Yl(i,"component"))}function Mb(n,e,t=n.props,i=!1){const{tag:s,loc:r}=n,o=n.tagType===1;let a=[];const l=[],c=[];let h=0,u=!1,d=!1,f=!1,p=!1,_=!1,y=!1;const m=[],g=({key:x,value:T})=>{if(Nn(x)){const S=x.content,b=Cr(S);if(!o&&b&&S.toLowerCase()!=="onclick"&&S!=="onUpdate:modelValue"&&!Rr(S)&&(p=!0),b&&Rr(S)&&(y=!0),T.type===20||(T.type===4||T.type===8)&&si(T,e)>0)return;S==="ref"?u=!0:S==="class"?d=!0:S==="style"?f=!0:S!=="key"&&!m.includes(S)&&m.push(S),o&&(S==="class"||S==="style")&&!m.includes(S)&&m.push(S)}else _=!0};for(let x=0;x<t.length;x++){const T=t[x];if(T.type===6){const{loc:S,name:b,value:M}=T;let N=qe(M?M.content:"",!0,M?M.loc:S);if(b==="ref"&&(u=!0),b==="is"&&(bm(s)||M&&M.content.startsWith("vue:")||Wr("COMPILER_IS_ON_ELEMENT",e)))continue;a.push(Dt(qe(b,!0,nb(S,0,b.length)),N))}else{const{name:S,arg:b,exp:M,loc:N}=T,P=S==="bind",L=S==="on";if(S==="slot"){o||e.onError(St(40,N));continue}if(S==="once"||S==="memo"||S==="is"||P&&fh(b,"is")&&(bm(s)||Wr("COMPILER_IS_ON_ELEMENT",e))||L&&i)continue;if(!b&&(P||L)){if(_=!0,M)if(a.length&&(l.push(ti(xm(a),r)),a=[]),P){if(Wr("COMPILER_V_BIND_OBJECT_ORDER",e)){l.unshift(M);continue}l.push(M)}else l.push({type:14,loc:N,callee:e.helper(rm),arguments:[M]});else e.onError(St(P?34:35,N));continue}const V=e.directiveTransforms[S];if(V){const{props:O,needRuntime:H}=V(T,n,e);!i&&O.forEach(g),a.push(...O),H&&(c.push(T),Eo(H)&&Eb.set(T,H))}else c.push(T)}T.type===6&&T.name==="ref"&&e.scopes.vFor>0&&Vo("COMPILER_V_FOR_REF",e,T.loc)&&a.push(Dt(qe("refInFor",!0),qe("true",!1)))}let v;if(l.length?(a.length&&l.push(ti(xm(a),r)),l.length>1?v=Ot(e.helper(ch),l,r):v=l[0]):a.length&&(v=ti(xm(a),r)),_?h|=16:(d&&!o&&(h|=2),f&&!o&&(h|=4),m.length&&(h|=8),p&&(h|=32)),(h===0||h===32)&&(u||y||c.length>0)&&(h|=512),!e.inSSR&&v)switch(v.type){case 15:let x=-1,T=-1,S=!1;for(let N=0;N<v.properties.length;N++){const P=v.properties[N].key;Nn(P)?P.content==="class"?x=N:P.content==="style"&&(T=N):P.isHandlerKey||(S=!0)}const b=v.properties[x],M=v.properties[T];S?v=Ot(e.helper(Vl),[v]):(b&&!Nn(b.value)&&(b.value=Ot(e.helper(im),[b.value])),M&&!Nn(M.value)&&(f||M.value.type===17)&&(M.value=Ot(e.helper(sm),[M.value])));break;case 14:break;default:v=Ot(e.helper(Vl),[Ot(e.helper(Gl),[v])]);break}return{props:v,directives:c,patchFlag:h,dynamicPropNames:m}}function xm(n){const e=new Map,t=[];for(let i=0;i<n.length;i++){const s=n[i];if(s.key.type===8||!s.key.isStatic){t.push(s);continue}const r=s.key.content,o=e.get(r);o?(r==="style"||r==="class"||Cr(r))&&DP(o,s):(e.set(r,s),t.push(s))}return t}function DP(n,e){n.value.type===17?n.value.elements.push(e.value):n.value=Xl([n.value,e.value],n.loc)}function OP(n,e){const t=[],i=Eb.get(n);i?t.push(e.helperString(i)):(e.helper(Zp),e.directives.add(n.name),t.push(Yl(n.name,"directive")));const{loc:s}=n;if(n.exp&&t.push(n.exp),n.arg&&(n.exp||t.push("void 0"),t.push(n.arg)),Object.keys(n.modifiers).length){n.arg||(n.exp||t.push("void 0"),t.push("void 0"));const r=qe("true",!1,s);t.push(ti(n.modifiers.map(o=>Dt(o,r)),s))}return Xl(t,n.loc)}function kP(n){let e="[";for(let t=0,i=n.length;t<i;t++)e+=JSON.stringify(n[t]),t<i-1&&(e+=", ");return e+"]"}function bm(n){return n==="component"||n==="Component"}const UP=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},BP=/-(\w)/g,Ab=UP(n=>n.replace(BP,(e,t)=>t?t.toUpperCase():"")),HP=(n,e)=>{if(mh(n)){const{children:t,loc:i}=n,{slotName:s,slotProps:r}=zP(n,e),o=[e.prefixIdentifiers?"_ctx.$slots":"$slots",s,"{}","undefined","true"];let a=2;r&&(o[2]=r,a=3),t.length&&(o[3]=Uo([],t,!1,!1,i),a=4),e.scopeId&&!e.slotted&&(a=5),o.splice(a),n.codegenNode=Ot(e.helper(Kx),o,i)}};function zP(n,e){let t='"default"',i;const s=[];for(let r=0;r<n.props.length;r++){const o=n.props[r];o.type===6?o.value&&(o.name==="name"?t=JSON.stringify(o.value.content):(o.name=Ab(o.name),s.push(o))):o.name==="bind"&&fh(o.arg,"name")?o.exp&&(t=o.exp):(o.name==="bind"&&o.arg&&Nn(o.arg)&&(o.arg.content=Ab(o.arg.content)),s.push(o))}if(s.length>0){const{props:r,directives:o}=Mb(n,e,s);i=r,o.length&&e.onError(St(36,o[0].loc))}return{slotName:t,slotProps:i}}const VP=/^\s*([\w$_]+|(async\s*)?\([^)]*?\))\s*=>|^\s*(async\s+)?function(?:\s+[\w$]+)?\s*\(/,Cb=(n,e,t,i)=>{const{loc:s,modifiers:r,arg:o}=n;!n.exp&&!r.length&&t.onError(St(35,s));let a;if(o.type===4)if(o.isStatic){const u=o.content;a=qe(Mo(pn(u)),!0,o.loc)}else a=Ui([`${t.helperString(am)}(`,o,")"]);else a=o,a.children.unshift(`${t.helperString(am)}(`),a.children.push(")");let l=n.exp;l&&!l.content.trim()&&(l=void 0);let c=t.cacheHandlers&&!l&&!t.inVOnce;if(l){const u=tb(l.content),d=!(u||VP.test(l.content)),f=l.content.includes(";");(d||c&&u)&&(l=Ui([`${d?"$event":"(...args)"} => ${f?"{":"("}`,l,f?"}":")"]))}let h={props:[Dt(a,l||qe("() => {}",!1,s))]};return i&&(h=i(h)),c&&(h.props[0].value=t.cache(h.props[0].value)),h.props.forEach(u=>u.key.isHandlerKey=!0),h},GP=(n,e,t)=>{const{exp:i,modifiers:s,loc:r}=n,o=n.arg;return o.type!==4?(o.children.unshift("("),o.children.push(') || ""')):o.isStatic||(o.content=`${o.content} || ""`),s.includes("camel")&&(o.type===4?o.isStatic?o.content=pn(o.content):o.content=`${t.helperString(om)}(${o.content})`:(o.children.unshift(`${t.helperString(om)}(`),o.children.push(")"))),t.inSSR||(s.includes("prop")&&Ib(o,"."),s.includes("attr")&&Ib(o,"^")),!i||i.type===4&&!i.content.trim()?(t.onError(St(34,r)),{props:[Dt(o,qe("",!0,r))]}):{props:[Dt(o,i)]}},Ib=(n,e)=>{n.type===4?n.isStatic?n.content=e+n.content:n.content=`\`${e}\${${n.content}}\``:(n.children.unshift(`'${e}' + (`),n.children.push(")"))},WP=(n,e)=>{if(n.type===0||n.type===1||n.type===11||n.type===10)return()=>{const t=n.children;let i,s=!1;for(let r=0;r<t.length;r++){const o=t[r];if(dm(o)){s=!0;for(let a=r+1;a<t.length;a++){const l=t[a];if(dm(l))i||(i=t[r]={type:8,loc:o.loc,children:[o]}),i.children.push(" + ",l),t.splice(a,1),a--;else{i=void 0;break}}}}if(!(!s||t.length===1&&(n.type===0||n.type===1&&n.tagType===0&&!n.props.find(r=>r.type===7&&!e.directiveTransforms[r.name])&&n.tag!=="template")))for(let r=0;r<t.length;r++){const o=t[r];if(dm(o)||o.type===8){const a=[];(o.type!==2||o.content!==" ")&&a.push(o),!e.ssr&&si(o,e)===0&&a.push(1+""),t[r]={type:12,content:o,loc:o.loc,codegenNode:Ot(e.helper(Kp),a)}}}}},Rb=new WeakSet,XP=(n,e)=>{if(n.type===1&&ni(n,"once",!0))return Rb.has(n)||e.inVOnce?void 0:(Rb.add(n),e.inVOnce=!0,e.helper(uh),()=>{e.inVOnce=!1;const t=e.currentNode;t.codegenNode&&(t.codegenNode=e.cache(t.codegenNode,!0))})},Lb=(n,e,t)=>{const{exp:i,arg:s}=n;if(!i)return t.onError(St(41,n.loc)),Tm();const r=i.loc.source,o=i.type===4?i.content:r;t.bindingMetadata[r];const a=!1;if(!o.trim()||!tb(o)&&!a)return t.onError(St(42,i.loc)),Tm();const l=s||qe("modelValue",!0),c=s?Nn(s)?`onUpdate:${s.content}`:Ui(['"onUpdate:" + ',s]):"onUpdate:modelValue";let h;const u=t.isTS?"($event: any)":"$event";h=Ui([`${u} => ((`,i,") = $event)"]);const d=[Dt(l,n.exp),Dt(c,h)];if(n.modifiers.length&&e.tagType===1){const f=n.modifiers.map(_=>(hm(_)?_:JSON.stringify(_))+": true").join(", "),p=s?Nn(s)?`${s.content}Modifiers`:Ui([s,' + "Modifiers"']):"modelModifiers";d.push(Dt(p,qe(`{ ${f} }`,!1,n.loc,2)))}return Tm(d)};function Tm(n=[]){return{props:n}}const qP=/[\w).+\-_$\]]/,YP=(n,e)=>{!Wr("COMPILER_FILTER",e)||(n.type===5&&Sh(n.content,e),n.type===1&&n.props.forEach(t=>{t.type===7&&t.name!=="for"&&t.exp&&Sh(t.exp,e)}))};function Sh(n,e){if(n.type===4)Pb(n,e);else for(let t=0;t<n.children.length;t++){const i=n.children[t];typeof i=="object"&&(i.type===4?Pb(i,e):i.type===8?Sh(n,e):i.type===5&&Sh(i.content,e))}}function Pb(n,e){const t=n.content;let i=!1,s=!1,r=!1,o=!1,a=0,l=0,c=0,h=0,u,d,f,p,_=[];for(f=0;f<t.length;f++)if(d=u,u=t.charCodeAt(f),i)u===39&&d!==92&&(i=!1);else if(s)u===34&&d!==92&&(s=!1);else if(r)u===96&&d!==92&&(r=!1);else if(o)u===47&&d!==92&&(o=!1);else if(u===124&&t.charCodeAt(f+1)!==124&&t.charCodeAt(f-1)!==124&&!a&&!l&&!c)p===void 0?(h=f+1,p=t.slice(0,f).trim()):y();else{switch(u){case 34:s=!0;break;case 39:i=!0;break;case 96:r=!0;break;case 40:c++;break;case 41:c--;break;case 91:l++;break;case 93:l--;break;case 123:a++;break;case 125:a--;break}if(u===47){let m=f-1,g;for(;m>=0&&(g=t.charAt(m),g===" ");m--);(!g||!qP.test(g))&&(o=!0)}}p===void 0?p=t.slice(0,f).trim():h!==0&&y();function y(){_.push(t.slice(h,f).trim()),h=f+1}if(_.length){for(f=0;f<_.length;f++)p=jP(p,_[f],e);n.content=p}}function jP(n,e,t){t.helper(em);const i=e.indexOf("(");if(i<0)return t.filters.add(e),`${Yl(e,"filter")}(${n})`;{const s=e.slice(0,i),r=e.slice(i+1);return t.filters.add(s),`${Yl(s,"filter")}(${n}${r!==")"?","+r:r}`}}const Nb=new WeakSet,$P=(n,e)=>{if(n.type===1){const t=ni(n,"memo");return!t||Nb.has(n)?void 0:(Nb.add(n),()=>{const i=n.codegenNode||e.currentNode.codegenNode;i&&i.type===13&&(n.tagType!==1&&fm(i,e),n.codegenNode=Ot(e.helper(cm),[t.exp,Uo(void 0,i),"_cache",String(e.cached++)]))})}};function QP(n){return[[XP,TP,$P,EP,YP,HP,NP,RP,WP],{on:Cb,bind:GP,model:Lb}]}function KP(n,e={}){const t=e.onError||Yp,i=e.mode==="module";e.prefixIdentifiers===!0?t(St(46)):i&&t(St(47));const s=!1;e.cacheHandlers&&t(St(48)),e.scopeId&&!i&&t(St(49));const r=Ue(n)?GL(n,e):n,[o,a]=QP();return iP(r,tt({},e,{prefixIdentifiers:s,nodeTransforms:[...o,...e.nodeTransforms||[]],directiveTransforms:tt({},a,e.directiveTransforms||{})})),aP(r,tt({},e,{prefixIdentifiers:s}))}const JP=()=>({props:[]}),Fb=Symbol(""),Db=Symbol(""),Ob=Symbol(""),kb=Symbol(""),wm=Symbol(""),Ub=Symbol(""),Bb=Symbol(""),Hb=Symbol(""),zb=Symbol(""),Vb=Symbol("");CL({[Fb]:"vModelRadio",[Db]:"vModelCheckbox",[Ob]:"vModelText",[kb]:"vModelSelect",[wm]:"vModelDynamic",[Ub]:"withModifiers",[Bb]:"withKeys",[Hb]:"vShow",[zb]:"Transition",[Vb]:"TransitionGroup"});let Go;function ZP(n,e=!1){return Go||(Go=document.createElement("div")),e?(Go.innerHTML=`<div foo="${n.replace(/"/g,"&quot;")}">`,Go.children[0].getAttribute("foo")):(Go.innerHTML=n,Go.textContent)}const e2=Gn("style,iframe,script,noscript",!0),t2={isVoidTag:iC,isNativeTag:n=>tC(n)||nC(n),isPreTag:n=>n==="pre",decodeEntities:ZP,isBuiltInComponent:n=>{if(Bo(n,"Transition"))return zb;if(Bo(n,"TransitionGroup"))return Vb},getNamespace(n,e){let t=e?e.ns:0;if(e&&t===2)if(e.tag==="annotation-xml"){if(n==="svg")return 1;e.props.some(i=>i.type===6&&i.name==="encoding"&&i.value!=null&&(i.value.content==="text/html"||i.value.content==="application/xhtml+xml"))&&(t=0)}else/^m(?:[ions]|text)$/.test(e.tag)&&n!=="mglyph"&&n!=="malignmark"&&(t=0);else e&&t===1&&(e.tag==="foreignObject"||e.tag==="desc"||e.tag==="title")&&(t=0);if(t===0){if(n==="svg")return 1;if(n==="math")return 2}return t},getTextMode({tag:n,ns:e}){if(e===0){if(n==="textarea"||n==="title")return 1;if(e2(n))return 2}return 0}},n2=n=>{n.type===1&&n.props.forEach((e,t)=>{e.type===6&&e.name==="style"&&e.value&&(n.props[t]={type:7,name:"bind",arg:qe("style",!0,e.loc),exp:i2(e.value.content,e.loc),modifiers:[],loc:e.loc})})},i2=(n,e)=>{const t=Ey(n);return qe(JSON.stringify(t),!1,e,3)};function cs(n,e){return St(n,e)}const s2=(n,e,t)=>{const{exp:i,loc:s}=n;return i||t.onError(cs(50,s)),e.children.length&&(t.onError(cs(51,s)),e.children.length=0),{props:[Dt(qe("innerHTML",!0,s),i||qe("",!0))]}},r2=(n,e,t)=>{const{exp:i,loc:s}=n;return i||t.onError(cs(52,s)),e.children.length&&(t.onError(cs(53,s)),e.children.length=0),{props:[Dt(qe("textContent",!0),i?Ot(t.helperString(lh),[i],s):qe("",!0))]}},o2=(n,e,t)=>{const i=Lb(n,e,t);if(!i.props.length||e.tagType===1)return i;n.arg&&t.onError(cs(55,n.arg.loc));const{tag:s}=e,r=t.isCustomElement(s);if(s==="input"||s==="textarea"||s==="select"||r){let o=Ob,a=!1;if(s==="input"||r){const l=ql(e,"type");if(l){if(l.type===7)o=wm;else if(l.value)switch(l.value.content){case"radio":o=Fb;break;case"checkbox":o=Db;break;case"file":a=!0,t.onError(cs(56,n.loc));break}}else kL(e)&&(o=wm)}else s==="select"&&(o=kb);a||(i.needRuntime=t.helper(o))}else t.onError(cs(54,n.loc));return i.props=i.props.filter(o=>!(o.key.type===4&&o.key.content==="modelValue")),i},a2=Gn("passive,once,capture"),l2=Gn("stop,prevent,self,ctrl,shift,alt,meta,exact,middle"),c2=Gn("left,right"),Gb=Gn("onkeyup,onkeydown,onkeypress",!0),u2=(n,e,t,i)=>{const s=[],r=[],o=[];for(let a=0;a<e.length;a++){const l=e[a];l==="native"&&Vo("COMPILER_V_ON_NATIVE",t)||a2(l)?o.push(l):c2(l)?Nn(n)?Gb(n.content)?s.push(l):r.push(l):(s.push(l),r.push(l)):l2(l)?r.push(l):s.push(l)}return{keyModifiers:s,nonKeyModifiers:r,eventOptionModifiers:o}},Wb=(n,e)=>Nn(n)&&n.content.toLowerCase()==="onclick"?qe(e,!0):n.type!==4?Ui(["(",n,`) === "onClick" ? "${e}" : (`,n,")"]):n,h2=(n,e,t)=>Cb(n,e,t,i=>{const{modifiers:s}=n;if(!s.length)return i;let{key:r,value:o}=i.props[0];const{keyModifiers:a,nonKeyModifiers:l,eventOptionModifiers:c}=u2(r,s,t,n.loc);if(l.includes("right")&&(r=Wb(r,"onContextmenu")),l.includes("middle")&&(r=Wb(r,"onMouseup")),l.length&&(o=Ot(t.helper(Ub),[o,JSON.stringify(l)])),a.length&&(!Nn(r)||Gb(r.content))&&(o=Ot(t.helper(Bb),[o,JSON.stringify(a)])),c.length){const h=c.map(Lr).join("");r=Nn(r)?qe(`${r.content}${h}`,!0):Ui(["(",r,`) + "${h}"`])}return{props:[Dt(r,o)]}}),d2=(n,e,t)=>{const{exp:i,loc:s}=n;return i||t.onError(cs(58,s)),{props:[],needRuntime:t.helper(Hb)}},f2=(n,e)=>{n.type===1&&n.tagType===0&&(n.tag==="script"||n.tag==="style")&&(e.onError(cs(60,n.loc)),e.removeNode())},p2=[n2],m2={cloak:JP,html:s2,text:r2,model:o2,on:h2,show:d2};function g2(n,e={}){return KP(n,tt({},t2,e,{nodeTransforms:[f2,...p2,...e.nodeTransforms||[]],directiveTransforms:tt({},m2,e.directiveTransforms||{}),transformHoist:null}))}const Xb=Object.create(null);function _2(n,e){if(!Ue(n))if(n.nodeType)n=n.innerHTML;else return Sn;const t=n,i=Xb[t];if(i)return i;if(n[0]==="#"){const o=document.querySelector(n);n=o?o.innerHTML:""}const{code:s}=g2(n,tt({hoistStatic:!0,onError:void 0,onWarn:Sn},e)),r=new Function("Vue",s)(TL);return r._rc=!0,Xb[t]=r}jv(_2);/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const us="132",Wo={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Xo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},y2=0,qb=1,v2=2,Yb=1,x2=2,Jl=3,js=0,Rt=1,Bi=2,jb=1,$s=0,Zl=1,Sm=2,$b=3,Qb=4,b2=5,qo=100,T2=101,w2=102,Kb=103,Jb=104,S2=200,E2=201,M2=202,A2=203,Zb=204,eT=205,C2=206,I2=207,R2=208,L2=209,P2=210,N2=0,F2=1,D2=2,Em=3,O2=4,k2=5,U2=6,B2=7,Eh=0,H2=1,z2=2,Xr=0,tT=1,V2=2,G2=3,W2=4,X2=5,nT=300,Mh=301,Ah=302,Mm=303,Am=304,Ch=306,Cm=307,Yo=1e3,Fn=1001,Ih=1002,zt=1003,Im=1004,Rm=1005,$t=1006,iT=1007,jo=1008,$o=1009,q2=1010,Y2=1011,Rh=1012,j2=1013,Lh=1014,Qs=1015,Qo=1016,$2=1017,Q2=1018,K2=1019,ec=1020,J2=1021,Hi=1022,_n=1023,Z2=1024,e3=1025,t3=_n,Ko=1026,tc=1027,n3=1028,i3=1029,s3=1030,r3=1031,o3=1032,a3=1033,sT=33776,rT=33777,oT=33778,aT=33779,lT=35840,cT=35841,uT=35842,hT=35843,l3=36196,dT=37492,fT=37496,c3=37808,u3=37809,h3=37810,d3=37811,f3=37812,p3=37813,m3=37814,g3=37815,_3=37816,y3=37817,v3=37818,x3=37819,b3=37820,T3=37821,w3=36492,S3=37840,E3=37841,M3=37842,A3=37843,C3=37844,I3=37845,R3=37846,L3=37847,P3=37848,N3=37849,F3=37850,D3=37851,O3=37852,k3=37853,U3=2200,B3=2201,H3=2202,nc=2300,Jo=2301,Lm=2302,Zo=2400,ea=2401,Ph=2402,Pm=2500,pT=2501,z3=0,V3=1,mT=2,Lt=3e3,ri=3001,Nh=3007,Fh=3002,G3=3003,Nm=3004,Fm=3005,Dm=3006,W3=3200,X3=3201,Ks=0,q3=1,Om=7680,Y3=519,ic=35044,Dh=35048,gT="300 es";class Js{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}const un=[];for(let n=0;n<256;n++)un[n]=(n<16?"0":"")+n.toString(16);let Oh=1234567;const sc=Math.PI/180,rc=180/Math.PI;function oi(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(un[n&255]+un[n>>8&255]+un[n>>16&255]+un[n>>24&255]+"-"+un[e&255]+un[e>>8&255]+"-"+un[e>>16&15|64]+un[e>>24&255]+"-"+un[t&63|128]+un[t>>8&255]+"-"+un[t>>16&255]+un[t>>24&255]+un[i&255]+un[i>>8&255]+un[i>>16&255]+un[i>>24&255]).toUpperCase()}function An(n,e,t){return Math.max(e,Math.min(t,n))}function km(n,e){return(n%e+e)%e}function j3(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}function $3(n,e,t){return n!==e?(t-n)/(e-n):0}function oc(n,e,t){return(1-t)*n+t*e}function Q3(n,e,t,i){return oc(n,e,1-Math.exp(-t*i))}function K3(n,e=1){return e-Math.abs(km(n,e*2)-e)}function J3(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function Z3(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function eN(n,e){return n+Math.floor(Math.random()*(e-n+1))}function tN(n,e){return n+Math.random()*(e-n)}function nN(n){return n*(.5-Math.random())}function iN(n){return n!==void 0&&(Oh=n%2147483647),Oh=Oh*16807%2147483647,(Oh-1)/2147483646}function sN(n){return n*sc}function rN(n){return n*rc}function Um(n){return(n&n-1)==0&&n!==0}function _T(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function yT(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function oN(n,e,t,i,s){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),u=r((e-i)/2),d=o((e-i)/2),f=r((i-e)/2),p=o((i-e)/2);switch(s){case"XYX":n.set(a*h,l*u,l*d,a*c);break;case"YZY":n.set(l*d,a*h,l*u,a*c);break;case"ZXZ":n.set(l*u,l*d,a*h,a*c);break;case"XZX":n.set(a*h,l*p,l*f,a*c);break;case"YXY":n.set(l*f,a*h,l*p,a*c);break;case"ZYZ":n.set(l*p,l*f,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}var aN=Object.freeze({__proto__:null,DEG2RAD:sc,RAD2DEG:rc,generateUUID:oi,clamp:An,euclideanModulo:km,mapLinear:j3,inverseLerp:$3,lerp:oc,damp:Q3,pingpong:K3,smoothstep:J3,smootherstep:Z3,randInt:eN,randFloat:tN,randFloatSpread:nN,seededRandom:iN,degToRad:sN,radToDeg:rN,isPowerOfTwo:Um,ceilPowerOfTwo:_T,floorPowerOfTwo:yT,setQuaternionFromProperEuler:oN});class ie{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*s+e.x,this.y=r*s+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}ie.prototype.isVector2=!0;class hn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,s,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=s,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],u=i[7],d=i[2],f=i[5],p=i[8],_=s[0],y=s[3],m=s[6],g=s[1],v=s[4],x=s[7],T=s[2],S=s[5],b=s[8];return r[0]=o*_+a*g+l*T,r[3]=o*y+a*v+l*S,r[6]=o*m+a*x+l*b,r[1]=c*_+h*g+u*T,r[4]=c*y+h*v+u*S,r[7]=c*m+h*x+u*b,r[2]=d*_+f*g+p*T,r[5]=d*y+f*v+p*S,r[8]=d*m+f*x+p*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+s*r*c-s*o*l}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=h*o-a*c,d=a*l-h*r,f=c*r-o*l,p=t*u+i*d+s*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/p;return e[0]=u*_,e[1]=(s*c-h*i)*_,e[2]=(a*i-s*o)*_,e[3]=d*_,e[4]=(h*t-s*l)*_,e[5]=(s*r-a*t)*_,e[6]=f*_,e[7]=(i*l-c*t)*_,e[8]=(o*t-i*r)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-s*c,s*l,-s*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),s=this.elements,r=s[0],o=s[3],a=s[6],l=s[1],c=s[4],h=s[7];return s[0]=t*r+i*l,s[3]=t*o+i*c,s[6]=t*a+i*h,s[1]=-i*r+t*l,s[4]=-i*o+t*c,s[7]=-i*a+t*h,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}hn.prototype.isMatrix3=!0;let ta;class na{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{ta===void 0&&(ta=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),ta.width=e.width,ta.height=e.height;const i=ta.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=ta}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let lN=0;class Qt extends Js{constructor(e=Qt.DEFAULT_IMAGE,t=Qt.DEFAULT_MAPPING,i=Fn,s=Fn,r=$t,o=jo,a=_n,l=$o,c=1,h=Lt){super();Object.defineProperty(this,"id",{value:lN++}),this.uuid=oi(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new ie(0,0),this.repeat=new ie(1,1),this.center=new ie(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new hn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const s=this.image;if(s.uuid===void 0&&(s.uuid=oi()),!t&&e.images[s.uuid]===void 0){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(Bm(s[o].image)):r.push(Bm(s[o]))}else r=Bm(s);e.images[s.uuid]={uuid:s.uuid,url:r}}i.image=s.uuid}return t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==nT)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Yo:e.x=e.x-Math.floor(e.x);break;case Fn:e.x=e.x<0?0:1;break;case Ih:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Yo:e.y=e.y-Math.floor(e.y);break;case Fn:e.y=e.y<0?0:1;break;case Ih:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}Qt.DEFAULT_IMAGE=void 0;Qt.DEFAULT_MAPPING=nT;Qt.prototype.isTexture=!0;function Bm(n){return typeof HTMLImageElement!="undefined"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&n instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&n instanceof ImageBitmap?na.getDataURL(n):n.data?{data:Array.prototype.slice.call(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Be{constructor(e=0,t=0,i=0,s=1){this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*s+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,r;const o=.01,a=.1,l=e.elements,c=l[0],h=l[4],u=l[8],d=l[1],f=l[5],p=l[9],_=l[2],y=l[6],m=l[10];if(Math.abs(h-d)<o&&Math.abs(u-_)<o&&Math.abs(p-y)<o){if(Math.abs(h+d)<a&&Math.abs(u+_)<a&&Math.abs(p+y)<a&&Math.abs(c+f+m-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const v=(c+1)/2,x=(f+1)/2,T=(m+1)/2,S=(h+d)/4,b=(u+_)/4,M=(p+y)/4;return v>x&&v>T?v<o?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(v),s=S/i,r=b/i):x>T?x<o?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(x),i=S/s,r=M/s):T<o?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(T),i=b/r,s=M/r),this.set(i,s,r,t),this}let g=Math.sqrt((y-p)*(y-p)+(u-_)*(u-_)+(d-h)*(d-h));return Math.abs(g)<.001&&(g=1),this.x=(y-p)/g,this.y=(u-_)/g,this.z=(d-h)/g,this.w=Math.acos((c+f+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Be.prototype.isVector4=!0;class Dn extends Js{constructor(e,t,i={}){super();this.width=e,this.height=t,this.depth=1,this.scissor=new Be(0,0,e,t),this.scissorTest=!1,this.viewport=new Be(0,0,e,t),this.texture=new Qt(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:$t,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=wy({},this.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Dn.prototype.isWebGLRenderTarget=!0;class cN extends Dn{constructor(e,t,i){super(e,t);const s=this.texture;this.texture=[];for(let r=0;r<i;r++)this.texture[r]=s.clone()}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let s=0,r=this.texture.length;s<r;s++)this.texture[s].image.width=e,this.texture[s].image.height=t,this.texture[s].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}cN.prototype.isWebGLMultipleRenderTargets=!0;class vT extends Dn{constructor(e,t,i){super(e,t,i);this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}vT.prototype.isWebGLMultisampleRenderTarget=!0;class gt{constructor(e=0,t=0,i=0,s=1){this._x=e,this._y=t,this._z=i,this._w=s}static slerp(e,t,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,s)}static slerpFlat(e,t,i,s,r,o,a){let l=i[s+0],c=i[s+1],h=i[s+2],u=i[s+3];const d=r[o+0],f=r[o+1],p=r[o+2],_=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u;return}if(a===1){e[t+0]=d,e[t+1]=f,e[t+2]=p,e[t+3]=_;return}if(u!==_||l!==d||c!==f||h!==p){let y=1-a;const m=l*d+c*f+h*p+u*_,g=m>=0?1:-1,v=1-m*m;if(v>Number.EPSILON){const T=Math.sqrt(v),S=Math.atan2(T,m*g);y=Math.sin(y*S)/T,a=Math.sin(a*S)/T}const x=a*g;if(l=l*y+d*x,c=c*y+f*x,h=h*y+p*x,u=u*y+_*x,y===1-a){const T=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=T,c*=T,h*=T,u*=T}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,s,r,o){const a=i[s],l=i[s+1],c=i[s+2],h=i[s+3],u=r[o],d=r[o+1],f=r[o+2],p=r[o+3];return e[t]=a*p+h*u+l*f-c*d,e[t+1]=l*p+h*d+c*u-a*f,e[t+2]=c*p+h*f+a*d-l*u,e[t+3]=h*p-a*u-l*d-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(s/2),u=a(r/2),d=l(i/2),f=l(s/2),p=l(r/2);switch(o){case"XYZ":this._x=d*h*u+c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u-d*f*p;break;case"YXZ":this._x=d*h*u+c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u+d*f*p;break;case"ZXY":this._x=d*h*u-c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u-d*f*p;break;case"ZYX":this._x=d*h*u-c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u+d*f*p;break;case"YZX":this._x=d*h*u+c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u-d*f*p;break;case"XZY":this._x=d*h*u-c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],u=t[10],d=i+a+u;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(h-l)*f,this._y=(r-c)*f,this._z=(o-s)*f}else if(i>a&&i>u){const f=2*Math.sqrt(1+i-a-u);this._w=(h-l)/f,this._x=.25*f,this._y=(s+o)/f,this._z=(r+c)/f}else if(a>u){const f=2*Math.sqrt(1+a-i-u);this._w=(r-c)/f,this._x=(s+o)/f,this._y=.25*f,this._z=(l+h)/f}else{const f=2*Math.sqrt(1+u-i-a);this._w=(o-s)/f,this._x=(r+c)/f,this._y=(l+h)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(An(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+s*c-r*l,this._y=s*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-s*a,this._w=o*h-i*a-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*s+t*this._y,this._z=f*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),u=Math.sin((1-t)*h)/c,d=Math.sin(t*h)/c;return this._w=o*u+this._w*d,this._x=i*u+this._x*d,this._y=s*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){this.copy(e).slerp(t,i)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}gt.prototype.isQuaternion=!0;class C{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(xT.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(xT.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*s-a*i,h=l*i+a*t-r*s,u=l*s+r*i-o*t,d=-r*t-o*i-a*s;return this.x=c*l+d*-r+h*-a-u*-o,this.y=h*l+d*-o+u*-r-c*-a,this.z=u*l+d*-a+c*-o-h*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=s*l-r*a,this.y=r*o-i*l,this.z=i*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Hm.copy(this).projectOnVector(e),this.sub(Hm)}reflect(e){return this.sub(Hm.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(An(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}C.prototype.isVector3=!0;const Hm=new C,xT=new gt;class ai{constructor(e=new C(1/0,1/0,1/0),t=new C(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const h=e[l],u=e[l+1],d=e[l+2];h<t&&(t=h),u<i&&(i=u),d<s&&(s=d),h>r&&(r=h),u>o&&(o=u),d>a&&(a=d)}return this.min.set(t,i,s),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const h=e.getX(l),u=e.getY(l),d=e.getZ(l);h<t&&(t=h),u<i&&(i=u),d<s&&(s=d),h>r&&(r=h),u>o&&(o=u),d>a&&(a=d)}return this.min.set(t,i,s),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=ac.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),zm.copy(t.boundingBox),zm.applyMatrix4(e.matrixWorld),this.union(zm));const i=e.children;for(let s=0,r=i.length;s<r;s++)this.expandByObject(i[s]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ac),ac.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(lc),kh.subVectors(this.max,lc),ia.subVectors(e.a,lc),sa.subVectors(e.b,lc),ra.subVectors(e.c,lc),Zs.subVectors(sa,ia),er.subVectors(ra,sa),qr.subVectors(ia,ra);let t=[0,-Zs.z,Zs.y,0,-er.z,er.y,0,-qr.z,qr.y,Zs.z,0,-Zs.x,er.z,0,-er.x,qr.z,0,-qr.x,-Zs.y,Zs.x,0,-er.y,er.x,0,-qr.y,qr.x,0];return!Vm(t,ia,sa,ra,kh)||(t=[1,0,0,0,1,0,0,0,1],!Vm(t,ia,sa,ra,kh))?!1:(Uh.crossVectors(Zs,er),t=[Uh.x,Uh.y,Uh.z],Vm(t,ia,sa,ra,kh))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ac.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(ac).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(hs[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),hs[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),hs[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),hs[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),hs[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),hs[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),hs[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),hs[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(hs),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}ai.prototype.isBox3=!0;const hs=[new C,new C,new C,new C,new C,new C,new C,new C],ac=new C,zm=new ai,ia=new C,sa=new C,ra=new C,Zs=new C,er=new C,qr=new C,lc=new C,kh=new C,Uh=new C,Yr=new C;function Vm(n,e,t,i,s){for(let r=0,o=n.length-3;r<=o;r+=3){Yr.fromArray(n,r);const a=s.x*Math.abs(Yr.x)+s.y*Math.abs(Yr.y)+s.z*Math.abs(Yr.z),l=e.dot(Yr),c=t.dot(Yr),h=i.dot(Yr);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const uN=new ai,bT=new C,Gm=new C,Wm=new C;class jr{constructor(e=new C,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):uN.setFromPoints(e).getCenter(i);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Wm.subVectors(e,this.center);const t=Wm.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.add(Wm.multiplyScalar(s/i)),this.radius+=s}return this}union(e){return Gm.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(bT.copy(e.center).add(Gm)),this.expandByPoint(bT.copy(e.center).sub(Gm)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ds=new C,Xm=new C,Bh=new C,tr=new C,qm=new C,Hh=new C,Ym=new C;class $r{constructor(e=new C,t=new C(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ds)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ds.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ds.copy(this.direction).multiplyScalar(t).add(this.origin),ds.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){Xm.copy(e).add(t).multiplyScalar(.5),Bh.copy(t).sub(e).normalize(),tr.copy(this.origin).sub(Xm);const r=e.distanceTo(t)*.5,o=-this.direction.dot(Bh),a=tr.dot(this.direction),l=-tr.dot(Bh),c=tr.lengthSq(),h=Math.abs(1-o*o);let u,d,f,p;if(h>0)if(u=o*l-a,d=o*a-l,p=r*h,u>=0)if(d>=-p)if(d<=p){const _=1/h;u*=_,d*=_,f=u*(u+o*d+2*a)+d*(o*u+d+2*l)+c}else d=r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;else d=-r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;else d<=-p?(u=Math.max(0,-(-o*r+a)),d=u>0?-r:Math.min(Math.max(-r,-l),r),f=-u*u+d*(d+2*l)+c):d<=p?(u=0,d=Math.min(Math.max(-r,-l),r),f=d*(d+2*l)+c):(u=Math.max(0,-(o*r+a)),d=u>0?r:Math.min(Math.max(-r,-l),r),f=-u*u+d*(d+2*l)+c);else d=o>0?-r:r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),s&&s.copy(Bh).multiplyScalar(d).add(Xm),f}intersectSphere(e,t){ds.subVectors(e.center,this.origin);const i=ds.dot(this.direction),s=ds.dot(ds)-i*i,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,l=i+o;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(i=(e.min.x-d.x)*c,s=(e.max.x-d.x)*c):(i=(e.max.x-d.x)*c,s=(e.min.x-d.x)*c),h>=0?(r=(e.min.y-d.y)*h,o=(e.max.y-d.y)*h):(r=(e.max.y-d.y)*h,o=(e.min.y-d.y)*h),i>o||r>s||((r>i||i!==i)&&(i=r),(o<s||s!==s)&&(s=o),u>=0?(a=(e.min.z-d.z)*u,l=(e.max.z-d.z)*u):(a=(e.max.z-d.z)*u,l=(e.min.z-d.z)*u),i>l||a>s)||((a>i||i!==i)&&(i=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,ds)!==null}intersectTriangle(e,t,i,s,r){qm.subVectors(t,e),Hh.subVectors(i,e),Ym.crossVectors(qm,Hh);let o=this.direction.dot(Ym),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;tr.subVectors(this.origin,e);const l=a*this.direction.dot(Hh.crossVectors(tr,Hh));if(l<0)return null;const c=a*this.direction.dot(qm.cross(tr));if(c<0||l+c>o)return null;const h=-a*tr.dot(Ym);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class be{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,s,r,o,a,l,c,h,u,d,f,p,_,y){const m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=s,m[1]=r,m[5]=o,m[9]=a,m[13]=l,m[2]=c,m[6]=h,m[10]=u,m[14]=d,m[3]=f,m[7]=p,m[11]=_,m[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new be().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/oa.setFromMatrixColumn(e,0).length(),r=1/oa.setFromMatrixColumn(e,1).length(),o=1/oa.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,s=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(s),c=Math.sin(s),h=Math.cos(r),u=Math.sin(r);if(e.order==="XYZ"){const d=o*h,f=o*u,p=a*h,_=a*u;t[0]=l*h,t[4]=-l*u,t[8]=c,t[1]=f+p*c,t[5]=d-_*c,t[9]=-a*l,t[2]=_-d*c,t[6]=p+f*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*h,f=l*u,p=c*h,_=c*u;t[0]=d+_*a,t[4]=p*a-f,t[8]=o*c,t[1]=o*u,t[5]=o*h,t[9]=-a,t[2]=f*a-p,t[6]=_+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*h,f=l*u,p=c*h,_=c*u;t[0]=d-_*a,t[4]=-o*u,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*h,t[9]=_-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*h,f=o*u,p=a*h,_=a*u;t[0]=l*h,t[4]=p*c-f,t[8]=d*c+_,t[1]=l*u,t[5]=_*c+d,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,f=o*c,p=a*l,_=a*c;t[0]=l*h,t[4]=_-d*u,t[8]=p*u+f,t[1]=u,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=f*u+p,t[10]=d-_*u}else if(e.order==="XZY"){const d=o*l,f=o*c,p=a*l,_=a*c;t[0]=l*h,t[4]=-u,t[8]=c*h,t[1]=d*u+_,t[5]=o*h,t[9]=f*u-p,t[2]=p*u-f,t[6]=a*h,t[10]=_*u+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(hN,e,dN)}lookAt(e,t,i){const s=this.elements;return Kn.subVectors(e,t),Kn.lengthSq()===0&&(Kn.z=1),Kn.normalize(),nr.crossVectors(i,Kn),nr.lengthSq()===0&&(Math.abs(i.z)===1?Kn.x+=1e-4:Kn.z+=1e-4,Kn.normalize(),nr.crossVectors(i,Kn)),nr.normalize(),zh.crossVectors(Kn,nr),s[0]=nr.x,s[4]=zh.x,s[8]=Kn.x,s[1]=nr.y,s[5]=zh.y,s[9]=Kn.y,s[2]=nr.z,s[6]=zh.z,s[10]=Kn.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],u=i[5],d=i[9],f=i[13],p=i[2],_=i[6],y=i[10],m=i[14],g=i[3],v=i[7],x=i[11],T=i[15],S=s[0],b=s[4],M=s[8],N=s[12],P=s[1],L=s[5],V=s[9],O=s[13],H=s[2],Q=s[6],q=s[10],Y=s[14],te=s[3],me=s[7],we=s[11],pe=s[15];return r[0]=o*S+a*P+l*H+c*te,r[4]=o*b+a*L+l*Q+c*me,r[8]=o*M+a*V+l*q+c*we,r[12]=o*N+a*O+l*Y+c*pe,r[1]=h*S+u*P+d*H+f*te,r[5]=h*b+u*L+d*Q+f*me,r[9]=h*M+u*V+d*q+f*we,r[13]=h*N+u*O+d*Y+f*pe,r[2]=p*S+_*P+y*H+m*te,r[6]=p*b+_*L+y*Q+m*me,r[10]=p*M+_*V+y*q+m*we,r[14]=p*N+_*O+y*Y+m*pe,r[3]=g*S+v*P+x*H+T*te,r[7]=g*b+v*L+x*Q+T*me,r[11]=g*M+v*V+x*q+T*we,r[15]=g*N+v*O+x*Y+T*pe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],u=e[6],d=e[10],f=e[14],p=e[3],_=e[7],y=e[11],m=e[15];return p*(+r*l*u-s*c*u-r*a*d+i*c*d+s*a*f-i*l*f)+_*(+t*l*f-t*c*d+r*o*d-s*o*f+s*c*h-r*l*h)+y*(+t*c*u-t*a*f-r*o*u+i*o*f+r*a*h-i*c*h)+m*(-s*a*h-t*l*u+t*a*d+s*o*u-i*o*d+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],f=e[11],p=e[12],_=e[13],y=e[14],m=e[15],g=u*y*c-_*d*c+_*l*f-a*y*f-u*l*m+a*d*m,v=p*d*c-h*y*c-p*l*f+o*y*f+h*l*m-o*d*m,x=h*_*c-p*u*c+p*a*f-o*_*f-h*a*m+o*u*m,T=p*u*l-h*_*l-p*a*d+o*_*d+h*a*y-o*u*y,S=t*g+i*v+s*x+r*T;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/S;return e[0]=g*b,e[1]=(_*d*r-u*y*r-_*s*f+i*y*f+u*s*m-i*d*m)*b,e[2]=(a*y*r-_*l*r+_*s*c-i*y*c-a*s*m+i*l*m)*b,e[3]=(u*l*r-a*d*r-u*s*c+i*d*c+a*s*f-i*l*f)*b,e[4]=v*b,e[5]=(h*y*r-p*d*r+p*s*f-t*y*f-h*s*m+t*d*m)*b,e[6]=(p*l*r-o*y*r-p*s*c+t*y*c+o*s*m-t*l*m)*b,e[7]=(o*d*r-h*l*r+h*s*c-t*d*c-o*s*f+t*l*f)*b,e[8]=x*b,e[9]=(p*u*r-h*_*r-p*i*f+t*_*f+h*i*m-t*u*m)*b,e[10]=(o*_*r-p*a*r+p*i*c-t*_*c-o*i*m+t*a*m)*b,e[11]=(h*a*r-o*u*r-h*i*c+t*u*c+o*i*f-t*a*f)*b,e[12]=T*b,e[13]=(h*_*s-p*u*s+p*i*d-t*_*d-h*i*y+t*u*y)*b,e[14]=(p*a*s-o*_*s-p*i*l+t*_*l+o*i*y-t*a*y)*b,e[15]=(o*u*s-h*a*s+h*i*l-t*u*l-o*i*d+t*a*d)*b,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-s*l,c*l+s*a,0,c*a+s*l,h*a+i,h*l-s*o,0,c*l-s*a,h*l+s*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,o){return this.set(1,i,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,u=a+a,d=r*c,f=r*h,p=r*u,_=o*h,y=o*u,m=a*u,g=l*c,v=l*h,x=l*u,T=i.x,S=i.y,b=i.z;return s[0]=(1-(_+m))*T,s[1]=(f+x)*T,s[2]=(p-v)*T,s[3]=0,s[4]=(f-x)*S,s[5]=(1-(d+m))*S,s[6]=(y+g)*S,s[7]=0,s[8]=(p+v)*b,s[9]=(y-g)*b,s[10]=(1-(d+_))*b,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let r=oa.set(s[0],s[1],s[2]).length();const o=oa.set(s[4],s[5],s[6]).length(),a=oa.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],yi.copy(this);const c=1/r,h=1/o,u=1/a;return yi.elements[0]*=c,yi.elements[1]*=c,yi.elements[2]*=c,yi.elements[4]*=h,yi.elements[5]*=h,yi.elements[6]*=h,yi.elements[8]*=u,yi.elements[9]*=u,yi.elements[10]*=u,t.setFromRotationMatrix(yi),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,s,r,o){o===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,l=2*r/(t-e),c=2*r/(i-s),h=(t+e)/(t-e),u=(i+s)/(i-s),d=-(o+r)/(o-r),f=-2*o*r/(o-r);return a[0]=l,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=c,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,s,r,o){const a=this.elements,l=1/(t-e),c=1/(i-s),h=1/(o-r),u=(t+e)*l,d=(i+s)*c,f=(o+r)*h;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}be.prototype.isMatrix4=!0;const oa=new C,yi=new be,hN=new C(0,0,0),dN=new C(1,1,1),nr=new C,zh=new C,Kn=new C,TT=new be,wT=new gt;class ir{constructor(e=0,t=0,i=0,s=ir.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,r=s[0],o=s[4],a=s[8],l=s[1],c=s[5],h=s[9],u=s[2],d=s[6],f=s[10];switch(t){case"XYZ":this._y=Math.asin(An(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-An(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(An(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-An(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(An(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-An(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return TT.makeRotationFromQuaternion(e),this.setFromRotationMatrix(TT,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return wT.setFromEuler(this),this.setFromQuaternion(wT,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new C(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ir.prototype.isEuler=!0;ir.DefaultOrder="XYZ";ir.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class ST{constructor(){this.mask=1|0}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=4294967295|0}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}}let fN=0;const ET=new C,aa=new gt,fs=new be,Vh=new C,cc=new C,pN=new C,mN=new gt,MT=new C(1,0,0),AT=new C(0,1,0),CT=new C(0,0,1),gN={type:"added"},IT={type:"removed"};class Qe extends Js{constructor(){super();Object.defineProperty(this,"id",{value:fN++}),this.uuid=oi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Qe.DefaultUp.clone();const e=new C,t=new ir,i=new gt,s=new C(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new be},normalMatrix:{value:new hn}}),this.matrix=new be,this.matrixWorld=new be,this.matrixAutoUpdate=Qe.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ST,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return aa.setFromAxisAngle(e,t),this.quaternion.multiply(aa),this}rotateOnWorldAxis(e,t){return aa.setFromAxisAngle(e,t),this.quaternion.premultiply(aa),this}rotateX(e){return this.rotateOnAxis(MT,e)}rotateY(e){return this.rotateOnAxis(AT,e)}rotateZ(e){return this.rotateOnAxis(CT,e)}translateOnAxis(e,t){return ET.copy(e).applyQuaternion(this.quaternion),this.position.add(ET.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(MT,e)}translateY(e){return this.translateOnAxis(AT,e)}translateZ(e){return this.translateOnAxis(CT,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(fs.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Vh.copy(e):Vh.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),cc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fs.lookAt(cc,Vh,this.up):fs.lookAt(Vh,cc,this.up),this.quaternion.setFromRotationMatrix(fs),s&&(fs.extractRotation(s.matrixWorld),aa.setFromRotationMatrix(fs),this.quaternion.premultiply(aa.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(gN)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(IT)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(IT)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),fs.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),fs.multiply(e.parent.matrixWorld)),e.applyMatrix4(fs),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cc,e,pN),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cc,mN,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];r(e.shapes,u)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));s.material=a}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),u=o(e.shapes),d=o(e.skeletons),f=o(e.animations);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),u.length>0&&(i.shapes=u),d.length>0&&(i.skeletons=d),f.length>0&&(i.animations=f)}return i.object=s,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}Qe.DefaultUp=new C(0,1,0);Qe.DefaultMatrixAutoUpdate=!0;Qe.prototype.isObject3D=!0;const vi=new C,ps=new C,jm=new C,ms=new C,la=new C,ca=new C,RT=new C,$m=new C,Qm=new C,Km=new C;class kt{constructor(e=new C,t=new C,i=new C){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),vi.subVectors(e,t),s.cross(vi);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,i,s,r){vi.subVectors(s,t),ps.subVectors(i,t),jm.subVectors(e,t);const o=vi.dot(vi),a=vi.dot(ps),l=vi.dot(jm),c=ps.dot(ps),h=ps.dot(jm),u=o*c-a*a;if(u===0)return r.set(-2,-1,-1);const d=1/u,f=(c*l-a*h)*d,p=(o*h-a*l)*d;return r.set(1-f-p,p,f)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,ms),ms.x>=0&&ms.y>=0&&ms.x+ms.y<=1}static getUV(e,t,i,s,r,o,a,l){return this.getBarycoord(e,t,i,s,ms),l.set(0,0),l.addScaledVector(r,ms.x),l.addScaledVector(o,ms.y),l.addScaledVector(a,ms.z),l}static isFrontFacing(e,t,i,s){return vi.subVectors(i,t),ps.subVectors(e,t),vi.cross(ps).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vi.subVectors(this.c,this.b),ps.subVectors(this.a,this.b),vi.cross(ps).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return kt.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return kt.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,s,r){return kt.getUV(e,this.a,this.b,this.c,t,i,s,r)}containsPoint(e){return kt.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return kt.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,r=this.c;let o,a;la.subVectors(s,i),ca.subVectors(r,i),$m.subVectors(e,i);const l=la.dot($m),c=ca.dot($m);if(l<=0&&c<=0)return t.copy(i);Qm.subVectors(e,s);const h=la.dot(Qm),u=ca.dot(Qm);if(h>=0&&u<=h)return t.copy(s);const d=l*u-h*c;if(d<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(la,o);Km.subVectors(e,r);const f=la.dot(Km),p=ca.dot(Km);if(p>=0&&f<=p)return t.copy(r);const _=f*c-l*p;if(_<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(i).addScaledVector(ca,a);const y=h*p-f*u;if(y<=0&&u-h>=0&&f-p>=0)return RT.subVectors(r,s),a=(u-h)/(u-h+(f-p)),t.copy(s).addScaledVector(RT,a);const m=1/(y+_+d);return o=_*m,a=d*m,t.copy(i).addScaledVector(la,o).addScaledVector(ca,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let _N=0;class Kt extends Js{constructor(){super();Object.defineProperty(this,"id",{value:_N++}),this.uuid=oi(),this.name="",this.type="Material",this.fog=!0,this.blending=Zl,this.side=js,this.vertexColors=!1,this.opacity=1,this.format=_n,this.transparent=!1,this.blendSrc=Zb,this.blendDst=eT,this.blendEquation=qo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Em,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Y3,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Om,this.stencilZFail=Om,this.stencilZPass=Om,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===jb;continue}const s=this[t];if(s===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheenTint&&this.sheenTint.isColor&&(i.sheenTint=this.sheenTint.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(i.specularTint=this.specularTint.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(i.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationTint!==void 0&&(i.attenuationTint=this.attenuationTint.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Zl&&(i.blending=this.blending),this.side!==js&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==_n&&(i.format=this.format),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=s(e.textures),o=s(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}Kt.prototype.isMaterial=!0;const LT={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},xi={h:0,s:0,l:0},Gh={h:0,s:0,l:0};function Jm(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}function Zm(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function eg(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}class ge{constructor(e,t,i){return t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=km(e,1),t=An(t,0,1),i=An(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,r=2*i-s;this.r=Jm(r,s,e+1/3),this.g=Jm(r,s,e),this.b=Jm(r,s,e-1/3)}return this}setStyle(e){function t(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let s;const r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,t(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,t(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const a=parseFloat(s[1])/360,l=parseInt(s[2],10)/100,c=parseInt(s[3],10)/100;return t(s[4]),this.setHSL(a,l,c)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],r=s.length;if(r===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,this;if(r===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=LT[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Zm(e.r),this.g=Zm(e.g),this.b=Zm(e.b),this}copyLinearToSRGB(e){return this.r=eg(e.r),this.g=eg(e.g),this.b=eg(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,i=this.g,s=this.b,r=Math.max(t,i,s),o=Math.min(t,i,s);let a,l;const c=(o+r)/2;if(o===r)a=0,l=0;else{const h=r-o;switch(l=c<=.5?h/(r+o):h/(2-r-o),r){case t:a=(i-s)/h+(i<s?6:0);break;case i:a=(s-t)/h+2;break;case s:a=(t-i)/h+4;break}a/=6}return e.h=a,e.s=l,e.l=c,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,i){return this.getHSL(xi),xi.h+=e,xi.s+=t,xi.l+=i,this.setHSL(xi.h,xi.s,xi.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(xi),e.getHSL(Gh);const i=oc(xi.h,Gh.h,t),s=oc(xi.s,Gh.s,t),r=oc(xi.l,Gh.l,t);return this.setHSL(i,s,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}ge.NAMES=LT;ge.prototype.isColor=!0;ge.prototype.r=1;ge.prototype.g=1;ge.prototype.b=1;class li extends Kt{constructor(e){super();this.type="MeshBasicMaterial",this.color=new ge(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Eh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}li.prototype.isMeshBasicMaterial=!0;const ut=new C,Wh=new ie;class Pt{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=ic,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let s=0,r=e.length;s<r;s++){let o=e[s];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",s),o=new ge),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let s=0,r=e.length;s<r;s++){let o=e[s];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",s),o=new ie),t[i++]=o.x,t[i++]=o.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let s=0,r=e.length;s<r;s++){let o=e[s];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",s),o=new C),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let s=0,r=e.length;s<r;s++){let o=e[s];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",s),o=new Be),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Wh.fromBufferAttribute(this,t),Wh.applyMatrix3(e),this.setXY(t,Wh.x,Wh.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)ut.fromBufferAttribute(this,t),ut.applyMatrix3(e),this.setXYZ(t,ut.x,ut.y,ut.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ut.x=this.getX(t),ut.y=this.getY(t),ut.z=this.getZ(t),ut.applyMatrix4(e),this.setXYZ(t,ut.x,ut.y,ut.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ut.x=this.getX(t),ut.y=this.getY(t),ut.z=this.getZ(t),ut.applyNormalMatrix(e),this.setXYZ(t,ut.x,ut.y,ut.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ut.x=this.getX(t),ut.y=this.getY(t),ut.z=this.getZ(t),ut.transformDirection(e),this.setXYZ(t,ut.x,ut.y,ut.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==ic&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}Pt.prototype.isBufferAttribute=!0;class PT extends Pt{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class NT extends Pt{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class yN extends Pt{constructor(e,t,i){super(new Uint16Array(e),t,i)}}yN.prototype.isFloat16BufferAttribute=!0;class lt extends Pt{constructor(e,t,i){super(new Float32Array(e),t,i)}}function FT(n){if(n.length===0)return-1/0;let e=n[0];for(let t=1,i=n.length;t<i;++t)n[t]>e&&(e=n[t]);return e}let vN=0;const ci=new be,tg=new Qe,ua=new C,Jn=new ai,uc=new ai,Jt=new C;class nt extends Js{constructor(){super();Object.defineProperty(this,"id",{value:vN++}),this.uuid=oi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(FT(e)>65535?NT:PT)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new hn().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ci.makeRotationFromQuaternion(e),this.applyMatrix4(ci),this}rotateX(e){return ci.makeRotationX(e),this.applyMatrix4(ci),this}rotateY(e){return ci.makeRotationY(e),this.applyMatrix4(ci),this}rotateZ(e){return ci.makeRotationZ(e),this.applyMatrix4(ci),this}translate(e,t,i){return ci.makeTranslation(e,t,i),this.applyMatrix4(ci),this}scale(e,t,i){return ci.makeScale(e,t,i),this.applyMatrix4(ci),this}lookAt(e){return tg.lookAt(e),tg.updateMatrix(),this.applyMatrix4(tg.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ua).negate(),this.translate(ua.x,ua.y,ua.z),this}setFromPoints(e){const t=[];for(let i=0,s=e.length;i<s;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new lt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ai);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new C(-1/0,-1/0,-1/0),new C(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const r=t[i];Jn.setFromBufferAttribute(r),this.morphTargetsRelative?(Jt.addVectors(this.boundingBox.min,Jn.min),this.boundingBox.expandByPoint(Jt),Jt.addVectors(this.boundingBox.max,Jn.max),this.boundingBox.expandByPoint(Jt)):(this.boundingBox.expandByPoint(Jn.min),this.boundingBox.expandByPoint(Jn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new jr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new C,1/0);return}if(e){const i=this.boundingSphere.center;if(Jn.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];uc.setFromBufferAttribute(a),this.morphTargetsRelative?(Jt.addVectors(Jn.min,uc.min),Jn.expandByPoint(Jt),Jt.addVectors(Jn.max,uc.max),Jn.expandByPoint(Jt)):(Jn.expandByPoint(uc.min),Jn.expandByPoint(uc.max))}Jn.getCenter(i);let s=0;for(let r=0,o=e.count;r<o;r++)Jt.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(Jt));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Jt.fromBufferAttribute(a,c),l&&(ua.fromBufferAttribute(e,c),Jt.add(ua)),s=Math.max(s,i.distanceToSquared(Jt))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,s=t.position.array,r=t.normal.array,o=t.uv.array,a=s.length/3;t.tangent===void 0&&this.setAttribute("tangent",new Pt(new Float32Array(4*a),4));const l=t.tangent.array,c=[],h=[];for(let P=0;P<a;P++)c[P]=new C,h[P]=new C;const u=new C,d=new C,f=new C,p=new ie,_=new ie,y=new ie,m=new C,g=new C;function v(P,L,V){u.fromArray(s,P*3),d.fromArray(s,L*3),f.fromArray(s,V*3),p.fromArray(o,P*2),_.fromArray(o,L*2),y.fromArray(o,V*2),d.sub(u),f.sub(u),_.sub(p),y.sub(p);const O=1/(_.x*y.y-y.x*_.y);!isFinite(O)||(m.copy(d).multiplyScalar(y.y).addScaledVector(f,-_.y).multiplyScalar(O),g.copy(f).multiplyScalar(_.x).addScaledVector(d,-y.x).multiplyScalar(O),c[P].add(m),c[L].add(m),c[V].add(m),h[P].add(g),h[L].add(g),h[V].add(g))}let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let P=0,L=x.length;P<L;++P){const V=x[P],O=V.start,H=V.count;for(let Q=O,q=O+H;Q<q;Q+=3)v(i[Q+0],i[Q+1],i[Q+2])}const T=new C,S=new C,b=new C,M=new C;function N(P){b.fromArray(r,P*3),M.copy(b);const L=c[P];T.copy(L),T.sub(b.multiplyScalar(b.dot(L))).normalize(),S.crossVectors(M,L);const O=S.dot(h[P])<0?-1:1;l[P*4]=T.x,l[P*4+1]=T.y,l[P*4+2]=T.z,l[P*4+3]=O}for(let P=0,L=x.length;P<L;++P){const V=x[P],O=V.start,H=V.count;for(let Q=O,q=O+H;Q<q;Q+=3)N(i[Q+0]),N(i[Q+1]),N(i[Q+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Pt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let d=0,f=i.count;d<f;d++)i.setXYZ(d,0,0,0);const s=new C,r=new C,o=new C,a=new C,l=new C,c=new C,h=new C,u=new C;if(e)for(let d=0,f=e.count;d<f;d+=3){const p=e.getX(d+0),_=e.getX(d+1),y=e.getX(d+2);s.fromBufferAttribute(t,p),r.fromBufferAttribute(t,_),o.fromBufferAttribute(t,y),h.subVectors(o,r),u.subVectors(s,r),h.cross(u),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,_),c.fromBufferAttribute(i,y),a.add(h),l.add(h),c.add(h),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(_,l.x,l.y,l.z),i.setXYZ(y,c.x,c.y,c.z)}else for(let d=0,f=t.count;d<f;d+=3)s.fromBufferAttribute(t,d+0),r.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),h.subVectors(o,r),u.subVectors(s,r),h.cross(u),i.setXYZ(d+0,h.x,h.y,h.z),i.setXYZ(d+1,h.x,h.y,h.z),i.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const s in i){if(e.attributes[s]===void 0)continue;const o=i[s].array,a=e.attributes[s],l=a.array,c=a.itemSize*t,h=Math.min(l.length,o.length-c);for(let u=0,d=c;u<h;u++,d++)o[d]=l[u]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Jt.fromBufferAttribute(e,t),Jt.normalize(),e.setXYZ(t,Jt.x,Jt.y,Jt.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,u=a.normalized,d=new c.constructor(l.length*h);let f=0,p=0;for(let _=0,y=l.length;_<y;_++){a.isInterleavedBufferAttribute?f=l[_]*a.data.stride+a.offset:f=l[_]*h;for(let m=0;m<h;m++)d[p++]=c[f++]}return new Pt(d,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new nt,i=this.index.array,s=this.attributes;for(const a in s){const l=s[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,u=c.length;h<u;h++){const d=c[h],f=e(d,i);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,d=c.length;u<d;u++){const f=c[u];h.push(f.toJSON(e.data))}h.length>0&&(s[l]=h,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new nt().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const s=e.attributes;for(const c in s){const h=s[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],u=r[c];for(let d=0,f=u.length;d<f;d++)h.push(u[d].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}nt.prototype.isBufferGeometry=!0;const DT=new be,ha=new $r,ng=new jr,sr=new C,rr=new C,or=new C,ig=new C,sg=new C,rg=new C,Xh=new C,qh=new C,Yh=new C,jh=new ie,$h=new ie,Qh=new ie,og=new C,Kh=new C;class Vt extends Qe{constructor(e=new nt,t=new li){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,s=this.material,r=this.matrixWorld;if(s===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),ng.copy(i.boundingSphere),ng.applyMatrix4(r),e.ray.intersectsSphere(ng)===!1)||(DT.copy(r).invert(),ha.copy(e.ray).applyMatrix4(DT),i.boundingBox!==null&&ha.intersectsBox(i.boundingBox)===!1))return;let o;if(i.isBufferGeometry){const a=i.index,l=i.attributes.position,c=i.morphAttributes.position,h=i.morphTargetsRelative,u=i.attributes.uv,d=i.attributes.uv2,f=i.groups,p=i.drawRange;if(a!==null)if(Array.isArray(s))for(let _=0,y=f.length;_<y;_++){const m=f[_],g=s[m.materialIndex],v=Math.max(m.start,p.start),x=Math.min(m.start+m.count,p.start+p.count);for(let T=v,S=x;T<S;T+=3){const b=a.getX(T),M=a.getX(T+1),N=a.getX(T+2);o=Jh(this,g,e,ha,l,c,h,u,d,b,M,N),o&&(o.faceIndex=Math.floor(T/3),o.face.materialIndex=m.materialIndex,t.push(o))}}else{const _=Math.max(0,p.start),y=Math.min(a.count,p.start+p.count);for(let m=_,g=y;m<g;m+=3){const v=a.getX(m),x=a.getX(m+1),T=a.getX(m+2);o=Jh(this,s,e,ha,l,c,h,u,d,v,x,T),o&&(o.faceIndex=Math.floor(m/3),t.push(o))}}else if(l!==void 0)if(Array.isArray(s))for(let _=0,y=f.length;_<y;_++){const m=f[_],g=s[m.materialIndex],v=Math.max(m.start,p.start),x=Math.min(m.start+m.count,p.start+p.count);for(let T=v,S=x;T<S;T+=3){const b=T,M=T+1,N=T+2;o=Jh(this,g,e,ha,l,c,h,u,d,b,M,N),o&&(o.faceIndex=Math.floor(T/3),o.face.materialIndex=m.materialIndex,t.push(o))}}else{const _=Math.max(0,p.start),y=Math.min(l.count,p.start+p.count);for(let m=_,g=y;m<g;m+=3){const v=m,x=m+1,T=m+2;o=Jh(this,s,e,ha,l,c,h,u,d,v,x,T),o&&(o.faceIndex=Math.floor(m/3),t.push(o))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}Vt.prototype.isMesh=!0;function xN(n,e,t,i,s,r,o,a){let l;if(e.side===Rt?l=i.intersectTriangle(o,r,s,!0,a):l=i.intersectTriangle(s,r,o,e.side!==Bi,a),l===null)return null;Kh.copy(a),Kh.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Kh);return c<t.near||c>t.far?null:{distance:c,point:Kh.clone(),object:n}}function Jh(n,e,t,i,s,r,o,a,l,c,h,u){sr.fromBufferAttribute(s,c),rr.fromBufferAttribute(s,h),or.fromBufferAttribute(s,u);const d=n.morphTargetInfluences;if(r&&d){Xh.set(0,0,0),qh.set(0,0,0),Yh.set(0,0,0);for(let p=0,_=r.length;p<_;p++){const y=d[p],m=r[p];y!==0&&(ig.fromBufferAttribute(m,c),sg.fromBufferAttribute(m,h),rg.fromBufferAttribute(m,u),o?(Xh.addScaledVector(ig,y),qh.addScaledVector(sg,y),Yh.addScaledVector(rg,y)):(Xh.addScaledVector(ig.sub(sr),y),qh.addScaledVector(sg.sub(rr),y),Yh.addScaledVector(rg.sub(or),y)))}sr.add(Xh),rr.add(qh),or.add(Yh)}n.isSkinnedMesh&&(n.boneTransform(c,sr),n.boneTransform(h,rr),n.boneTransform(u,or));const f=xN(n,e,t,i,sr,rr,or,og);if(f){a&&(jh.fromBufferAttribute(a,c),$h.fromBufferAttribute(a,h),Qh.fromBufferAttribute(a,u),f.uv=kt.getUV(og,sr,rr,or,jh,$h,Qh,new ie)),l&&(jh.fromBufferAttribute(l,c),$h.fromBufferAttribute(l,h),Qh.fromBufferAttribute(l,u),f.uv2=kt.getUV(og,sr,rr,or,jh,$h,Qh,new ie));const p={a:c,b:h,c:u,normal:new C,materialIndex:0};kt.getNormal(sr,rr,or,p.normal),f.face=p}return f}class hc extends nt{constructor(e=1,t=1,i=1,s=1,r=1,o=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],u=[];let d=0,f=0;p("z","y","x",-1,-1,i,t,e,o,r,0),p("z","y","x",1,-1,i,t,-e,o,r,1),p("x","z","y",1,1,e,i,t,s,o,2),p("x","z","y",1,-1,e,i,-t,s,o,3),p("x","y","z",1,-1,e,t,i,s,r,4),p("x","y","z",-1,-1,e,t,-i,s,r,5),this.setIndex(l),this.setAttribute("position",new lt(c,3)),this.setAttribute("normal",new lt(h,3)),this.setAttribute("uv",new lt(u,2));function p(_,y,m,g,v,x,T,S,b,M,N){const P=x/b,L=T/M,V=x/2,O=T/2,H=S/2,Q=b+1,q=M+1;let Y=0,te=0;const me=new C;for(let we=0;we<q;we++){const pe=we*L-O;for(let Se=0;Se<Q;Se++){const ne=Se*P-V;me[_]=ne*g,me[y]=pe*v,me[m]=H,c.push(me.x,me.y,me.z),me[_]=0,me[y]=0,me[m]=S>0?1:-1,h.push(me.x,me.y,me.z),u.push(Se/b),u.push(1-we/M),Y+=1}}for(let we=0;we<M;we++)for(let pe=0;pe<b;pe++){const Se=d+pe+Q*we,ne=d+pe+Q*(we+1),he=d+(pe+1)+Q*(we+1),ve=d+(pe+1)+Q*we;l.push(Se,ne,ve),l.push(ne,he,ve),te+=6}a.addGroup(f,te,N),f+=te,d+=Y}}static fromJSON(e){return new hc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function da(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}function yn(n){const e={};for(let t=0;t<n.length;t++){const i=da(n[t]);for(const s in i)e[s]=i[s]}return e}const fa={clone:da,merge:yn};var bN=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,TN=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Cn extends Kt{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=bN,this.fragmentShader=TN,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=da(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}Cn.prototype.isShaderMaterial=!0;class ag extends Qe{constructor(){super();this.type="Camera",this.matrixWorldInverse=new be,this.projectionMatrix=new be,this.projectionMatrixInverse=new be}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}ag.prototype.isCamera=!0;class vn extends ag{constructor(e=50,t=1,i=.1,s=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=rc*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(sc*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return rc*2*Math.atan(Math.tan(sc*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(sc*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/l,t-=o.offsetY*i/c,s*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}vn.prototype.isPerspectiveCamera=!0;const pa=90,ma=1;class lg extends Qe{constructor(e,t,i){super();if(this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;const s=new vn(pa,ma,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new C(1,0,0)),this.add(s);const r=new vn(pa,ma,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new C(-1,0,0)),this.add(r);const o=new vn(pa,ma,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new C(0,1,0)),this.add(o);const a=new vn(pa,ma,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new C(0,-1,0)),this.add(a);const l=new vn(pa,ma,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new C(0,0,1)),this.add(l);const c=new vn(pa,ma,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new C(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[s,r,o,a,l,c]=this.children,h=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,s),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(u),e.xr.enabled=h}}class Zh extends Qt{constructor(e,t,i,s,r,o,a,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:Mh,a=a!==void 0?a:Hi;super(e,t,i,s,r,o,a,l,c,h);this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Zh.prototype.isCubeTexture=!0;class OT extends Dn{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i);super(e,e,t);t=t||{},this.texture=new Zh(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:$t,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=_n,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new hc(5,5,5),r=new Cn({name:"CubemapFromEquirect",uniforms:da(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Rt,blending:$s});r.uniforms.tEquirect.value=t;const o=new Vt(s,r),a=t.minFilter;return t.minFilter===jo&&(t.minFilter=$t),new lg(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,s){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,s);e.setRenderTarget(r)}}OT.prototype.isWebGLCubeRenderTarget=!0;const cg=new C,wN=new C,SN=new hn;class gs{constructor(e=new C(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=cg.subVectors(i,t).cross(wN.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(cg),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||SN.getNormalMatrix(e),s=this.coplanarPoint(cg).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}gs.prototype.isPlane=!0;const ga=new jr,ed=new C;class td{constructor(e=new gs,t=new gs,i=new gs,s=new gs,r=new gs,o=new gs){this.planes=[e,t,i,s,r,o]}set(e,t,i,s,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,s=i[0],r=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],f=i[9],p=i[10],_=i[11],y=i[12],m=i[13],g=i[14],v=i[15];return t[0].setComponents(a-s,u-l,_-d,v-y).normalize(),t[1].setComponents(a+s,u+l,_+d,v+y).normalize(),t[2].setComponents(a+r,u+c,_+f,v+m).normalize(),t[3].setComponents(a-r,u-c,_-f,v-m).normalize(),t[4].setComponents(a-o,u-h,_-p,v-g).normalize(),t[5].setComponents(a+o,u+h,_+p,v+g).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),ga.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ga)}intersectsSprite(e){return ga.center.set(0,0,0),ga.radius=.7071067811865476,ga.applyMatrix4(e.matrixWorld),this.intersectsSphere(ga)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(ed.x=s.normal.x>0?e.max.x:e.min.x,ed.y=s.normal.y>0?e.max.y:e.min.y,ed.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(ed)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function kT(){let n=null,e=!1,t=null,i=null;function s(r,o){t(r,o),i=n.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){n=r}}}function EN(n,e){const t=e.isWebGL2,i=new WeakMap;function s(c,h){const u=c.array,d=c.usage,f=n.createBuffer();n.bindBuffer(h,f),n.bufferData(h,u,d),c.onUploadCallback();let p=5126;return u instanceof Float32Array?p=5126:u instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):u instanceof Uint16Array?c.isFloat16BufferAttribute?t?p=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):p=5123:u instanceof Int16Array?p=5122:u instanceof Uint32Array?p=5125:u instanceof Int32Array?p=5124:u instanceof Int8Array?p=5120:(u instanceof Uint8Array||u instanceof Uint8ClampedArray)&&(p=5121),{buffer:f,type:p,bytesPerElement:u.BYTES_PER_ELEMENT,version:c.version}}function r(c,h,u){const d=h.array,f=h.updateRange;n.bindBuffer(u,c),f.count===-1?n.bufferSubData(u,0,d):(t?n.bufferSubData(u,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):n.bufferSubData(u,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1)}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const h=i.get(c);h&&(n.deleteBuffer(h.buffer),i.delete(c))}function l(c,h){if(c.isGLBufferAttribute){const d=i.get(c);(!d||d.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const u=i.get(c);u===void 0?i.set(c,s(c,h)):u.version<c.version&&(r(u.buffer,c,h),u.version=c.version)}return{get:o,remove:a,update:l}}class nd extends nt{constructor(e=1,t=1,i=1,s=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(s),c=a+1,h=l+1,u=e/a,d=t/l,f=[],p=[],_=[],y=[];for(let m=0;m<h;m++){const g=m*d-o;for(let v=0;v<c;v++){const x=v*u-r;p.push(x,-g,0),_.push(0,0,1),y.push(v/a),y.push(1-m/l)}}for(let m=0;m<l;m++)for(let g=0;g<a;g++){const v=g+c*m,x=g+c*(m+1),T=g+1+c*(m+1),S=g+1+c*m;f.push(v,x,S),f.push(x,T,S)}this.setIndex(f),this.setAttribute("position",new lt(p,3)),this.setAttribute("normal",new lt(_,3)),this.setAttribute("uv",new lt(y,2))}static fromJSON(e){return new nd(e.width,e.height,e.widthSegments,e.heightSegments)}}var MN=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,AN=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,CN=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,IN=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,RN=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,LN=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,PN="vec3 transformed = vec3( position );",NN=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,FN=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotVH = saturate( dot( geometry.viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float NoH ) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float NoV, float NoL ) {
	return saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );
}
vec3 BRDF_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,DN=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,ON=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,kN=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,UN=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,BN=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,HN=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,zN=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,VN=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,GN=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,WN=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,XN=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,qN=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,YN=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,jN=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,$N=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,QN=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,KN="gl_FragColor = linearToOutputTexel( gl_FragColor );",JN=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,ZN=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,eF=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,tF=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,nF=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,iF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,sF=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,rF=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,oF=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,aF=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,lF=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,cF=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,uF=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,hF=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,dF=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,fF=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in GeometricContext geometry ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,pF=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,mF=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,gF=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,_F=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,yF=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularTintFactor = specularTint;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARTINTMAP
			specularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularTintFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenTint = sheenTint;
#endif`,vF=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenTint;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += irradiance * BRDF_Sheen( material.roughness, directLight.direction, geometry, material.sheenTint );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,xF=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,bF=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,TF=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,wF=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,SF=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,EF=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,MF=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,AF=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,CF=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,IF=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,RF=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,LF=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,PF=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,NF=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,FF=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,DF=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,OF=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,kF=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,UF=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,BF=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,HF=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,zF=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,VF=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,GF=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,WF=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,XF=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,qF=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,YF=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,jF=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,$F=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,QF=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,KF=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,JF=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,ZF=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,eD=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,tD=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,nD=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,iD=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,sD=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,rD=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,oD=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,aD=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,lD=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,cD=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,uD=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,hD=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationTint, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = transmission.a;
#endif`,dD=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationTint;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,fD=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,pD=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,mD=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,gD=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,_D=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,yD=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,vD=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,xD=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,bD=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,TD=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,wD=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,SD=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,ED=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,MD=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,AD=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,CD=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ID=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,RD=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,LD=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,PD=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ND=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,FD=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,DD=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,OD=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kD=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,UD=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,BD=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,HD=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zD=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,VD=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularTint;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARTINTMAP
		uniform sampler2D specularTintMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenTint;
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,GD=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,WD=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,XD=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,qD=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,YD=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,jD=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,$D=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,QD=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,KD=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const Xe={alphamap_fragment:MN,alphamap_pars_fragment:AN,alphatest_fragment:CN,alphatest_pars_fragment:IN,aomap_fragment:RN,aomap_pars_fragment:LN,begin_vertex:PN,beginnormal_vertex:NN,bsdfs:FN,bumpmap_pars_fragment:DN,clipping_planes_fragment:ON,clipping_planes_pars_fragment:kN,clipping_planes_pars_vertex:UN,clipping_planes_vertex:BN,color_fragment:HN,color_pars_fragment:zN,color_pars_vertex:VN,color_vertex:GN,common:WN,cube_uv_reflection_fragment:XN,defaultnormal_vertex:qN,displacementmap_pars_vertex:YN,displacementmap_vertex:jN,emissivemap_fragment:$N,emissivemap_pars_fragment:QN,encodings_fragment:KN,encodings_pars_fragment:JN,envmap_fragment:ZN,envmap_common_pars_fragment:eF,envmap_pars_fragment:tF,envmap_pars_vertex:nF,envmap_physical_pars_fragment:fF,envmap_vertex:iF,fog_vertex:sF,fog_pars_vertex:rF,fog_fragment:oF,fog_pars_fragment:aF,gradientmap_pars_fragment:lF,lightmap_fragment:cF,lightmap_pars_fragment:uF,lights_lambert_vertex:hF,lights_pars_begin:dF,lights_toon_fragment:pF,lights_toon_pars_fragment:mF,lights_phong_fragment:gF,lights_phong_pars_fragment:_F,lights_physical_fragment:yF,lights_physical_pars_fragment:vF,lights_fragment_begin:xF,lights_fragment_maps:bF,lights_fragment_end:TF,logdepthbuf_fragment:wF,logdepthbuf_pars_fragment:SF,logdepthbuf_pars_vertex:EF,logdepthbuf_vertex:MF,map_fragment:AF,map_pars_fragment:CF,map_particle_fragment:IF,map_particle_pars_fragment:RF,metalnessmap_fragment:LF,metalnessmap_pars_fragment:PF,morphnormal_vertex:NF,morphtarget_pars_vertex:FF,morphtarget_vertex:DF,normal_fragment_begin:OF,normal_fragment_maps:kF,normal_pars_fragment:UF,normal_pars_vertex:BF,normal_vertex:HF,normalmap_pars_fragment:zF,clearcoat_normal_fragment_begin:VF,clearcoat_normal_fragment_maps:GF,clearcoat_pars_fragment:WF,output_fragment:XF,packing:qF,premultiplied_alpha_fragment:YF,project_vertex:jF,dithering_fragment:$F,dithering_pars_fragment:QF,roughnessmap_fragment:KF,roughnessmap_pars_fragment:JF,shadowmap_pars_fragment:ZF,shadowmap_pars_vertex:eD,shadowmap_vertex:tD,shadowmask_pars_fragment:nD,skinbase_vertex:iD,skinning_pars_vertex:sD,skinning_vertex:rD,skinnormal_vertex:oD,specularmap_fragment:aD,specularmap_pars_fragment:lD,tonemapping_fragment:cD,tonemapping_pars_fragment:uD,transmission_fragment:hD,transmission_pars_fragment:dD,uv_pars_fragment:fD,uv_pars_vertex:pD,uv_vertex:mD,uv2_pars_fragment:gD,uv2_pars_vertex:_D,uv2_vertex:yD,worldpos_vertex:vD,background_frag:xD,background_vert:bD,cube_frag:TD,cube_vert:wD,depth_frag:SD,depth_vert:ED,distanceRGBA_frag:MD,distanceRGBA_vert:AD,equirect_frag:CD,equirect_vert:ID,linedashed_frag:RD,linedashed_vert:LD,meshbasic_frag:PD,meshbasic_vert:ND,meshlambert_frag:FD,meshlambert_vert:DD,meshmatcap_frag:OD,meshmatcap_vert:kD,meshnormal_frag:UD,meshnormal_vert:BD,meshphong_frag:HD,meshphong_vert:zD,meshphysical_frag:VD,meshphysical_vert:GD,meshtoon_frag:WD,meshtoon_vert:XD,points_frag:qD,points_vert:YD,shadow_frag:jD,shadow_vert:$D,sprite_frag:QD,sprite_vert:KD},fe={common:{diffuse:{value:new ge(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new hn},uv2Transform:{value:new hn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ie(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ge(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ge(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new hn}},sprite:{diffuse:{value:new ge(16777215)},opacity:{value:1},center:{value:new ie(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new hn}}},zi={basic:{uniforms:yn([fe.common,fe.specularmap,fe.envmap,fe.aomap,fe.lightmap,fe.fog]),vertexShader:Xe.meshbasic_vert,fragmentShader:Xe.meshbasic_frag},lambert:{uniforms:yn([fe.common,fe.specularmap,fe.envmap,fe.aomap,fe.lightmap,fe.emissivemap,fe.fog,fe.lights,{emissive:{value:new ge(0)}}]),vertexShader:Xe.meshlambert_vert,fragmentShader:Xe.meshlambert_frag},phong:{uniforms:yn([fe.common,fe.specularmap,fe.envmap,fe.aomap,fe.lightmap,fe.emissivemap,fe.bumpmap,fe.normalmap,fe.displacementmap,fe.fog,fe.lights,{emissive:{value:new ge(0)},specular:{value:new ge(1118481)},shininess:{value:30}}]),vertexShader:Xe.meshphong_vert,fragmentShader:Xe.meshphong_frag},standard:{uniforms:yn([fe.common,fe.envmap,fe.aomap,fe.lightmap,fe.emissivemap,fe.bumpmap,fe.normalmap,fe.displacementmap,fe.roughnessmap,fe.metalnessmap,fe.fog,fe.lights,{emissive:{value:new ge(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Xe.meshphysical_vert,fragmentShader:Xe.meshphysical_frag},toon:{uniforms:yn([fe.common,fe.aomap,fe.lightmap,fe.emissivemap,fe.bumpmap,fe.normalmap,fe.displacementmap,fe.gradientmap,fe.fog,fe.lights,{emissive:{value:new ge(0)}}]),vertexShader:Xe.meshtoon_vert,fragmentShader:Xe.meshtoon_frag},matcap:{uniforms:yn([fe.common,fe.bumpmap,fe.normalmap,fe.displacementmap,fe.fog,{matcap:{value:null}}]),vertexShader:Xe.meshmatcap_vert,fragmentShader:Xe.meshmatcap_frag},points:{uniforms:yn([fe.points,fe.fog]),vertexShader:Xe.points_vert,fragmentShader:Xe.points_frag},dashed:{uniforms:yn([fe.common,fe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Xe.linedashed_vert,fragmentShader:Xe.linedashed_frag},depth:{uniforms:yn([fe.common,fe.displacementmap]),vertexShader:Xe.depth_vert,fragmentShader:Xe.depth_frag},normal:{uniforms:yn([fe.common,fe.bumpmap,fe.normalmap,fe.displacementmap,{opacity:{value:1}}]),vertexShader:Xe.meshnormal_vert,fragmentShader:Xe.meshnormal_frag},sprite:{uniforms:yn([fe.sprite,fe.fog]),vertexShader:Xe.sprite_vert,fragmentShader:Xe.sprite_frag},background:{uniforms:{uvTransform:{value:new hn},t2D:{value:null}},vertexShader:Xe.background_vert,fragmentShader:Xe.background_frag},cube:{uniforms:yn([fe.envmap,{opacity:{value:1}}]),vertexShader:Xe.cube_vert,fragmentShader:Xe.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xe.equirect_vert,fragmentShader:Xe.equirect_frag},distanceRGBA:{uniforms:yn([fe.common,fe.displacementmap,{referencePosition:{value:new C},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Xe.distanceRGBA_vert,fragmentShader:Xe.distanceRGBA_frag},shadow:{uniforms:yn([fe.lights,fe.fog,{color:{value:new ge(0)},opacity:{value:1}}]),vertexShader:Xe.shadow_vert,fragmentShader:Xe.shadow_frag}};zi.physical={uniforms:yn([zi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ie(1,1)},clearcoatNormalMap:{value:null},sheenTint:{value:new ge(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ie},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new ge(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new ge(1,1,1)},specularTintMap:{value:null}}]),vertexShader:Xe.meshphysical_vert,fragmentShader:Xe.meshphysical_frag};function JD(n,e,t,i,s){const r=new ge(0);let o=0,a,l,c=null,h=0,u=null;function d(p,_){let y=!1,m=_.isScene===!0?_.background:null;m&&m.isTexture&&(m=e.get(m));const g=n.xr,v=g.getSession&&g.getSession();v&&v.environmentBlendMode==="additive"&&(m=null),m===null?f(r,o):m&&m.isColor&&(f(m,1),y=!0),(n.autoClear||y)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),m&&(m.isCubeTexture||m.mapping===Ch)?(l===void 0&&(l=new Vt(new hc(1,1,1),new Cn({name:"BackgroundCubeMaterial",uniforms:da(zi.cube.uniforms),vertexShader:zi.cube.vertexShader,fragmentShader:zi.cube.fragmentShader,side:Rt,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(x,T,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m.isRenderTargetTexture===!1?-1:1,(c!==m||h!==m.version||u!==n.toneMapping)&&(l.material.needsUpdate=!0,c=m,h=m.version,u=n.toneMapping),p.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(a===void 0&&(a=new Vt(new nd(2,2),new Cn({name:"BackgroundMaterial",uniforms:da(zi.background.uniforms),vertexShader:zi.background.vertexShader,fragmentShader:zi.background.fragmentShader,side:js,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=m,m.matrixAutoUpdate===!0&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),(c!==m||h!==m.version||u!==n.toneMapping)&&(a.material.needsUpdate=!0,c=m,h=m.version,u=n.toneMapping),p.unshift(a,a.geometry,a.material,0,0,null))}function f(p,_){t.buffers.color.setClear(p.r,p.g,p.b,_,s)}return{getClearColor:function(){return r},setClearColor:function(p,_=1){r.set(p),o=_,f(r,o)},getClearAlpha:function(){return o},setClearAlpha:function(p){o=p,f(r,o)},render:d}}function ZD(n,e,t,i){const s=n.getParameter(34921),r=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||r!==null,a={},l=_(null);let c=l;function h(O,H,Q,q,Y){let te=!1;if(o){const me=p(q,Q,H);c!==me&&(c=me,d(c.object)),te=y(q,Y),te&&m(q,Y)}else{const me=H.wireframe===!0;(c.geometry!==q.id||c.program!==Q.id||c.wireframe!==me)&&(c.geometry=q.id,c.program=Q.id,c.wireframe=me,te=!0)}O.isInstancedMesh===!0&&(te=!0),Y!==null&&t.update(Y,34963),te&&(b(O,H,Q,q),Y!==null&&n.bindBuffer(34963,t.get(Y).buffer))}function u(){return i.isWebGL2?n.createVertexArray():r.createVertexArrayOES()}function d(O){return i.isWebGL2?n.bindVertexArray(O):r.bindVertexArrayOES(O)}function f(O){return i.isWebGL2?n.deleteVertexArray(O):r.deleteVertexArrayOES(O)}function p(O,H,Q){const q=Q.wireframe===!0;let Y=a[O.id];Y===void 0&&(Y={},a[O.id]=Y);let te=Y[H.id];te===void 0&&(te={},Y[H.id]=te);let me=te[q];return me===void 0&&(me=_(u()),te[q]=me),me}function _(O){const H=[],Q=[],q=[];for(let Y=0;Y<s;Y++)H[Y]=0,Q[Y]=0,q[Y]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:H,enabledAttributes:Q,attributeDivisors:q,object:O,attributes:{},index:null}}function y(O,H){const Q=c.attributes,q=O.attributes;let Y=0;for(const te in q){const me=Q[te],we=q[te];if(me===void 0||me.attribute!==we||me.data!==we.data)return!0;Y++}return c.attributesNum!==Y||c.index!==H}function m(O,H){const Q={},q=O.attributes;let Y=0;for(const te in q){const me=q[te],we={};we.attribute=me,me.data&&(we.data=me.data),Q[te]=we,Y++}c.attributes=Q,c.attributesNum=Y,c.index=H}function g(){const O=c.newAttributes;for(let H=0,Q=O.length;H<Q;H++)O[H]=0}function v(O){x(O,0)}function x(O,H){const Q=c.newAttributes,q=c.enabledAttributes,Y=c.attributeDivisors;Q[O]=1,q[O]===0&&(n.enableVertexAttribArray(O),q[O]=1),Y[O]!==H&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](O,H),Y[O]=H)}function T(){const O=c.newAttributes,H=c.enabledAttributes;for(let Q=0,q=H.length;Q<q;Q++)H[Q]!==O[Q]&&(n.disableVertexAttribArray(Q),H[Q]=0)}function S(O,H,Q,q,Y,te){i.isWebGL2===!0&&(Q===5124||Q===5125)?n.vertexAttribIPointer(O,H,Q,Y,te):n.vertexAttribPointer(O,H,Q,q,Y,te)}function b(O,H,Q,q){if(i.isWebGL2===!1&&(O.isInstancedMesh||q.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;g();const Y=q.attributes,te=Q.getAttributes(),me=H.defaultAttributeValues;for(const we in te){const pe=te[we];if(pe.location>=0){let Se=Y[we];if(Se===void 0&&(we==="instanceMatrix"&&O.instanceMatrix&&(Se=O.instanceMatrix),we==="instanceColor"&&O.instanceColor&&(Se=O.instanceColor)),Se!==void 0){const ne=Se.normalized,he=Se.itemSize,ve=t.get(Se);if(ve===void 0)continue;const $=ve.buffer,xe=ve.type,Me=ve.bytesPerElement;if(Se.isInterleavedBufferAttribute){const ye=Se.data,_e=ye.stride,Ie=Se.offset;if(ye&&ye.isInstancedInterleavedBuffer){for(let Z=0;Z<pe.locationSize;Z++)x(pe.location+Z,ye.meshPerAttribute);O.isInstancedMesh!==!0&&q._maxInstanceCount===void 0&&(q._maxInstanceCount=ye.meshPerAttribute*ye.count)}else for(let Z=0;Z<pe.locationSize;Z++)v(pe.location+Z);n.bindBuffer(34962,$);for(let Z=0;Z<pe.locationSize;Z++)S(pe.location+Z,he/pe.locationSize,xe,ne,_e*Me,(Ie+he/pe.locationSize*Z)*Me)}else{if(Se.isInstancedBufferAttribute){for(let ye=0;ye<pe.locationSize;ye++)x(pe.location+ye,Se.meshPerAttribute);O.isInstancedMesh!==!0&&q._maxInstanceCount===void 0&&(q._maxInstanceCount=Se.meshPerAttribute*Se.count)}else for(let ye=0;ye<pe.locationSize;ye++)v(pe.location+ye);n.bindBuffer(34962,$);for(let ye=0;ye<pe.locationSize;ye++)S(pe.location+ye,he/pe.locationSize,xe,ne,he*Me,he/pe.locationSize*ye*Me)}}else if(me!==void 0){const ne=me[we];if(ne!==void 0)switch(ne.length){case 2:n.vertexAttrib2fv(pe.location,ne);break;case 3:n.vertexAttrib3fv(pe.location,ne);break;case 4:n.vertexAttrib4fv(pe.location,ne);break;default:n.vertexAttrib1fv(pe.location,ne)}}}}T()}function M(){L();for(const O in a){const H=a[O];for(const Q in H){const q=H[Q];for(const Y in q)f(q[Y].object),delete q[Y];delete H[Q]}delete a[O]}}function N(O){if(a[O.id]===void 0)return;const H=a[O.id];for(const Q in H){const q=H[Q];for(const Y in q)f(q[Y].object),delete q[Y];delete H[Q]}delete a[O.id]}function P(O){for(const H in a){const Q=a[H];if(Q[O.id]===void 0)continue;const q=Q[O.id];for(const Y in q)f(q[Y].object),delete q[Y];delete Q[O.id]}}function L(){V(),c!==l&&(c=l,d(c.object))}function V(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:L,resetDefaultState:V,dispose:M,releaseStatesOfGeometry:N,releaseStatesOfProgram:P,initAttributes:g,enableAttribute:v,disableUnusedAttributes:T}}function eO(n,e,t,i){const s=i.isWebGL2;let r;function o(c){r=c}function a(c,h){n.drawArrays(r,c,h),t.update(h,r,1)}function l(c,h,u){if(u===0)return;let d,f;if(s)d=n,f="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](r,c,h,u),t.update(h,r,u)}this.setMode=o,this.render=a,this.renderInstances=l}function tO(n,e,t){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const b=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function r(b){if(b==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";b="mediump"}return b==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext!="undefined"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&n instanceof WebGL2ComputeRenderingContext;let a=t.precision!==void 0?t.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),h=t.logarithmicDepthBuffer===!0,u=n.getParameter(34930),d=n.getParameter(35660),f=n.getParameter(3379),p=n.getParameter(34076),_=n.getParameter(34921),y=n.getParameter(36347),m=n.getParameter(36348),g=n.getParameter(36349),v=d>0,x=o||e.has("OES_texture_float"),T=v&&x,S=o?n.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:s,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:_,maxVertexUniforms:y,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:x,floatVertexTextures:T,maxSamples:S}}function nO(n){const e=this;let t=null,i=0,s=!1,r=!1;const o=new gs,a=new hn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d,f){const p=u.length!==0||d||i!==0||s;return s=d,t=h(u,f,0),i=u.length,p},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1,c()},this.setState=function(u,d,f){const p=u.clippingPlanes,_=u.clipIntersection,y=u.clipShadows,m=n.get(u);if(!s||p===null||p.length===0||r&&!y)r?h(null):c();else{const g=r?0:i,v=g*4;let x=m.clippingState||null;l.value=x,x=h(p,d,v,f);for(let T=0;T!==v;++T)x[T]=t[T];m.clippingState=x,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=g}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(u,d,f,p){const _=u!==null?u.length:0;let y=null;if(_!==0){if(y=l.value,p!==!0||y===null){const m=f+_*4,g=d.matrixWorldInverse;a.getNormalMatrix(g),(y===null||y.length<m)&&(y=new Float32Array(m));for(let v=0,x=f;v!==_;++v,x+=4)o.copy(u[v]).applyMatrix4(g,a),o.normal.toArray(y,x),y[x+3]=o.constant}l.value=y,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,y}}function iO(n){let e=new WeakMap;function t(o,a){return a===Mm?o.mapping=Mh:a===Am&&(o.mapping=Ah),o}function i(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===Mm||a===Am)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=n.getRenderTarget(),h=new OT(l.height/2);return h.fromEquirectangularTexture(n,o),e.set(o,h),n.setRenderTarget(c),o.addEventListener("dispose",s),t(h.texture,o.mapping)}else return null}}return o}function s(o){const a=o.target;a.removeEventListener("dispose",s);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}class ar extends ag{constructor(e=-1,t=1,i=1,s=-1,r=.1,o=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}ar.prototype.isOrthographicCamera=!0;class id extends Cn{constructor(e){super(e);this.type="RawShaderMaterial"}}id.prototype.isRawShaderMaterial=!0;const _a=4,lr=8,Vi=Math.pow(2,lr),UT=[.125,.215,.35,.446,.526,.582],BT=lr-_a+1+UT.length,ya=20,Gi={[Lt]:0,[ri]:1,[Fh]:2,[Nm]:3,[Fm]:4,[Dm]:5,[Nh]:6},ug=new ar,{_lodPlanes:dc,_sizeLods:HT,_sigmas:sd}=oO(),zT=new ge;let hg=null;const Qr=(1+Math.sqrt(5))/2,va=1/Qr,VT=[new C(1,1,1),new C(-1,1,1),new C(1,1,-1),new C(-1,1,-1),new C(0,Qr,va),new C(0,Qr,-va),new C(va,0,Qr),new C(-va,0,Qr),new C(Qr,va,0),new C(-Qr,va,0)];class sO{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=aO(ya),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){hg=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(e,i,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=XT(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=WT(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<dc.length;e++)dc[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(hg),e.scissorTest=!1,rd(e,0,0,e.width,e.height)}_fromTexture(e){hg=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:zt,minFilter:zt,generateMipmaps:!1,type:$o,format:t3,encoding:rO(e)?e.encoding:Fh,depthBuffer:!1},i=GT(t);return i.depthBuffer=!e,this._pingPongRenderTarget=GT(t),i}_compileMaterial(e){const t=new Vt(dc[0],e);this._renderer.compile(t,ug)}_sceneToCubeUV(e,t,i,s){const r=90,o=1,a=new vn(r,o,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,u=h.autoClear,d=h.outputEncoding,f=h.toneMapping;h.getClearColor(zT),h.toneMapping=Xr,h.outputEncoding=Lt,h.autoClear=!1;const p=new li({name:"PMREM.Background",side:Rt,depthWrite:!1,depthTest:!1}),_=new Vt(new hc,p);let y=!1;const m=e.background;m?m.isColor&&(p.color.copy(m),e.background=null,y=!0):(p.color.copy(zT),y=!0);for(let g=0;g<6;g++){const v=g%3;v==0?(a.up.set(0,l[g],0),a.lookAt(c[g],0,0)):v==1?(a.up.set(0,0,l[g]),a.lookAt(0,c[g],0)):(a.up.set(0,l[g],0),a.lookAt(0,0,c[g])),rd(s,v*Vi,g>2?Vi:0,Vi,Vi),h.setRenderTarget(s),y&&h.render(_,a),h.render(e,a)}_.geometry.dispose(),_.material.dispose(),h.toneMapping=f,h.outputEncoding=d,h.autoClear=u,e.background=m}_textureToCubeUV(e,t){const i=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=XT()):this._equirectShader==null&&(this._equirectShader=WT());const s=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new Vt(dc[0],s),o=s.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=Gi[e.encoding],o.outputEncoding.value=Gi[t.texture.encoding],rd(t,0,0,3*Vi,2*Vi),i.setRenderTarget(t),i.render(r,ug)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let s=1;s<BT;s++){const r=Math.sqrt(sd[s]*sd[s]-sd[s-1]*sd[s-1]),o=VT[(s-1)%VT.length];this._blur(e,s-1,s,r,o)}t.autoClear=i}_blur(e,t,i,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,s,"latitudinal",r),this._halfBlur(o,e,i,i,s,"longitudinal",r)}_halfBlur(e,t,i,s,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,u=new Vt(dc[s],c),d=c.uniforms,f=HT[i]-1,p=isFinite(r)?Math.PI/(2*f):2*Math.PI/(2*ya-1),_=r/p,y=isFinite(r)?1+Math.floor(h*_):ya;y>ya&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${ya}`);const m=[];let g=0;for(let S=0;S<ya;++S){const b=S/_,M=Math.exp(-b*b/2);m.push(M),S==0?g+=M:S<y&&(g+=2*M)}for(let S=0;S<m.length;S++)m[S]=m[S]/g;d.envMap.value=e.texture,d.samples.value=y,d.weights.value=m,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a),d.dTheta.value=p,d.mipInt.value=lr-i,d.inputEncoding.value=Gi[e.texture.encoding],d.outputEncoding.value=Gi[e.texture.encoding];const v=HT[s],x=3*Math.max(0,Vi-2*v),T=(s===0?0:2*Vi)+2*v*(s>lr-_a?s-lr+_a:0);rd(t,x,T,3*v,2*v),l.setRenderTarget(t),l.render(u,ug)}}function rO(n){return n===void 0||n.type!==$o?!1:n.encoding===Lt||n.encoding===ri||n.encoding===Nh}function oO(){const n=[],e=[],t=[];let i=lr;for(let s=0;s<BT;s++){const r=Math.pow(2,i);e.push(r);let o=1/r;s>lr-_a?o=UT[s-lr+_a-1]:s==0&&(o=0),t.push(o);const a=1/(r-1),l=-a/2,c=1+a/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],u=6,d=6,f=3,p=2,_=1,y=new Float32Array(f*d*u),m=new Float32Array(p*d*u),g=new Float32Array(_*d*u);for(let x=0;x<u;x++){const T=x%3*2/3-1,S=x>2?0:-1,b=[T,S,0,T+2/3,S,0,T+2/3,S+1,0,T,S,0,T+2/3,S+1,0,T,S+1,0];y.set(b,f*d*x),m.set(h,p*d*x);const M=[x,x,x,x,x,x];g.set(M,_*d*x)}const v=new nt;v.setAttribute("position",new Pt(y,f)),v.setAttribute("uv",new Pt(m,p)),v.setAttribute("faceIndex",new Pt(g,_)),n.push(v),i>_a&&i--}return{_lodPlanes:n,_sizeLods:e,_sigmas:t}}function GT(n){const e=new Dn(3*Vi,3*Vi,n);return e.texture.mapping=Ch,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function rd(n,e,t,i,s){n.viewport.set(e,t,i,s),n.scissor.set(e,t,i,s)}function aO(n){const e=new Float32Array(n),t=new C(0,1,0);return new id({name:"SphericalGaussianBlur",defines:{n},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:Gi[Lt]},outputEncoding:{value:Gi[Lt]}},vertexShader:dg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${fg()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:$s,depthTest:!1,depthWrite:!1})}function WT(){const n=new ie(1,1);return new id({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:n},inputEncoding:{value:Gi[Lt]},outputEncoding:{value:Gi[Lt]}},vertexShader:dg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${fg()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:$s,depthTest:!1,depthWrite:!1})}function XT(){return new id({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Gi[Lt]},outputEncoding:{value:Gi[Lt]}},vertexShader:dg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${fg()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:$s,depthTest:!1,depthWrite:!1})}function dg(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function fg(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function lO(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){const l=a.mapping,c=l===Mm||l===Am,h=l===Mh||l===Ah;if(c||h){if(e.has(a))return e.get(a).texture;{const u=a.image;if(c&&u&&u.height>0||h&&u&&s(u)){const d=n.getRenderTarget();t===null&&(t=new sO(n));const f=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),n.setRenderTarget(d),a.addEventListener("dispose",r),f.texture}else return null}}}return a}function s(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function cO(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return e[i]=s,s}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(i){const s=t(i);return s===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function uO(n,e,t,i){const s={},r=new WeakMap;function o(u){const d=u.target;d.index!==null&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);d.removeEventListener("dispose",o),delete s[d.id];const f=r.get(d);f&&(e.remove(f),r.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(u,d){return s[d.id]===!0||(d.addEventListener("dispose",o),s[d.id]=!0,t.memory.geometries++),d}function l(u){const d=u.attributes;for(const p in d)e.update(d[p],34962);const f=u.morphAttributes;for(const p in f){const _=f[p];for(let y=0,m=_.length;y<m;y++)e.update(_[y],34962)}}function c(u){const d=[],f=u.index,p=u.attributes.position;let _=0;if(f!==null){const g=f.array;_=f.version;for(let v=0,x=g.length;v<x;v+=3){const T=g[v+0],S=g[v+1],b=g[v+2];d.push(T,S,S,b,b,T)}}else{const g=p.array;_=p.version;for(let v=0,x=g.length/3-1;v<x;v+=3){const T=v+0,S=v+1,b=v+2;d.push(T,S,S,b,b,T)}}const y=new(FT(d)>65535?NT:PT)(d,1);y.version=_;const m=r.get(u);m&&e.remove(m),r.set(u,y)}function h(u){const d=r.get(u);if(d){const f=u.index;f!==null&&d.version<f.version&&c(u)}else c(u);return r.get(u)}return{get:a,update:l,getWireframeAttribute:h}}function hO(n,e,t,i){const s=i.isWebGL2;let r;function o(d){r=d}let a,l;function c(d){a=d.type,l=d.bytesPerElement}function h(d,f){n.drawElements(r,f,a,d*l),t.update(f,r,1)}function u(d,f,p){if(p===0)return;let _,y;if(s)_=n,y="drawElementsInstanced";else if(_=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",_===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}_[y](r,f,a,d*l,p),t.update(f,r,p)}this.setMode=o,this.setIndex=c,this.render=h,this.renderInstances=u}function dO(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(r/3);break;case 1:t.lines+=a*(r/2);break;case 3:t.lines+=a*(r-1);break;case 2:t.lines+=a*r;break;case 0:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}function fO(n,e){return n[0]-e[0]}function pO(n,e){return Math.abs(e[1])-Math.abs(n[1])}function mO(n){const e={},t=new Float32Array(8),i=[];for(let r=0;r<8;r++)i[r]=[r,0];function s(r,o,a,l){const c=r.morphTargetInfluences,h=c===void 0?0:c.length;let u=e[o.id];if(u===void 0||u.length!==h){u=[];for(let y=0;y<h;y++)u[y]=[y,0];e[o.id]=u}for(let y=0;y<h;y++){const m=u[y];m[0]=y,m[1]=c[y]}u.sort(pO);for(let y=0;y<8;y++)y<h&&u[y][1]?(i[y][0]=u[y][0],i[y][1]=u[y][1]):(i[y][0]=Number.MAX_SAFE_INTEGER,i[y][1]=0);i.sort(fO);const d=o.morphAttributes.position,f=o.morphAttributes.normal;let p=0;for(let y=0;y<8;y++){const m=i[y],g=m[0],v=m[1];g!==Number.MAX_SAFE_INTEGER&&v?(d&&o.getAttribute("morphTarget"+y)!==d[g]&&o.setAttribute("morphTarget"+y,d[g]),f&&o.getAttribute("morphNormal"+y)!==f[g]&&o.setAttribute("morphNormal"+y,f[g]),t[y]=v,p+=v):(d&&o.hasAttribute("morphTarget"+y)===!0&&o.deleteAttribute("morphTarget"+y),f&&o.hasAttribute("morphNormal"+y)===!0&&o.deleteAttribute("morphNormal"+y),t[y]=0)}const _=o.morphTargetsRelative?1:1-p;l.getUniforms().setValue(n,"morphTargetBaseInfluence",_),l.getUniforms().setValue(n,"morphTargetInfluences",t)}return{update:s}}function gO(n,e,t,i){let s=new WeakMap;function r(l){const c=i.render.frame,h=l.geometry,u=e.get(l,h);return s.get(u)!==c&&(e.update(u),s.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),u}function o(){s=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:o}}class qT extends Qt{constructor(e=null,t=1,i=1,s=1){super(null);this.image={data:e,width:t,height:i,depth:s},this.magFilter=zt,this.minFilter=zt,this.wrapR=Fn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}qT.prototype.isDataTexture2DArray=!0;class YT extends Qt{constructor(e=null,t=1,i=1,s=1){super(null);this.image={data:e,width:t,height:i,depth:s},this.magFilter=zt,this.minFilter=zt,this.wrapR=Fn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}YT.prototype.isDataTexture3D=!0;const jT=new Qt,_O=new qT,yO=new YT,$T=new Zh,QT=[],KT=[],JT=new Float32Array(16),ZT=new Float32Array(9),ew=new Float32Array(4);function xa(n,e,t){const i=n[0];if(i<=0||i>0)return n;const s=e*t;let r=QT[s];if(r===void 0&&(r=new Float32Array(s),QT[s]=r),e!==0){i.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(r,a)}return r}function In(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function xn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function tw(n,e){let t=KT[e];t===void 0&&(t=new Int32Array(e),KT[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function vO(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function xO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(In(t,e))return;n.uniform2fv(this.addr,e),xn(t,e)}}function bO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(In(t,e))return;n.uniform3fv(this.addr,e),xn(t,e)}}function TO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(In(t,e))return;n.uniform4fv(this.addr,e),xn(t,e)}}function wO(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(In(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),xn(t,e)}else{if(In(t,i))return;ew.set(i),n.uniformMatrix2fv(this.addr,!1,ew),xn(t,i)}}function SO(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(In(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),xn(t,e)}else{if(In(t,i))return;ZT.set(i),n.uniformMatrix3fv(this.addr,!1,ZT),xn(t,i)}}function EO(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(In(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),xn(t,e)}else{if(In(t,i))return;JT.set(i),n.uniformMatrix4fv(this.addr,!1,JT),xn(t,i)}}function MO(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function AO(n,e){const t=this.cache;In(t,e)||(n.uniform2iv(this.addr,e),xn(t,e))}function CO(n,e){const t=this.cache;In(t,e)||(n.uniform3iv(this.addr,e),xn(t,e))}function IO(n,e){const t=this.cache;In(t,e)||(n.uniform4iv(this.addr,e),xn(t,e))}function RO(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function LO(n,e){const t=this.cache;In(t,e)||(n.uniform2uiv(this.addr,e),xn(t,e))}function PO(n,e){const t=this.cache;In(t,e)||(n.uniform3uiv(this.addr,e),xn(t,e))}function NO(n,e){const t=this.cache;In(t,e)||(n.uniform4uiv(this.addr,e),xn(t,e))}function FO(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.safeSetTexture2D(e||jT,s)}function DO(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||yO,s)}function OO(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.safeSetTextureCube(e||$T,s)}function kO(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||_O,s)}function UO(n){switch(n){case 5126:return vO;case 35664:return xO;case 35665:return bO;case 35666:return TO;case 35674:return wO;case 35675:return SO;case 35676:return EO;case 5124:case 35670:return MO;case 35667:case 35671:return AO;case 35668:case 35672:return CO;case 35669:case 35673:return IO;case 5125:return RO;case 36294:return LO;case 36295:return PO;case 36296:return NO;case 35678:case 36198:case 36298:case 36306:case 35682:return FO;case 35679:case 36299:case 36307:return DO;case 35680:case 36300:case 36308:case 36293:return OO;case 36289:case 36303:case 36311:case 36292:return kO}}function BO(n,e){n.uniform1fv(this.addr,e)}function HO(n,e){const t=xa(e,this.size,2);n.uniform2fv(this.addr,t)}function zO(n,e){const t=xa(e,this.size,3);n.uniform3fv(this.addr,t)}function VO(n,e){const t=xa(e,this.size,4);n.uniform4fv(this.addr,t)}function GO(n,e){const t=xa(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function WO(n,e){const t=xa(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function XO(n,e){const t=xa(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function qO(n,e){n.uniform1iv(this.addr,e)}function YO(n,e){n.uniform2iv(this.addr,e)}function jO(n,e){n.uniform3iv(this.addr,e)}function $O(n,e){n.uniform4iv(this.addr,e)}function QO(n,e){n.uniform1uiv(this.addr,e)}function KO(n,e){n.uniform2uiv(this.addr,e)}function JO(n,e){n.uniform3uiv(this.addr,e)}function ZO(n,e){n.uniform4uiv(this.addr,e)}function ek(n,e,t){const i=e.length,s=tw(t,i);n.uniform1iv(this.addr,s);for(let r=0;r!==i;++r)t.safeSetTexture2D(e[r]||jT,s[r])}function tk(n,e,t){const i=e.length,s=tw(t,i);n.uniform1iv(this.addr,s);for(let r=0;r!==i;++r)t.safeSetTextureCube(e[r]||$T,s[r])}function nk(n){switch(n){case 5126:return BO;case 35664:return HO;case 35665:return zO;case 35666:return VO;case 35674:return GO;case 35675:return WO;case 35676:return XO;case 5124:case 35670:return qO;case 35667:case 35671:return YO;case 35668:case 35672:return jO;case 35669:case 35673:return $O;case 5125:return QO;case 36294:return KO;case 36295:return JO;case 36296:return ZO;case 35678:case 36198:case 36298:case 36306:case 35682:return ek;case 35680:case 36300:case 36308:case 36293:return tk}}function ik(n,e,t){this.id=n,this.addr=t,this.cache=[],this.setValue=UO(e.type)}function nw(n,e,t){this.id=n,this.addr=t,this.cache=[],this.size=e.size,this.setValue=nk(e.type)}nw.prototype.updateCache=function(n){const e=this.cache;n instanceof Float32Array&&e.length!==n.length&&(this.cache=new Float32Array(n.length)),xn(e,n)};function iw(n){this.id=n,this.seq=[],this.map={}}iw.prototype.setValue=function(n,e,t){const i=this.seq;for(let s=0,r=i.length;s!==r;++s){const o=i[s];o.setValue(n,e[o.id],t)}};const pg=/(\w+)(\])?(\[|\.)?/g;function sw(n,e){n.seq.push(e),n.map[e.id]=e}function sk(n,e,t){const i=n.name,s=i.length;for(pg.lastIndex=0;;){const r=pg.exec(i),o=pg.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===s){sw(t,c===void 0?new ik(a,n,e):new nw(a,n,e));break}else{let u=t.map[a];u===void 0&&(u=new iw(a),sw(t,u)),t=u}}}function cr(n,e){this.seq=[],this.map={};const t=n.getProgramParameter(e,35718);for(let i=0;i<t;++i){const s=n.getActiveUniform(e,i),r=n.getUniformLocation(e,s.name);sk(s,r,this)}}cr.prototype.setValue=function(n,e,t,i){const s=this.map[e];s!==void 0&&s.setValue(n,t,i)};cr.prototype.setOptional=function(n,e,t){const i=e[t];i!==void 0&&this.setValue(n,t,i)};cr.upload=function(n,e,t,i){for(let s=0,r=e.length;s!==r;++s){const o=e[s],a=t[o.id];a.needsUpdate!==!1&&o.setValue(n,a.value,i)}};cr.seqWithValue=function(n,e){const t=[];for(let i=0,s=n.length;i!==s;++i){const r=n[i];r.id in e&&t.push(r)}return t};function rw(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let rk=0;function ok(n){const e=n.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function ow(n){switch(n){case Lt:return["Linear","( value )"];case ri:return["sRGB","( value )"];case Fh:return["RGBE","( value )"];case Nm:return["RGBM","( value, 7.0 )"];case Fm:return["RGBM","( value, 16.0 )"];case Dm:return["RGBD","( value, 256.0 )"];case Nh:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case G3:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}function aw(n,e,t){const i=n.getShaderParameter(e,35713),s=n.getShaderInfoLog(e).trim();return i&&s===""?"":t.toUpperCase()+`

`+s+`

`+ok(n.getShaderSource(e))}function ba(n,e){const t=ow(e);return"vec4 "+n+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function ak(n,e){const t=ow(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function lk(n,e){let t;switch(e){case tT:t="Linear";break;case V2:t="Reinhard";break;case G2:t="OptimizedCineon";break;case W2:t="ACESFilmic";break;case X2:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function ck(n){return[n.extensionDerivatives||n.envMapCubeUV||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(fc).join(`
`)}function uk(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function hk(n,e){const t={},i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const r=n.getActiveAttrib(e,s),o=r.name;let a=1;r.type===35674&&(a=2),r.type===35675&&(a=3),r.type===35676&&(a=4),t[o]={type:r.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function fc(n){return n!==""}function lw(n,e){return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function cw(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const dk=/^[ \t]*#include +<([\w\d./]+)>/gm;function mg(n){return n.replace(dk,fk)}function fk(n,e){const t=Xe[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return mg(t)}const pk=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,mk=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function uw(n){return n.replace(mk,hw).replace(pk,gk)}function gk(n,e,t,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),hw(n,e,t,i)}function hw(n,e,t,i){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function dw(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function _k(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Yb?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===x2?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Jl&&(e="SHADOWMAP_TYPE_VSM"),e}function yk(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Mh:case Ah:e="ENVMAP_TYPE_CUBE";break;case Ch:case Cm:e="ENVMAP_TYPE_CUBE_UV";break}return e}function vk(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Ah:case Cm:e="ENVMAP_MODE_REFRACTION";break}return e}function xk(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Eh:e="ENVMAP_BLENDING_MULTIPLY";break;case H2:e="ENVMAP_BLENDING_MIX";break;case z2:e="ENVMAP_BLENDING_ADD";break}return e}function bk(n,e,t,i){const s=n.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=_k(t),c=yk(t),h=vk(t),u=xk(t),d=n.gammaFactor>0?n.gammaFactor:1,f=t.isWebGL2?"":ck(t),p=uk(r),_=s.createProgram();let y,m,g=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(y=[p].filter(fc).join(`
`),y.length>0&&(y+=`
`),m=[f,p].filter(fc).join(`
`),m.length>0&&(m+=`
`)):(y=[dw(t),"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularTintMap?"#define USE_SPECULARTINTMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(fc).join(`
`),m=[f,dw(t),"#define SHADER_NAME "+t.shaderName,p,"#define GAMMA_FACTOR "+d,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularTintMap?"#define USE_SPECULARTINTMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheenTint?"#define USE_SHEEN":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Xr?"#define TONE_MAPPING":"",t.toneMapping!==Xr?Xe.tonemapping_pars_fragment:"",t.toneMapping!==Xr?lk("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.format===Hi?"#define OPAQUE":"",Xe.encodings_pars_fragment,t.map?ba("mapTexelToLinear",t.mapEncoding):"",t.matcap?ba("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?ba("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?ba("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.specularTintMap?ba("specularTintMapTexelToLinear",t.specularTintMapEncoding):"",t.lightMap?ba("lightMapTexelToLinear",t.lightMapEncoding):"",ak("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(fc).join(`
`)),o=mg(o),o=lw(o,t),o=cw(o,t),a=mg(a),a=lw(a,t),a=cw(a,t),o=uw(o),a=uw(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(g=`#version 300 es
`,y=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,m=["#define varying in",t.glslVersion===gT?"":"out highp vec4 pc_fragColor;",t.glslVersion===gT?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const v=g+y+o,x=g+m+a,T=rw(s,35633,v),S=rw(s,35632,x);if(s.attachShader(_,T),s.attachShader(_,S),t.index0AttributeName!==void 0?s.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(_,0,"position"),s.linkProgram(_),n.debug.checkShaderErrors){const N=s.getProgramInfoLog(_).trim(),P=s.getShaderInfoLog(T).trim(),L=s.getShaderInfoLog(S).trim();let V=!0,O=!0;if(s.getProgramParameter(_,35714)===!1){V=!1;const H=aw(s,T,"vertex"),Q=aw(s,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(_,35715)+`

Program Info Log: `+N+`
`+H+`
`+Q)}else N!==""?console.warn("THREE.WebGLProgram: Program Info Log:",N):(P===""||L==="")&&(O=!1);O&&(this.diagnostics={runnable:V,programLog:N,vertexShader:{log:P,prefix:y},fragmentShader:{log:L,prefix:m}})}s.deleteShader(T),s.deleteShader(S);let b;this.getUniforms=function(){return b===void 0&&(b=new cr(s,_)),b};let M;return this.getAttributes=function(){return M===void 0&&(M=hk(s,_)),M},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(_),this.program=void 0},this.name=t.shaderName,this.id=rk++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=T,this.fragmentShader=S,this}function Tk(n,e,t,i,s,r,o){const a=[],l=s.isWebGL2,c=s.logarithmicDepthBuffer,h=s.floatVertexTextures,u=s.maxVertexUniforms,d=s.vertexTextures;let f=s.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},_=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheenTint","transmission","transmissionMap","thicknessMap"];function y(b){const N=b.skeleton.bones;if(h)return 1024;{const L=Math.floor((u-20)/4),V=Math.min(L,N.length);return V<N.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+N.length+" bones. This GPU supports "+V+"."),0):V}}function m(b){let M;return b&&b.isTexture?M=b.encoding:b&&b.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),M=b.texture.encoding):M=Lt,M}function g(b,M,N,P,L){const V=P.fog,O=b.isMeshStandardMaterial?P.environment:null,H=(b.isMeshStandardMaterial?t:e).get(b.envMap||O),Q=p[b.type],q=L.isSkinnedMesh?y(L):0;b.precision!==null&&(f=s.getMaxPrecision(b.precision),f!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",f,"instead."));let Y,te;if(Q){const ne=zi[Q];Y=ne.vertexShader,te=ne.fragmentShader}else Y=b.vertexShader,te=b.fragmentShader;const me=n.getRenderTarget(),we=b.alphaTest>0,pe=b.clearcoat>0;return{isWebGL2:l,shaderID:Q,shaderName:b.type,vertexShader:Y,fragmentShader:te,defines:b.defines,isRawShaderMaterial:b.isRawShaderMaterial===!0,glslVersion:b.glslVersion,precision:f,instancing:L.isInstancedMesh===!0,instancingColor:L.isInstancedMesh===!0&&L.instanceColor!==null,supportsVertexTextures:d,outputEncoding:me!==null?m(me.texture):n.outputEncoding,map:!!b.map,mapEncoding:m(b.map),matcap:!!b.matcap,matcapEncoding:m(b.matcap),envMap:!!H,envMapMode:H&&H.mapping,envMapEncoding:m(H),envMapCubeUV:!!H&&(H.mapping===Ch||H.mapping===Cm),lightMap:!!b.lightMap,lightMapEncoding:m(b.lightMap),aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,emissiveMapEncoding:m(b.emissiveMap),bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,objectSpaceNormalMap:b.normalMapType===q3,tangentSpaceNormalMap:b.normalMapType===Ks,clearcoat:pe,clearcoatMap:pe&&!!b.clearcoatMap,clearcoatRoughnessMap:pe&&!!b.clearcoatRoughnessMap,clearcoatNormalMap:pe&&!!b.clearcoatNormalMap,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,specularIntensityMap:!!b.specularIntensityMap,specularTintMap:!!b.specularTintMap,specularTintMapEncoding:m(b.specularTintMap),alphaMap:!!b.alphaMap,alphaTest:we,gradientMap:!!b.gradientMap,sheenTint:!!b.sheenTint&&(b.sheenTint.r>0||b.sheenTint.g>0||b.sheenTint.b>0),transmission:b.transmission>0,transmissionMap:!!b.transmissionMap,thicknessMap:!!b.thicknessMap,combine:b.combine,vertexTangents:!!b.normalMap&&!!L.geometry&&!!L.geometry.attributes.tangent,vertexColors:b.vertexColors,vertexAlphas:b.vertexColors===!0&&!!L.geometry&&!!L.geometry.attributes.color&&L.geometry.attributes.color.itemSize===4,vertexUvs:!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatMap||!!b.clearcoatRoughnessMap||!!b.clearcoatNormalMap||!!b.displacementMap||!!b.transmissionMap||!!b.thicknessMap||!!b.specularIntensityMap||!!b.specularTintMap,uvsVertexOnly:!(!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatNormalMap||b.transmission>0||!!b.transmissionMap||!!b.thicknessMap||!!b.specularIntensityMap||!!b.specularTintMap)&&!!b.displacementMap,fog:!!V,useFog:b.fog,fogExp2:V&&V.isFogExp2,flatShading:!!b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:c,skinning:L.isSkinnedMesh===!0&&q>0,maxBones:q,useVertexTexture:h,morphTargets:!!L.geometry&&!!L.geometry.morphAttributes.position,morphNormals:!!L.geometry&&!!L.geometry.morphAttributes.normal,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:b.format,dithering:b.dithering,shadowMapEnabled:n.shadowMap.enabled&&N.length>0,shadowMapType:n.shadowMap.type,toneMapping:b.toneMapped?n.toneMapping:Xr,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,doubleSided:b.side===Bi,flipSided:b.side===Rt,depthPacking:b.depthPacking!==void 0?b.depthPacking:!1,index0AttributeName:b.index0AttributeName,extensionDerivatives:b.extensions&&b.extensions.derivatives,extensionFragDepth:b.extensions&&b.extensions.fragDepth,extensionDrawBuffers:b.extensions&&b.extensions.drawBuffers,extensionShaderTextureLOD:b.extensions&&b.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||i.has("EXT_shader_texture_lod"),customProgramCacheKey:b.customProgramCacheKey()}}function v(b){const M=[];if(b.shaderID?M.push(b.shaderID):(M.push(b.fragmentShader),M.push(b.vertexShader)),b.defines!==void 0)for(const N in b.defines)M.push(N),M.push(b.defines[N]);if(b.isRawShaderMaterial===!1){for(let N=0;N<_.length;N++)M.push(b[_[N]]);M.push(n.outputEncoding),M.push(n.gammaFactor)}return M.push(b.customProgramCacheKey),M.join()}function x(b){const M=p[b.type];let N;if(M){const P=zi[M];N=fa.clone(P.uniforms)}else N=b.uniforms;return N}function T(b,M){let N;for(let P=0,L=a.length;P<L;P++){const V=a[P];if(V.cacheKey===M){N=V,++N.usedTimes;break}}return N===void 0&&(N=new bk(n,M,b,r),a.push(N)),N}function S(b){if(--b.usedTimes==0){const M=a.indexOf(b);a[M]=a[a.length-1],a.pop(),b.destroy()}}return{getParameters:g,getProgramCacheKey:v,getUniforms:x,acquireProgram:T,releaseProgram:S,programs:a}}function wk(){let n=new WeakMap;function e(r){let o=n.get(r);return o===void 0&&(o={},n.set(r,o)),o}function t(r){n.delete(r)}function i(r,o,a){n.get(r)[o]=a}function s(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:s}}function Sk(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.program!==e.program?n.program.id-e.program.id:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function fw(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function pw(n){const e=[];let t=0;const i=[],s=[],r=[],o={id:-1};function a(){t=0,i.length=0,s.length=0,r.length=0}function l(f,p,_,y,m,g){let v=e[t];const x=n.get(_);return v===void 0?(v={id:f.id,object:f,geometry:p,material:_,program:x.program||o,groupOrder:y,renderOrder:f.renderOrder,z:m,group:g},e[t]=v):(v.id=f.id,v.object=f,v.geometry=p,v.material=_,v.program=x.program||o,v.groupOrder=y,v.renderOrder=f.renderOrder,v.z=m,v.group=g),t++,v}function c(f,p,_,y,m,g){const v=l(f,p,_,y,m,g);_.transmission>0?s.push(v):_.transparent===!0?r.push(v):i.push(v)}function h(f,p,_,y,m,g){const v=l(f,p,_,y,m,g);_.transmission>0?s.unshift(v):_.transparent===!0?r.unshift(v):i.unshift(v)}function u(f,p){i.length>1&&i.sort(f||Sk),s.length>1&&s.sort(p||fw),r.length>1&&r.sort(p||fw)}function d(){for(let f=t,p=e.length;f<p;f++){const _=e[f];if(_.id===null)break;_.id=null,_.object=null,_.geometry=null,_.material=null,_.program=null,_.group=null}}return{opaque:i,transmissive:s,transparent:r,init:a,push:c,unshift:h,finish:d,sort:u}}function Ek(n){let e=new WeakMap;function t(s,r){let o;return e.has(s)===!1?(o=new pw(n),e.set(s,[o])):r>=e.get(s).length?(o=new pw(n),e.get(s).push(o)):o=e.get(s)[r],o}function i(){e=new WeakMap}return{get:t,dispose:i}}function Mk(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new C,color:new ge};break;case"SpotLight":t={position:new C,direction:new C,color:new ge,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new C,color:new ge,distance:0,decay:0};break;case"HemisphereLight":t={direction:new C,skyColor:new ge,groundColor:new ge};break;case"RectAreaLight":t={color:new ge,position:new C,halfWidth:new C,halfHeight:new C};break}return n[e.id]=t,t}}}function Ak(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ie};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ie};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ie,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let Ck=0;function Ik(n,e){return(e.castShadow?1:0)-(n.castShadow?1:0)}function Rk(n,e){const t=new Mk,i=Ak(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let h=0;h<9;h++)s.probe.push(new C);const r=new C,o=new be,a=new be;function l(h,u){let d=0,f=0,p=0;for(let N=0;N<9;N++)s.probe[N].set(0,0,0);let _=0,y=0,m=0,g=0,v=0,x=0,T=0,S=0;h.sort(Ik);const b=u!==!0?Math.PI:1;for(let N=0,P=h.length;N<P;N++){const L=h[N],V=L.color,O=L.intensity,H=L.distance,Q=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)d+=V.r*O*b,f+=V.g*O*b,p+=V.b*O*b;else if(L.isLightProbe)for(let q=0;q<9;q++)s.probe[q].addScaledVector(L.sh.coefficients[q],O);else if(L.isDirectionalLight){const q=t.get(L);if(q.color.copy(L.color).multiplyScalar(L.intensity*b),L.castShadow){const Y=L.shadow,te=i.get(L);te.shadowBias=Y.bias,te.shadowNormalBias=Y.normalBias,te.shadowRadius=Y.radius,te.shadowMapSize=Y.mapSize,s.directionalShadow[_]=te,s.directionalShadowMap[_]=Q,s.directionalShadowMatrix[_]=L.shadow.matrix,x++}s.directional[_]=q,_++}else if(L.isSpotLight){const q=t.get(L);if(q.position.setFromMatrixPosition(L.matrixWorld),q.color.copy(V).multiplyScalar(O*b),q.distance=H,q.coneCos=Math.cos(L.angle),q.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),q.decay=L.decay,L.castShadow){const Y=L.shadow,te=i.get(L);te.shadowBias=Y.bias,te.shadowNormalBias=Y.normalBias,te.shadowRadius=Y.radius,te.shadowMapSize=Y.mapSize,s.spotShadow[m]=te,s.spotShadowMap[m]=Q,s.spotShadowMatrix[m]=L.shadow.matrix,S++}s.spot[m]=q,m++}else if(L.isRectAreaLight){const q=t.get(L);q.color.copy(V).multiplyScalar(O),q.halfWidth.set(L.width*.5,0,0),q.halfHeight.set(0,L.height*.5,0),s.rectArea[g]=q,g++}else if(L.isPointLight){const q=t.get(L);if(q.color.copy(L.color).multiplyScalar(L.intensity*b),q.distance=L.distance,q.decay=L.decay,L.castShadow){const Y=L.shadow,te=i.get(L);te.shadowBias=Y.bias,te.shadowNormalBias=Y.normalBias,te.shadowRadius=Y.radius,te.shadowMapSize=Y.mapSize,te.shadowCameraNear=Y.camera.near,te.shadowCameraFar=Y.camera.far,s.pointShadow[y]=te,s.pointShadowMap[y]=Q,s.pointShadowMatrix[y]=L.shadow.matrix,T++}s.point[y]=q,y++}else if(L.isHemisphereLight){const q=t.get(L);q.skyColor.copy(L.color).multiplyScalar(O*b),q.groundColor.copy(L.groundColor).multiplyScalar(O*b),s.hemi[v]=q,v++}}g>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=fe.LTC_FLOAT_1,s.rectAreaLTC2=fe.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=fe.LTC_HALF_1,s.rectAreaLTC2=fe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=d,s.ambient[1]=f,s.ambient[2]=p;const M=s.hash;(M.directionalLength!==_||M.pointLength!==y||M.spotLength!==m||M.rectAreaLength!==g||M.hemiLength!==v||M.numDirectionalShadows!==x||M.numPointShadows!==T||M.numSpotShadows!==S)&&(s.directional.length=_,s.spot.length=m,s.rectArea.length=g,s.point.length=y,s.hemi.length=v,s.directionalShadow.length=x,s.directionalShadowMap.length=x,s.pointShadow.length=T,s.pointShadowMap.length=T,s.spotShadow.length=S,s.spotShadowMap.length=S,s.directionalShadowMatrix.length=x,s.pointShadowMatrix.length=T,s.spotShadowMatrix.length=S,M.directionalLength=_,M.pointLength=y,M.spotLength=m,M.rectAreaLength=g,M.hemiLength=v,M.numDirectionalShadows=x,M.numPointShadows=T,M.numSpotShadows=S,s.version=Ck++)}function c(h,u){let d=0,f=0,p=0,_=0,y=0;const m=u.matrixWorldInverse;for(let g=0,v=h.length;g<v;g++){const x=h[g];if(x.isDirectionalLight){const T=s.directional[d];T.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(m),d++}else if(x.isSpotLight){const T=s.spot[p];T.position.setFromMatrixPosition(x.matrixWorld),T.position.applyMatrix4(m),T.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(m),p++}else if(x.isRectAreaLight){const T=s.rectArea[_];T.position.setFromMatrixPosition(x.matrixWorld),T.position.applyMatrix4(m),a.identity(),o.copy(x.matrixWorld),o.premultiply(m),a.extractRotation(o),T.halfWidth.set(x.width*.5,0,0),T.halfHeight.set(0,x.height*.5,0),T.halfWidth.applyMatrix4(a),T.halfHeight.applyMatrix4(a),_++}else if(x.isPointLight){const T=s.point[f];T.position.setFromMatrixPosition(x.matrixWorld),T.position.applyMatrix4(m),f++}else if(x.isHemisphereLight){const T=s.hemi[y];T.direction.setFromMatrixPosition(x.matrixWorld),T.direction.transformDirection(m),T.direction.normalize(),y++}}}return{setup:l,setupView:c,state:s}}function mw(n,e){const t=new Rk(n,e),i=[],s=[];function r(){i.length=0,s.length=0}function o(u){i.push(u)}function a(u){s.push(u)}function l(u){t.setup(i,u)}function c(u){t.setupView(i,u)}return{init:r,state:{lightsArray:i,shadowsArray:s,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function Lk(n,e){let t=new WeakMap;function i(r,o=0){let a;return t.has(r)===!1?(a=new mw(n,e),t.set(r,[a])):o>=t.get(r).length?(a=new mw(n,e),t.get(r).push(a)):a=t.get(r)[o],a}function s(){t=new WeakMap}return{get:i,dispose:s}}class gw extends Kt{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=W3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}gw.prototype.isMeshDepthMaterial=!0;class _w extends Kt{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new C,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}_w.prototype.isMeshDistanceMaterial=!0;var Pk=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
uniform float samples;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,Nk=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function yw(n,e,t){let i=new td;const s=new ie,r=new ie,o=new Be,a=new gw({depthPacking:X3}),l=new _w,c={},h=t.maxTextureSize,u={0:Rt,1:js,2:Bi},d=new Cn({uniforms:{shadow_pass:{value:null},resolution:{value:new ie},radius:{value:4},samples:{value:8}},vertexShader:Nk,fragmentShader:Pk}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new nt;p.setAttribute("position",new Pt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new Vt(p,d),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Yb,this.render=function(x,T,S){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||x.length===0)return;const b=n.getRenderTarget(),M=n.getActiveCubeFace(),N=n.getActiveMipmapLevel(),P=n.state;P.setBlending($s),P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);for(let L=0,V=x.length;L<V;L++){const O=x[L],H=O.shadow;if(H===void 0){console.warn("THREE.WebGLShadowMap:",O,"has no shadow.");continue}if(H.autoUpdate===!1&&H.needsUpdate===!1)continue;s.copy(H.mapSize);const Q=H.getFrameExtents();if(s.multiply(Q),r.copy(H.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/Q.x),s.x=r.x*Q.x,H.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/Q.y),s.y=r.y*Q.y,H.mapSize.y=r.y)),H.map===null&&!H.isPointLightShadow&&this.type===Jl){const Y={minFilter:$t,magFilter:$t,format:_n};H.map=new Dn(s.x,s.y,Y),H.map.texture.name=O.name+".shadowMap",H.mapPass=new Dn(s.x,s.y,Y),H.camera.updateProjectionMatrix()}if(H.map===null){const Y={minFilter:zt,magFilter:zt,format:_n};H.map=new Dn(s.x,s.y,Y),H.map.texture.name=O.name+".shadowMap",H.camera.updateProjectionMatrix()}n.setRenderTarget(H.map),n.clear();const q=H.getViewportCount();for(let Y=0;Y<q;Y++){const te=H.getViewport(Y);o.set(r.x*te.x,r.y*te.y,r.x*te.z,r.y*te.w),P.viewport(o),H.updateMatrices(O,Y),i=H.getFrustum(),v(T,S,H.camera,O,this.type)}!H.isPointLightShadow&&this.type===Jl&&m(H,S),H.needsUpdate=!1}y.needsUpdate=!1,n.setRenderTarget(b,M,N)};function m(x,T){const S=e.update(_);d.uniforms.shadow_pass.value=x.map.texture,d.uniforms.resolution.value=x.mapSize,d.uniforms.radius.value=x.radius,d.uniforms.samples.value=x.blurSamples,n.setRenderTarget(x.mapPass),n.clear(),n.renderBufferDirect(T,null,S,d,_,null),f.uniforms.shadow_pass.value=x.mapPass.texture,f.uniforms.resolution.value=x.mapSize,f.uniforms.radius.value=x.radius,f.uniforms.samples.value=x.blurSamples,n.setRenderTarget(x.map),n.clear(),n.renderBufferDirect(T,null,S,f,_,null)}function g(x,T,S,b,M,N,P){let L=null;const V=b.isPointLight===!0?x.customDistanceMaterial:x.customDepthMaterial;if(V!==void 0?L=V:L=b.isPointLight===!0?l:a,n.localClippingEnabled&&S.clipShadows===!0&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0){const O=L.uuid,H=S.uuid;let Q=c[O];Q===void 0&&(Q={},c[O]=Q);let q=Q[H];q===void 0&&(q=L.clone(),Q[H]=q),L=q}return L.visible=S.visible,L.wireframe=S.wireframe,P===Jl?L.side=S.shadowSide!==null?S.shadowSide:S.side:L.side=S.shadowSide!==null?S.shadowSide:u[S.side],L.alphaMap=S.alphaMap,L.alphaTest=S.alphaTest,L.clipShadows=S.clipShadows,L.clippingPlanes=S.clippingPlanes,L.clipIntersection=S.clipIntersection,L.displacementMap=S.displacementMap,L.displacementScale=S.displacementScale,L.displacementBias=S.displacementBias,L.wireframeLinewidth=S.wireframeLinewidth,L.linewidth=S.linewidth,b.isPointLight===!0&&L.isMeshDistanceMaterial===!0&&(L.referencePosition.setFromMatrixPosition(b.matrixWorld),L.nearDistance=M,L.farDistance=N),L}function v(x,T,S,b,M){if(x.visible===!1)return;if(x.layers.test(T.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&M===Jl)&&(!x.frustumCulled||i.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,x.matrixWorld);const L=e.update(x),V=x.material;if(Array.isArray(V)){const O=L.groups;for(let H=0,Q=O.length;H<Q;H++){const q=O[H],Y=V[q.materialIndex];if(Y&&Y.visible){const te=g(x,L,Y,b,S.near,S.far,M);n.renderBufferDirect(S,null,L,te,x,q)}}}else if(V.visible){const O=g(x,L,V,b,S.near,S.far,M);n.renderBufferDirect(S,null,L,O,x,null)}}const P=x.children;for(let L=0,V=P.length;L<V;L++)v(P[L],T,S,b,M)}}function Fk(n,e,t){const i=t.isWebGL2;function s(){let D=!1;const ae=new Be;let K=null;const le=new Be(0,0,0,0);return{setMask:function(F){K!==F&&!D&&(n.colorMask(F,F,F,F),K=F)},setLocked:function(F){D=F},setClear:function(F,ue,He,ke,Tt){Tt===!0&&(F*=ke,ue*=ke,He*=ke),ae.set(F,ue,He,ke),le.equals(ae)===!1&&(n.clearColor(F,ue,He,ke),le.copy(ae))},reset:function(){D=!1,K=null,le.set(-1,0,0,0)}}}function r(){let D=!1,ae=null,K=null,le=null;return{setTest:function(F){F?he(2929):ve(2929)},setMask:function(F){ae!==F&&!D&&(n.depthMask(F),ae=F)},setFunc:function(F){if(K!==F){if(F)switch(F){case N2:n.depthFunc(512);break;case F2:n.depthFunc(519);break;case D2:n.depthFunc(513);break;case Em:n.depthFunc(515);break;case O2:n.depthFunc(514);break;case k2:n.depthFunc(518);break;case U2:n.depthFunc(516);break;case B2:n.depthFunc(517);break;default:n.depthFunc(515)}else n.depthFunc(515);K=F}},setLocked:function(F){D=F},setClear:function(F){le!==F&&(n.clearDepth(F),le=F)},reset:function(){D=!1,ae=null,K=null,le=null}}}function o(){let D=!1,ae=null,K=null,le=null,F=null,ue=null,He=null,ke=null,Tt=null;return{setTest:function(De){D||(De?he(2960):ve(2960))},setMask:function(De){ae!==De&&!D&&(n.stencilMask(De),ae=De)},setFunc:function(De,pt,wn){(K!==De||le!==pt||F!==wn)&&(n.stencilFunc(De,pt,wn),K=De,le=pt,F=wn)},setOp:function(De,pt,wn){(ue!==De||He!==pt||ke!==wn)&&(n.stencilOp(De,pt,wn),ue=De,He=pt,ke=wn)},setLocked:function(De){D=De},setClear:function(De){Tt!==De&&(n.clearStencil(De),Tt=De)},reset:function(){D=!1,ae=null,K=null,le=null,F=null,ue=null,He=null,ke=null,Tt=null}}}const a=new s,l=new r,c=new o;let h={},u=null,d={},f=null,p=!1,_=null,y=null,m=null,g=null,v=null,x=null,T=null,S=!1,b=null,M=null,N=null,P=null,L=null;const V=n.getParameter(35661);let O=!1,H=0;const Q=n.getParameter(7938);Q.indexOf("WebGL")!==-1?(H=parseFloat(/^WebGL (\d)/.exec(Q)[1]),O=H>=1):Q.indexOf("OpenGL ES")!==-1&&(H=parseFloat(/^OpenGL ES (\d)/.exec(Q)[1]),O=H>=2);let q=null,Y={};const te=n.getParameter(3088),me=n.getParameter(2978),we=new Be().fromArray(te),pe=new Be().fromArray(me);function Se(D,ae,K){const le=new Uint8Array(4),F=n.createTexture();n.bindTexture(D,F),n.texParameteri(D,10241,9728),n.texParameteri(D,10240,9728);for(let ue=0;ue<K;ue++)n.texImage2D(ae+ue,0,6408,1,1,0,6408,5121,le);return F}const ne={};ne[3553]=Se(3553,3553,1),ne[34067]=Se(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),he(2929),l.setFunc(Em),A(!1),R(qb),he(2884),Ie($s);function he(D){h[D]!==!0&&(n.enable(D),h[D]=!0)}function ve(D){h[D]!==!1&&(n.disable(D),h[D]=!1)}function $(D){D!==u&&(n.bindFramebuffer(36160,D),u=D)}function xe(D,ae){return ae===null&&u!==null&&(ae=u),d[D]!==ae?(n.bindFramebuffer(D,ae),d[D]=ae,i&&(D===36009&&(d[36160]=ae),D===36160&&(d[36009]=ae)),!0):!1}function Me(D){return f!==D?(n.useProgram(D),f=D,!0):!1}const ye={[qo]:32774,[T2]:32778,[w2]:32779};if(i)ye[Kb]=32775,ye[Jb]=32776;else{const D=e.get("EXT_blend_minmax");D!==null&&(ye[Kb]=D.MIN_EXT,ye[Jb]=D.MAX_EXT)}const _e={[S2]:0,[E2]:1,[M2]:768,[Zb]:770,[P2]:776,[R2]:774,[C2]:772,[A2]:769,[eT]:771,[L2]:775,[I2]:773};function Ie(D,ae,K,le,F,ue,He,ke){if(D===$s){p===!0&&(ve(3042),p=!1);return}if(p===!1&&(he(3042),p=!0),D!==b2){if(D!==_||ke!==S){if((y!==qo||v!==qo)&&(n.blendEquation(32774),y=qo,v=qo),ke)switch(D){case Zl:n.blendFuncSeparate(1,771,1,771);break;case Sm:n.blendFunc(1,1);break;case $b:n.blendFuncSeparate(0,0,769,771);break;case Qb:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",D);break}else switch(D){case Zl:n.blendFuncSeparate(770,771,1,771);break;case Sm:n.blendFunc(770,1);break;case $b:n.blendFunc(0,769);break;case Qb:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",D);break}m=null,g=null,x=null,T=null,_=D,S=ke}return}F=F||ae,ue=ue||K,He=He||le,(ae!==y||F!==v)&&(n.blendEquationSeparate(ye[ae],ye[F]),y=ae,v=F),(K!==m||le!==g||ue!==x||He!==T)&&(n.blendFuncSeparate(_e[K],_e[le],_e[ue],_e[He]),m=K,g=le,x=ue,T=He),_=D,S=null}function Z(D,ae){D.side===Bi?ve(2884):he(2884);let K=D.side===Rt;ae&&(K=!K),A(K),D.blending===Zl&&D.transparent===!1?Ie($s):Ie(D.blending,D.blendEquation,D.blendSrc,D.blendDst,D.blendEquationAlpha,D.blendSrcAlpha,D.blendDstAlpha,D.premultipliedAlpha),l.setFunc(D.depthFunc),l.setTest(D.depthTest),l.setMask(D.depthWrite),a.setMask(D.colorWrite);const le=D.stencilWrite;c.setTest(le),le&&(c.setMask(D.stencilWriteMask),c.setFunc(D.stencilFunc,D.stencilRef,D.stencilFuncMask),c.setOp(D.stencilFail,D.stencilZFail,D.stencilZPass)),z(D.polygonOffset,D.polygonOffsetFactor,D.polygonOffsetUnits),D.alphaToCoverage===!0?he(32926):ve(32926)}function A(D){b!==D&&(D?n.frontFace(2304):n.frontFace(2305),b=D)}function R(D){D!==y2?(he(2884),D!==M&&(D===qb?n.cullFace(1029):D===v2?n.cullFace(1028):n.cullFace(1032))):ve(2884),M=D}function B(D){D!==N&&(O&&n.lineWidth(D),N=D)}function z(D,ae,K){D?(he(32823),(P!==ae||L!==K)&&(n.polygonOffset(ae,K),P=ae,L=K)):ve(32823)}function E(D){D?he(3089):ve(3089)}function w(D){D===void 0&&(D=33984+V-1),q!==D&&(n.activeTexture(D),q=D)}function k(D,ae){q===null&&w();let K=Y[q];K===void 0&&(K={type:void 0,texture:void 0},Y[q]=K),(K.type!==D||K.texture!==ae)&&(n.bindTexture(D,ae||ne[D]),K.type=D,K.texture=ae)}function U(){const D=Y[q];D!==void 0&&D.type!==void 0&&(n.bindTexture(D.type,null),D.type=void 0,D.texture=void 0)}function X(){try{n.compressedTexImage2D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}}function W(){try{n.texImage2D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}}function re(){try{n.texImage3D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}}function ee(D){we.equals(D)===!1&&(n.scissor(D.x,D.y,D.z,D.w),we.copy(D))}function oe(D){pe.equals(D)===!1&&(n.viewport(D.x,D.y,D.z,D.w),pe.copy(D))}function se(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),i===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},q=null,Y={},u=null,d={},f=null,p=!1,_=null,y=null,m=null,g=null,v=null,x=null,T=null,S=!1,b=null,M=null,N=null,P=null,L=null,we.set(0,0,n.canvas.width,n.canvas.height),pe.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:he,disable:ve,bindFramebuffer:xe,bindXRFramebuffer:$,useProgram:Me,setBlending:Ie,setMaterial:Z,setFlipSided:A,setCullFace:R,setLineWidth:B,setPolygonOffset:z,setScissorTest:E,activeTexture:w,bindTexture:k,unbindTexture:U,compressedTexImage2D:X,texImage2D:W,texImage3D:re,scissor:ee,viewport:oe,reset:se}}function Dk(n,e,t,i,s,r,o){const a=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,h=s.maxTextureSize,u=s.maxSamples,d=new WeakMap;let f,p=!1;try{p=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function _(E,w){return p?new OffscreenCanvas(E,w):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function y(E,w,k,U){let X=1;if((E.width>U||E.height>U)&&(X=U/Math.max(E.width,E.height)),X<1||w===!0)if(typeof HTMLImageElement!="undefined"&&E instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&E instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&E instanceof ImageBitmap){const W=w?yT:Math.floor,re=W(X*E.width),ee=W(X*E.height);f===void 0&&(f=_(re,ee));const oe=k?_(re,ee):f;return oe.width=re,oe.height=ee,oe.getContext("2d").drawImage(E,0,0,re,ee),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+E.width+"x"+E.height+") to ("+re+"x"+ee+")."),oe}else return"data"in E&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+E.width+"x"+E.height+")."),E;return E}function m(E){return Um(E.width)&&Um(E.height)}function g(E){return a?!1:E.wrapS!==Fn||E.wrapT!==Fn||E.minFilter!==zt&&E.minFilter!==$t}function v(E,w){return E.generateMipmaps&&w&&E.minFilter!==zt&&E.minFilter!==$t}function x(E,w,k,U,X=1){n.generateMipmap(E);const W=i.get(w);W.__maxMipLevel=Math.log2(Math.max(k,U,X))}function T(E,w,k){if(a===!1)return w;if(E!==null){if(n[E]!==void 0)return n[E];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+E+"'")}let U=w;return w===6403&&(k===5126&&(U=33326),k===5131&&(U=33325),k===5121&&(U=33321)),w===6407&&(k===5126&&(U=34837),k===5131&&(U=34843),k===5121&&(U=32849)),w===6408&&(k===5126&&(U=34836),k===5131&&(U=34842),k===5121&&(U=32856)),(U===33325||U===33326||U===34842||U===34836)&&e.get("EXT_color_buffer_float"),U}function S(E){return E===zt||E===Im||E===Rm?9728:9729}function b(E){const w=E.target;w.removeEventListener("dispose",b),N(w),w.isVideoTexture&&d.delete(w),o.memory.textures--}function M(E){const w=E.target;w.removeEventListener("dispose",M),P(w)}function N(E){const w=i.get(E);w.__webglInit!==void 0&&(n.deleteTexture(w.__webglTexture),i.remove(E))}function P(E){const w=E.texture,k=i.get(E),U=i.get(w);if(!!E){if(U.__webglTexture!==void 0&&(n.deleteTexture(U.__webglTexture),o.memory.textures--),E.depthTexture&&E.depthTexture.dispose(),E.isWebGLCubeRenderTarget)for(let X=0;X<6;X++)n.deleteFramebuffer(k.__webglFramebuffer[X]),k.__webglDepthbuffer&&n.deleteRenderbuffer(k.__webglDepthbuffer[X]);else n.deleteFramebuffer(k.__webglFramebuffer),k.__webglDepthbuffer&&n.deleteRenderbuffer(k.__webglDepthbuffer),k.__webglMultisampledFramebuffer&&n.deleteFramebuffer(k.__webglMultisampledFramebuffer),k.__webglColorRenderbuffer&&n.deleteRenderbuffer(k.__webglColorRenderbuffer),k.__webglDepthRenderbuffer&&n.deleteRenderbuffer(k.__webglDepthRenderbuffer);if(E.isWebGLMultipleRenderTargets)for(let X=0,W=w.length;X<W;X++){const re=i.get(w[X]);re.__webglTexture&&(n.deleteTexture(re.__webglTexture),o.memory.textures--),i.remove(w[X])}i.remove(w),i.remove(E)}}let L=0;function V(){L=0}function O(){const E=L;return E>=l&&console.warn("THREE.WebGLTextures: Trying to use "+E+" texture units while this GPU supports only "+l),L+=1,E}function H(E,w){const k=i.get(E);if(E.isVideoTexture&&Z(E),E.version>0&&k.__version!==E.version){const U=E.image;if(U===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(U.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Se(k,E,w);return}}t.activeTexture(33984+w),t.bindTexture(3553,k.__webglTexture)}function Q(E,w){const k=i.get(E);if(E.version>0&&k.__version!==E.version){Se(k,E,w);return}t.activeTexture(33984+w),t.bindTexture(35866,k.__webglTexture)}function q(E,w){const k=i.get(E);if(E.version>0&&k.__version!==E.version){Se(k,E,w);return}t.activeTexture(33984+w),t.bindTexture(32879,k.__webglTexture)}function Y(E,w){const k=i.get(E);if(E.version>0&&k.__version!==E.version){ne(k,E,w);return}t.activeTexture(33984+w),t.bindTexture(34067,k.__webglTexture)}const te={[Yo]:10497,[Fn]:33071,[Ih]:33648},me={[zt]:9728,[Im]:9984,[Rm]:9986,[$t]:9729,[iT]:9985,[jo]:9987};function we(E,w,k){if(k?(n.texParameteri(E,10242,te[w.wrapS]),n.texParameteri(E,10243,te[w.wrapT]),(E===32879||E===35866)&&n.texParameteri(E,32882,te[w.wrapR]),n.texParameteri(E,10240,me[w.magFilter]),n.texParameteri(E,10241,me[w.minFilter])):(n.texParameteri(E,10242,33071),n.texParameteri(E,10243,33071),(E===32879||E===35866)&&n.texParameteri(E,32882,33071),(w.wrapS!==Fn||w.wrapT!==Fn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(E,10240,S(w.magFilter)),n.texParameteri(E,10241,S(w.minFilter)),w.minFilter!==zt&&w.minFilter!==$t&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const U=e.get("EXT_texture_filter_anisotropic");if(w.type===Qs&&e.has("OES_texture_float_linear")===!1||a===!1&&w.type===Qo&&e.has("OES_texture_half_float_linear")===!1)return;(w.anisotropy>1||i.get(w).__currentAnisotropy)&&(n.texParameterf(E,U.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(w.anisotropy,s.getMaxAnisotropy())),i.get(w).__currentAnisotropy=w.anisotropy)}}function pe(E,w){E.__webglInit===void 0&&(E.__webglInit=!0,w.addEventListener("dispose",b),E.__webglTexture=n.createTexture(),o.memory.textures++)}function Se(E,w,k){let U=3553;w.isDataTexture2DArray&&(U=35866),w.isDataTexture3D&&(U=32879),pe(E,w),t.activeTexture(33984+k),t.bindTexture(U,E.__webglTexture),n.pixelStorei(37440,w.flipY),n.pixelStorei(37441,w.premultiplyAlpha),n.pixelStorei(3317,w.unpackAlignment),n.pixelStorei(37443,0);const X=g(w)&&m(w.image)===!1,W=y(w.image,X,!1,h),re=m(W)||a,ee=r.convert(w.format);let oe=r.convert(w.type),se=T(w.internalFormat,ee,oe);we(U,w,re);let D;const ae=w.mipmaps;if(w.isDepthTexture)se=6402,a?w.type===Qs?se=36012:w.type===Lh?se=33190:w.type===ec?se=35056:se=33189:w.type===Qs&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),w.format===Ko&&se===6402&&w.type!==Rh&&w.type!==Lh&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),w.type=Rh,oe=r.convert(w.type)),w.format===tc&&se===6402&&(se=34041,w.type!==ec&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),w.type=ec,oe=r.convert(w.type))),t.texImage2D(3553,0,se,W.width,W.height,0,ee,oe,null);else if(w.isDataTexture)if(ae.length>0&&re){for(let K=0,le=ae.length;K<le;K++)D=ae[K],t.texImage2D(3553,K,se,D.width,D.height,0,ee,oe,D.data);w.generateMipmaps=!1,E.__maxMipLevel=ae.length-1}else t.texImage2D(3553,0,se,W.width,W.height,0,ee,oe,W.data),E.__maxMipLevel=0;else if(w.isCompressedTexture){for(let K=0,le=ae.length;K<le;K++)D=ae[K],w.format!==_n&&w.format!==Hi?ee!==null?t.compressedTexImage2D(3553,K,se,D.width,D.height,0,D.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,K,se,D.width,D.height,0,ee,oe,D.data);E.__maxMipLevel=ae.length-1}else if(w.isDataTexture2DArray)t.texImage3D(35866,0,se,W.width,W.height,W.depth,0,ee,oe,W.data),E.__maxMipLevel=0;else if(w.isDataTexture3D)t.texImage3D(32879,0,se,W.width,W.height,W.depth,0,ee,oe,W.data),E.__maxMipLevel=0;else if(ae.length>0&&re){for(let K=0,le=ae.length;K<le;K++)D=ae[K],t.texImage2D(3553,K,se,ee,oe,D);w.generateMipmaps=!1,E.__maxMipLevel=ae.length-1}else t.texImage2D(3553,0,se,ee,oe,W),E.__maxMipLevel=0;v(w,re)&&x(U,w,W.width,W.height),E.__version=w.version,w.onUpdate&&w.onUpdate(w)}function ne(E,w,k){if(w.image.length!==6)return;pe(E,w),t.activeTexture(33984+k),t.bindTexture(34067,E.__webglTexture),n.pixelStorei(37440,w.flipY),n.pixelStorei(37441,w.premultiplyAlpha),n.pixelStorei(3317,w.unpackAlignment),n.pixelStorei(37443,0);const U=w&&(w.isCompressedTexture||w.image[0].isCompressedTexture),X=w.image[0]&&w.image[0].isDataTexture,W=[];for(let K=0;K<6;K++)!U&&!X?W[K]=y(w.image[K],!1,!0,c):W[K]=X?w.image[K].image:w.image[K];const re=W[0],ee=m(re)||a,oe=r.convert(w.format),se=r.convert(w.type),D=T(w.internalFormat,oe,se);we(34067,w,ee);let ae;if(U){for(let K=0;K<6;K++){ae=W[K].mipmaps;for(let le=0;le<ae.length;le++){const F=ae[le];w.format!==_n&&w.format!==Hi?oe!==null?t.compressedTexImage2D(34069+K,le,D,F.width,F.height,0,F.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+K,le,D,F.width,F.height,0,oe,se,F.data)}}E.__maxMipLevel=ae.length-1}else{ae=w.mipmaps;for(let K=0;K<6;K++)if(X){t.texImage2D(34069+K,0,D,W[K].width,W[K].height,0,oe,se,W[K].data);for(let le=0;le<ae.length;le++){const ue=ae[le].image[K].image;t.texImage2D(34069+K,le+1,D,ue.width,ue.height,0,oe,se,ue.data)}}else{t.texImage2D(34069+K,0,D,oe,se,W[K]);for(let le=0;le<ae.length;le++){const F=ae[le];t.texImage2D(34069+K,le+1,D,oe,se,F.image[K])}}E.__maxMipLevel=ae.length}v(w,ee)&&x(34067,w,re.width,re.height),E.__version=w.version,w.onUpdate&&w.onUpdate(w)}function he(E,w,k,U,X){const W=r.convert(k.format),re=r.convert(k.type),ee=T(k.internalFormat,W,re);X===32879||X===35866?t.texImage3D(X,0,ee,w.width,w.height,w.depth,0,W,re,null):t.texImage2D(X,0,ee,w.width,w.height,0,W,re,null),t.bindFramebuffer(36160,E),n.framebufferTexture2D(36160,U,X,i.get(k).__webglTexture,0),t.bindFramebuffer(36160,null)}function ve(E,w,k){if(n.bindRenderbuffer(36161,E),w.depthBuffer&&!w.stencilBuffer){let U=33189;if(k){const X=w.depthTexture;X&&X.isDepthTexture&&(X.type===Qs?U=36012:X.type===Lh&&(U=33190));const W=Ie(w);n.renderbufferStorageMultisample(36161,W,U,w.width,w.height)}else n.renderbufferStorage(36161,U,w.width,w.height);n.framebufferRenderbuffer(36160,36096,36161,E)}else if(w.depthBuffer&&w.stencilBuffer){if(k){const U=Ie(w);n.renderbufferStorageMultisample(36161,U,35056,w.width,w.height)}else n.renderbufferStorage(36161,34041,w.width,w.height);n.framebufferRenderbuffer(36160,33306,36161,E)}else{const U=w.isWebGLMultipleRenderTargets===!0?w.texture[0]:w.texture,X=r.convert(U.format),W=r.convert(U.type),re=T(U.internalFormat,X,W);if(k){const ee=Ie(w);n.renderbufferStorageMultisample(36161,ee,re,w.width,w.height)}else n.renderbufferStorage(36161,re,w.width,w.height)}n.bindRenderbuffer(36161,null)}function $(E,w){if(w&&w.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,E),!(w.depthTexture&&w.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(w.depthTexture).__webglTexture||w.depthTexture.image.width!==w.width||w.depthTexture.image.height!==w.height)&&(w.depthTexture.image.width=w.width,w.depthTexture.image.height=w.height,w.depthTexture.needsUpdate=!0),H(w.depthTexture,0);const U=i.get(w.depthTexture).__webglTexture;if(w.depthTexture.format===Ko)n.framebufferTexture2D(36160,36096,3553,U,0);else if(w.depthTexture.format===tc)n.framebufferTexture2D(36160,33306,3553,U,0);else throw new Error("Unknown depthTexture format")}function xe(E){const w=i.get(E),k=E.isWebGLCubeRenderTarget===!0;if(E.depthTexture){if(k)throw new Error("target.depthTexture not supported in Cube render targets");$(w.__webglFramebuffer,E)}else if(k){w.__webglDepthbuffer=[];for(let U=0;U<6;U++)t.bindFramebuffer(36160,w.__webglFramebuffer[U]),w.__webglDepthbuffer[U]=n.createRenderbuffer(),ve(w.__webglDepthbuffer[U],E,!1)}else t.bindFramebuffer(36160,w.__webglFramebuffer),w.__webglDepthbuffer=n.createRenderbuffer(),ve(w.__webglDepthbuffer,E,!1);t.bindFramebuffer(36160,null)}function Me(E){const w=E.texture,k=i.get(E),U=i.get(w);E.addEventListener("dispose",M),E.isWebGLMultipleRenderTargets!==!0&&(U.__webglTexture=n.createTexture(),U.__version=w.version,o.memory.textures++);const X=E.isWebGLCubeRenderTarget===!0,W=E.isWebGLMultipleRenderTargets===!0,re=E.isWebGLMultisampleRenderTarget===!0,ee=w.isDataTexture3D||w.isDataTexture2DArray,oe=m(E)||a;if(a&&w.format===Hi&&(w.type===Qs||w.type===Qo)&&(w.format=_n,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),X){k.__webglFramebuffer=[];for(let se=0;se<6;se++)k.__webglFramebuffer[se]=n.createFramebuffer()}else if(k.__webglFramebuffer=n.createFramebuffer(),W)if(s.drawBuffers){const se=E.texture;for(let D=0,ae=se.length;D<ae;D++){const K=i.get(se[D]);K.__webglTexture===void 0&&(K.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(re)if(a){k.__webglMultisampledFramebuffer=n.createFramebuffer(),k.__webglColorRenderbuffer=n.createRenderbuffer(),n.bindRenderbuffer(36161,k.__webglColorRenderbuffer);const se=r.convert(w.format),D=r.convert(w.type),ae=T(w.internalFormat,se,D),K=Ie(E);n.renderbufferStorageMultisample(36161,K,ae,E.width,E.height),t.bindFramebuffer(36160,k.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064,36161,k.__webglColorRenderbuffer),n.bindRenderbuffer(36161,null),E.depthBuffer&&(k.__webglDepthRenderbuffer=n.createRenderbuffer(),ve(k.__webglDepthRenderbuffer,E,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(X){t.bindTexture(34067,U.__webglTexture),we(34067,w,oe);for(let se=0;se<6;se++)he(k.__webglFramebuffer[se],E,w,36064,34069+se);v(w,oe)&&x(34067,w,E.width,E.height),t.unbindTexture()}else if(W){const se=E.texture;for(let D=0,ae=se.length;D<ae;D++){const K=se[D],le=i.get(K);t.bindTexture(3553,le.__webglTexture),we(3553,K,oe),he(k.__webglFramebuffer,E,K,36064+D,3553),v(K,oe)&&x(3553,K,E.width,E.height)}t.unbindTexture()}else{let se=3553;ee&&(a?se=w.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(se,U.__webglTexture),we(se,w,oe),he(k.__webglFramebuffer,E,w,36064,se),v(w,oe)&&x(se,w,E.width,E.height,E.depth),t.unbindTexture()}E.depthBuffer&&xe(E)}function ye(E){const w=m(E)||a,k=E.isWebGLMultipleRenderTargets===!0?E.texture:[E.texture];for(let U=0,X=k.length;U<X;U++){const W=k[U];if(v(W,w)){const re=E.isWebGLCubeRenderTarget?34067:3553,ee=i.get(W).__webglTexture;t.bindTexture(re,ee),x(re,W,E.width,E.height),t.unbindTexture()}}}function _e(E){if(E.isWebGLMultisampleRenderTarget)if(a){const w=E.width,k=E.height;let U=16384;E.depthBuffer&&(U|=256),E.stencilBuffer&&(U|=1024);const X=i.get(E);t.bindFramebuffer(36008,X.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,X.__webglFramebuffer),n.blitFramebuffer(0,0,w,k,0,0,w,k,U,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,X.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function Ie(E){return a&&E.isWebGLMultisampleRenderTarget?Math.min(u,E.samples):0}function Z(E){const w=o.render.frame;d.get(E)!==w&&(d.set(E,w),E.update())}let A=!1,R=!1;function B(E,w){E&&E.isWebGLRenderTarget&&(A===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),A=!0),E=E.texture),H(E,w)}function z(E,w){E&&E.isWebGLCubeRenderTarget&&(R===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),R=!0),E=E.texture),Y(E,w)}this.allocateTextureUnit=O,this.resetTextureUnits=V,this.setTexture2D=H,this.setTexture2DArray=Q,this.setTexture3D=q,this.setTextureCube=Y,this.setupRenderTarget=Me,this.updateRenderTargetMipmap=ye,this.updateMultisampleRenderTarget=_e,this.safeSetTexture2D=B,this.safeSetTextureCube=z}function Ok(n,e,t){const i=t.isWebGL2;function s(r){let o;if(r===$o)return 5121;if(r===$2)return 32819;if(r===Q2)return 32820;if(r===K2)return 33635;if(r===q2)return 5120;if(r===Y2)return 5122;if(r===Rh)return 5123;if(r===j2)return 5124;if(r===Lh)return 5125;if(r===Qs)return 5126;if(r===Qo)return i?5131:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(r===J2)return 6406;if(r===Hi)return 6407;if(r===_n)return 6408;if(r===Z2)return 6409;if(r===e3)return 6410;if(r===Ko)return 6402;if(r===tc)return 34041;if(r===n3)return 6403;if(r===i3)return 36244;if(r===s3)return 33319;if(r===r3)return 33320;if(r===o3)return 36248;if(r===a3)return 36249;if(r===sT||r===rT||r===oT||r===aT)if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(r===sT)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===rT)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===oT)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===aT)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===lT||r===cT||r===uT||r===hT)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(r===lT)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===cT)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===uT)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===hT)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===l3)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if((r===dT||r===fT)&&(o=e.get("WEBGL_compressed_texture_etc"),o!==null)){if(r===dT)return o.COMPRESSED_RGB8_ETC2;if(r===fT)return o.COMPRESSED_RGBA8_ETC2_EAC}if(r===c3||r===u3||r===h3||r===d3||r===f3||r===p3||r===m3||r===g3||r===_3||r===y3||r===v3||r===x3||r===b3||r===T3||r===S3||r===E3||r===M3||r===A3||r===C3||r===I3||r===R3||r===L3||r===P3||r===N3||r===F3||r===D3||r===O3||r===k3)return o=e.get("WEBGL_compressed_texture_astc"),o!==null?r:null;if(r===w3)return o=e.get("EXT_texture_compression_bptc"),o!==null?r:null;if(r===ec)return i?34042:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:s}}class vw extends vn{constructor(e=[]){super();this.cameras=e}}vw.prototype.isArrayCamera=!0;class ur extends Qe{constructor(){super();this.type="Group"}}ur.prototype.isGroup=!0;const kk={type:"move"};class gg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ur,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ur,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new C,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new C),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ur,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new C,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new C),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(a!==null&&(s=t.getPose(e.targetRaySpace,i),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(kk))),c&&e.hand){o=!0;for(const _ of e.hand.values()){const y=t.getJointPose(_,i);if(c.joints[_.jointName]===void 0){const g=new ur;g.matrixAutoUpdate=!1,g.visible=!1,c.joints[_.jointName]=g,c.add(g)}const m=c.joints[_.jointName];y!==null&&(m.matrix.fromArray(y.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=y.radius),m.visible=y!==null}const h=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],d=h.position.distanceTo(u.position),f=.02,p=.005;c.inputState.pinching&&d>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));return a!==null&&(a.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}}class Uk extends Js{constructor(e,t){super();const i=this,s=e.state;let r=null,o=1,a=null,l="local-floor",c=null,h=null,u=null,d=null,f=null,p=!1,_=null,y=null,m=null,g=null,v=null,x=null;const T=[],S=new Map,b=new vn;b.layers.enable(1),b.viewport=new Be;const M=new vn;M.layers.enable(2),M.viewport=new Be;const N=[b,M],P=new vw;P.layers.enable(1),P.layers.enable(2);let L=null,V=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ne){let he=T[ne];return he===void 0&&(he=new gg,T[ne]=he),he.getTargetRaySpace()},this.getControllerGrip=function(ne){let he=T[ne];return he===void 0&&(he=new gg,T[ne]=he),he.getGripSpace()},this.getHand=function(ne){let he=T[ne];return he===void 0&&(he=new gg,T[ne]=he),he.getHandSpace()};function O(ne){const he=S.get(ne.inputSource);he&&he.dispatchEvent({type:ne.type,data:ne.inputSource})}function H(){S.forEach(function(ne,he){ne.disconnect(he)}),S.clear(),L=null,V=null,s.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),u&&t.deleteFramebuffer(u),_&&t.deleteFramebuffer(_),y&&t.deleteRenderbuffer(y),m&&t.deleteRenderbuffer(m),u=null,_=null,y=null,m=null,f=null,d=null,h=null,r=null,Se.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ne){o=ne,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ne){l=ne,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return g},this.getSession=function(){return r},this.setSession=async function(ne){if(r=ne,r!==null){r.addEventListener("select",O),r.addEventListener("selectstart",O),r.addEventListener("selectend",O),r.addEventListener("squeeze",O),r.addEventListener("squeezestart",O),r.addEventListener("squeezeend",O),r.addEventListener("end",H),r.addEventListener("inputsourceschange",Q);const he=t.getContextAttributes();if(he.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0){const ve={antialias:he.antialias,alpha:he.alpha,depth:he.depth,stencil:he.stencil,framebufferScaleFactor:o};f=new XRWebGLLayer(r,t,ve),r.updateRenderState({baseLayer:f})}else if(t instanceof WebGLRenderingContext){const ve={antialias:!0,alpha:he.alpha,depth:he.depth,stencil:he.stencil,framebufferScaleFactor:o};f=new XRWebGLLayer(r,t,ve),r.updateRenderState({layers:[f]})}else{p=he.antialias;let ve=null;he.depth&&(x=256,he.stencil&&(x|=1024),v=he.stencil?33306:36096,ve=he.stencil?35056:33190);const $={colorFormat:he.alpha?32856:32849,depthFormat:ve,scaleFactor:o};h=new XRWebGLBinding(r,t),d=h.createProjectionLayer($),u=t.createFramebuffer(),r.updateRenderState({layers:[d]}),p&&(_=t.createFramebuffer(),y=t.createRenderbuffer(),t.bindRenderbuffer(36161,y),t.renderbufferStorageMultisample(36161,4,32856,d.textureWidth,d.textureHeight),s.bindFramebuffer(36160,_),t.framebufferRenderbuffer(36160,36064,36161,y),t.bindRenderbuffer(36161,null),ve!==null&&(m=t.createRenderbuffer(),t.bindRenderbuffer(36161,m),t.renderbufferStorageMultisample(36161,4,ve,d.textureWidth,d.textureHeight),t.framebufferRenderbuffer(36160,v,36161,m),t.bindRenderbuffer(36161,null)),s.bindFramebuffer(36160,null))}a=await r.requestReferenceSpace(l),Se.setContext(r),Se.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function Q(ne){const he=r.inputSources;for(let ve=0;ve<T.length;ve++)S.set(he[ve],T[ve]);for(let ve=0;ve<ne.removed.length;ve++){const $=ne.removed[ve],xe=S.get($);xe&&(xe.dispatchEvent({type:"disconnected",data:$}),S.delete($))}for(let ve=0;ve<ne.added.length;ve++){const $=ne.added[ve],xe=S.get($);xe&&xe.dispatchEvent({type:"connected",data:$})}}const q=new C,Y=new C;function te(ne,he,ve){q.setFromMatrixPosition(he.matrixWorld),Y.setFromMatrixPosition(ve.matrixWorld);const $=q.distanceTo(Y),xe=he.projectionMatrix.elements,Me=ve.projectionMatrix.elements,ye=xe[14]/(xe[10]-1),_e=xe[14]/(xe[10]+1),Ie=(xe[9]+1)/xe[5],Z=(xe[9]-1)/xe[5],A=(xe[8]-1)/xe[0],R=(Me[8]+1)/Me[0],B=ye*A,z=ye*R,E=$/(-A+R),w=E*-A;he.matrixWorld.decompose(ne.position,ne.quaternion,ne.scale),ne.translateX(w),ne.translateZ(E),ne.matrixWorld.compose(ne.position,ne.quaternion,ne.scale),ne.matrixWorldInverse.copy(ne.matrixWorld).invert();const k=ye+E,U=_e+E,X=B-w,W=z+($-w),re=Ie*_e/U*k,ee=Z*_e/U*k;ne.projectionMatrix.makePerspective(X,W,re,ee,k,U)}function me(ne,he){he===null?ne.matrixWorld.copy(ne.matrix):ne.matrixWorld.multiplyMatrices(he.matrixWorld,ne.matrix),ne.matrixWorldInverse.copy(ne.matrixWorld).invert()}this.updateCamera=function(ne){if(r===null)return;P.near=M.near=b.near=ne.near,P.far=M.far=b.far=ne.far,(L!==P.near||V!==P.far)&&(r.updateRenderState({depthNear:P.near,depthFar:P.far}),L=P.near,V=P.far);const he=ne.parent,ve=P.cameras;me(P,he);for(let xe=0;xe<ve.length;xe++)me(ve[xe],he);P.matrixWorld.decompose(P.position,P.quaternion,P.scale),ne.position.copy(P.position),ne.quaternion.copy(P.quaternion),ne.scale.copy(P.scale),ne.matrix.copy(P.matrix),ne.matrixWorld.copy(P.matrixWorld);const $=ne.children;for(let xe=0,Me=$.length;xe<Me;xe++)$[xe].updateMatrixWorld(!0);ve.length===2?te(P,b,M):P.projectionMatrix.copy(b.projectionMatrix)},this.getCamera=function(){return P},this.getFoveation=function(){if(d!==null)return d.fixedFoveation;if(f!==null)return f.fixedFoveation},this.setFoveation=function(ne){d!==null&&(d.fixedFoveation=ne),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=ne)};let we=null;function pe(ne,he){if(c=he.getViewerPose(a),g=he,c!==null){const $=c.views;f!==null&&s.bindXRFramebuffer(f.framebuffer);let xe=!1;$.length!==P.cameras.length&&(P.cameras.length=0,xe=!0);for(let Me=0;Me<$.length;Me++){const ye=$[Me];let _e=null;if(f!==null)_e=f.getViewport(ye);else{const Z=h.getViewSubImage(d,ye);s.bindXRFramebuffer(u),Z.depthStencilTexture!==void 0&&t.framebufferTexture2D(36160,v,3553,Z.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,Z.colorTexture,0),_e=Z.viewport}const Ie=N[Me];Ie.matrix.fromArray(ye.transform.matrix),Ie.projectionMatrix.fromArray(ye.projectionMatrix),Ie.viewport.set(_e.x,_e.y,_e.width,_e.height),Me===0&&P.matrix.copy(Ie.matrix),xe===!0&&P.cameras.push(Ie)}p&&(s.bindXRFramebuffer(_),x!==null&&t.clear(x))}const ve=r.inputSources;for(let $=0;$<T.length;$++){const xe=T[$],Me=ve[$];xe.update(Me,he,a)}if(we&&we(ne,he),p){const $=d.textureWidth,xe=d.textureHeight;s.bindFramebuffer(36008,_),s.bindFramebuffer(36009,u),t.invalidateFramebuffer(36008,[v]),t.invalidateFramebuffer(36009,[v]),t.blitFramebuffer(0,0,$,xe,0,0,$,xe,16384,9728),t.invalidateFramebuffer(36008,[36064]),s.bindFramebuffer(36008,null),s.bindFramebuffer(36009,null),s.bindFramebuffer(36160,_)}g=null}const Se=new kT;Se.setAnimationLoop(pe),this.setAnimationLoop=function(ne){we=ne},this.dispose=function(){}}}function Bk(n){function e(m,g){m.fogColor.value.copy(g.color),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)}function t(m,g,v,x,T){g.isMeshBasicMaterial?i(m,g):g.isMeshLambertMaterial?(i(m,g),l(m,g)):g.isMeshToonMaterial?(i(m,g),h(m,g)):g.isMeshPhongMaterial?(i(m,g),c(m,g)):g.isMeshStandardMaterial?(i(m,g),g.isMeshPhysicalMaterial?d(m,g,T):u(m,g)):g.isMeshMatcapMaterial?(i(m,g),f(m,g)):g.isMeshDepthMaterial?(i(m,g),p(m,g)):g.isMeshDistanceMaterial?(i(m,g),_(m,g)):g.isMeshNormalMaterial?(i(m,g),y(m,g)):g.isLineBasicMaterial?(s(m,g),g.isLineDashedMaterial&&r(m,g)):g.isPointsMaterial?o(m,g,v,x):g.isSpriteMaterial?a(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function i(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);const v=n.get(g).envMap;if(v){m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio;const S=n.get(v).__maxMipLevel;S!==void 0&&(m.maxMipLevel.value=S)}g.lightMap&&(m.lightMap.value=g.lightMap,m.lightMapIntensity.value=g.lightMapIntensity),g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity);let x;g.map?x=g.map:g.specularMap?x=g.specularMap:g.displacementMap?x=g.displacementMap:g.normalMap?x=g.normalMap:g.bumpMap?x=g.bumpMap:g.roughnessMap?x=g.roughnessMap:g.metalnessMap?x=g.metalnessMap:g.alphaMap?x=g.alphaMap:g.emissiveMap?x=g.emissiveMap:g.clearcoatMap?x=g.clearcoatMap:g.clearcoatNormalMap?x=g.clearcoatNormalMap:g.clearcoatRoughnessMap?x=g.clearcoatRoughnessMap:g.specularIntensityMap?x=g.specularIntensityMap:g.specularTintMap?x=g.specularTintMap:g.transmissionMap?x=g.transmissionMap:g.thicknessMap&&(x=g.thicknessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix));let T;g.aoMap?T=g.aoMap:g.lightMap&&(T=g.lightMap),T!==void 0&&(T.isWebGLRenderTarget&&(T=T.texture),T.matrixAutoUpdate===!0&&T.updateMatrix(),m.uv2Transform.value.copy(T.matrix))}function s(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}function r(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}function o(m,g,v,x){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=x*.5,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let T;g.map?T=g.map:g.alphaMap&&(T=g.alphaMap),T!==void 0&&(T.matrixAutoUpdate===!0&&T.updateMatrix(),m.uvTransform.value.copy(T.matrix))}function a(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v;g.map?v=g.map:g.alphaMap&&(v=g.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix))}function l(m,g){g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap)}function c(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===Rt&&(m.bumpScale.value*=-1)),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===Rt&&m.normalScale.value.negate()),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias)}function h(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===Rt&&(m.bumpScale.value*=-1)),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===Rt&&m.normalScale.value.negate()),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias)}function u(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===Rt&&(m.bumpScale.value*=-1)),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===Rt&&m.normalScale.value.negate()),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),n.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}function d(m,g,v){u(m,g),m.ior.value=g.ior,g.sheenTint&&m.sheenTint.value.copy(g.sheenTint),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===Rt&&m.clearcoatNormalScale.value.negate())),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationTint.value.copy(g.attenuationTint)),m.specularIntensity.value=g.specularIntensity,m.specularTint.value.copy(g.specularTint),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularTintMap&&(m.specularTintMap.value=g.specularTintMap)}function f(m,g){g.matcap&&(m.matcap.value=g.matcap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===Rt&&(m.bumpScale.value*=-1)),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===Rt&&m.normalScale.value.negate()),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias)}function p(m,g){g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias)}function _(m,g){g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}function y(m,g){g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===Rt&&(m.bumpScale.value*=-1)),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===Rt&&m.normalScale.value.negate()),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function Hk(){const n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.style.display="block",n}function ot(n={}){const e=n.canvas!==void 0?n.canvas:Hk(),t=n.context!==void 0?n.context:null,i=n.alpha!==void 0?n.alpha:!1,s=n.depth!==void 0?n.depth:!0,r=n.stencil!==void 0?n.stencil:!0,o=n.antialias!==void 0?n.antialias:!1,a=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,l=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,c=n.powerPreference!==void 0?n.powerPreference:"default",h=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1;let u=null,d=null;const f=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Lt,this.physicallyCorrectLights=!1,this.toneMapping=Xr,this.toneMappingExposure=1;const _=this;let y=!1,m=0,g=0,v=null,x=-1,T=null;const S=new Be,b=new Be;let M=null,N=e.width,P=e.height,L=1,V=null,O=null;const H=new Be(0,0,N,P),Q=new Be(0,0,N,P);let q=!1;const Y=[],te=new td;let me=!1,we=!1,pe=null;const Se=new be,ne=new C,he={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ve(){return v===null?L:1}let $=t;function xe(I,j){for(let G=0;G<I.length;G++){const J=I[G],ce=e.getContext(J,j);if(ce!==null)return ce}return null}try{const I={alpha:i,depth:s,stencil:r,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(e.addEventListener("webglcontextlost",He,!1),e.addEventListener("webglcontextrestored",ke,!1),$===null){const j=["webgl2","webgl","experimental-webgl"];if(_.isWebGL1Renderer===!0&&j.shift(),$=xe(j,I),$===null)throw xe(j)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}$.getShaderPrecisionFormat===void 0&&($.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(I){throw console.error("THREE.WebGLRenderer: "+I.message),I}let Me,ye,_e,Ie,Z,A,R,B,z,E,w,k,U,X,W,re,ee,oe,se,D,ae,K,le;function F(){Me=new cO($),ye=new tO($,Me,n),Me.init(ye),K=new Ok($,Me,ye),_e=new Fk($,Me,ye),Y[0]=1029,Ie=new dO($),Z=new wk,A=new Dk($,Me,_e,Z,ye,K,Ie),R=new iO(_),B=new lO(_),z=new EN($,ye),le=new ZD($,Me,z,ye),E=new uO($,z,Ie,le),w=new gO($,E,z,Ie),se=new mO($),re=new nO(Z),k=new Tk(_,R,B,Me,ye,le,re),U=new Bk(Z),X=new Ek(Z),W=new Lk(Me,ye),oe=new JD(_,R,_e,w,a),ee=new yw(_,w,ye),D=new eO($,Me,Ie,ye),ae=new hO($,Me,Ie,ye),Ie.programs=k.programs,_.capabilities=ye,_.extensions=Me,_.properties=Z,_.renderLists=X,_.shadowMap=ee,_.state=_e,_.info=Ie}F();const ue=new Uk(_,$);this.xr=ue,this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.forceContextLoss=function(){const I=Me.get("WEBGL_lose_context");I&&I.loseContext()},this.forceContextRestore=function(){const I=Me.get("WEBGL_lose_context");I&&I.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(I){I!==void 0&&(L=I,this.setSize(N,P,!1))},this.getSize=function(I){return I.set(N,P)},this.setSize=function(I,j,G){if(ue.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}N=I,P=j,e.width=Math.floor(I*L),e.height=Math.floor(j*L),G!==!1&&(e.style.width=I+"px",e.style.height=j+"px"),this.setViewport(0,0,I,j)},this.getDrawingBufferSize=function(I){return I.set(N*L,P*L).floor()},this.setDrawingBufferSize=function(I,j,G){N=I,P=j,L=G,e.width=Math.floor(I*G),e.height=Math.floor(j*G),this.setViewport(0,0,I,j)},this.getCurrentViewport=function(I){return I.copy(S)},this.getViewport=function(I){return I.copy(H)},this.setViewport=function(I,j,G,J){I.isVector4?H.set(I.x,I.y,I.z,I.w):H.set(I,j,G,J),_e.viewport(S.copy(H).multiplyScalar(L).floor())},this.getScissor=function(I){return I.copy(Q)},this.setScissor=function(I,j,G,J){I.isVector4?Q.set(I.x,I.y,I.z,I.w):Q.set(I,j,G,J),_e.scissor(b.copy(Q).multiplyScalar(L).floor())},this.getScissorTest=function(){return q},this.setScissorTest=function(I){_e.setScissorTest(q=I)},this.setOpaqueSort=function(I){V=I},this.setTransparentSort=function(I){O=I},this.getClearColor=function(I){return I.copy(oe.getClearColor())},this.setClearColor=function(){oe.setClearColor.apply(oe,arguments)},this.getClearAlpha=function(){return oe.getClearAlpha()},this.setClearAlpha=function(){oe.setClearAlpha.apply(oe,arguments)},this.clear=function(I,j,G){let J=0;(I===void 0||I)&&(J|=16384),(j===void 0||j)&&(J|=256),(G===void 0||G)&&(J|=1024),$.clear(J)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",He,!1),e.removeEventListener("webglcontextrestored",ke,!1),X.dispose(),W.dispose(),Z.dispose(),R.dispose(),B.dispose(),w.dispose(),le.dispose(),ue.dispose(),ue.removeEventListener("sessionstart",my),ue.removeEventListener("sessionend",gy),pe&&(pe.dispose(),pe=null),Er.stop()};function He(I){I.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function ke(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const I=Ie.autoReset,j=ee.enabled,G=ee.autoUpdate,J=ee.needsUpdate,ce=ee.type;F(),Ie.autoReset=I,ee.enabled=j,ee.autoUpdate=G,ee.needsUpdate=J,ee.type=ce}function Tt(I){const j=I.target;j.removeEventListener("dispose",Tt),De(j)}function De(I){pt(I),Z.remove(I)}function pt(I){const j=Z.get(I).programs;j!==void 0&&j.forEach(function(G){k.releaseProgram(G)})}function wn(I,j){I.render(function(G){_.renderBufferImmediate(G,j)})}this.renderBufferImmediate=function(I,j){le.initAttributes();const G=Z.get(I);I.hasPositions&&!G.position&&(G.position=$.createBuffer()),I.hasNormals&&!G.normal&&(G.normal=$.createBuffer()),I.hasUvs&&!G.uv&&(G.uv=$.createBuffer()),I.hasColors&&!G.color&&(G.color=$.createBuffer());const J=j.getAttributes();I.hasPositions&&($.bindBuffer(34962,G.position),$.bufferData(34962,I.positionArray,35048),le.enableAttribute(J.position.location),$.vertexAttribPointer(J.position.location,3,5126,!1,0,0)),I.hasNormals&&($.bindBuffer(34962,G.normal),$.bufferData(34962,I.normalArray,35048),le.enableAttribute(J.normal.location),$.vertexAttribPointer(J.normal.location,3,5126,!1,0,0)),I.hasUvs&&($.bindBuffer(34962,G.uv),$.bufferData(34962,I.uvArray,35048),le.enableAttribute(J.uv.location),$.vertexAttribPointer(J.uv.location,2,5126,!1,0,0)),I.hasColors&&($.bindBuffer(34962,G.color),$.bufferData(34962,I.colorArray,35048),le.enableAttribute(J.color.location),$.vertexAttribPointer(J.color.location,3,5126,!1,0,0)),le.disableUnusedAttributes(),$.drawArrays(4,0,I.count),I.count=0},this.renderBufferDirect=function(I,j,G,J,ce,Oe){j===null&&(j=he);const Re=ce.isMesh&&ce.matrixWorld.determinant()<0,Ae=xy(I,j,J,ce);_e.setMaterial(J,Re);let We=G.index;const st=G.attributes.position;if(We===null){if(st===void 0||st.count===0)return}else if(We.count===0)return;let Ye=1;J.wireframe===!0&&(We=E.getWireframeAttribute(G),Ye=2),(G.morphAttributes.position!==void 0||G.morphAttributes.normal!==void 0)&&se.update(ce,G,J,Ae),le.setup(ce,J,Ae,G,We);let Ke,Le=D;We!==null&&(Ke=z.get(We),Le=ae,Le.setIndex(Ke));const Mr=We!==null?We.count:st.count,Ft=G.drawRange.start*Ye,Rs=G.drawRange.count*Ye,gi=Oe!==null?Oe.start*Ye:0,Ar=Oe!==null?Oe.count*Ye:1/0,Ls=Math.max(Ft,gi),Yt=Math.min(Mr,Ft+Rs,gi+Ar)-1,Pi=Math.max(0,Yt-Ls+1);if(Pi!==0){if(ce.isMesh)J.wireframe===!0?(_e.setLineWidth(J.wireframeLinewidth*ve()),Le.setMode(1)):Le.setMode(4);else if(ce.isLine){let an=J.linewidth;an===void 0&&(an=1),_e.setLineWidth(an*ve()),ce.isLineSegments?Le.setMode(1):ce.isLineLoop?Le.setMode(2):Le.setMode(3)}else ce.isPoints?Le.setMode(0):ce.isSprite&&Le.setMode(4);if(ce.isInstancedMesh)Le.renderInstances(Ls,Pi,ce.count);else if(G.isInstancedBufferGeometry){const an=Math.min(G.instanceCount,G._maxInstanceCount);Le.renderInstances(Ls,Pi,an)}else Le.render(Ls,Pi)}},this.compile=function(I,j){d=W.get(I),d.init(),p.push(d),I.traverseVisible(function(G){G.isLight&&G.layers.test(j.layers)&&(d.pushLight(G),G.castShadow&&d.pushShadow(G))}),d.setupLights(_.physicallyCorrectLights),I.traverse(function(G){const J=G.material;if(J)if(Array.isArray(J))for(let ce=0;ce<J.length;ce++){const Oe=J[ce];kf(Oe,I,G)}else kf(J,I,G)}),p.pop(),d=null};let Vn=null;function mi(I){Vn&&Vn(I)}function my(){Er.stop()}function gy(){Er.start()}const Er=new kT;Er.setAnimationLoop(mi),typeof window!="undefined"&&Er.setContext(window),this.setAnimationLoop=function(I){Vn=I,ue.setAnimationLoop(I),I===null?Er.stop():Er.start()},ue.addEventListener("sessionstart",my),ue.addEventListener("sessionend",gy),this.render=function(I,j){if(j!==void 0&&j.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;I.autoUpdate===!0&&I.updateMatrixWorld(),j.parent===null&&j.updateMatrixWorld(),ue.enabled===!0&&ue.isPresenting===!0&&(ue.cameraAutoUpdate===!0&&ue.updateCamera(j),j=ue.getCamera()),I.isScene===!0&&I.onBeforeRender(_,I,j,v),d=W.get(I,p.length),d.init(),p.push(d),Se.multiplyMatrices(j.projectionMatrix,j.matrixWorldInverse),te.setFromProjectionMatrix(Se),we=this.localClippingEnabled,me=re.init(this.clippingPlanes,we,j),u=X.get(I,f.length),u.init(),f.push(u),_y(I,j,0,_.sortObjects),u.finish(),_.sortObjects===!0&&u.sort(V,O),me===!0&&re.beginShadows();const G=d.state.shadowsArray;if(ee.render(G,I,j),me===!0&&re.endShadows(),this.info.autoReset===!0&&this.info.reset(),oe.render(u,I),d.setupLights(_.physicallyCorrectLights),j.isArrayCamera){const J=j.cameras;for(let ce=0,Oe=J.length;ce<Oe;ce++){const Re=J[ce];yy(u,I,Re,Re.viewport)}}else yy(u,I,j);v!==null&&(A.updateMultisampleRenderTarget(v),A.updateRenderTargetMipmap(v)),I.isScene===!0&&I.onAfterRender(_,I,j),_e.buffers.depth.setTest(!0),_e.buffers.depth.setMask(!0),_e.buffers.color.setMask(!0),_e.setPolygonOffset(!1),le.resetDefaultState(),x=-1,T=null,p.pop(),p.length>0?d=p[p.length-1]:d=null,f.pop(),f.length>0?u=f[f.length-1]:u=null};function _y(I,j,G,J){if(I.visible===!1)return;if(I.layers.test(j.layers)){if(I.isGroup)G=I.renderOrder;else if(I.isLOD)I.autoUpdate===!0&&I.update(j);else if(I.isLight)d.pushLight(I),I.castShadow&&d.pushShadow(I);else if(I.isSprite){if(!I.frustumCulled||te.intersectsSprite(I)){J&&ne.setFromMatrixPosition(I.matrixWorld).applyMatrix4(Se);const Re=w.update(I),Ae=I.material;Ae.visible&&u.push(I,Re,Ae,G,ne.z,null)}}else if(I.isImmediateRenderObject)J&&ne.setFromMatrixPosition(I.matrixWorld).applyMatrix4(Se),u.push(I,null,I.material,G,ne.z,null);else if((I.isMesh||I.isLine||I.isPoints)&&(I.isSkinnedMesh&&I.skeleton.frame!==Ie.render.frame&&(I.skeleton.update(),I.skeleton.frame=Ie.render.frame),!I.frustumCulled||te.intersectsObject(I))){J&&ne.setFromMatrixPosition(I.matrixWorld).applyMatrix4(Se);const Re=w.update(I),Ae=I.material;if(Array.isArray(Ae)){const We=Re.groups;for(let st=0,Ye=We.length;st<Ye;st++){const Ke=We[st],Le=Ae[Ke.materialIndex];Le&&Le.visible&&u.push(I,Re,Le,G,ne.z,Ke)}}else Ae.visible&&u.push(I,Re,Ae,G,ne.z,null)}}const Oe=I.children;for(let Re=0,Ae=Oe.length;Re<Ae;Re++)_y(Oe[Re],j,G,J)}function yy(I,j,G,J){const ce=I.opaque,Oe=I.transmissive,Re=I.transparent;d.setupLightsView(G),Oe.length>0&&kA(ce,j,G),J&&_e.viewport(S.copy(J)),ce.length>0&&gu(ce,j,G),Oe.length>0&&gu(Oe,j,G),Re.length>0&&gu(Re,j,G)}function kA(I,j,G){if(pe===null){const Re=o===!0&&ye.isWebGL2===!0?vT:Dn;pe=new Re(1024,1024,{generateMipmaps:!0,type:K.convert(Qo)!==null?Qo:$o,minFilter:jo,magFilter:zt,wrapS:Fn,wrapT:Fn})}const J=_.getRenderTarget();_.setRenderTarget(pe),_.clear();const ce=_.toneMapping;_.toneMapping=Xr,gu(I,j,G),_.toneMapping=ce,A.updateMultisampleRenderTarget(pe),A.updateRenderTargetMipmap(pe),_.setRenderTarget(J)}function gu(I,j,G){const J=j.isScene===!0?j.overrideMaterial:null;for(let ce=0,Oe=I.length;ce<Oe;ce++){const Re=I[ce],Ae=Re.object,We=Re.geometry,st=J===null?Re.material:J,Ye=Re.group;Ae.layers.test(G.layers)&&UA(Ae,j,G,We,st,Ye)}}function UA(I,j,G,J,ce,Oe){if(I.onBeforeRender(_,j,G,J,ce,Oe),I.modelViewMatrix.multiplyMatrices(G.matrixWorldInverse,I.matrixWorld),I.normalMatrix.getNormalMatrix(I.modelViewMatrix),I.isImmediateRenderObject){const Re=xy(G,j,ce,I);_e.setMaterial(ce),le.reset(),wn(I,Re)}else ce.transparent===!0&&ce.side===Bi?(ce.side=Rt,ce.needsUpdate=!0,_.renderBufferDirect(G,j,J,ce,I,Oe),ce.side=js,ce.needsUpdate=!0,_.renderBufferDirect(G,j,J,ce,I,Oe),ce.side=Bi):_.renderBufferDirect(G,j,J,ce,I,Oe);I.onAfterRender(_,j,G,J,ce,Oe)}function kf(I,j,G){j.isScene!==!0&&(j=he);const J=Z.get(I),ce=d.state.lights,Oe=d.state.shadowsArray,Re=ce.state.version,Ae=k.getParameters(I,ce.state,Oe,j,G),We=k.getProgramCacheKey(Ae);let st=J.programs;J.environment=I.isMeshStandardMaterial?j.environment:null,J.fog=j.fog,J.envMap=(I.isMeshStandardMaterial?B:R).get(I.envMap||J.environment),st===void 0&&(I.addEventListener("dispose",Tt),st=new Map,J.programs=st);let Ye=st.get(We);if(Ye!==void 0){if(J.currentProgram===Ye&&J.lightsStateVersion===Re)return vy(I,Ae),Ye}else Ae.uniforms=k.getUniforms(I),I.onBuild(Ae,_),I.onBeforeCompile(Ae,_),Ye=k.acquireProgram(Ae,We),st.set(We,Ye),J.uniforms=Ae.uniforms;const Ke=J.uniforms;(!I.isShaderMaterial&&!I.isRawShaderMaterial||I.clipping===!0)&&(Ke.clippingPlanes=re.uniform),vy(I,Ae),J.needsLights=HA(I),J.lightsStateVersion=Re,J.needsLights&&(Ke.ambientLightColor.value=ce.state.ambient,Ke.lightProbe.value=ce.state.probe,Ke.directionalLights.value=ce.state.directional,Ke.directionalLightShadows.value=ce.state.directionalShadow,Ke.spotLights.value=ce.state.spot,Ke.spotLightShadows.value=ce.state.spotShadow,Ke.rectAreaLights.value=ce.state.rectArea,Ke.ltc_1.value=ce.state.rectAreaLTC1,Ke.ltc_2.value=ce.state.rectAreaLTC2,Ke.pointLights.value=ce.state.point,Ke.pointLightShadows.value=ce.state.pointShadow,Ke.hemisphereLights.value=ce.state.hemi,Ke.directionalShadowMap.value=ce.state.directionalShadowMap,Ke.directionalShadowMatrix.value=ce.state.directionalShadowMatrix,Ke.spotShadowMap.value=ce.state.spotShadowMap,Ke.spotShadowMatrix.value=ce.state.spotShadowMatrix,Ke.pointShadowMap.value=ce.state.pointShadowMap,Ke.pointShadowMatrix.value=ce.state.pointShadowMatrix);const Le=Ye.getUniforms(),Mr=cr.seqWithValue(Le.seq,Ke);return J.currentProgram=Ye,J.uniformsList=Mr,Ye}function vy(I,j){const G=Z.get(I);G.outputEncoding=j.outputEncoding,G.instancing=j.instancing,G.skinning=j.skinning,G.morphTargets=j.morphTargets,G.morphNormals=j.morphNormals,G.numClippingPlanes=j.numClippingPlanes,G.numIntersection=j.numClipIntersection,G.vertexAlphas=j.vertexAlphas,G.vertexTangents=j.vertexTangents}function xy(I,j,G,J){j.isScene!==!0&&(j=he),A.resetTextureUnits();const ce=j.fog,Oe=G.isMeshStandardMaterial?j.environment:null,Re=v===null?_.outputEncoding:v.texture.encoding,Ae=(G.isMeshStandardMaterial?B:R).get(G.envMap||Oe),We=G.vertexColors===!0&&!!J.geometry&&!!J.geometry.attributes.color&&J.geometry.attributes.color.itemSize===4,st=!!J.geometry&&!!J.geometry.attributes.tangent,Ye=!!J.geometry&&!!J.geometry.morphAttributes.position,Ke=!!J.geometry&&!!J.geometry.morphAttributes.normal,Le=Z.get(G),Mr=d.state.lights;if(me===!0&&(we===!0||I!==T)){const an=I===T&&G.id===x;re.setState(G,I,an)}let Ft=!1;G.version===Le.__version?(Le.needsLights&&Le.lightsStateVersion!==Mr.state.version||Le.outputEncoding!==Re||J.isInstancedMesh&&Le.instancing===!1||!J.isInstancedMesh&&Le.instancing===!0||J.isSkinnedMesh&&Le.skinning===!1||!J.isSkinnedMesh&&Le.skinning===!0||Le.envMap!==Ae||G.fog&&Le.fog!==ce||Le.numClippingPlanes!==void 0&&(Le.numClippingPlanes!==re.numPlanes||Le.numIntersection!==re.numIntersection)||Le.vertexAlphas!==We||Le.vertexTangents!==st||Le.morphTargets!==Ye||Le.morphNormals!==Ke)&&(Ft=!0):(Ft=!0,Le.__version=G.version);let Rs=Le.currentProgram;Ft===!0&&(Rs=kf(G,j,J));let gi=!1,Ar=!1,Ls=!1;const Yt=Rs.getUniforms(),Pi=Le.uniforms;if(_e.useProgram(Rs.program)&&(gi=!0,Ar=!0,Ls=!0),G.id!==x&&(x=G.id,Ar=!0),gi||T!==I){if(Yt.setValue($,"projectionMatrix",I.projectionMatrix),ye.logarithmicDepthBuffer&&Yt.setValue($,"logDepthBufFC",2/(Math.log(I.far+1)/Math.LN2)),T!==I&&(T=I,Ar=!0,Ls=!0),G.isShaderMaterial||G.isMeshPhongMaterial||G.isMeshToonMaterial||G.isMeshStandardMaterial||G.envMap){const an=Yt.map.cameraPosition;an!==void 0&&an.setValue($,ne.setFromMatrixPosition(I.matrixWorld))}(G.isMeshPhongMaterial||G.isMeshToonMaterial||G.isMeshLambertMaterial||G.isMeshBasicMaterial||G.isMeshStandardMaterial||G.isShaderMaterial)&&Yt.setValue($,"isOrthographic",I.isOrthographicCamera===!0),(G.isMeshPhongMaterial||G.isMeshToonMaterial||G.isMeshLambertMaterial||G.isMeshBasicMaterial||G.isMeshStandardMaterial||G.isShaderMaterial||G.isShadowMaterial||J.isSkinnedMesh)&&Yt.setValue($,"viewMatrix",I.matrixWorldInverse)}if(J.isSkinnedMesh){Yt.setOptional($,J,"bindMatrix"),Yt.setOptional($,J,"bindMatrixInverse");const an=J.skeleton;an&&(ye.floatVertexTextures?(an.boneTexture===null&&an.computeBoneTexture(),Yt.setValue($,"boneTexture",an.boneTexture,A),Yt.setValue($,"boneTextureSize",an.boneTextureSize)):Yt.setOptional($,an,"boneMatrices"))}return(Ar||Le.receiveShadow!==J.receiveShadow)&&(Le.receiveShadow=J.receiveShadow,Yt.setValue($,"receiveShadow",J.receiveShadow)),Ar&&(Yt.setValue($,"toneMappingExposure",_.toneMappingExposure),Le.needsLights&&BA(Pi,Ls),ce&&G.fog&&U.refreshFogUniforms(Pi,ce),U.refreshMaterialUniforms(Pi,G,L,P,pe),cr.upload($,Le.uniformsList,Pi,A)),G.isShaderMaterial&&G.uniformsNeedUpdate===!0&&(cr.upload($,Le.uniformsList,Pi,A),G.uniformsNeedUpdate=!1),G.isSpriteMaterial&&Yt.setValue($,"center",J.center),Yt.setValue($,"modelViewMatrix",J.modelViewMatrix),Yt.setValue($,"normalMatrix",J.normalMatrix),Yt.setValue($,"modelMatrix",J.matrixWorld),Rs}function BA(I,j){I.ambientLightColor.needsUpdate=j,I.lightProbe.needsUpdate=j,I.directionalLights.needsUpdate=j,I.directionalLightShadows.needsUpdate=j,I.pointLights.needsUpdate=j,I.pointLightShadows.needsUpdate=j,I.spotLights.needsUpdate=j,I.spotLightShadows.needsUpdate=j,I.rectAreaLights.needsUpdate=j,I.hemisphereLights.needsUpdate=j}function HA(I){return I.isMeshLambertMaterial||I.isMeshToonMaterial||I.isMeshPhongMaterial||I.isMeshStandardMaterial||I.isShadowMaterial||I.isShaderMaterial&&I.lights===!0}this.getActiveCubeFace=function(){return m},this.getActiveMipmapLevel=function(){return g},this.getRenderTarget=function(){return v},this.setRenderTarget=function(I,j=0,G=0){v=I,m=j,g=G,I&&Z.get(I).__webglFramebuffer===void 0&&A.setupRenderTarget(I);let J=null,ce=!1,Oe=!1;if(I){const Ae=I.texture;(Ae.isDataTexture3D||Ae.isDataTexture2DArray)&&(Oe=!0);const We=Z.get(I).__webglFramebuffer;I.isWebGLCubeRenderTarget?(J=We[j],ce=!0):I.isWebGLMultisampleRenderTarget?J=Z.get(I).__webglMultisampledFramebuffer:J=We,S.copy(I.viewport),b.copy(I.scissor),M=I.scissorTest}else S.copy(H).multiplyScalar(L).floor(),b.copy(Q).multiplyScalar(L).floor(),M=q;if(_e.bindFramebuffer(36160,J)&&ye.drawBuffers){let Ae=!1;if(I)if(I.isWebGLMultipleRenderTargets){const We=I.texture;if(Y.length!==We.length||Y[0]!==36064){for(let st=0,Ye=We.length;st<Ye;st++)Y[st]=36064+st;Y.length=We.length,Ae=!0}}else(Y.length!==1||Y[0]!==36064)&&(Y[0]=36064,Y.length=1,Ae=!0);else(Y.length!==1||Y[0]!==1029)&&(Y[0]=1029,Y.length=1,Ae=!0);Ae&&(ye.isWebGL2?$.drawBuffers(Y):Me.get("WEBGL_draw_buffers").drawBuffersWEBGL(Y))}if(_e.viewport(S),_e.scissor(b),_e.setScissorTest(M),ce){const Ae=Z.get(I.texture);$.framebufferTexture2D(36160,36064,34069+j,Ae.__webglTexture,G)}else if(Oe){const Ae=Z.get(I.texture),We=j||0;$.framebufferTextureLayer(36160,36064,Ae.__webglTexture,G||0,We)}x=-1},this.readRenderTargetPixels=function(I,j,G,J,ce,Oe,Re){if(!(I&&I.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ae=Z.get(I).__webglFramebuffer;if(I.isWebGLCubeRenderTarget&&Re!==void 0&&(Ae=Ae[Re]),Ae){_e.bindFramebuffer(36160,Ae);try{const We=I.texture,st=We.format,Ye=We.type;if(st!==_n&&K.convert(st)!==$.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Ke=Ye===Qo&&(Me.has("EXT_color_buffer_half_float")||ye.isWebGL2&&Me.has("EXT_color_buffer_float"));if(Ye!==$o&&K.convert(Ye)!==$.getParameter(35738)&&!(Ye===Qs&&(ye.isWebGL2||Me.has("OES_texture_float")||Me.has("WEBGL_color_buffer_float")))&&!Ke){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}$.checkFramebufferStatus(36160)===36053?j>=0&&j<=I.width-J&&G>=0&&G<=I.height-ce&&$.readPixels(j,G,J,ce,K.convert(st),K.convert(Ye),Oe):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const We=v!==null?Z.get(v).__webglFramebuffer:null;_e.bindFramebuffer(36160,We)}}},this.copyFramebufferToTexture=function(I,j,G=0){const J=Math.pow(2,-G),ce=Math.floor(j.image.width*J),Oe=Math.floor(j.image.height*J);let Re=K.convert(j.format);ye.isWebGL2&&(Re===6407&&(Re=32849),Re===6408&&(Re=32856)),A.setTexture2D(j,0),$.copyTexImage2D(3553,G,Re,I.x,I.y,ce,Oe,0),_e.unbindTexture()},this.copyTextureToTexture=function(I,j,G,J=0){const ce=j.image.width,Oe=j.image.height,Re=K.convert(G.format),Ae=K.convert(G.type);A.setTexture2D(G,0),$.pixelStorei(37440,G.flipY),$.pixelStorei(37441,G.premultiplyAlpha),$.pixelStorei(3317,G.unpackAlignment),j.isDataTexture?$.texSubImage2D(3553,J,I.x,I.y,ce,Oe,Re,Ae,j.image.data):j.isCompressedTexture?$.compressedTexSubImage2D(3553,J,I.x,I.y,j.mipmaps[0].width,j.mipmaps[0].height,Re,j.mipmaps[0].data):$.texSubImage2D(3553,J,I.x,I.y,Re,Ae,j.image),J===0&&G.generateMipmaps&&$.generateMipmap(3553),_e.unbindTexture()},this.copyTextureToTexture3D=function(I,j,G,J,ce=0){if(_.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Oe=I.max.x-I.min.x+1,Re=I.max.y-I.min.y+1,Ae=I.max.z-I.min.z+1,We=K.convert(J.format),st=K.convert(J.type);let Ye;if(J.isDataTexture3D)A.setTexture3D(J,0),Ye=32879;else if(J.isDataTexture2DArray)A.setTexture2DArray(J,0),Ye=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}$.pixelStorei(37440,J.flipY),$.pixelStorei(37441,J.premultiplyAlpha),$.pixelStorei(3317,J.unpackAlignment);const Ke=$.getParameter(3314),Le=$.getParameter(32878),Mr=$.getParameter(3316),Ft=$.getParameter(3315),Rs=$.getParameter(32877),gi=G.isCompressedTexture?G.mipmaps[0]:G.image;$.pixelStorei(3314,gi.width),$.pixelStorei(32878,gi.height),$.pixelStorei(3316,I.min.x),$.pixelStorei(3315,I.min.y),$.pixelStorei(32877,I.min.z),G.isDataTexture||G.isDataTexture3D?$.texSubImage3D(Ye,ce,j.x,j.y,j.z,Oe,Re,Ae,We,st,gi.data):G.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),$.compressedTexSubImage3D(Ye,ce,j.x,j.y,j.z,Oe,Re,Ae,We,gi.data)):$.texSubImage3D(Ye,ce,j.x,j.y,j.z,Oe,Re,Ae,We,st,gi),$.pixelStorei(3314,Ke),$.pixelStorei(32878,Le),$.pixelStorei(3316,Mr),$.pixelStorei(3315,Ft),$.pixelStorei(32877,Rs),ce===0&&J.generateMipmaps&&$.generateMipmap(Ye),_e.unbindTexture()},this.initTexture=function(I){A.setTexture2D(I,0),_e.unbindTexture()},this.resetState=function(){m=0,g=0,v=null,_e.reset(),le.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class zk extends ot{}zk.prototype.isWebGL1Renderer=!0;class od extends Qe{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}od.prototype.isScene=!0;class Ta{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=ic,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=oi()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=oi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=oi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Ta.prototype.isInterleavedBuffer=!0;const Nt=new C;class wa{constructor(e,t,i,s=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Nt.x=this.getX(t),Nt.y=this.getY(t),Nt.z=this.getZ(t),Nt.applyMatrix4(e),this.setXYZ(t,Nt.x,Nt.y,Nt.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Nt.x=this.getX(t),Nt.y=this.getY(t),Nt.z=this.getZ(t),Nt.applyNormalMatrix(e),this.setXYZ(t,Nt.x,Nt.y,Nt.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Nt.x=this.getX(t),Nt.y=this.getY(t),Nt.z=this.getZ(t),Nt.transformDirection(e),this.setXYZ(t,Nt.x,Nt.y,Nt.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new Pt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new wa(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}wa.prototype.isInterleavedBufferAttribute=!0;class xw extends Kt{constructor(e){super();this.type="SpriteMaterial",this.color=new ge(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}xw.prototype.isSpriteMaterial=!0;let Sa;const pc=new C,Ea=new C,Ma=new C,Aa=new ie,mc=new ie,bw=new be,ad=new C,gc=new C,ld=new C,Tw=new ie,_g=new ie,ww=new ie;class Vk extends Qe{constructor(e){super();if(this.type="Sprite",Sa===void 0){Sa=new nt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Ta(t,5);Sa.setIndex([0,1,2,0,2,3]),Sa.setAttribute("position",new wa(i,3,0,!1)),Sa.setAttribute("uv",new wa(i,2,3,!1))}this.geometry=Sa,this.material=e!==void 0?e:new xw,this.center=new ie(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ea.setFromMatrixScale(this.matrixWorld),bw.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ma.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ea.multiplyScalar(-Ma.z);const i=this.material.rotation;let s,r;i!==0&&(r=Math.cos(i),s=Math.sin(i));const o=this.center;cd(ad.set(-.5,-.5,0),Ma,o,Ea,s,r),cd(gc.set(.5,-.5,0),Ma,o,Ea,s,r),cd(ld.set(.5,.5,0),Ma,o,Ea,s,r),Tw.set(0,0),_g.set(1,0),ww.set(1,1);let a=e.ray.intersectTriangle(ad,gc,ld,!1,pc);if(a===null&&(cd(gc.set(-.5,.5,0),Ma,o,Ea,s,r),_g.set(0,1),a=e.ray.intersectTriangle(ad,ld,gc,!1,pc),a===null))return;const l=e.ray.origin.distanceTo(pc);l<e.near||l>e.far||t.push({distance:l,point:pc.clone(),uv:kt.getUV(pc,ad,gc,ld,Tw,_g,ww,new ie),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}Vk.prototype.isSprite=!0;function cd(n,e,t,i,s,r){Aa.subVectors(n,t).addScalar(.5).multiply(i),s!==void 0?(mc.x=r*Aa.x-s*Aa.y,mc.y=s*Aa.x+r*Aa.y):mc.copy(Aa),n.copy(e),n.x+=mc.x,n.y+=mc.y,n.applyMatrix4(bw)}const Sw=new C,Ew=new Be,Mw=new Be,Gk=new C,Aw=new be;class ud extends Vt{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new be,this.bindMatrixInverse=new be}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Be,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,s=this.geometry;Ew.fromBufferAttribute(s.attributes.skinIndex,e),Mw.fromBufferAttribute(s.attributes.skinWeight,e),Sw.fromBufferAttribute(s.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=Mw.getComponent(r);if(o!==0){const a=Ew.getComponent(r);Aw.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(Gk.copy(Sw).applyMatrix4(Aw),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}ud.prototype.isSkinnedMesh=!0;class yg extends Qe{constructor(){super();this.type="Bone"}}yg.prototype.isBone=!0;class Cw extends Qt{constructor(e=null,t=1,i=1,s,r,o,a,l,c=zt,h=zt,u,d){super(null,o,a,l,c,h,s,r,u,d);this.image={data:e,width:t,height:i},this.magFilter=c,this.minFilter=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Cw.prototype.isDataTexture=!0;const Iw=new be,Wk=new be;class hd{constructor(e=[],t=[]){this.uuid=oi(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new be)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new be;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:Wk;Iw.multiplyMatrices(a,t[r]),Iw.toArray(i,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new hd(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=_T(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Cw(t,e,e,_n,Qs);return this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new yg),this.bones.push(o),this.boneInverses.push(new be().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const a=i[s];e.boneInverses.push(a.toArray())}return e}}class vg extends Pt{constructor(e,t,i,s=1){typeof i=="number"&&(s=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(e,t,i);this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}vg.prototype.isInstancedBufferAttribute=!0;const Rw=new be,Lw=new be,dd=[],_c=new Vt;class Xk extends Vt{constructor(e,t,i){super(e,t);this.instanceMatrix=new vg(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,s=this.count;if(_c.geometry=this.geometry,_c.material=this.material,_c.material!==void 0)for(let r=0;r<s;r++){this.getMatrixAt(r,Rw),Lw.multiplyMatrices(i,Rw),_c.matrixWorld=Lw,_c.raycast(e,dd);for(let o=0,a=dd.length;o<a;o++){const l=dd[o];l.instanceId=r,l.object=this,t.push(l)}dd.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new vg(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Xk.prototype.isInstancedMesh=!0;class Ca extends Kt{constructor(e){super();this.type="LineBasicMaterial",this.color=new ge(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Ca.prototype.isLineBasicMaterial=!0;const Pw=new C,Nw=new C,Fw=new be,xg=new $r,fd=new jr;class pd extends Qe{constructor(e=new nt,t=new Ca){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,r=t.count;s<r;s++)Pw.fromBufferAttribute(t,s-1),Nw.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=Pw.distanceTo(Nw);e.setAttribute("lineDistance",new lt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),fd.copy(i.boundingSphere),fd.applyMatrix4(s),fd.radius+=r,e.ray.intersectsSphere(fd)===!1)return;Fw.copy(s).invert(),xg.copy(e.ray).applyMatrix4(Fw);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new C,h=new C,u=new C,d=new C,f=this.isLineSegments?2:1;if(i.isBufferGeometry){const p=i.index,y=i.attributes.position;if(p!==null){const m=Math.max(0,o.start),g=Math.min(p.count,o.start+o.count);for(let v=m,x=g-1;v<x;v+=f){const T=p.getX(v),S=p.getX(v+1);if(c.fromBufferAttribute(y,T),h.fromBufferAttribute(y,S),xg.distanceSqToSegment(c,h,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(d);M<e.near||M>e.far||t.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else{const m=Math.max(0,o.start),g=Math.min(y.count,o.start+o.count);for(let v=m,x=g-1;v<x;v+=f){if(c.fromBufferAttribute(y,v),h.fromBufferAttribute(y,v+1),xg.distanceSqToSegment(c,h,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const S=e.ray.origin.distanceTo(d);S<e.near||S>e.far||t.push({distance:S,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}pd.prototype.isLine=!0;const Dw=new C,Ow=new C;class md extends pd{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,r=t.count;s<r;s+=2)Dw.fromBufferAttribute(t,s),Ow.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+Dw.distanceTo(Ow);e.setAttribute("lineDistance",new lt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}md.prototype.isLineSegments=!0;class kw extends pd{constructor(e,t){super(e,t);this.type="LineLoop"}}kw.prototype.isLineLoop=!0;class bg extends Kt{constructor(e){super();this.type="PointsMaterial",this.color=new ge(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}bg.prototype.isPointsMaterial=!0;const Uw=new be,Tg=new $r,gd=new jr,_d=new C;class Bw extends Qe{constructor(e=new nt,t=new bg){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),gd.copy(i.boundingSphere),gd.applyMatrix4(s),gd.radius+=r,e.ray.intersectsSphere(gd)===!1)return;Uw.copy(s).invert(),Tg.copy(e.ray).applyMatrix4(Uw);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a;if(i.isBufferGeometry){const c=i.index,u=i.attributes.position;if(c!==null){const d=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let p=d,_=f;p<_;p++){const y=c.getX(p);_d.fromBufferAttribute(u,y),Hw(_d,y,l,s,e,t,this)}}else{const d=Math.max(0,o.start),f=Math.min(u.count,o.start+o.count);for(let p=d,_=f;p<_;p++)_d.fromBufferAttribute(u,p),Hw(_d,p,l,s,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Bw.prototype.isPoints=!0;function Hw(n,e,t,i,s,r,o){const a=Tg.distanceSqToPoint(n);if(a<t){const l=new C;Tg.closestPointToPoint(n,l),l.applyMatrix4(i);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class qk extends Qt{constructor(e,t,i,s,r,o,a,l,c){super(e,t,i,s,r,o,a,l,c);this.format=a!==void 0?a:Hi,this.minFilter=o!==void 0?o:$t,this.magFilter=r!==void 0?r:$t,this.generateMipmaps=!1;const h=this;function u(){h.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}qk.prototype.isVideoTexture=!0;class Yk extends Qt{constructor(e,t,i,s,r,o,a,l,c,h,u,d){super(null,o,a,l,c,h,s,r,u,d);this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}Yk.prototype.isCompressedTexture=!0;class jk extends Qt{constructor(e,t,i,s,r,o,a,l,c){super(e,t,i,s,r,o,a,l,c);this.needsUpdate=!0}}jk.prototype.isCanvasTexture=!0;class $k extends Qt{constructor(e,t,i,s,r,o,a,l,c,h){if(h=h!==void 0?h:Ko,h!==Ko&&h!==tc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===Ko&&(i=Rh),i===void 0&&h===tc&&(i=ec);super(null,s,r,o,a,l,h,i,c);this.image={width:e,height:t},this.magFilter=a!==void 0?a:zt,this.minFilter=l!==void 0?l:zt,this.flipY=!1,this.generateMipmaps=!1}}$k.prototype.isDepthTexture=!0;new C;new C;new C;new kt;class ui{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(s),t.push(r),s=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let s=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let a=0,l=r-1,c;for(;a<=l;)if(s=Math.floor(a+(l-a)/2),c=i[s]-o,c<0)a=s+1;else if(c>0)l=s-1;else{l=s;break}if(s=l,i[s]===o)return s/(r-1);const h=i[s],d=i[s+1]-h,f=(o-h)/d;return(s+f)/(r-1)}getTangent(e,t){const i=1e-4;let s=e-i,r=e+i;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),a=this.getPoint(r),l=t||(o.isVector2?new ie:new C);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new C,s=[],r=[],o=[],a=new C,l=new be;for(let f=0;f<=e;f++){const p=f/e;s[f]=this.getTangentAt(p,new C),s[f].normalize()}r[0]=new C,o[0]=new C;let c=Number.MAX_VALUE;const h=Math.abs(s[0].x),u=Math.abs(s[0].y),d=Math.abs(s[0].z);h<=c&&(c=h,i.set(1,0,0)),u<=c&&(c=u,i.set(0,1,0)),d<=c&&i.set(0,0,1),a.crossVectors(s[0],i).normalize(),r[0].crossVectors(s[0],a),o[0].crossVectors(s[0],r[0]);for(let f=1;f<=e;f++){if(r[f]=r[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(s[f-1],s[f]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(An(s[f-1].dot(s[f]),-1,1));r[f].applyMatrix4(l.makeRotationAxis(a,p))}o[f].crossVectors(s[f],r[f])}if(t===!0){let f=Math.acos(An(r[0].dot(r[e]),-1,1));f/=e,s[0].dot(a.crossVectors(r[0],r[e]))>0&&(f=-f);for(let p=1;p<=e;p++)r[p].applyMatrix4(l.makeRotationAxis(s[p],f*p)),o[p].crossVectors(s[p],r[p])}return{tangents:s,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class yd extends ui{constructor(e=0,t=0,i=1,s=1,r=0,o=Math.PI*2,a=!1,l=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=s,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const i=t||new ie,s=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=s;for(;r>s;)r-=s;r<Number.EPSILON&&(o?r=0:r=s),this.aClockwise===!0&&!o&&(r===s?r=-s:r=r-s);const a=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=l-this.aX,f=c-this.aY;l=d*h-f*u+this.aX,c=d*u+f*h+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}yd.prototype.isEllipseCurve=!0;class zw extends yd{constructor(e,t,i,s,r,o){super(e,t,i,i,s,r,o);this.type="ArcCurve"}}zw.prototype.isArcCurve=!0;function wg(){let n=0,e=0,t=0,i=0;function s(r,o,a,l){n=r,e=a,t=-3*r+3*o-2*a-l,i=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,c){s(o,a,c*(a-r),c*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,c,h,u){let d=(o-r)/c-(a-r)/(c+h)+(a-o)/h,f=(a-o)/h-(l-o)/(h+u)+(l-a)/u;d*=h,f*=h,s(o,a,d,f)},calc:function(r){const o=r*r,a=o*r;return n+e*r+t*o+i*a}}}const vd=new C,Sg=new wg,Eg=new wg,Mg=new wg;class Vw extends ui{constructor(e=[],t=!1,i="centripetal",s=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=s}getPoint(e,t=new C){const i=t,s=this.points,r=s.length,o=(r-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,h;this.closed||a>0?c=s[(a-1)%r]:(vd.subVectors(s[0],s[1]).add(s[0]),c=vd);const u=s[a%r],d=s[(a+1)%r];if(this.closed||a+2<r?h=s[(a+2)%r]:(vd.subVectors(s[r-1],s[r-2]).add(s[r-1]),h=vd),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let p=Math.pow(c.distanceToSquared(u),f),_=Math.pow(u.distanceToSquared(d),f),y=Math.pow(d.distanceToSquared(h),f);_<1e-4&&(_=1),p<1e-4&&(p=_),y<1e-4&&(y=_),Sg.initNonuniformCatmullRom(c.x,u.x,d.x,h.x,p,_,y),Eg.initNonuniformCatmullRom(c.y,u.y,d.y,h.y,p,_,y),Mg.initNonuniformCatmullRom(c.z,u.z,d.z,h.z,p,_,y)}else this.curveType==="catmullrom"&&(Sg.initCatmullRom(c.x,u.x,d.x,h.x,this.tension),Eg.initCatmullRom(c.y,u.y,d.y,h.y,this.tension),Mg.initCatmullRom(c.z,u.z,d.z,h.z,this.tension));return i.set(Sg.calc(l),Eg.calc(l),Mg.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new C().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}Vw.prototype.isCatmullRomCurve3=!0;function Gw(n,e,t,i,s){const r=(i-e)*.5,o=(s-t)*.5,a=n*n,l=n*a;return(2*t-2*i+r+o)*l+(-3*t+3*i-2*r-o)*a+r*n+t}function Qk(n,e){const t=1-n;return t*t*e}function Kk(n,e){return 2*(1-n)*n*e}function Jk(n,e){return n*n*e}function yc(n,e,t,i){return Qk(n,e)+Kk(n,t)+Jk(n,i)}function Zk(n,e){const t=1-n;return t*t*t*e}function e4(n,e){const t=1-n;return 3*t*t*n*e}function t4(n,e){return 3*(1-n)*n*n*e}function n4(n,e){return n*n*n*e}function vc(n,e,t,i,s){return Zk(n,e)+e4(n,t)+t4(n,i)+n4(n,s)}class Ag extends ui{constructor(e=new ie,t=new ie,i=new ie,s=new ie){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new ie){const i=t,s=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(vc(e,s.x,r.x,o.x,a.x),vc(e,s.y,r.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Ag.prototype.isCubicBezierCurve=!0;class Ww extends ui{constructor(e=new C,t=new C,i=new C,s=new C){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new C){const i=t,s=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(vc(e,s.x,r.x,o.x,a.x),vc(e,s.y,r.y,o.y,a.y),vc(e,s.z,r.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Ww.prototype.isCubicBezierCurve3=!0;class xd extends ui{constructor(e=new ie,t=new ie){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ie){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new ie;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}xd.prototype.isLineCurve=!0;class i4 extends ui{constructor(e=new C,t=new C){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new C){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Cg extends ui{constructor(e=new ie,t=new ie,i=new ie){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ie){const i=t,s=this.v0,r=this.v1,o=this.v2;return i.set(yc(e,s.x,r.x,o.x),yc(e,s.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Cg.prototype.isQuadraticBezierCurve=!0;class Xw extends ui{constructor(e=new C,t=new C,i=new C){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new C){const i=t,s=this.v0,r=this.v1,o=this.v2;return i.set(yc(e,s.x,r.x,o.x),yc(e,s.y,r.y,o.y),yc(e,s.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Xw.prototype.isQuadraticBezierCurve3=!0;class Ig extends ui{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new ie){const i=t,s=this.points,r=(s.length-1)*e,o=Math.floor(r),a=r-o,l=s[o===0?o:o-1],c=s[o],h=s[o>s.length-2?s.length-1:o+1],u=s[o>s.length-3?s.length-1:o+2];return i.set(Gw(a,l.x,c.x,h.x,u.x),Gw(a,l.y,c.y,h.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new ie().fromArray(s))}return this}}Ig.prototype.isSplineCurve=!0;var qw=Object.freeze({__proto__:null,ArcCurve:zw,CatmullRomCurve3:Vw,CubicBezierCurve:Ag,CubicBezierCurve3:Ww,EllipseCurve:yd,LineCurve:xd,LineCurve3:i4,QuadraticBezierCurve:Cg,QuadraticBezierCurve3:Xw,SplineCurve:Ig});const s4={triangulate:function(n,e,t=2){const i=e&&e.length,s=i?e[0]*t:n.length;let r=Yw(n,0,s,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,u,d,f;if(i&&(r=c4(n,e,r,t)),n.length>80*t){a=c=n[0],l=h=n[1];for(let p=t;p<s;p+=t)u=n[p],d=n[p+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);f=Math.max(c-a,h-l),f=f!==0?1/f:0}return xc(r,o,t,a,l,f),o}};function Yw(n,e,t,i,s){let r,o;if(s===x4(n,e,t,i)>0)for(r=e;r<t;r+=i)o=Qw(r,n[r],n[r+1],o);else for(r=t-i;r>=e;r-=i)o=Qw(r,n[r],n[r+1],o);return o&&bd(o,o.next)&&(Tc(o),o=o.next),o}function hr(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(bd(t,t.next)||Et(t.prev,t,t.next)===0)){if(Tc(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function xc(n,e,t,i,s,r,o){if(!n)return;!o&&r&&p4(n,i,s,r);let a=n,l,c;for(;n.prev!==n.next;){if(l=n.prev,c=n.next,r?o4(n,i,s,r):r4(n)){e.push(l.i/t),e.push(n.i/t),e.push(c.i/t),Tc(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=a4(hr(n),e,t),xc(n,e,t,i,s,r,2)):o===2&&l4(n,e,t,i,s,r):xc(hr(n),e,t,i,s,r,1);break}}}function r4(n){const e=n.prev,t=n,i=n.next;if(Et(e,t,i)>=0)return!1;let s=n.next.next;for(;s!==n.prev;){if(Ia(e.x,e.y,t.x,t.y,i.x,i.y,s.x,s.y)&&Et(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function o4(n,e,t,i){const s=n.prev,r=n,o=n.next;if(Et(s,r,o)>=0)return!1;const a=s.x<r.x?s.x<o.x?s.x:o.x:r.x<o.x?r.x:o.x,l=s.y<r.y?s.y<o.y?s.y:o.y:r.y<o.y?r.y:o.y,c=s.x>r.x?s.x>o.x?s.x:o.x:r.x>o.x?r.x:o.x,h=s.y>r.y?s.y>o.y?s.y:o.y:r.y>o.y?r.y:o.y,u=Rg(a,l,e,t,i),d=Rg(c,h,e,t,i);let f=n.prevZ,p=n.nextZ;for(;f&&f.z>=u&&p&&p.z<=d;){if(f!==n.prev&&f!==n.next&&Ia(s.x,s.y,r.x,r.y,o.x,o.y,f.x,f.y)&&Et(f.prev,f,f.next)>=0||(f=f.prevZ,p!==n.prev&&p!==n.next&&Ia(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&Et(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;f&&f.z>=u;){if(f!==n.prev&&f!==n.next&&Ia(s.x,s.y,r.x,r.y,o.x,o.y,f.x,f.y)&&Et(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==n.prev&&p!==n.next&&Ia(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&Et(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function a4(n,e,t){let i=n;do{const s=i.prev,r=i.next.next;!bd(s,r)&&jw(s,i,i.next,r)&&bc(s,r)&&bc(r,s)&&(e.push(s.i/t),e.push(i.i/t),e.push(r.i/t),Tc(i),Tc(i.next),i=n=r),i=i.next}while(i!==n);return hr(i)}function l4(n,e,t,i,s,r){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&_4(o,a)){let l=$w(o,a);o=hr(o,o.next),l=hr(l,l.next),xc(o,e,t,i,s,r),xc(l,e,t,i,s,r);return}a=a.next}o=o.next}while(o!==n)}function c4(n,e,t,i){const s=[];let r,o,a,l,c;for(r=0,o=e.length;r<o;r++)a=e[r]*i,l=r<o-1?e[r+1]*i:n.length,c=Yw(n,a,l,i,!1),c===c.next&&(c.steiner=!0),s.push(g4(c));for(s.sort(u4),r=0;r<s.length;r++)h4(s[r],t),t=hr(t,t.next);return t}function u4(n,e){return n.x-e.x}function h4(n,e){if(e=d4(n,e),e){const t=$w(e,n);hr(e,e.next),hr(t,t.next)}}function d4(n,e){let t=e;const i=n.x,s=n.y;let r=-1/0,o;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){const d=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=i&&d>r){if(r=d,d===i){if(s===t.y)return t;if(s===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(i===r)return o;const a=o,l=o.x,c=o.y;let h=1/0,u;t=o;do i>=t.x&&t.x>=l&&i!==t.x&&Ia(s<c?i:r,s,l,c,s<c?r:i,s,t.x,t.y)&&(u=Math.abs(s-t.y)/(i-t.x),bc(t,n)&&(u<h||u===h&&(t.x>o.x||t.x===o.x&&f4(o,t)))&&(o=t,h=u)),t=t.next;while(t!==a);return o}function f4(n,e){return Et(n.prev,n,e.prev)<0&&Et(e.next,n,n.next)<0}function p4(n,e,t,i){let s=n;do s.z===null&&(s.z=Rg(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,m4(s)}function m4(n){let e,t,i,s,r,o,a,l,c=1;do{for(t=n,n=null,r=null,o=0;t;){for(o++,i=t,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(s=t,t=t.nextZ,a--):(s=i,i=i.nextZ,l--),r?r.nextZ=s:n=s,s.prevZ=r,r=s;t=i}r.nextZ=null,c*=2}while(o>1);return n}function Rg(n,e,t,i,s){return n=32767*(n-t)*s,e=32767*(e-i)*s,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function g4(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Ia(n,e,t,i,s,r,o,a){return(s-o)*(e-a)-(n-o)*(r-a)>=0&&(n-o)*(i-a)-(t-o)*(e-a)>=0&&(t-o)*(r-a)-(s-o)*(i-a)>=0}function _4(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!y4(n,e)&&(bc(n,e)&&bc(e,n)&&v4(n,e)&&(Et(n.prev,n,e.prev)||Et(n,e.prev,e))||bd(n,e)&&Et(n.prev,n,n.next)>0&&Et(e.prev,e,e.next)>0)}function Et(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function bd(n,e){return n.x===e.x&&n.y===e.y}function jw(n,e,t,i){const s=wd(Et(n,e,t)),r=wd(Et(n,e,i)),o=wd(Et(t,i,n)),a=wd(Et(t,i,e));return!!(s!==r&&o!==a||s===0&&Td(n,t,e)||r===0&&Td(n,i,e)||o===0&&Td(t,n,i)||a===0&&Td(t,e,i))}function Td(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function wd(n){return n>0?1:n<0?-1:0}function y4(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&jw(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function bc(n,e){return Et(n.prev,n,n.next)<0?Et(n,e,n.next)>=0&&Et(n,n.prev,e)>=0:Et(n,e,n.prev)<0||Et(n,n.next,e)<0}function v4(n,e){let t=n,i=!1;const s=(n.x+e.x)/2,r=(n.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function $w(n,e){const t=new Lg(n.i,n.x,n.y),i=new Lg(e.i,e.x,e.y),s=n.next,r=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function Qw(n,e,t,i){const s=new Lg(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Tc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Lg(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function x4(n,e,t,i){let s=0;for(let r=e,o=t-i;r<t;r+=i)s+=(n[o]-n[r])*(n[r+1]+n[o+1]),o=r;return s}class dr{static area(e){const t=e.length;let i=0;for(let s=t-1,r=0;r<t;s=r++)i+=e[s].x*e[r].y-e[r].x*e[s].y;return i*.5}static isClockWise(e){return dr.area(e)<0}static triangulateShape(e,t){const i=[],s=[],r=[];Kw(e),Jw(i,e);let o=e.length;t.forEach(Kw);for(let l=0;l<t.length;l++)s.push(o),o+=t[l].length,Jw(i,t[l]);const a=s4.triangulate(i,s);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function Kw(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function Jw(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class Ra extends nt{constructor(e,t){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,s=[],r=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new lt(s,3)),this.setAttribute("uv",new lt(r,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1;let u=t.depth!==void 0?t.depth:100,d=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:6,p=t.bevelSize!==void 0?t.bevelSize:f-2,_=t.bevelOffset!==void 0?t.bevelOffset:0,y=t.bevelSegments!==void 0?t.bevelSegments:3;const m=t.extrudePath,g=t.UVGenerator!==void 0?t.UVGenerator:b4;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=t.amount);let v,x=!1,T,S,b,M;m&&(v=m.getSpacedPoints(h),x=!0,d=!1,T=m.computeFrenetFrames(h,!1),S=new C,b=new C,M=new C),d||(y=0,f=0,p=0,_=0);const N=a.extractPoints(c);let P=N.shape;const L=N.holes;if(!dr.isClockWise(P)){P=P.reverse();for(let Z=0,A=L.length;Z<A;Z++){const R=L[Z];dr.isClockWise(R)&&(L[Z]=R.reverse())}}const O=dr.triangulateShape(P,L),H=P;for(let Z=0,A=L.length;Z<A;Z++){const R=L[Z];P=P.concat(R)}function Q(Z,A,R){return A||console.error("THREE.ExtrudeGeometry: vec does not exist"),A.clone().multiplyScalar(R).add(Z)}const q=P.length,Y=O.length;function te(Z,A,R){let B,z,E;const w=Z.x-A.x,k=Z.y-A.y,U=R.x-Z.x,X=R.y-Z.y,W=w*w+k*k,re=w*X-k*U;if(Math.abs(re)>Number.EPSILON){const ee=Math.sqrt(W),oe=Math.sqrt(U*U+X*X),se=A.x-k/ee,D=A.y+w/ee,ae=R.x-X/oe,K=R.y+U/oe,le=((ae-se)*X-(K-D)*U)/(w*X-k*U);B=se+w*le-Z.x,z=D+k*le-Z.y;const F=B*B+z*z;if(F<=2)return new ie(B,z);E=Math.sqrt(F/2)}else{let ee=!1;w>Number.EPSILON?U>Number.EPSILON&&(ee=!0):w<-Number.EPSILON?U<-Number.EPSILON&&(ee=!0):Math.sign(k)===Math.sign(X)&&(ee=!0),ee?(B=-k,z=w,E=Math.sqrt(W)):(B=w,z=k,E=Math.sqrt(W/2))}return new ie(B/E,z/E)}const me=[];for(let Z=0,A=H.length,R=A-1,B=Z+1;Z<A;Z++,R++,B++)R===A&&(R=0),B===A&&(B=0),me[Z]=te(H[Z],H[R],H[B]);const we=[];let pe,Se=me.concat();for(let Z=0,A=L.length;Z<A;Z++){const R=L[Z];pe=[];for(let B=0,z=R.length,E=z-1,w=B+1;B<z;B++,E++,w++)E===z&&(E=0),w===z&&(w=0),pe[B]=te(R[B],R[E],R[w]);we.push(pe),Se=Se.concat(pe)}for(let Z=0;Z<y;Z++){const A=Z/y,R=f*Math.cos(A*Math.PI/2),B=p*Math.sin(A*Math.PI/2)+_;for(let z=0,E=H.length;z<E;z++){const w=Q(H[z],me[z],B);xe(w.x,w.y,-R)}for(let z=0,E=L.length;z<E;z++){const w=L[z];pe=we[z];for(let k=0,U=w.length;k<U;k++){const X=Q(w[k],pe[k],B);xe(X.x,X.y,-R)}}}const ne=p+_;for(let Z=0;Z<q;Z++){const A=d?Q(P[Z],Se[Z],ne):P[Z];x?(b.copy(T.normals[0]).multiplyScalar(A.x),S.copy(T.binormals[0]).multiplyScalar(A.y),M.copy(v[0]).add(b).add(S),xe(M.x,M.y,M.z)):xe(A.x,A.y,0)}for(let Z=1;Z<=h;Z++)for(let A=0;A<q;A++){const R=d?Q(P[A],Se[A],ne):P[A];x?(b.copy(T.normals[Z]).multiplyScalar(R.x),S.copy(T.binormals[Z]).multiplyScalar(R.y),M.copy(v[Z]).add(b).add(S),xe(M.x,M.y,M.z)):xe(R.x,R.y,u/h*Z)}for(let Z=y-1;Z>=0;Z--){const A=Z/y,R=f*Math.cos(A*Math.PI/2),B=p*Math.sin(A*Math.PI/2)+_;for(let z=0,E=H.length;z<E;z++){const w=Q(H[z],me[z],B);xe(w.x,w.y,u+R)}for(let z=0,E=L.length;z<E;z++){const w=L[z];pe=we[z];for(let k=0,U=w.length;k<U;k++){const X=Q(w[k],pe[k],B);x?xe(X.x,X.y+v[h-1].y,v[h-1].x+R):xe(X.x,X.y,u+R)}}}he(),ve();function he(){const Z=s.length/3;if(d){let A=0,R=q*A;for(let B=0;B<Y;B++){const z=O[B];Me(z[2]+R,z[1]+R,z[0]+R)}A=h+y*2,R=q*A;for(let B=0;B<Y;B++){const z=O[B];Me(z[0]+R,z[1]+R,z[2]+R)}}else{for(let A=0;A<Y;A++){const R=O[A];Me(R[2],R[1],R[0])}for(let A=0;A<Y;A++){const R=O[A];Me(R[0]+q*h,R[1]+q*h,R[2]+q*h)}}i.addGroup(Z,s.length/3-Z,0)}function ve(){const Z=s.length/3;let A=0;$(H,A),A+=H.length;for(let R=0,B=L.length;R<B;R++){const z=L[R];$(z,A),A+=z.length}i.addGroup(Z,s.length/3-Z,1)}function $(Z,A){let R=Z.length;for(;--R>=0;){const B=R;let z=R-1;z<0&&(z=Z.length-1);for(let E=0,w=h+y*2;E<w;E++){const k=q*E,U=q*(E+1),X=A+B+k,W=A+z+k,re=A+z+U,ee=A+B+U;ye(X,W,re,ee)}}}function xe(Z,A,R){l.push(Z),l.push(A),l.push(R)}function Me(Z,A,R){_e(Z),_e(A),_e(R);const B=s.length/3,z=g.generateTopUV(i,s,B-3,B-2,B-1);Ie(z[0]),Ie(z[1]),Ie(z[2])}function ye(Z,A,R,B){_e(Z),_e(A),_e(B),_e(A),_e(R),_e(B);const z=s.length/3,E=g.generateSideWallUV(i,s,z-6,z-3,z-2,z-1);Ie(E[0]),Ie(E[1]),Ie(E[3]),Ie(E[1]),Ie(E[2]),Ie(E[3])}function _e(Z){s.push(l[Z*3+0]),s.push(l[Z*3+1]),s.push(l[Z*3+2])}function Ie(Z){r.push(Z.x),r.push(Z.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return T4(t,i,e)}static fromJSON(e,t){const i=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=t[e.shapes[r]];i.push(a)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new qw[s.type]().fromJSON(s)),new Ra(i,e.options)}}const b4={generateTopUV:function(n,e,t,i,s){const r=e[t*3],o=e[t*3+1],a=e[i*3],l=e[i*3+1],c=e[s*3],h=e[s*3+1];return[new ie(r,o),new ie(a,l),new ie(c,h)]},generateSideWallUV:function(n,e,t,i,s,r){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[i*3],h=e[i*3+1],u=e[i*3+2],d=e[s*3],f=e[s*3+1],p=e[s*3+2],_=e[r*3],y=e[r*3+1],m=e[r*3+2];return Math.abs(a-h)<Math.abs(o-c)?[new ie(o,1-l),new ie(c,1-u),new ie(d,1-p),new ie(_,1-m)]:[new ie(a,1-l),new ie(h,1-u),new ie(f,1-p),new ie(y,1-m)]}};function T4(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,s=n.length;i<s;i++){const r=n[i];t.shapes.push(r.uuid)}else t.shapes.push(n.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Pg extends nt{constructor(e,t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],s=[],r=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(a,l,h),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new lt(s,3)),this.setAttribute("normal",new lt(r,3)),this.setAttribute("uv",new lt(o,2));function c(h){const u=s.length/3,d=h.extractPoints(t);let f=d.shape;const p=d.holes;dr.isClockWise(f)===!1&&(f=f.reverse());for(let y=0,m=p.length;y<m;y++){const g=p[y];dr.isClockWise(g)===!0&&(p[y]=g.reverse())}const _=dr.triangulateShape(f,p);for(let y=0,m=p.length;y<m;y++){const g=p[y];f=f.concat(g)}for(let y=0,m=f.length;y<m;y++){const g=f[y];s.push(g.x,g.y,0),r.push(0,0,1),o.push(g.x,g.y)}for(let y=0,m=_.length;y<m;y++){const g=_[y],v=g[0]+u,x=g[1]+u,T=g[2]+u;i.push(v,x,T),l+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return w4(t,e)}static fromJSON(e,t){const i=[];for(let s=0,r=e.shapes.length;s<r;s++){const o=t[e.shapes[s]];i.push(o)}return new Pg(i,e.curveSegments)}}function w4(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const s=n[t];e.shapes.push(s.uuid)}else e.shapes.push(n.uuid);return e}class Ng extends nt{constructor(e=1,t=32,i=16,s=0,r=Math.PI*2,o=0,a=Math.PI){super();this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const h=[],u=new C,d=new C,f=[],p=[],_=[],y=[];for(let m=0;m<=i;m++){const g=[],v=m/i;let x=0;m==0&&o==0?x=.5/t:m==i&&l==Math.PI&&(x=-.5/t);for(let T=0;T<=t;T++){const S=T/t;u.x=-e*Math.cos(s+S*r)*Math.sin(o+v*a),u.y=e*Math.cos(o+v*a),u.z=e*Math.sin(s+S*r)*Math.sin(o+v*a),p.push(u.x,u.y,u.z),d.copy(u).normalize(),_.push(d.x,d.y,d.z),y.push(S+x,1-v),g.push(c++)}h.push(g)}for(let m=0;m<i;m++)for(let g=0;g<t;g++){const v=h[m][g+1],x=h[m][g],T=h[m+1][g],S=h[m+1][g+1];(m!==0||o>0)&&f.push(v,x,S),(m!==i-1||l<Math.PI)&&f.push(x,T,S)}this.setIndex(f),this.setAttribute("position",new lt(p,3)),this.setAttribute("normal",new lt(_,3)),this.setAttribute("uv",new lt(y,2))}static fromJSON(e){return new Ng(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class S4 extends Kt{constructor(e){super();this.type="ShadowMaterial",this.color=new ge(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}S4.prototype.isShadowMaterial=!0;class wc extends Kt{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ge(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}wc.prototype.isMeshStandardMaterial=!0;class La extends wc{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ie(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return An(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenTint=new ge(0),this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new ge(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new ge(1,1,1),this.specularTintMap=null,this._clearcoat=0,this._transmission=0,this.setValues(e)}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheenTint.copy(e.sheenTint),this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}La.prototype.isMeshPhysicalMaterial=!0;class E4 extends Kt{constructor(e){super();this.type="MeshPhongMaterial",this.color=new ge(16777215),this.specular=new ge(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Eh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}E4.prototype.isMeshPhongMaterial=!0;class M4 extends Kt{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ge(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}M4.prototype.isMeshToonMaterial=!0;class A4 extends Kt{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}A4.prototype.isMeshNormalMaterial=!0;class C4 extends Kt{constructor(e){super();this.type="MeshLambertMaterial",this.color=new ge(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Eh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}C4.prototype.isMeshLambertMaterial=!0;class I4 extends Kt{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ge(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}I4.prototype.isMeshMatcapMaterial=!0;class R4 extends Ca{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}R4.prototype.isLineDashedMaterial=!0;const yt={arraySlice:function(n,e,t){return yt.isTypedArray(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)},convertArray:function(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)},isTypedArray:function(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)},getKeyframeOrder:function(n){function e(s,r){return n[s]-n[r]}const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i},sortedArray:function(n,e,t){const i=n.length,s=new n.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let l=0;l!==e;++l)s[o++]=n[a+l]}return s},flattenJSON:function(n,e,t,i){let s=1,r=n[0];for(;r!==void 0&&r[i]===void 0;)r=n[s++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=n[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=n[s++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=n[s++];while(r!==void 0)},subclip:function(n,e,t,i,s=30){const r=n.clone();r.name=e;const o=[];for(let l=0;l<r.tracks.length;++l){const c=r.tracks[l],h=c.getValueSize(),u=[],d=[];for(let f=0;f<c.times.length;++f){const p=c.times[f]*s;if(!(p<t||p>=i)){u.push(c.times[f]);for(let _=0;_<h;++_)d.push(c.values[f*h+_])}}u.length!==0&&(c.times=yt.convertArray(u,c.times.constructor),c.values=yt.convertArray(d,c.values.constructor),o.push(c))}r.tracks=o;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r},makeClipAdditive:function(n,e=0,t=n,i=30){i<=0&&(i=30);const s=t.tracks.length,r=e/i;for(let o=0;o<s;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=n.tracks.find(function(m){return m.name===a.name&&m.ValueTypeName===l});if(c===void 0)continue;let h=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=u/3);let d=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);const p=a.times.length-1;let _;if(r<=a.times[0]){const m=h,g=u-h;_=yt.arraySlice(a.values,m,g)}else if(r>=a.times[p]){const m=p*u+h,g=m+u-h;_=yt.arraySlice(a.values,m,g)}else{const m=a.createInterpolant(),g=h,v=u-h;m.evaluate(r),_=yt.arraySlice(m.resultBuffer,g,v)}l==="quaternion"&&new gt().fromArray(_).normalize().conjugate().toArray(_);const y=c.times.length;for(let m=0;m<y;++m){const g=m*f+d;if(l==="quaternion")gt.multiplyQuaternionsFlat(c.values,g,_,0,c.values,g);else{const v=f-d*2;for(let x=0;x<v;++x)c.values[g+x]-=_[x]}}}return n.blendMode=pT,n}};class _s{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],r=t[i-1];e:{t:{let o;n:{i:if(!(e<s)){for(let a=i+2;;){if(s===void 0){if(e<r)break i;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,r)}if(i===a)break;if(r=s,s=t[++i],e<s)break t}o=t.length;break n}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,s);if(i===l)break;if(s=r,r=t[--i-1],e>=r)break t}o=i,i=0;break n}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(s=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,s);if(s===void 0)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,r,e)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}_s.prototype.beforeStart_=_s.prototype.copySampleValue_;_s.prototype.afterEnd_=_s.prototype.copySampleValue_;class L4 extends _s{constructor(e,t,i,s){super(e,t,i,s);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Zo,endingEnd:Zo}}intervalChanged_(e,t,i){const s=this.parameterPositions;let r=e-2,o=e+1,a=s[r],l=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case ea:r=e,a=2*t-i;break;case Ph:r=s.length-2,a=t+s[r]-s[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case ea:o=e,l=2*i-t;break;case Ph:o=1,l=i+s[1]-s[0];break;default:o=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(i-t)/(s-t),_=p*p,y=_*p,m=-d*y+2*d*_-d*p,g=(1+d)*y+(-1.5-2*d)*_+(-.5+d)*p+1,v=(-1-f)*y+(1.5+f)*_+.5*p,x=f*y-f*_;for(let T=0;T!==a;++T)r[T]=m*o[h+T]+g*o[c+T]+v*o[l+T]+x*o[u+T];return r}}class Zw extends _s{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(i-t)/(s-t),u=1-h;for(let d=0;d!==a;++d)r[d]=o[c+d]*u+o[l+d]*h;return r}}class P4 extends _s{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Wi{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=yt.convertArray(t,this.TimeBufferType),this.values=yt.convertArray(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:yt.convertArray(e.times,Array),values:yt.convertArray(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new P4(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Zw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new L4(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case nc:t=this.InterpolantFactoryMethodDiscrete;break;case Jo:t=this.InterpolantFactoryMethodLinear;break;case Lm:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return nc;case this.InterpolantFactoryMethodLinear:return Jo;case this.InterpolantFactoryMethodSmooth:return Lm}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=yt.arraySlice(i,r,o),this.values=yt.arraySlice(this.values,r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(s!==void 0&&yt.isTypedArray(s))for(let a=0,l=s.length;a!==l;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=yt.arraySlice(this.times),t=yt.arraySlice(this.values),i=this.getValueSize(),s=this.getInterpolation()===Lm,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(s)l=!0;else{const u=a*i,d=u-i,f=u+i;for(let p=0;p!==i;++p){const _=t[u+p];if(_!==t[d+p]||_!==t[f+p]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const u=a*i,d=o*i;for(let f=0;f!==i;++f)t[d+f]=t[u+f]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=yt.arraySlice(e,0,o),this.values=yt.arraySlice(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=yt.arraySlice(this.times,0),t=yt.arraySlice(this.values,0),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}Wi.prototype.TimeBufferType=Float32Array;Wi.prototype.ValueBufferType=Float32Array;Wi.prototype.DefaultInterpolation=Jo;class Pa extends Wi{}Pa.prototype.ValueTypeName="bool";Pa.prototype.ValueBufferType=Array;Pa.prototype.DefaultInterpolation=nc;Pa.prototype.InterpolantFactoryMethodLinear=void 0;Pa.prototype.InterpolantFactoryMethodSmooth=void 0;class eS extends Wi{}eS.prototype.ValueTypeName="color";class Sc extends Wi{}Sc.prototype.ValueTypeName="number";class N4 extends _s{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(s-t);let c=e*a;for(let h=c+a;c!==h;c+=4)gt.slerpFlat(r,0,o,c-a,o,c,l);return r}}class Kr extends Wi{InterpolantFactoryMethodLinear(e){return new N4(this.times,this.values,this.getValueSize(),e)}}Kr.prototype.ValueTypeName="quaternion";Kr.prototype.DefaultInterpolation=Jo;Kr.prototype.InterpolantFactoryMethodSmooth=void 0;class Na extends Wi{}Na.prototype.ValueTypeName="string";Na.prototype.ValueBufferType=Array;Na.prototype.DefaultInterpolation=nc;Na.prototype.InterpolantFactoryMethodLinear=void 0;Na.prototype.InterpolantFactoryMethodSmooth=void 0;class Ec extends Wi{}Ec.prototype.ValueTypeName="vector";class Fg{constructor(e,t=-1,i,s=Pm){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=oi(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(D4(i[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(Wi.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=yt.getKeyframeOrder(l);l=yt.sortedArray(l,1,h),c=yt.sortedArray(c,1,h),!s&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new Sc(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const u=h[1];let d=s[u];d||(s[u]=d=[]),d.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(u,d,f,p,_){if(f.length!==0){const y=[],m=[];yt.flattenJSON(f,y,m,p),y.length!==0&&_.push(new u(d,y,m))}},s=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let u=0;u<c.length;u++){const d=c[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let _=0;_<d[p].morphTargets.length;_++)f[d[p].morphTargets[_]]=-1;for(const _ in f){const y=[],m=[];for(let g=0;g!==d[p].morphTargets.length;++g){const v=d[p];y.push(v.time),m.push(v.morphTarget===_?1:0)}s.push(new Sc(".morphTargetInfluence["+_+"]",y,m))}l=f.length*(o||1)}else{const f=".bones["+t[u].name+"]";i(Ec,f+".position",d,"pos",s),i(Kr,f+".quaternion",d,"rot",s),i(Ec,f+".scale",d,"scl",s)}}return s.length===0?null:new this(r,l,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function F4(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Sc;case"vector":case"vector2":case"vector3":case"vector4":return Ec;case"color":return eS;case"quaternion":return Kr;case"bool":case"boolean":return Pa;case"string":return Na}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function D4(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=F4(n.type);if(n.times===void 0){const t=[],i=[];yt.flattenJSON(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Fa={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class O4{constructor(e,t,i){const s=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,r===!1&&s.onStart!==void 0&&s.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,s.onProgress!==void 0&&s.onProgress(h,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=c.length;u<d;u+=2){const f=c[u],p=c[u+1];if(f.global&&(f.lastIndex=0),f.test(h))return p}return null}}}const k4=new O4;class ys{constructor(e){this.manager=e!==void 0?e:k4,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,r){i.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const bi={};class Dg extends ys{constructor(e){super(e)}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Fa.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;if(bi[e]!==void 0){bi[e].push({onLoad:t,onProgress:i,onError:s});return}const a=/^data:(.*?)(;base64)?,(.*)$/,l=e.match(a);let c;if(l){const h=l[1],u=!!l[2];let d=l[3];d=decodeURIComponent(d),u&&(d=atob(d));try{let f;const p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":const _=new Uint8Array(d.length);for(let m=0;m<d.length;m++)_[m]=d.charCodeAt(m);p==="blob"?f=new Blob([_.buffer],{type:h}):f=_.buffer;break;case"document":f=new DOMParser().parseFromString(d,h);break;case"json":f=JSON.parse(d);break;default:f=d;break}setTimeout(function(){t&&t(f),r.manager.itemEnd(e)},0)}catch(f){setTimeout(function(){s&&s(f),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{bi[e]=[],bi[e].push({onLoad:t,onProgress:i,onError:s}),c=new XMLHttpRequest,c.open("GET",e,!0),c.addEventListener("load",function(h){const u=this.response,d=bi[e];if(delete bi[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Fa.add(e,u);for(let f=0,p=d.length;f<p;f++){const _=d[f];_.onLoad&&_.onLoad(u)}r.manager.itemEnd(e)}else{for(let f=0,p=d.length;f<p;f++){const _=d[f];_.onError&&_.onError(h)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),c.addEventListener("progress",function(h){const u=bi[e];for(let d=0,f=u.length;d<f;d++){const p=u[d];p.onProgress&&p.onProgress(h)}},!1),c.addEventListener("error",function(h){const u=bi[e];delete bi[e];for(let d=0,f=u.length;d<f;d++){const p=u[d];p.onError&&p.onError(h)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),c.addEventListener("abort",function(h){const u=bi[e];delete bi[e];for(let d=0,f=u.length;d<f;d++){const p=u[d];p.onError&&p.onError(h)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),this.responseType!==void 0&&(c.responseType=this.responseType),this.withCredentials!==void 0&&(c.withCredentials=this.withCredentials),c.overrideMimeType&&c.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const h in this.requestHeader)c.setRequestHeader(h,this.requestHeader[h]);c.send(null)}return r.manager.itemStart(e),c}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class tS extends ys{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Fa.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function l(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1),Fa.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(h){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1),s&&s(h),r.manager.itemError(e),r.manager.itemEnd(e)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class U4 extends ys{constructor(e){super(e)}load(e,t,i,s){const r=new Zh,o=new tS(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(h){r.images[c]=h,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,s)}for(let c=0;c<e.length;++c)l(c);return r}}class nS extends ys{constructor(e){super(e)}load(e,t,i,s){const r=new Qt,o=new tS(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a;const l=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;r.format=l?Hi:_n,r.needsUpdate=!0,t!==void 0&&t(r)},i,s),r}}class B4 extends ui{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new xd(t,e))}getPoint(e){const t=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=t){const r=i[s]-t,o=this.curves[s],a=o.getLength(),l=a===0?0:1-r/a;return o.getPointAt(l)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,s=this.curves.length;i<s;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let s=0,r=this.curves;s<r.length;s++){const o=r[s],a=o&&o.isEllipseCurve?e*2:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const h=l[c];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(new qw[s.type]().fromJSON(s))}return this}}class Og extends B4{constructor(e){super();this.type="Path",this.currentPoint=new ie,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new xd(this.currentPoint.clone(),new ie(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,s){const r=new Cg(this.currentPoint.clone(),new ie(e,t),new ie(i,s));return this.curves.push(r),this.currentPoint.set(i,s),this}bezierCurveTo(e,t,i,s,r,o){const a=new Ag(this.currentPoint.clone(),new ie(e,t),new ie(i,s),new ie(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new Ig(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,s,r,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,s,r,o),this}absarc(e,t,i,s,r,o){return this.absellipse(e,t,i,i,s,r,o),this}ellipse(e,t,i,s,r,o,a,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,i,s,r,o,a,l),this}absellipse(e,t,i,s,r,o,a,l){const c=new yd(e,t,i,s,r,o,a,l);if(this.curves.length>0){const u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class kg extends Og{constructor(e){super(e);this.uuid=oi(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,s=this.holes.length;i<s;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(new Og().fromJSON(s))}return this}}class Xi extends Qe{constructor(e,t=1){super();this.type="Light",this.color=new ge(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}Xi.prototype.isLight=!0;class iS extends Xi{constructor(e,t,i){super(e,i);this.type="HemisphereLight",this.position.copy(Qe.DefaultUp),this.updateMatrix(),this.groundColor=new ge(t)}copy(e){return Xi.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}iS.prototype.isHemisphereLight=!0;const sS=new be,rS=new C,oS=new C;class Ug{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ie(512,512),this.map=null,this.mapPass=null,this.matrix=new be,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new td,this._frameExtents=new ie(1,1),this._viewportCount=1,this._viewports=[new Be(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;rS.setFromMatrixPosition(e.matrixWorld),t.position.copy(rS),oS.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(oS),t.updateMatrixWorld(),sS.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sS),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class aS extends Ug{constructor(){super(new vn(50,1,.5,500));this.focus=1}updateMatrices(e){const t=this.camera,i=rc*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}aS.prototype.isSpotLightShadow=!0;class lS extends Xi{constructor(e,t,i=0,s=Math.PI/3,r=0,o=1){super(e,t);this.type="SpotLight",this.position.copy(Qe.DefaultUp),this.updateMatrix(),this.target=new Qe,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.shadow=new aS}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}lS.prototype.isSpotLight=!0;const cS=new be,Mc=new C,Bg=new C;class uS extends Ug{constructor(){super(new vn(90,1,.5,500));this._frameExtents=new ie(4,2),this._viewportCount=6,this._viewports=[new Be(2,1,1,1),new Be(0,1,1,1),new Be(3,1,1,1),new Be(1,1,1,1),new Be(3,0,1,1),new Be(1,0,1,1)],this._cubeDirections=[new C(1,0,0),new C(-1,0,0),new C(0,0,1),new C(0,0,-1),new C(0,1,0),new C(0,-1,0)],this._cubeUps=[new C(0,1,0),new C(0,1,0),new C(0,1,0),new C(0,1,0),new C(0,0,1),new C(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Mc.setFromMatrixPosition(e.matrixWorld),i.position.copy(Mc),Bg.copy(i.position),Bg.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Bg),i.updateMatrixWorld(),s.makeTranslation(-Mc.x,-Mc.y,-Mc.z),cS.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(cS)}}uS.prototype.isPointLightShadow=!0;class hS extends Xi{constructor(e,t,i=0,s=1){super(e,t);this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new uS}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}hS.prototype.isPointLight=!0;class dS extends Ug{constructor(){super(new ar(-5,5,5,-5,.5,500))}}dS.prototype.isDirectionalLightShadow=!0;class Hg extends Xi{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy(Qe.DefaultUp),this.updateMatrix(),this.target=new Qe,this.shadow=new dS}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Hg.prototype.isDirectionalLight=!0;class H4 extends Xi{constructor(e,t){super(e,t);this.type="AmbientLight"}}H4.prototype.isAmbientLight=!0;class z4 extends Xi{constructor(e,t,i=10,s=10){super(e,t);this.type="RectAreaLight",this.width=i,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}z4.prototype.isRectAreaLight=!0;class fS{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new C)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*s),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*s)),t.addScaledVector(o[5],1.092548*(s*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(i*r)),t.addScaledVector(o[8],.546274*(i*i-s*s)),t}getIrradianceAt(e,t){const i=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*s),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*s),t.addScaledVector(o[5],2*.429043*s*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*i*r),t.addScaledVector(o[8],.429043*(i*i-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const i=e.x,s=e.y,r=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*s,t[5]=1.092548*s*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-s*s)}}fS.prototype.isSphericalHarmonics3=!0;class zg extends Xi{constructor(e=new fS,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}zg.prototype.isLightProbe=!0;class Da{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}}class V4 extends nt{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}V4.prototype.isInstancedBufferGeometry=!0;class pS extends ys{constructor(e){super(e);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Fa.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){Fa.add(e,l),t&&t(l),r.manager.itemEnd(e)}).catch(function(l){s&&s(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}pS.prototype.isImageBitmapLoader=!0;let Sd;const G4={getContext:function(){return Sd===void 0&&(Sd=new(window.AudioContext||window.webkitAudioContext)),Sd},setContext:function(n){Sd=n}};class W4 extends ys{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new Dg(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{const l=a.slice(0);G4.getContext().decodeAudioData(l,function(h){t(h)})}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},i,s)}}class X4 extends zg{constructor(e,t,i=1){super(void 0,i);const s=new ge().set(e),r=new ge().set(t),o=new C(s.r,s.g,s.b),a=new C(r.r,r.g,r.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(c)}}X4.prototype.isHemisphereLightProbe=!0;class q4 extends zg{constructor(e,t=1){super(void 0,t);const i=new ge().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}q4.prototype.isAmbientLightProbe=!0;class mS{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=gS(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=gS();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function gS(){return(typeof performance=="undefined"?Date:performance).now()}class Y4 extends Qe{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}class j4{constructor(e,t,i){this.binding=e,this.valueSize=i;let s,r,o;switch(t){case"quaternion":s=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:s=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,s=this.valueSize,r=e*s+s;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==s;++a)i[r+a]=i[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(i,r,0,a,s)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,s=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,s=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=t*this._origIndex;this._mixBufferRegion(i,s,l,1-r,t)}o>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){a.setValue(i,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,s=i*this._origIndex;e.getValue(t,s);for(let r=i,o=s;r!==o;++r)t[r]=t[s+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,s,r){if(s>=.5)for(let o=0;o!==r;++o)e[t+o]=e[i+o]}_slerp(e,t,i,s){gt.slerpFlat(e,t,e,t,e,i,s)}_slerpAdditive(e,t,i,s,r){const o=this._workIndex*r;gt.multiplyQuaternionsFlat(e,o,e,t,e,i),gt.slerpFlat(e,t,e,t,e,o,s)}_lerp(e,t,i,s,r){const o=1-s;for(let a=0;a!==r;++a){const l=t+a;e[l]=e[l]*o+e[i+a]*s}}_lerpAdditive(e,t,i,s,r){for(let o=0;o!==r;++o){const a=t+o;e[a]=e[a]+e[i+o]*s}}}const Vg="\\[\\]\\.:\\/",$4=new RegExp("["+Vg+"]","g"),Gg="[^"+Vg+"]",Q4="[^"+Vg.replace("\\.","")+"]",K4=/((?:WC+[\/:])*)/.source.replace("WC",Gg),J4=/(WCOD+)?/.source.replace("WCOD",Q4),Z4=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Gg),eU=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Gg),tU=new RegExp("^"+K4+J4+Z4+eU+"$"),nU=["material","materials","bones"];class iU{constructor(e,t,i){const s=i||it.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class it{constructor(e,t,i){this.path=t,this.parsedPath=i||it.parseTrackName(t),this.node=it.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new it.Composite(e,t,i):new it(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace($4,"")}static parseTrackName(e){const t=tU.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=i.nodeName.substring(s+1);nU.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=it.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[s];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}it.Composite=iU;it.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};it.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};it.prototype.GetterByBindingType=[it.prototype._getValue_direct,it.prototype._getValue_array,it.prototype._getValue_arrayElement,it.prototype._getValue_toArray];it.prototype.SetterByBindingTypeAndVersioning=[[it.prototype._setValue_direct,it.prototype._setValue_direct_setNeedsUpdate,it.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[it.prototype._setValue_array,it.prototype._setValue_array_setNeedsUpdate,it.prototype._setValue_array_setMatrixWorldNeedsUpdate],[it.prototype._setValue_arrayElement,it.prototype._setValue_arrayElement_setNeedsUpdate,it.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[it.prototype._setValue_fromArray,it.prototype._setValue_fromArray_setNeedsUpdate,it.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class sU{constructor(e,t,i=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=s;const r=t.tracks,o=r.length,a=new Array(o),l={endingStart:Zo,endingEnd:Zo};for(let c=0;c!==o;++c){const h=r[c].createInterpolant(null);a[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=B3,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const s=this._clip.duration,r=e._clip.duration,o=r/s,a=s/r;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const s=this._mixer,r=s.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=s._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+i,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,s){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*i;if(l<0||i===0)return;this._startTime=null,t=i*l}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case pT:for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(o),c[h].accumulateAdditive(a);break;case Pm:default:for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(o),c[h].accumulate(s,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;i!==null&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let s=this.time+e,r=this._loopCount;const o=i===H3;if(e===0)return r===-1?s:o&&(r&1)==1?t-s:s;if(i===U3){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),s>=t||s<0){const a=Math.floor(s/t);s-=t*a,r+=Math.abs(a);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=s;if(o&&(r&1)==1)return t-s}return s}_setEndings(e,t,i){const s=this._interpolantSettings;i?(s.endingStart=ea,s.endingEnd=ea):(e?s.endingStart=this.zeroSlopeAtStart?ea:Zo:s.endingStart=Ph,t?s.endingEnd=this.zeroSlopeAtEnd?ea:Zo:s.endingEnd=Ph)}_scheduleFading(e,t,i){const s=this._mixer,r=s.time;let o=this._weightInterpolant;o===null&&(o=s._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=i,this}}class rU extends Js{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,s=e._clip.tracks,r=s.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let u=0;u!==r;++u){const d=s[u],f=d.name;let p=h[f];if(p!==void 0)o[u]=p;else{if(p=o[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,f));continue}const _=t&&t._propertyBindings[u].binding.parsedPath;p=new j4(it.create(i,f,_),d.ValueTypeName,d.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,f),o[u]=p}a[u].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,s=e._clip.uuid,r=this._actionsByClip[s];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,s,i)}const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];r.useCount++==0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];--r.useCount==0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const s=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=s.length,s.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],s=e._cacheIndex;i._cacheIndex=s,t[s]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,a=o[r],l=a.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null;const u=a.actionByRoot,d=(e._localRoot||this._root).uuid;delete u[d],l.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];--r.referenceCount==0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,s=this._nActiveActions++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,s=--this._nActiveActions,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const s=this._bindingsByRootAndName,r=this._bindings;let o=s[t];o===void 0&&(o={},s[t]=o),o[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,s=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[s],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[r],Object.keys(a).length===0&&delete o[s]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,s=this._nActiveBindings++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,s=--this._nActiveBindings,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new Zw(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,s=--this._nActiveControlInterpolants,r=t[s];e.__cacheIndex=s,t[s]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const s=t||this._root,r=s.uuid;let o=typeof e=="string"?Fg.findByName(s,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(i===void 0&&(o!==null?i=o.blendMode:i=Pm),l!==void 0){const u=l.actionByRoot[r];if(u!==void 0&&u.blendMode===i)return u;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const h=new sU(this,o,t,i);return this._bindAction(h,c),this._addInactiveAction(h,a,r),h}existingAction(e,t){const i=t||this._root,s=i.uuid,r=typeof e=="string"?Fg.findByName(i,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,s=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(s,e,r,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,s=this._actionsByClip,r=s[i];if(r!==void 0){const o=r.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const h=c._cacheIndex,u=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,u._cacheIndex=h,t[h]=u,t.pop(),this._removeInactiveBindingsForAction(c)}delete s[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const s=this._bindingsByRootAndName,r=s[t];if(r!==void 0)for(const o in r){const a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}rU.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class oU extends Ta{constructor(e,t,i=1){super(e,t);this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}oU.prototype.isInstancedInterleavedBuffer=!0;class aU{constructor(e,t,i=0,s=1/0){this.ray=new $r(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new ST,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,i=[]){return Wg(e,this,i,t),i.sort(_S),i}intersectObjects(e,t=!1,i=[]){for(let s=0,r=e.length;s<r;s++)Wg(e[s],this,i,t);return i.sort(_S),i}}function _S(n,e){return n.distance-e.distance}function Wg(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const s=n.children;for(let r=0,o=s.length;r<o;r++)Wg(s[r],e,t,!0)}}class yS{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(An(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class lU extends Qe{constructor(e){super();this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}lU.prototype.isImmediateRenderObject=!0;const fr=new C,Ed=new be,Xg=new be;class cU extends md{constructor(e){const t=vS(e),i=new nt,s=[],r=[],o=new ge(0,0,1),a=new ge(0,1,0);for(let c=0;c<t.length;c++){const h=t[c];h.parent&&h.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new lt(s,3)),i.setAttribute("color",new lt(r,3));const l=new Ca({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,s=i.getAttribute("position");Xg.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const a=t[r];a.parent&&a.parent.isBone&&(Ed.multiplyMatrices(Xg,a.matrixWorld),fr.setFromMatrixPosition(Ed),s.setXYZ(o,fr.x,fr.y,fr.z),Ed.multiplyMatrices(Xg,a.parent.matrixWorld),fr.setFromMatrixPosition(Ed),s.setXYZ(o+1,fr.x,fr.y,fr.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function vS(n){const e=[];n&&n.isBone&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,vS(n.children[t]));return e}class uU extends md{constructor(e=10,t=10,i=4473924,s=8947848){i=new ge(i),s=new ge(s);const r=t/2,o=e/t,a=e/2,l=[],c=[];for(let d=0,f=0,p=-a;d<=t;d++,p+=o){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);const _=d===r?i:s;_.toArray(c,f),f+=3,_.toArray(c,f),f+=3,_.toArray(c,f),f+=3,_.toArray(c,f),f+=3}const h=new nt;h.setAttribute("position",new lt(l,3)),h.setAttribute("color",new lt(c,3));const u=new Ca({vertexColors:!0,toneMapped:!1});super(h,u);this.type="GridHelper"}}const hU=new Float32Array(1);new Int32Array(hU.buffer);ui.create=function(n,e){return console.log("THREE.Curve.create() has been deprecated"),n.prototype=Object.create(ui.prototype),n.prototype.constructor=n,n.prototype.getPoint=e,n};Og.prototype.fromPoints=function(n){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(n)};uU.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};cU.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};ys.prototype.extractUrlBase=function(n){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Da.extractUrlBase(n)};ys.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};ai.prototype.center=function(n){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(n)};ai.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};ai.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};ai.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)};ai.prototype.size=function(n){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(n)};jr.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};td.prototype.setFromMatrix=function(n){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(n)};hn.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)};hn.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)};hn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};hn.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)};hn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};hn.prototype.getInverse=function(n){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()};be.prototype.extractPosition=function(n){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(n)};be.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)};be.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new C().setFromMatrixColumn(this,3)};be.prototype.setRotationFromQuaternion=function(n){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(n)};be.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};be.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};be.prototype.multiplyVector4=function(n){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};be.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};be.prototype.rotateAxis=function(n){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),n.transformDirection(this)};be.prototype.crossVector=function(n){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};be.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};be.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};be.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};be.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};be.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};be.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};be.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};be.prototype.makeFrustum=function(n,e,t,i,s,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(n,e,i,t,s,r)};be.prototype.getInverse=function(n){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()};gs.prototype.isIntersectionLine=function(n){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(n)};gt.prototype.multiplyVector3=function(n){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),n.applyQuaternion(this)};gt.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};$r.prototype.isIntersectionBox=function(n){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};$r.prototype.isIntersectionPlane=function(n){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(n)};$r.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)};kt.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};kt.prototype.barycoordFromPoint=function(n,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(n,e)};kt.prototype.midpoint=function(n){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(n)};kt.prototypenormal=function(n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(n)};kt.prototype.plane=function(n){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(n)};kt.barycoordFromPoint=function(n,e,t,i,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),kt.getBarycoord(n,e,t,i,s)};kt.normal=function(n,e,t,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),kt.getNormal(n,e,t,i)};kg.prototype.extractAllPoints=function(n){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(n)};kg.prototype.extrude=function(n){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ra(this,n)};kg.prototype.makeGeometry=function(n){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Pg(this,n)};ie.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};ie.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)};ie.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};C.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};C.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};C.prototype.getPositionFromMatrix=function(n){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(n)};C.prototype.getScaleFromMatrix=function(n){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(n)};C.prototype.getColumnFromMatrix=function(n,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,n)};C.prototype.applyProjection=function(n){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(n)};C.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};C.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)};C.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Be.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};Be.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Qe.prototype.getChildByName=function(n){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(n)};Qe.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Qe.prototype.translate=function(n,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,n)};Qe.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Qe.prototype.applyMatrix=function(n){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)};Object.defineProperties(Qe.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(n){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=n}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Vt.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(Vt.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),z3},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});ud.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};vn.prototype.setLens=function(n,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(n)};Object.defineProperties(Xi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(n){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=n}},shadowCameraLeft:{set:function(n){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=n}},shadowCameraRight:{set:function(n){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=n}},shadowCameraTop:{set:function(n){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=n}},shadowCameraBottom:{set:function(n){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=n}},shadowCameraNear:{set:function(n){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=n}},shadowCameraFar:{set:function(n){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=n}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(n){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=n}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(n){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=n}},shadowMapHeight:{set:function(n){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=n}}});Object.defineProperties(Pt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Dh},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Dh)}}});Pt.prototype.setDynamic=function(n){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?Dh:ic),this};Pt.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Pt.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};nt.prototype.addIndex=function(n){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(n)};nt.prototype.addAttribute=function(n,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(n,new Pt(arguments[1],arguments[2]))):n==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(n,e)};nt.prototype.addDrawCall=function(n,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(n,e)};nt.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};nt.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};nt.prototype.removeAttribute=function(n){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(n)};nt.prototype.applyMatrix=function(n){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)};Object.defineProperties(nt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Ta.prototype.setDynamic=function(n){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?Dh:ic),this};Ta.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Ra.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};Ra.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};Ra.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};od.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(Kt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ge}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(n){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===jb}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(n){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=n}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(Cn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(n){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=n}}});ot.prototype.clearTarget=function(n,e,t,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(n),this.clear(e,t,i)};ot.prototype.animate=function(n){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(n)};ot.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};ot.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};ot.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};ot.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};ot.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};ot.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};ot.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};ot.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};ot.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};ot.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};ot.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};ot.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};ot.prototype.enableScissorTest=function(n){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(n)};ot.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};ot.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};ot.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};ot.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};ot.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};ot.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};ot.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};ot.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};ot.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};ot.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(ot.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=n}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=n}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(n){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=n===!0?ri:Lt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(yw.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Dn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=n}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=n}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=n}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=n}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(n){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=n}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(n){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=n}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(n){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=n}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(n){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=n}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(n){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=n}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(n){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=n}}});Y4.prototype.load=function(n){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new W4().load(n,function(i){e.setBuffer(i)}),this};lg.prototype.updateCubeMap=function(n,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(n,e)};lg.prototype.clear=function(n,e,t,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(n,e,t,i)};na.crossOrigin=void 0;na.loadTexture=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const s=new nS;s.setCrossOrigin(this.crossOrigin);const r=s.load(n,t,void 0,i);return e&&(r.mapping=e),r};na.loadTextureCube=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const s=new U4;s.setCrossOrigin(this.crossOrigin);const r=s.load(n,t,void 0,i);return e&&(r.mapping=e),r};na.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};na.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:us}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=us);class xS extends ys{constructor(e){super(e);this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new mU(t)}),this.register(function(t){return new xU(t)}),this.register(function(t){return new bU(t)}),this.register(function(t){return new gU(t)}),this.register(function(t){return new _U(t)}),this.register(function(t){return new yU(t)}),this.register(function(t){return new vU(t)}),this.register(function(t){return new fU(t)}),this.register(function(t){return new TU(t)})}load(e,t,i,s){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=Da.extractUrlBase(e),this.manager.itemStart(e);const a=function(c){s?s(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new Dg(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let r;const o={},a={};if(typeof e=="string")r=e;else if(Da.decodeText(new Uint8Array(e,0,4))===bS){try{o[$e.KHR_BINARY_GLTF]=new wU(e)}catch(u){s&&s(u);return}r=o[$e.KHR_BINARY_GLTF].content}else r=Da.decodeText(new Uint8Array(e));const l=JSON.parse(r);if(l.asset===void 0||l.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new DU(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);a[u.name]=u,o[u.name]=!0}if(l.extensionsUsed)for(let h=0;h<l.extensionsUsed.length;++h){const u=l.extensionsUsed[h],d=l.extensionsRequired||[];switch(u){case $e.KHR_MATERIALS_UNLIT:o[u]=new pU;break;case $e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[u]=new MU;break;case $e.KHR_DRACO_MESH_COMPRESSION:o[u]=new SU(l,this.dracoLoader);break;case $e.KHR_TEXTURE_TRANSFORM:o[u]=new EU;break;case $e.KHR_MESH_QUANTIZATION:o[u]=new AU;break;default:d.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,s)}}function dU(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const $e={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class fU{constructor(e){this.parser=e,this.name=$e.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new ge(16777215);l.color!==void 0&&h.fromArray(l.color);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new Hg(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new hS(h),c.distance=u;break;case"spot":c=new lS(h),c.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(c),t.cache.add(i,s),s}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}class pU{constructor(){this.name=$e.KHR_MATERIALS_UNLIT}getMaterialType(){return li}extendParams(e,t,i){const s=[];e.color=new ge(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(s)}}class mU{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:La}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ie(a,-a)}return Promise.all(r)}}class gU{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:La}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class _U{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:La}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;const a=o.attenuationColor||[1,1,1];return t.attenuationTint=new ge(a[0],a[1],a[2]),Promise.all(r)}}class yU{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:La}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class vU{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:La}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularTint=new ge(a[0],a[1],a[2]),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularTintMap",o.specularColorTexture).then(function(l){l.encoding=ri})),Promise.all(r)}}class xU{constructor(e){this.parser=e,this.name=$e.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=i.images[r.source],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,a)}}class bU{constructor(e){this.parser=e,this.name=$e.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,a,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class TU{constructor(e){this.name=$e.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,o.ready]).then(function(a){const l=s.byteOffset||0,c=s.byteLength||0,h=s.count,u=s.byteStride,d=new ArrayBuffer(h*u),f=new Uint8Array(a[0],l,c);return o.decodeGltfBuffer(new Uint8Array(d),h,u,f,s.mode,s.filter),d})}else return null}}const bS="glTF",Ac=12,TS={JSON:1313821514,BIN:5130562};class wU{constructor(e){this.name=$e.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Ac);if(this.header={magic:Da.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==bS)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-Ac,s=new DataView(e,Ac);let r=0;for(;r<i;){const o=s.getUint32(r,!0);r+=4;const a=s.getUint32(r,!0);if(r+=4,a===TS.JSON){const l=new Uint8Array(e,Ac+r,o);this.content=Da.decodeText(l)}else if(a===TS.BIN){const l=Ac+r;this.body=e.slice(l,l+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class SU{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=$e.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const u=Yg[h]||h.toLowerCase();a[u]=o[h]}for(const h in e.attributes){const u=Yg[h]||h.toLowerCase();if(o[h]!==void 0){const d=i.accessors[e.attributes[h]],f=Cc[d.componentType];c[u]=f,l[u]=d.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(u){s.decodeDracoFile(h,function(d){for(const f in d.attributes){const p=d.attributes[f],_=l[f];_!==void 0&&(p.normalized=_)}u(d)},a,c)})})}}class EU{constructor(){this.name=$e.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class qg extends wc{constructor(e){super();this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),i=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new ge().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(l){for(const c in a)l.uniforms[c]=a[c];l.fragmentShader=l.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(l){a.specular.value=l}},specularMap:{get:function(){return a.specularMap.value},set:function(l){a.specularMap.value=l,l?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(l){a.glossiness.value=l}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(l){a.glossinessMap.value=l,l?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class MU{constructor(){this.name=$e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return qg}extendParams(e,t,i){const s=t.extensions[this.name];e.color=new ge(1,1,1),e.opacity=1;const r=[];if(Array.isArray(s.diffuseFactor)){const o=s.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(s.diffuseTexture!==void 0&&r.push(i.assignTexture(e,"map",s.diffuseTexture)),e.emissive=new ge(0,0,0),e.glossiness=s.glossinessFactor!==void 0?s.glossinessFactor:1,e.specular=new ge(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),s.specularGlossinessTexture!==void 0){const o=s.specularGlossinessTexture;r.push(i.assignTexture(e,"glossinessMap",o)),r.push(i.assignTexture(e,"specularMap",o))}return Promise.all(r)}createMaterial(e){const t=new qg(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Ks,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class AU{constructor(){this.name=$e.KHR_MESH_QUANTIZATION}}class Jr extends _s{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)t[o]=i[r+o];return t}}Jr.prototype.beforeStart_=Jr.prototype.copySampleValue_;Jr.prototype.afterEnd_=Jr.prototype.copySampleValue_;Jr.prototype.interpolate_=function(n,e,t,i){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=o*2,l=o*3,c=i-e,h=(t-e)/c,u=h*h,d=u*h,f=n*l,p=f-l,_=-2*d+3*u,y=d-u,m=1-_,g=y-u+h;for(let v=0;v!==o;v++){const x=r[p+v+o],T=r[p+v+a]*c,S=r[f+v+o],b=r[f+v]*c;s[v]=m*x+g*T+_*S+y*b}return s};const CU=new gt;class IU extends Jr{interpolate_(e,t,i,s){const r=super.interpolate_(e,t,i,s);return CU.fromArray(r).normalize().toArray(r),r}}const vs={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Cc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},wS={9728:zt,9729:$t,9984:Im,9985:iT,9986:Rm,9987:jo},SS={33071:Fn,33648:Ih,10497:Yo},ES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Yg={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},pr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},RU={CUBICSPLINE:void 0,LINEAR:Jo,STEP:nc},jg={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function MS(n,e){return typeof n!="string"||n===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(n)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(n)||/^data:.*,.*$/i.test(n)||/^blob:.*$/i.test(n)?n:e+n)}function LU(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new wc({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:js})),n.DefaultMaterial}function Ic(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Zr(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function PU(n,e,t){let i=!1,s=!1;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(c.POSITION!==void 0&&(i=!0),c.NORMAL!==void 0&&(s=!0),i&&s)break}if(!i&&!s)return Promise.resolve(n);const r=[],o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];if(i){const h=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):n.attributes.position;r.push(h)}if(s){const h=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):n.attributes.normal;o.push(h)}}return Promise.all([Promise.all(r),Promise.all(o)]).then(function(a){const l=a[0],c=a[1];return i&&(n.morphAttributes.position=l),s&&(n.morphAttributes.normal=c),n.morphTargetsRelative=!0,n})}function NU(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function FU(n){const e=n.extensions&&n.extensions[$e.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+AS(e.attributes):t=n.indices+":"+AS(n.attributes)+":"+n.mode,t}function AS(n){let e="";const t=Object.keys(n).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+n[t[i]]+";";return e}function $g(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class DU{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new dU,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new pS(this.options.manager):this.textureLoader=new nS(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Dg(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};Ic(r,a,s),Zr(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const o=t[s].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone();return s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this.loadNode(t);break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this.loadAnimation(t);break;case"camera":s=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[$e.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(MS(t.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0)return Promise.resolve(null);const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=ES[s.type],c=Cc[s.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=s.byteOffset||0,f=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,p=s.normalized===!0;let _,y;if(f&&f!==u){const m=Math.floor(d/f),g="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+m+":"+s.count;let v=t.cache.get(g);v||(_=new c(a,m*f,s.count*f/h),v=new Ta(_,f/h),t.cache.add(g,v)),y=new wa(v,l,d%f/h,p)}else a===null?_=new c(s.count*l):_=new c(a,d,s.count*l),y=new Pt(_,l,p);if(s.sparse!==void 0){const m=ES.SCALAR,g=Cc[s.sparse.indices.componentType],v=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,T=new g(o[1],v,s.sparse.count*m),S=new c(o[2],x,s.sparse.count*l);a!==null&&(y=new Pt(y.array.slice(),y.itemSize,y.normalized));for(let b=0,M=T.length;b<M;b++){const N=T[b];if(y.setX(N,S[b*l]),l>=2&&y.setY(N,S[b*l+1]),l>=3&&y.setZ(N,S[b*l+2]),l>=4&&y.setW(N,S[b*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e],r=t.images[s.source];let o=this.textureLoader;if(r.uri){const a=i.manager.getHandler(r.uri);a!==null&&(o=a)}return this.loadTextureImage(e,r,o)}loadTextureImage(e,t,i){const s=this,r=this.json,o=this.options,a=r.textures[e],l=(t.uri||t.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=self.URL||self.webkitURL;let h=t.uri||"",u=!1,d=!0;const f=h.search(/\.jpe?g($|\?)/i)>0||h.search(/^data\:image\/jpeg/)===0;if((t.mimeType==="image/jpeg"||f)&&(d=!1),t.bufferView!==void 0)h=s.getDependency("bufferView",t.bufferView).then(function(_){if(t.mimeType==="image/png"){const m=new DataView(_,25,1).getUint8(0,!1);d=m===6||m===4||m===3}u=!0;const y=new Blob([_],{type:t.mimeType});return h=c.createObjectURL(y),h});else if(t.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const p=Promise.resolve(h).then(function(_){return new Promise(function(y,m){let g=y;i.isImageBitmapLoader===!0&&(g=function(v){const x=new Qt(v);x.needsUpdate=!0,y(x)}),i.load(MS(_,o.path),g,void 0,m)})}).then(function(_){u===!0&&c.revokeObjectURL(h),_.flipY=!1,a.name&&(_.name=a.name),d||(_.format=Hi);const m=(r.samplers||{})[a.sampler]||{};return _.magFilter=wS[m.magFilter]||$t,_.minFilter=wS[m.minFilter]||jo,_.wrapS=SS[m.wrapS]||Yo,_.wrapT=SS[m.wrapT]||Yo,s.associations.set(_,{type:"textures",index:e}),_}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",h),null});return this.textureCache[l]=p,p}assignTexture(e,t,i){const s=this;return this.getDependency("texture",i.index).then(function(r){if(i.texCoord!==void 0&&i.texCoord!=0&&!(t==="aoMap"&&i.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),s.extensions[$e.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[$e.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const a=s.associations.get(r);r=s.extensions[$e.KHR_TEXTURE_TRANSFORM].extendTexture(r,o),s.associations.set(r,a)}}return e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent!==void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new bg,Kt.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Ca,Kt.prototype.copy.call(l,i),l.color.copy(i.color),this.cache.add(a,l)),i=l}if(s||r||o){let a="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),s&&(a+="vertex-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}i.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=i}getMaterialType(){return wc}loadMaterial(e){const t=this,i=this.json,s=this.extensions,r=i.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[$e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const u=s[$e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=u.getMaterialType(),c.push(u.extendParams(a,r,t))}else if(l[$e.KHR_MATERIALS_UNLIT]){const u=s[$e.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),c.push(u.extendParams(a,r,t))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new ge(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;a.color.fromArray(d),a.opacity=d[3]}u.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",u.baseColorTexture)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Bi);const h=r.alphaMode||jg.OPAQUE;return h===jg.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.format=Hi,a.transparent=!1,h===jg.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==li&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new ie(1,-1),r.normalTexture.scale!==void 0&&a.normalScale.set(r.normalTexture.scale,-r.normalTexture.scale)),r.occlusionTexture!==void 0&&o!==li&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==li&&(a.emissive=new ge().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==li&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture)),Promise.all(c).then(function(){let u;return o===qg?u=s[$e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):u=new o(a),r.name&&(u.name=r.name),u.map&&(u.map.encoding=ri),u.emissiveMap&&(u.emissiveMap.encoding=ri),Zr(u,r),t.associations.set(u,{type:"materials",index:e}),r.extensions&&Ic(s,u,r),u})}createUniqueName(e){const t=it.sanitizeNodeName(e||"");let i=t;for(let s=1;this.nodeNamesUsed[i];++s)i=t+"_"+s;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function r(a){return i[$e.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return IS(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],h=FU(c),u=s[h];if(u)o.push(u.promise);else{let d;c.extensions&&c.extensions[$e.KHR_DRACO_MESH_COMPRESSION]?d=r(c):d=IS(new nt,c,t),s[h]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,s=this.extensions,r=i.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?LU(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let f=0,p=h.length;f<p;f++){const _=h[f],y=o[f];let m;const g=c[f];if(y.mode===vs.TRIANGLES||y.mode===vs.TRIANGLE_STRIP||y.mode===vs.TRIANGLE_FAN||y.mode===void 0)m=r.isSkinnedMesh===!0?new ud(_,g):new Vt(_,g),m.isSkinnedMesh===!0&&!m.geometry.attributes.skinWeight.normalized&&m.normalizeSkinWeights(),y.mode===vs.TRIANGLE_STRIP?m.geometry=RS(m.geometry,V3):y.mode===vs.TRIANGLE_FAN&&(m.geometry=RS(m.geometry,mT));else if(y.mode===vs.LINES)m=new md(_,g);else if(y.mode===vs.LINE_STRIP)m=new pd(_,g);else if(y.mode===vs.LINE_LOOP)m=new kw(_,g);else if(y.mode===vs.POINTS)m=new Bw(_,g);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(m.geometry.morphAttributes).length>0&&NU(m,r),m.name=t.createUniqueName(r.name||"mesh_"+e),Zr(m,r),y.extensions&&Ic(s,m,y),t.assignFinalMaterial(m),u.push(m)}if(u.length===1)return u[0];const d=new ur;for(let f=0,p=u.length;f<p;f++)d.add(u[f]);return d})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new vn(aN.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new ar(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Zr(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(s){return i.inverseBindMatrices=s,i})}loadAnimation(e){const i=this.json.animations[e],s=[],r=[],o=[],a=[],l=[];for(let c=0,h=i.channels.length;c<h;c++){const u=i.channels[c],d=i.samplers[u.sampler],f=u.target,p=f.node!==void 0?f.node:f.id,_=i.parameters!==void 0?i.parameters[d.input]:d.input,y=i.parameters!==void 0?i.parameters[d.output]:d.output;s.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",_)),o.push(this.getDependency("accessor",y)),a.push(d),l.push(f)}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],u=c[1],d=c[2],f=c[3],p=c[4],_=[];for(let m=0,g=h.length;m<g;m++){const v=h[m],x=u[m],T=d[m],S=f[m],b=p[m];if(v===void 0)continue;v.updateMatrix(),v.matrixAutoUpdate=!0;let M;switch(pr[b.path]){case pr.weights:M=Sc;break;case pr.rotation:M=Kr;break;case pr.position:case pr.scale:default:M=Ec;break}const N=v.name?v.name:v.uuid,P=S.interpolation!==void 0?RU[S.interpolation]:Jo,L=[];pr[b.path]===pr.weights?v.traverse(function(O){O.isMesh===!0&&O.morphTargetInfluences&&L.push(O.name?O.name:O.uuid)}):L.push(N);let V=T.array;if(T.normalized){const O=$g(V.constructor),H=new Float32Array(V.length);for(let Q=0,q=V.length;Q<q;Q++)H[Q]=V[Q]*O;V=H}for(let O=0,H=L.length;O<H;O++){const Q=new M(L[O]+"."+pr[b.path],x.array,V,P);S.interpolation==="CUBICSPLINE"&&(Q.createInterpolant=function(Y){const te=this instanceof Kr?IU:Jr;return new te(this.times,this.values,this.getValueSize()/3,Y)},Q.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),_.push(Q)}}const y=i.name?i.name:"animation_"+e;return new Fg(y,void 0,_)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(!!a.isMesh)for(let l=0,c=s.weights.length;l<c;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(e){const t=this.json,i=this.extensions,s=this,r=t.nodes[e],o=r.name?s.createUniqueName(r.name):"";return function(){const a=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),Promise.all(a)}().then(function(a){let l;if(r.isBone===!0?l=new yg:a.length>1?l=new ur:a.length===1?l=a[0]:l=new Qe,l!==a[0])for(let c=0,h=a.length;c<h;c++)l.add(a[c]);if(r.name&&(l.userData.name=r.name,l.name=o),Zr(l,r),r.extensions&&Ic(i,l,r),r.matrix!==void 0){const c=new be;c.fromArray(r.matrix),l.applyMatrix4(c)}else r.translation!==void 0&&l.position.fromArray(r.translation),r.rotation!==void 0&&l.quaternion.fromArray(r.rotation),r.scale!==void 0&&l.scale.fromArray(r.scale);return s.associations.set(l,{type:"nodes",index:e}),l})}loadScene(e){const t=this.json,i=this.extensions,s=this.json.scenes[e],r=this,o=new ur;s.name&&(o.name=r.createUniqueName(s.name)),Zr(o,s),s.extensions&&Ic(i,o,s);const a=s.nodes||[],l=[];for(let c=0,h=a.length;c<h;c++)l.push(CS(a[c],o,t,r));return Promise.all(l).then(function(){return o})}}function CS(n,e,t,i){const s=t.nodes[n];return i.getDependency("node",n).then(function(r){if(s.skin===void 0)return r;let o;return i.getDependency("skin",s.skin).then(function(a){o=a;const l=[];for(let c=0,h=o.joints.length;c<h;c++)l.push(i.getDependency("node",o.joints[c]));return Promise.all(l)}).then(function(a){return r.traverse(function(l){if(!l.isMesh)return;const c=[],h=[];for(let u=0,d=a.length;u<d;u++){const f=a[u];if(f){c.push(f);const p=new be;o.inverseBindMatrices!==void 0&&p.fromArray(o.inverseBindMatrices.array,u*16),h.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[u])}l.bind(new hd(c,h),l.matrixWorld)}),r})}).then(function(r){e.add(r);const o=[];if(s.children){const a=s.children;for(let l=0,c=a.length;l<c;l++){const h=a[l];o.push(CS(h,r,t,i))}}return Promise.all(o)})}function OU(n,e,t){const i=e.attributes,s=new ai;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(s.set(new C(l[0],l[1],l[2]),new C(c[0],c[1],c[2])),a.normalized){const h=$g(Cc[a.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new C,l=new C;for(let c=0,h=r.length;c<h;c++){const u=r[c];if(u.POSITION!==void 0){const d=t.json.accessors[u.POSITION],f=d.min,p=d.max;if(f!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),d.normalized){const _=$g(Cc[d.componentType]);l.multiplyScalar(_)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}n.boundingBox=s;const o=new jr;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=o}function IS(n,e,t){const i=e.attributes,s=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=Yg[o]||o.toLowerCase();a in n.attributes||s.push(r(i[o],a))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});s.push(o)}return Zr(n,e),OU(n,e,t),Promise.all(s).then(function(){return e.targets!==void 0?PU(n,e.targets,t):n})}function RS(n,e){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,s=[];if(e===mT)for(let o=1;o<=i;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2==0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(s),r}const LS={type:"change"},Qg={type:"start"},Kg={type:"end"};class kU extends Js{constructor(e,t){super();t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new C,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Wo.ROTATE,MIDDLE:Wo.DOLLY,RIGHT:Wo.PAN},this.touches={ONE:Xo.ROTATE,TWO:Xo.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(F){F.addEventListener("keydown",W),this._domElementKeyEvents=F},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(LS),i.update(),r=s.NONE},this.update=function(){const F=new C,ue=new gt().setFromUnitVectors(e.up,new C(0,1,0)),He=ue.clone().invert(),ke=new C,Tt=new gt,De=2*Math.PI;return function(){const wn=i.object.position;F.copy(wn).sub(i.target),F.applyQuaternion(ue),a.setFromVector3(F),i.autoRotate&&r===s.NONE&&N(b()),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let Vn=i.minAzimuthAngle,mi=i.maxAzimuthAngle;return isFinite(Vn)&&isFinite(mi)&&(Vn<-Math.PI?Vn+=De:Vn>Math.PI&&(Vn-=De),mi<-Math.PI?mi+=De:mi>Math.PI&&(mi-=De),Vn<=mi?a.theta=Math.max(Vn,Math.min(mi,a.theta)):a.theta=a.theta>(Vn+mi)/2?Math.max(Vn,a.theta):Math.min(mi,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(i.minDistance,Math.min(i.maxDistance,a.radius)),i.enableDamping===!0?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),F.setFromSpherical(a),F.applyQuaternion(He),wn.copy(i.target).add(F),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),h.set(0,0,0)),c=1,u||ke.distanceToSquared(i.object.position)>o||8*(1-Tt.dot(i.object.quaternion))>o?(i.dispatchEvent(LS),ke.copy(i.object.position),Tt.copy(i.object.quaternion),u=!1,!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",se),i.domElement.removeEventListener("pointerdown",R),i.domElement.removeEventListener("pointercancel",E),i.domElement.removeEventListener("wheel",X),i.domElement.removeEventListener("pointermove",B),i.domElement.removeEventListener("pointerup",z),i._domElementKeyEvents!==null&&i._domElementKeyEvents.removeEventListener("keydown",W)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const o=1e-6,a=new yS,l=new yS;let c=1;const h=new C;let u=!1;const d=new ie,f=new ie,p=new ie,_=new ie,y=new ie,m=new ie,g=new ie,v=new ie,x=new ie,T=[],S={};function b(){return 2*Math.PI/60/60*i.autoRotateSpeed}function M(){return Math.pow(.95,i.zoomSpeed)}function N(F){l.theta-=F}function P(F){l.phi-=F}const L=function(){const F=new C;return function(He,ke){F.setFromMatrixColumn(ke,0),F.multiplyScalar(-He),h.add(F)}}(),V=function(){const F=new C;return function(He,ke){i.screenSpacePanning===!0?F.setFromMatrixColumn(ke,1):(F.setFromMatrixColumn(ke,0),F.crossVectors(i.object.up,F)),F.multiplyScalar(He),h.add(F)}}(),O=function(){const F=new C;return function(He,ke){const Tt=i.domElement;if(i.object.isPerspectiveCamera){const De=i.object.position;F.copy(De).sub(i.target);let pt=F.length();pt*=Math.tan(i.object.fov/2*Math.PI/180),L(2*He*pt/Tt.clientHeight,i.object.matrix),V(2*ke*pt/Tt.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(L(He*(i.object.right-i.object.left)/i.object.zoom/Tt.clientWidth,i.object.matrix),V(ke*(i.object.top-i.object.bottom)/i.object.zoom/Tt.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function H(F){i.object.isPerspectiveCamera?c/=F:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*F)),i.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Q(F){i.object.isPerspectiveCamera?c*=F:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/F)),i.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function q(F){d.set(F.clientX,F.clientY)}function Y(F){g.set(F.clientX,F.clientY)}function te(F){_.set(F.clientX,F.clientY)}function me(F){f.set(F.clientX,F.clientY),p.subVectors(f,d).multiplyScalar(i.rotateSpeed);const ue=i.domElement;N(2*Math.PI*p.x/ue.clientHeight),P(2*Math.PI*p.y/ue.clientHeight),d.copy(f),i.update()}function we(F){v.set(F.clientX,F.clientY),x.subVectors(v,g),x.y>0?H(M()):x.y<0&&Q(M()),g.copy(v),i.update()}function pe(F){y.set(F.clientX,F.clientY),m.subVectors(y,_).multiplyScalar(i.panSpeed),O(m.x,m.y),_.copy(y),i.update()}function Se(F){F.deltaY<0?Q(M()):F.deltaY>0&&H(M()),i.update()}function ne(F){let ue=!1;switch(F.code){case i.keys.UP:O(0,i.keyPanSpeed),ue=!0;break;case i.keys.BOTTOM:O(0,-i.keyPanSpeed),ue=!0;break;case i.keys.LEFT:O(i.keyPanSpeed,0),ue=!0;break;case i.keys.RIGHT:O(-i.keyPanSpeed,0),ue=!0;break}ue&&(F.preventDefault(),i.update())}function he(){if(T.length===1)d.set(T[0].pageX,T[0].pageY);else{const F=.5*(T[0].pageX+T[1].pageX),ue=.5*(T[0].pageY+T[1].pageY);d.set(F,ue)}}function ve(){if(T.length===1)_.set(T[0].pageX,T[0].pageY);else{const F=.5*(T[0].pageX+T[1].pageX),ue=.5*(T[0].pageY+T[1].pageY);_.set(F,ue)}}function $(){const F=T[0].pageX-T[1].pageX,ue=T[0].pageY-T[1].pageY,He=Math.sqrt(F*F+ue*ue);g.set(0,He)}function xe(){i.enableZoom&&$(),i.enablePan&&ve()}function Me(){i.enableZoom&&$(),i.enableRotate&&he()}function ye(F){if(T.length==1)f.set(F.pageX,F.pageY);else{const He=le(F),ke=.5*(F.pageX+He.x),Tt=.5*(F.pageY+He.y);f.set(ke,Tt)}p.subVectors(f,d).multiplyScalar(i.rotateSpeed);const ue=i.domElement;N(2*Math.PI*p.x/ue.clientHeight),P(2*Math.PI*p.y/ue.clientHeight),d.copy(f)}function _e(F){if(T.length===1)y.set(F.pageX,F.pageY);else{const ue=le(F),He=.5*(F.pageX+ue.x),ke=.5*(F.pageY+ue.y);y.set(He,ke)}m.subVectors(y,_).multiplyScalar(i.panSpeed),O(m.x,m.y),_.copy(y)}function Ie(F){const ue=le(F),He=F.pageX-ue.x,ke=F.pageY-ue.y,Tt=Math.sqrt(He*He+ke*ke);v.set(0,Tt),x.set(0,Math.pow(v.y/g.y,i.zoomSpeed)),H(x.y),g.copy(v)}function Z(F){i.enableZoom&&Ie(F),i.enablePan&&_e(F)}function A(F){i.enableZoom&&Ie(F),i.enableRotate&&ye(F)}function R(F){i.enabled!==!1&&(T.length===0&&(i.domElement.setPointerCapture(F.pointerId),i.domElement.addEventListener("pointermove",B),i.domElement.addEventListener("pointerup",z)),D(F),F.pointerType==="touch"?re(F):w(F))}function B(F){i.enabled!==!1&&(F.pointerType==="touch"?ee(F):k(F))}function z(F){i.enabled!==!1&&(F.pointerType==="touch"?oe():U(),ae(F),T.length===0&&(i.domElement.releasePointerCapture(F.pointerId),i.domElement.removeEventListener("pointermove",B),i.domElement.removeEventListener("pointerup",z)))}function E(F){ae(F)}function w(F){let ue;switch(F.button){case 0:ue=i.mouseButtons.LEFT;break;case 1:ue=i.mouseButtons.MIDDLE;break;case 2:ue=i.mouseButtons.RIGHT;break;default:ue=-1}switch(ue){case Wo.DOLLY:if(i.enableZoom===!1)return;Y(F),r=s.DOLLY;break;case Wo.ROTATE:if(F.ctrlKey||F.metaKey||F.shiftKey){if(i.enablePan===!1)return;te(F),r=s.PAN}else{if(i.enableRotate===!1)return;q(F),r=s.ROTATE}break;case Wo.PAN:if(F.ctrlKey||F.metaKey||F.shiftKey){if(i.enableRotate===!1)return;q(F),r=s.ROTATE}else{if(i.enablePan===!1)return;te(F),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(Qg)}function k(F){if(i.enabled!==!1)switch(r){case s.ROTATE:if(i.enableRotate===!1)return;me(F);break;case s.DOLLY:if(i.enableZoom===!1)return;we(F);break;case s.PAN:if(i.enablePan===!1)return;pe(F);break}}function U(F){i.dispatchEvent(Kg),r=s.NONE}function X(F){i.enabled===!1||i.enableZoom===!1||r!==s.NONE&&r!==s.ROTATE||(F.preventDefault(),i.dispatchEvent(Qg),Se(F),i.dispatchEvent(Kg))}function W(F){i.enabled===!1||i.enablePan===!1||ne(F)}function re(F){switch(K(F),T.length){case 1:switch(i.touches.ONE){case Xo.ROTATE:if(i.enableRotate===!1)return;he(),r=s.TOUCH_ROTATE;break;case Xo.PAN:if(i.enablePan===!1)return;ve(),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(i.touches.TWO){case Xo.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;xe(),r=s.TOUCH_DOLLY_PAN;break;case Xo.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Me(),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(Qg)}function ee(F){switch(K(F),r){case s.TOUCH_ROTATE:if(i.enableRotate===!1)return;ye(F),i.update();break;case s.TOUCH_PAN:if(i.enablePan===!1)return;_e(F),i.update();break;case s.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Z(F),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;A(F),i.update();break;default:r=s.NONE}}function oe(F){i.dispatchEvent(Kg),r=s.NONE}function se(F){i.enabled!==!1&&F.preventDefault()}function D(F){T.push(F)}function ae(F){delete S[F.pointerId];for(let ue=0;ue<T.length;ue++)if(T[ue].pointerId==F.pointerId){T.splice(ue,1);return}}function K(F){let ue=S[F.pointerId];ue===void 0&&(ue=new ie,S[F.pointerId]=ue),ue.set(F.pageX,F.pageY)}function le(F){const ue=F.pointerId===T[0].pointerId?T[1]:T[0];return S[ue.pointerId]}i.domElement.addEventListener("contextmenu",se),i.domElement.addEventListener("pointerdown",R),i.domElement.addEventListener("pointercancel",E),i.domElement.addEventListener("wheel",X,{passive:!1}),this.update()}}var Jg={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;

		}`};class Md{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const UU=new ar(-1,1,1,-1,0,1),Zg=new nt;Zg.setAttribute("position",new lt([-1,3,0,-1,-1,0,3,-1,0],3));Zg.setAttribute("uv",new lt([0,2,0,0,2,0],2));class BU{constructor(e){this._mesh=new Vt(Zg,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,UU)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class qi extends Md{constructor(e,t){super();this.textureID=t!==void 0?t:"tDiffuse",e instanceof Cn?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=fa.clone(e.uniforms),this.material=new Cn({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new BU(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class PS extends Md{constructor(e,t){super();this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const s=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),r.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),r.buffers.stencil.setClear(a),r.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(s.EQUAL,1,4294967295),r.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),r.buffers.stencil.setLocked(!0)}}class HU extends Md{constructor(){super();this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class zU{constructor(e,t){if(this.renderer=e,t===void 0){const i={minFilter:$t,magFilter:$t,format:_n},s=e.getSize(new ie);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,t=new Dn(this._width*this._pixelRatio,this._height*this._pixelRatio,i),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],Jg===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),qi===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new qi(Jg),this.clock=new mS}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let s=0,r=this.passes.length;s<r;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}PS!==void 0&&(o instanceof PS?i=!0:o instanceof HU&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new ie);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(i,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}new ar(-1,1,1,-1,0,1);const NS=new nt;NS.setAttribute("position",new lt([-1,3,0,-1,-1,0,3,-1,0],3));NS.setAttribute("uv",new lt([0,2,0,0,2,0],2));class VU extends Md{constructor(e,t,i,s,r){super();this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=r!==void 0?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new ge}render(e,t,i){const s=e.autoClear;e.autoClear=!1;let r,o;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=s}}class GU{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const WU=new ar(-1,1,1,-1,0,1),e_=new nt;e_.setAttribute("position",new lt([-1,3,0,-1,-1,0,3,-1,0],3));e_.setAttribute("uv",new lt([0,2,0,0,2,0],2));class XU{constructor(e){this._mesh=new Vt(e_,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,WU)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}var FS={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;

		}`};const DS={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new ge(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			vec3 luma = vec3( 0.299, 0.587, 0.114 );

			float v = dot( texel.xyz, luma );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class Oa extends GU{constructor(e,t,i,s){super();this.strength=t!==void 0?t:1,this.radius=i,this.threshold=s,this.resolution=e!==void 0?new ie(e.x,e.y):new ie(256,256),this.clearColor=new ge(0,0,0);const r={minFilter:$t,magFilter:$t,format:_n};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new Dn(o,a,r),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let d=0;d<this.nMips;d++){const f=new Dn(o,a,r);f.texture.name="UnrealBloomPass.h"+d,f.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(f);const p=new Dn(o,a,r);p.texture.name="UnrealBloomPass.v"+d,p.texture.generateMipmaps=!1,this.renderTargetsVertical.push(p),o=Math.round(o/2),a=Math.round(a/2)}DS===void 0&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const l=DS;this.highPassUniforms=fa.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Cn({uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const c=[3,5,7,9,11];o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let d=0;d<this.nMips;d++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[d])),this.separableBlurMaterials[d].uniforms.texSize.value=new ie(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const h=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=h,this.bloomTintColors=[new C(1,1,1),new C(1,1,1),new C(1,1,1),new C(1,1,1),new C(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,FS===void 0&&console.error("THREE.UnrealBloomPass relies on CopyShader");const u=FS;this.copyUniforms=fa.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Cn({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:Sm,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new ge,this.oldClearAlpha=1,this.basic=new li,this.fsQuad=new XU(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let i=Math.round(e/2),s=Math.round(t/2);this.renderTargetBright.setSize(i,s);for(let r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(i,s),this.renderTargetsVertical[r].setSize(i,s),this.separableBlurMaterials[r].uniforms.texSize.value=new ie(i,s),i=Math.round(i/2),s=Math.round(s/2)}render(e,t,i,s,r){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),r&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let a=this.renderTargetBright;for(let l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[l].uniforms.direction.value=Oa.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[l]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[l].uniforms.colorTexture.value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms.direction.value=Oa.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[l]),e.clear(),this.fsQuad.render(e),a=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}getSeperableBlurMaterial(e){return new Cn({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new ie(.5,.5)},direction:{value:new ie(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					float alphaSum = 0.0;
					vec3 diffuseSum = texture2D(colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ )
					{
						float x = float(i);
						float weight = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;

						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						float weightAlpha = sample1.a * weight;
						diffuseSum += sample1.rgb * weightAlpha;
						alphaSum += weightAlpha;
						weightSum += weight;

						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						weightAlpha = sample2.a * weight;
						diffuseSum += sample2.rgb * weightAlpha;
						alphaSum += weightAlpha;
						weightSum += weight;

					}
					alphaSum /= weightSum;
					diffuseSum /= alphaSum; // Should apply discard here if alphaSum is 0
					gl_FragColor = vec4(diffuseSum.rgb, alphaSum);
				}`})}getCompositeMaterial(e){return new Cn({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform sampler2D dirtTexture;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}Oa.BlurDirectionX=new ie(1,0);Oa.BlurDirectionY=new ie(0,1);const qU={uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float hue;
		uniform float saturation;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// hue
			float angle = hue * 3.14159265;
			float s = sin(angle), c = cos(angle);
			vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;
			float len = length(gl_FragColor.rgb);
			gl_FragColor.rgb = vec3(
				dot(gl_FragColor.rgb, weights.xyz),
				dot(gl_FragColor.rgb, weights.zxy),
				dot(gl_FragColor.rgb, weights.yzx)
			);

			// saturation
			float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;
			if (saturation > 0.0) {
				gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));
			} else {
				gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);
			}

		}`},YU={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float brightness;
		uniform float contrast;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			gl_FragColor.rgb += brightness;

			if (contrast > 0.0) {
				gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;
			} else {
				gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;
			}

		}`},jU={uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			gl_FragColor = LinearTosRGB( tex ); // optional: LinearToGamma( tex, float( GAMMA_FACTOR ) );

		}`},$U={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float offset;
		uniform float darkness;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			// Eskil's vignette

			vec4 texel = texture2D( tDiffuse, vUv );
			vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );
			gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );

		}`},QU={uniforms:{tDiffuse:{value:null},powRGB:{value:new C(2,2,2)},mulRGB:{value:new C(1,1,1)},addRGB:{value:new C(0,0,0)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 powRGB;
		uniform vec3 mulRGB;
		uniform vec3 addRGB;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );

		}`},KU={uniforms:{tDiffuse:{value:null},amount:{value:.005},angle:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float amount;
		uniform float angle;

		varying vec2 vUv;

		void main() {

			vec2 offset = amount * vec2( cos(angle), sin(angle));
			vec4 cr = texture2D(tDiffuse, vUv + offset);
			vec4 cga = texture2D(tDiffuse, vUv);
			vec4 cb = texture2D(tDiffuse, vUv - offset);
			gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);

		}`},JU={uniforms:{tDiffuse:{value:null},resolution:{value:new ie(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D tDiffuse;

		uniform vec2 resolution;

		varying vec2 vUv;

		#define FXAA_PC 1
		#define FXAA_GLSL_100 1
		#define FXAA_QUALITY_PRESET 12

		#define FXAA_GREEN_AS_LUMA 1

		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_PC_CONSOLE
				//
				// The console algorithm for PC is included
				// for developers targeting really low spec machines.
				// Likely better to just run FXAA_PC, and use a really low preset.
				//
				#define FXAA_PC_CONSOLE 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_GLSL_120
				#define FXAA_GLSL_120 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_GLSL_130
				#define FXAA_GLSL_130 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_HLSL_3
				#define FXAA_HLSL_3 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_HLSL_4
				#define FXAA_HLSL_4 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_HLSL_5
				#define FXAA_HLSL_5 0
		#endif
		/*==========================================================================*/
		#ifndef FXAA_GREEN_AS_LUMA
				//
				// For those using non-linear color,
				// and either not able to get luma in alpha, or not wanting to,
				// this enables FXAA to run using green as a proxy for luma.
				// So with this enabled, no need to pack luma in alpha.
				//
				// This will turn off AA on anything which lacks some amount of green.
				// Pure red and blue or combination of only R and B, will get no AA.
				//
				// Might want to lower the settings for both,
				//		fxaaConsoleEdgeThresholdMin
				//		fxaaQualityEdgeThresholdMin
				// In order to insure AA does not get turned off on colors
				// which contain a minor amount of green.
				//
				// 1 = On.
				// 0 = Off.
				//
				#define FXAA_GREEN_AS_LUMA 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_EARLY_EXIT
				//
				// Controls algorithm's early exit path.
				// On PS3 turning this ON adds 2 cycles to the shader.
				// On 360 turning this OFF adds 10ths of a millisecond to the shader.
				// Turning this off on console will result in a more blurry image.
				// So this defaults to on.
				//
				// 1 = On.
				// 0 = Off.
				//
				#define FXAA_EARLY_EXIT 1
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_DISCARD
				//
				// Only valid for PC OpenGL currently.
				// Probably will not work when FXAA_GREEN_AS_LUMA = 1.
				//
				// 1 = Use discard on pixels which don't need AA.
				//		 For APIs which enable concurrent TEX+ROP from same surface.
				// 0 = Return unchanged color on pixels which don't need AA.
				//
				#define FXAA_DISCARD 0
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_FAST_PIXEL_OFFSET
				//
				// Used for GLSL 120 only.
				//
				// 1 = GL API supports fast pixel offsets
				// 0 = do not use fast pixel offsets
				//
				#ifdef GL_EXT_gpu_shader4
						#define FXAA_FAST_PIXEL_OFFSET 1
				#endif
				#ifdef GL_NV_gpu_shader5
						#define FXAA_FAST_PIXEL_OFFSET 1
				#endif
				#ifdef GL_ARB_gpu_shader5
						#define FXAA_FAST_PIXEL_OFFSET 1
				#endif
				#ifndef FXAA_FAST_PIXEL_OFFSET
						#define FXAA_FAST_PIXEL_OFFSET 0
				#endif
		#endif
		/*--------------------------------------------------------------------------*/
		#ifndef FXAA_GATHER4_ALPHA
				//
				// 1 = API supports gather4 on alpha channel.
				// 0 = API does not support gather4 on alpha channel.
				//
				#if (FXAA_HLSL_5 == 1)
						#define FXAA_GATHER4_ALPHA 1
				#endif
				#ifdef GL_ARB_gpu_shader5
						#define FXAA_GATHER4_ALPHA 1
				#endif
				#ifdef GL_NV_gpu_shader5
						#define FXAA_GATHER4_ALPHA 1
				#endif
				#ifndef FXAA_GATHER4_ALPHA
						#define FXAA_GATHER4_ALPHA 0
				#endif
		#endif


		/*============================================================================
														FXAA QUALITY - TUNING KNOBS
		------------------------------------------------------------------------------
		NOTE the other tuning knobs are now in the shader function inputs!
		============================================================================*/
		#ifndef FXAA_QUALITY_PRESET
				//
				// Choose the quality preset.
				// This needs to be compiled into the shader as it effects code.
				// Best option to include multiple presets is to
				// in each shader define the preset, then include this file.
				//
				// OPTIONS
				// -----------------------------------------------------------------------
				// 10 to 15 - default medium dither (10=fastest, 15=highest quality)
				// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)
				// 39			 - no dither, very expensive
				//
				// NOTES
				// -----------------------------------------------------------------------
				// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)
				// 13 = about same speed as FXAA 3.9 and better than 12
				// 23 = closest to FXAA 3.9 visually and performance wise
				//	_ = the lowest digit is directly related to performance
				// _	= the highest digit is directly related to style
				//
				#define FXAA_QUALITY_PRESET 12
		#endif


		/*============================================================================

															 FXAA QUALITY - PRESETS

		============================================================================*/

		/*============================================================================
												 FXAA QUALITY - MEDIUM DITHER PRESETS
		============================================================================*/
		#if (FXAA_QUALITY_PRESET == 10)
				#define FXAA_QUALITY_PS 3
				#define FXAA_QUALITY_P0 1.5
				#define FXAA_QUALITY_P1 3.0
				#define FXAA_QUALITY_P2 12.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 11)
				#define FXAA_QUALITY_PS 4
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 3.0
				#define FXAA_QUALITY_P3 12.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 12)
				#define FXAA_QUALITY_PS 5
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 4.0
				#define FXAA_QUALITY_P4 12.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 13)
				#define FXAA_QUALITY_PS 6
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 4.0
				#define FXAA_QUALITY_P5 12.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 14)
				#define FXAA_QUALITY_PS 7
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 4.0
				#define FXAA_QUALITY_P6 12.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 15)
				#define FXAA_QUALITY_PS 8
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 4.0
				#define FXAA_QUALITY_P7 12.0
		#endif

		/*============================================================================
												 FXAA QUALITY - LOW DITHER PRESETS
		============================================================================*/
		#if (FXAA_QUALITY_PRESET == 20)
				#define FXAA_QUALITY_PS 3
				#define FXAA_QUALITY_P0 1.5
				#define FXAA_QUALITY_P1 2.0
				#define FXAA_QUALITY_P2 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 21)
				#define FXAA_QUALITY_PS 4
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 22)
				#define FXAA_QUALITY_PS 5
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 23)
				#define FXAA_QUALITY_PS 6
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 24)
				#define FXAA_QUALITY_PS 7
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 3.0
				#define FXAA_QUALITY_P6 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 25)
				#define FXAA_QUALITY_PS 8
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 4.0
				#define FXAA_QUALITY_P7 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 26)
				#define FXAA_QUALITY_PS 9
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 2.0
				#define FXAA_QUALITY_P7 4.0
				#define FXAA_QUALITY_P8 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 27)
				#define FXAA_QUALITY_PS 10
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 2.0
				#define FXAA_QUALITY_P7 2.0
				#define FXAA_QUALITY_P8 4.0
				#define FXAA_QUALITY_P9 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 28)
				#define FXAA_QUALITY_PS 11
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 2.0
				#define FXAA_QUALITY_P7 2.0
				#define FXAA_QUALITY_P8 2.0
				#define FXAA_QUALITY_P9 4.0
				#define FXAA_QUALITY_P10 8.0
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_QUALITY_PRESET == 29)
				#define FXAA_QUALITY_PS 12
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.5
				#define FXAA_QUALITY_P2 2.0
				#define FXAA_QUALITY_P3 2.0
				#define FXAA_QUALITY_P4 2.0
				#define FXAA_QUALITY_P5 2.0
				#define FXAA_QUALITY_P6 2.0
				#define FXAA_QUALITY_P7 2.0
				#define FXAA_QUALITY_P8 2.0
				#define FXAA_QUALITY_P9 2.0
				#define FXAA_QUALITY_P10 4.0
				#define FXAA_QUALITY_P11 8.0
		#endif

		/*============================================================================
												 FXAA QUALITY - EXTREME QUALITY
		============================================================================*/
		#if (FXAA_QUALITY_PRESET == 39)
				#define FXAA_QUALITY_PS 12
				#define FXAA_QUALITY_P0 1.0
				#define FXAA_QUALITY_P1 1.0
				#define FXAA_QUALITY_P2 1.0
				#define FXAA_QUALITY_P3 1.0
				#define FXAA_QUALITY_P4 1.0
				#define FXAA_QUALITY_P5 1.5
				#define FXAA_QUALITY_P6 2.0
				#define FXAA_QUALITY_P7 2.0
				#define FXAA_QUALITY_P8 2.0
				#define FXAA_QUALITY_P9 2.0
				#define FXAA_QUALITY_P10 4.0
				#define FXAA_QUALITY_P11 8.0
		#endif



		/*============================================================================

																		API PORTING

		============================================================================*/
		#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)
				#define FxaaBool bool
				#define FxaaDiscard discard
				#define FxaaFloat float
				#define FxaaFloat2 vec2
				#define FxaaFloat3 vec3
				#define FxaaFloat4 vec4
				#define FxaaHalf float
				#define FxaaHalf2 vec2
				#define FxaaHalf3 vec3
				#define FxaaHalf4 vec4
				#define FxaaInt2 ivec2
				#define FxaaSat(x) clamp(x, 0.0, 1.0)
				#define FxaaTex sampler2D
		#else
				#define FxaaBool bool
				#define FxaaDiscard clip(-1)
				#define FxaaFloat float
				#define FxaaFloat2 float2
				#define FxaaFloat3 float3
				#define FxaaFloat4 float4
				#define FxaaHalf half
				#define FxaaHalf2 half2
				#define FxaaHalf3 half3
				#define FxaaHalf4 half4
				#define FxaaSat(x) saturate(x)
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_GLSL_100 == 1)
			#define FxaaTexTop(t, p) texture2D(t, p, 0.0)
			#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_GLSL_120 == 1)
				// Requires,
				//	#version 120
				// And at least,
				//	#extension GL_EXT_gpu_shader4 : enable
				//	(or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)
				#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)
				#if (FXAA_FAST_PIXEL_OFFSET == 1)
						#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)
				#else
						#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)
				#endif
				#if (FXAA_GATHER4_ALPHA == 1)
						// use #extension GL_ARB_gpu_shader5 : enable
						#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)
						#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)
						#define FxaaTexGreen4(t, p) textureGather(t, p, 1)
						#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)
				#endif
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_GLSL_130 == 1)
				// Requires "#version 130" or better
				#define FxaaTexTop(t, p) textureLod(t, p, 0.0)
				#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)
				#if (FXAA_GATHER4_ALPHA == 1)
						// use #extension GL_ARB_gpu_shader5 : enable
						#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)
						#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)
						#define FxaaTexGreen4(t, p) textureGather(t, p, 1)
						#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)
				#endif
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_HLSL_3 == 1)
				#define FxaaInt2 float2
				#define FxaaTex sampler2D
				#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))
				#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_HLSL_4 == 1)
				#define FxaaInt2 int2
				struct FxaaTex { SamplerState smpl; Texture2D tex; };
				#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)
				#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)
		#endif
		/*--------------------------------------------------------------------------*/
		#if (FXAA_HLSL_5 == 1)
				#define FxaaInt2 int2
				struct FxaaTex { SamplerState smpl; Texture2D tex; };
				#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)
				#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)
				#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)
				#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)
				#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)
				#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)
		#endif


		/*============================================================================
											 GREEN AS LUMA OPTION SUPPORT FUNCTION
		============================================================================*/
		#if (FXAA_GREEN_AS_LUMA == 0)
				FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }
		#else
				FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }
		#endif




		/*============================================================================

																 FXAA3 QUALITY - PC

		============================================================================*/
		#if (FXAA_PC == 1)
		/*--------------------------------------------------------------------------*/
		FxaaFloat4 FxaaPixelShader(
				//
				// Use noperspective interpolation here (turn off perspective interpolation).
				// {xy} = center of pixel
				FxaaFloat2 pos,
				//
				// Used only for FXAA Console, and not used on the 360 version.
				// Use noperspective interpolation here (turn off perspective interpolation).
				// {xy_} = upper left of pixel
				// {_zw} = lower right of pixel
				FxaaFloat4 fxaaConsolePosPos,
				//
				// Input color texture.
				// {rgb_} = color in linear or perceptual color space
				// if (FXAA_GREEN_AS_LUMA == 0)
				//		 {__a} = luma in perceptual color space (not linear)
				FxaaTex tex,
				//
				// Only used on the optimized 360 version of FXAA Console.
				// For everything but 360, just use the same input here as for "tex".
				// For 360, same texture, just alias with a 2nd sampler.
				// This sampler needs to have an exponent bias of -1.
				FxaaTex fxaaConsole360TexExpBiasNegOne,
				//
				// Only used on the optimized 360 version of FXAA Console.
				// For everything but 360, just use the same input here as for "tex".
				// For 360, same texture, just alias with a 3nd sampler.
				// This sampler needs to have an exponent bias of -2.
				FxaaTex fxaaConsole360TexExpBiasNegTwo,
				//
				// Only used on FXAA Quality.
				// This must be from a constant/uniform.
				// {x_} = 1.0/screenWidthInPixels
				// {_y} = 1.0/screenHeightInPixels
				FxaaFloat2 fxaaQualityRcpFrame,
				//
				// Only used on FXAA Console.
				// This must be from a constant/uniform.
				// This effects sub-pixel AA quality and inversely sharpness.
				//	 Where N ranges between,
				//		 N = 0.50 (default)
				//		 N = 0.33 (sharper)
				// {x__} = -N/screenWidthInPixels
				// {_y_} = -N/screenHeightInPixels
				// {_z_} =	N/screenWidthInPixels
				// {__w} =	N/screenHeightInPixels
				FxaaFloat4 fxaaConsoleRcpFrameOpt,
				//
				// Only used on FXAA Console.
				// Not used on 360, but used on PS3 and PC.
				// This must be from a constant/uniform.
				// {x__} = -2.0/screenWidthInPixels
				// {_y_} = -2.0/screenHeightInPixels
				// {_z_} =	2.0/screenWidthInPixels
				// {__w} =	2.0/screenHeightInPixels
				FxaaFloat4 fxaaConsoleRcpFrameOpt2,
				//
				// Only used on FXAA Console.
				// Only used on 360 in place of fxaaConsoleRcpFrameOpt2.
				// This must be from a constant/uniform.
				// {x__} =	8.0/screenWidthInPixels
				// {_y_} =	8.0/screenHeightInPixels
				// {_z_} = -4.0/screenWidthInPixels
				// {__w} = -4.0/screenHeightInPixels
				FxaaFloat4 fxaaConsole360RcpFrameOpt2,
				//
				// Only used on FXAA Quality.
				// This used to be the FXAA_QUALITY_SUBPIX define.
				// It is here now to allow easier tuning.
				// Choose the amount of sub-pixel aliasing removal.
				// This can effect sharpness.
				//	 1.00 - upper limit (softer)
				//	 0.75 - default amount of filtering
				//	 0.50 - lower limit (sharper, less sub-pixel aliasing removal)
				//	 0.25 - almost off
				//	 0.00 - completely off
				FxaaFloat fxaaQualitySubpix,
				//
				// Only used on FXAA Quality.
				// This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.
				// It is here now to allow easier tuning.
				// The minimum amount of local contrast required to apply algorithm.
				//	 0.333 - too little (faster)
				//	 0.250 - low quality
				//	 0.166 - default
				//	 0.125 - high quality
				//	 0.063 - overkill (slower)
				FxaaFloat fxaaQualityEdgeThreshold,
				//
				// Only used on FXAA Quality.
				// This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.
				// It is here now to allow easier tuning.
				// Trims the algorithm from processing darks.
				//	 0.0833 - upper limit (default, the start of visible unfiltered edges)
				//	 0.0625 - high quality (faster)
				//	 0.0312 - visible limit (slower)
				// Special notes when using FXAA_GREEN_AS_LUMA,
				//	 Likely want to set this to zero.
				//	 As colors that are mostly not-green
				//	 will appear very dark in the green channel!
				//	 Tune by looking at mostly non-green content,
				//	 then start at zero and increase until aliasing is a problem.
				FxaaFloat fxaaQualityEdgeThresholdMin,
				//
				// Only used on FXAA Console.
				// This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.
				// It is here now to allow easier tuning.
				// This does not effect PS3, as this needs to be compiled in.
				//	 Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.
				//	 Due to the PS3 being ALU bound,
				//	 there are only three safe values here: 2 and 4 and 8.
				//	 These options use the shaders ability to a free *|/ by 2|4|8.
				// For all other platforms can be a non-power of two.
				//	 8.0 is sharper (default!!!)
				//	 4.0 is softer
				//	 2.0 is really soft (good only for vector graphics inputs)
				FxaaFloat fxaaConsoleEdgeSharpness,
				//
				// Only used on FXAA Console.
				// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.
				// It is here now to allow easier tuning.
				// This does not effect PS3, as this needs to be compiled in.
				//	 Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.
				//	 Due to the PS3 being ALU bound,
				//	 there are only two safe values here: 1/4 and 1/8.
				//	 These options use the shaders ability to a free *|/ by 2|4|8.
				// The console setting has a different mapping than the quality setting.
				// Other platforms can use other values.
				//	 0.125 leaves less aliasing, but is softer (default!!!)
				//	 0.25 leaves more aliasing, and is sharper
				FxaaFloat fxaaConsoleEdgeThreshold,
				//
				// Only used on FXAA Console.
				// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.
				// It is here now to allow easier tuning.
				// Trims the algorithm from processing darks.
				// The console setting has a different mapping than the quality setting.
				// This only applies when FXAA_EARLY_EXIT is 1.
				// This does not apply to PS3,
				// PS3 was simplified to avoid more shader instructions.
				//	 0.06 - faster but more aliasing in darks
				//	 0.05 - default
				//	 0.04 - slower and less aliasing in darks
				// Special notes when using FXAA_GREEN_AS_LUMA,
				//	 Likely want to set this to zero.
				//	 As colors that are mostly not-green
				//	 will appear very dark in the green channel!
				//	 Tune by looking at mostly non-green content,
				//	 then start at zero and increase until aliasing is a problem.
				FxaaFloat fxaaConsoleEdgeThresholdMin,
				//
				// Extra constants for 360 FXAA Console only.
				// Use zeros or anything else for other platforms.
				// These must be in physical constant registers and NOT immediates.
				// Immediates will result in compiler un-optimizing.
				// {xyzw} = float4(1.0, -1.0, 0.25, -0.25)
				FxaaFloat4 fxaaConsole360ConstDir
		) {
		/*--------------------------------------------------------------------------*/
				FxaaFloat2 posM;
				posM.x = pos.x;
				posM.y = pos.y;
				#if (FXAA_GATHER4_ALPHA == 1)
						#if (FXAA_DISCARD == 0)
								FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);
								#if (FXAA_GREEN_AS_LUMA == 0)
										#define lumaM rgbyM.w
								#else
										#define lumaM rgbyM.y
								#endif
						#endif
						#if (FXAA_GREEN_AS_LUMA == 0)
								FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);
								FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));
						#else
								FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);
								FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));
						#endif
						#if (FXAA_DISCARD == 1)
								#define lumaM luma4A.w
						#endif
						#define lumaE luma4A.z
						#define lumaS luma4A.x
						#define lumaSE luma4A.y
						#define lumaNW luma4B.w
						#define lumaN luma4B.z
						#define lumaW luma4B.x
				#else
						FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);
						#if (FXAA_GREEN_AS_LUMA == 0)
								#define lumaM rgbyM.w
						#else
								#define lumaM rgbyM.y
						#endif
						#if (FXAA_GLSL_100 == 1)
							FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));
						#else
							FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));
						#endif
				#endif
		/*--------------------------------------------------------------------------*/
				FxaaFloat maxSM = max(lumaS, lumaM);
				FxaaFloat minSM = min(lumaS, lumaM);
				FxaaFloat maxESM = max(lumaE, maxSM);
				FxaaFloat minESM = min(lumaE, minSM);
				FxaaFloat maxWN = max(lumaN, lumaW);
				FxaaFloat minWN = min(lumaN, lumaW);
				FxaaFloat rangeMax = max(maxWN, maxESM);
				FxaaFloat rangeMin = min(minWN, minESM);
				FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;
				FxaaFloat range = rangeMax - rangeMin;
				FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);
				FxaaBool earlyExit = range < rangeMaxClamped;
		/*--------------------------------------------------------------------------*/
				if(earlyExit)
						#if (FXAA_DISCARD == 1)
								FxaaDiscard;
						#else
								return rgbyM;
						#endif
		/*--------------------------------------------------------------------------*/
				#if (FXAA_GATHER4_ALPHA == 0)
						#if (FXAA_GLSL_100 == 1)
							FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));
						#else
							FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));
							FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));
						#endif
				#else
						FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));
						FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));
				#endif
		/*--------------------------------------------------------------------------*/
				FxaaFloat lumaNS = lumaN + lumaS;
				FxaaFloat lumaWE = lumaW + lumaE;
				FxaaFloat subpixRcpRange = 1.0/range;
				FxaaFloat subpixNSWE = lumaNS + lumaWE;
				FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;
				FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;
		/*--------------------------------------------------------------------------*/
				FxaaFloat lumaNESE = lumaNE + lumaSE;
				FxaaFloat lumaNWNE = lumaNW + lumaNE;
				FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;
				FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;
		/*--------------------------------------------------------------------------*/
				FxaaFloat lumaNWSW = lumaNW + lumaSW;
				FxaaFloat lumaSWSE = lumaSW + lumaSE;
				FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);
				FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);
				FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;
				FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;
				FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;
				FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;
		/*--------------------------------------------------------------------------*/
				FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;
				FxaaFloat lengthSign = fxaaQualityRcpFrame.x;
				FxaaBool horzSpan = edgeHorz >= edgeVert;
				FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;
		/*--------------------------------------------------------------------------*/
				if(!horzSpan) lumaN = lumaW;
				if(!horzSpan) lumaS = lumaE;
				if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;
				FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;
		/*--------------------------------------------------------------------------*/
				FxaaFloat gradientN = lumaN - lumaM;
				FxaaFloat gradientS = lumaS - lumaM;
				FxaaFloat lumaNN = lumaN + lumaM;
				FxaaFloat lumaSS = lumaS + lumaM;
				FxaaBool pairN = abs(gradientN) >= abs(gradientS);
				FxaaFloat gradient = max(abs(gradientN), abs(gradientS));
				if(pairN) lengthSign = -lengthSign;
				FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);
		/*--------------------------------------------------------------------------*/
				FxaaFloat2 posB;
				posB.x = posM.x;
				posB.y = posM.y;
				FxaaFloat2 offNP;
				offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
				offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;
				if(!horzSpan) posB.x += lengthSign * 0.5;
				if( horzSpan) posB.y += lengthSign * 0.5;
		/*--------------------------------------------------------------------------*/
				FxaaFloat2 posN;
				posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;
				posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;
				FxaaFloat2 posP;
				posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;
				posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;
				FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;
				FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));
				FxaaFloat subpixE = subpixC * subpixC;
				FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));
		/*--------------------------------------------------------------------------*/
				if(!pairN) lumaNN = lumaSS;
				FxaaFloat gradientScaled = gradient * 1.0/4.0;
				FxaaFloat lumaMM = lumaM - lumaNN * 0.5;
				FxaaFloat subpixF = subpixD * subpixE;
				FxaaBool lumaMLTZero = lumaMM < 0.0;
		/*--------------------------------------------------------------------------*/
				lumaEndN -= lumaNN * 0.5;
				lumaEndP -= lumaNN * 0.5;
				FxaaBool doneN = abs(lumaEndN) >= gradientScaled;
				FxaaBool doneP = abs(lumaEndP) >= gradientScaled;
				if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;
				if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;
				FxaaBool doneNP = (!doneN) || (!doneP);
				if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;
				if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;
		/*--------------------------------------------------------------------------*/
				if(doneNP) {
						if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
						if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
						if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
						if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
						doneN = abs(lumaEndN) >= gradientScaled;
						doneP = abs(lumaEndP) >= gradientScaled;
						if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;
						if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;
						doneNP = (!doneN) || (!doneP);
						if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;
						if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;
		/*--------------------------------------------------------------------------*/
						#if (FXAA_QUALITY_PS > 3)
						if(doneNP) {
								if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
								if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
								if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
								if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
								doneN = abs(lumaEndN) >= gradientScaled;
								doneP = abs(lumaEndP) >= gradientScaled;
								if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;
								if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;
								doneNP = (!doneN) || (!doneP);
								if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;
								if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;
		/*--------------------------------------------------------------------------*/
								#if (FXAA_QUALITY_PS > 4)
								if(doneNP) {
										if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
										if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
										if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
										if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
										doneN = abs(lumaEndN) >= gradientScaled;
										doneP = abs(lumaEndP) >= gradientScaled;
										if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;
										if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;
										doneNP = (!doneN) || (!doneP);
										if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;
										if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;
		/*--------------------------------------------------------------------------*/
										#if (FXAA_QUALITY_PS > 5)
										if(doneNP) {
												if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
												if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
												if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
												if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
												doneN = abs(lumaEndN) >= gradientScaled;
												doneP = abs(lumaEndP) >= gradientScaled;
												if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;
												if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;
												doneNP = (!doneN) || (!doneP);
												if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;
												if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;
		/*--------------------------------------------------------------------------*/
												#if (FXAA_QUALITY_PS > 6)
												if(doneNP) {
														if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
														if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
														if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
														if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
														doneN = abs(lumaEndN) >= gradientScaled;
														doneP = abs(lumaEndP) >= gradientScaled;
														if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;
														if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;
														doneNP = (!doneN) || (!doneP);
														if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;
														if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;
		/*--------------------------------------------------------------------------*/
														#if (FXAA_QUALITY_PS > 7)
														if(doneNP) {
																if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
																if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
																if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
																if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
																doneN = abs(lumaEndN) >= gradientScaled;
																doneP = abs(lumaEndP) >= gradientScaled;
																if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;
																if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;
																doneNP = (!doneN) || (!doneP);
																if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;
																if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;
		/*--------------------------------------------------------------------------*/
				#if (FXAA_QUALITY_PS > 8)
				if(doneNP) {
						if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
						if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
						if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
						if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
						doneN = abs(lumaEndN) >= gradientScaled;
						doneP = abs(lumaEndP) >= gradientScaled;
						if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;
						if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;
						doneNP = (!doneN) || (!doneP);
						if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;
						if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;
		/*--------------------------------------------------------------------------*/
						#if (FXAA_QUALITY_PS > 9)
						if(doneNP) {
								if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
								if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
								if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
								if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
								doneN = abs(lumaEndN) >= gradientScaled;
								doneP = abs(lumaEndP) >= gradientScaled;
								if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;
								if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;
								doneNP = (!doneN) || (!doneP);
								if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;
								if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;
		/*--------------------------------------------------------------------------*/
								#if (FXAA_QUALITY_PS > 10)
								if(doneNP) {
										if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
										if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
										if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
										if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
										doneN = abs(lumaEndN) >= gradientScaled;
										doneP = abs(lumaEndP) >= gradientScaled;
										if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;
										if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;
										doneNP = (!doneN) || (!doneP);
										if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;
										if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;
		/*--------------------------------------------------------------------------*/
										#if (FXAA_QUALITY_PS > 11)
										if(doneNP) {
												if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
												if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
												if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
												if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
												doneN = abs(lumaEndN) >= gradientScaled;
												doneP = abs(lumaEndP) >= gradientScaled;
												if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;
												if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;
												doneNP = (!doneN) || (!doneP);
												if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;
												if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;
		/*--------------------------------------------------------------------------*/
												#if (FXAA_QUALITY_PS > 12)
												if(doneNP) {
														if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
														if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
														if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
														if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
														doneN = abs(lumaEndN) >= gradientScaled;
														doneP = abs(lumaEndP) >= gradientScaled;
														if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;
														if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;
														doneNP = (!doneN) || (!doneP);
														if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;
														if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;
		/*--------------------------------------------------------------------------*/
												}
												#endif
		/*--------------------------------------------------------------------------*/
										}
										#endif
		/*--------------------------------------------------------------------------*/
								}
								#endif
		/*--------------------------------------------------------------------------*/
						}
						#endif
		/*--------------------------------------------------------------------------*/
				}
				#endif
		/*--------------------------------------------------------------------------*/
														}
														#endif
		/*--------------------------------------------------------------------------*/
												}
												#endif
		/*--------------------------------------------------------------------------*/
										}
										#endif
		/*--------------------------------------------------------------------------*/
								}
								#endif
		/*--------------------------------------------------------------------------*/
						}
						#endif
		/*--------------------------------------------------------------------------*/
				}
		/*--------------------------------------------------------------------------*/
				FxaaFloat dstN = posM.x - posN.x;
				FxaaFloat dstP = posP.x - posM.x;
				if(!horzSpan) dstN = posM.y - posN.y;
				if(!horzSpan) dstP = posP.y - posM.y;
		/*--------------------------------------------------------------------------*/
				FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;
				FxaaFloat spanLength = (dstP + dstN);
				FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;
				FxaaFloat spanLengthRcp = 1.0/spanLength;
		/*--------------------------------------------------------------------------*/
				FxaaBool directionN = dstN < dstP;
				FxaaFloat dst = min(dstN, dstP);
				FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;
				FxaaFloat subpixG = subpixF * subpixF;
				FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;
				FxaaFloat subpixH = subpixG * fxaaQualitySubpix;
		/*--------------------------------------------------------------------------*/
				FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;
				FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);
				if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;
				if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;
				#if (FXAA_DISCARD == 1)
						return FxaaTexTop(tex, posM);
				#else
						return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);
				#endif
		}
		/*==========================================================================*/
		#endif

		void main() {
			gl_FragColor = FxaaPixelShader(
				vUv,
				vec4(0.0),
				tDiffuse,
				tDiffuse,
				tDiffuse,
				resolution,
				vec4(0.0),
				vec4(0.0),
				vec4(0.0),
				0.75,
				0.166,
				0.0833,
				0.0,
				0.0,
				0.0,
				vec4(0.0)
			);

			// TODO avoid querying texture twice for same texel
			gl_FragColor.a = texture2D(tDiffuse, vUv).a;
		}`};/*! (c) 2019-2021 pixiv Inc. - https://github.com/pixiv/three-vrm/blob/release/LICENSE *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function At(n,e,t,i){return new(t||(t=Promise))(function(s,r){function o(c){try{l(i.next(c))}catch(h){r(h)}}function a(c){try{l(i.throw(c))}catch(h){r(h)}}function l(c){var h;c.done?s(c.value):(h=c.value,h instanceof t?h:new t(function(u){u(h)})).then(o,a)}l((i=i.apply(n,e||[])).next())})}function OS(n){Object.keys(n).forEach(e=>{const t=n[e];(t==null?void 0:t.isTexture)&&t.dispose()}),n.dispose()}function ZU(n){const e=n.geometry;e&&e.dispose();const t=n.material;t&&(Array.isArray(t)?t.forEach(i=>OS(i)):t&&OS(t))}var dn;(function(n){n[n.NUMBER=0]="NUMBER",n[n.VECTOR2=1]="VECTOR2",n[n.VECTOR3=2]="VECTOR3",n[n.VECTOR4=3]="VECTOR4",n[n.COLOR=4]="COLOR"})(dn||(dn={}));const e5=new ie,t5=new C,n5=new Be,i5=new ge;class s5 extends Qe{constructor(e){super(),this.weight=0,this.isBinary=!1,this._binds=[],this._materialValues=[],this.name=`BlendShapeController_${e}`,this.type="BlendShapeController",this.visible=!1}addBind(e){const t=e.weight/100;this._binds.push({meshes:e.meshes,morphTargetIndex:e.morphTargetIndex,weight:t})}addMaterialValue(e){const t=e.material,i=e.propertyName;let s,r,o,a,l=t[i];l&&(l=e.defaultValue||l,l.isVector2?(s=dn.VECTOR2,r=l.clone(),o=new ie().fromArray(e.targetValue),a=o.clone().sub(r)):l.isVector3?(s=dn.VECTOR3,r=l.clone(),o=new C().fromArray(e.targetValue),a=o.clone().sub(r)):l.isVector4?(s=dn.VECTOR4,r=l.clone(),o=new Be().fromArray([e.targetValue[2],e.targetValue[3],e.targetValue[0],e.targetValue[1]]),a=o.clone().sub(r)):l.isColor?(s=dn.COLOR,r=l.clone(),o=new ge().fromArray(e.targetValue),a=o.clone().sub(r)):(s=dn.NUMBER,r=l,o=e.targetValue[0],a=o-r),this._materialValues.push({material:t,propertyName:i,defaultValue:r,targetValue:o,deltaValue:a,type:s}))}applyWeight(){const e=this.isBinary?this.weight<.5?0:1:this.weight;this._binds.forEach(t=>{t.meshes.forEach(i=>{i.morphTargetInfluences&&(i.morphTargetInfluences[t.morphTargetIndex]+=e*t.weight)})}),this._materialValues.forEach(t=>{if(t.material[t.propertyName]!==void 0){if(t.type===dn.NUMBER){const i=t.deltaValue;t.material[t.propertyName]+=i*e}else if(t.type===dn.VECTOR2){const i=t.deltaValue;t.material[t.propertyName].add(e5.copy(i).multiplyScalar(e))}else if(t.type===dn.VECTOR3){const i=t.deltaValue;t.material[t.propertyName].add(t5.copy(i).multiplyScalar(e))}else if(t.type===dn.VECTOR4){const i=t.deltaValue;t.material[t.propertyName].add(n5.copy(i).multiplyScalar(e))}else if(t.type===dn.COLOR){const i=t.deltaValue;t.material[t.propertyName].add(i5.copy(i).multiplyScalar(e))}typeof t.material.shouldApplyUniforms=="boolean"&&(t.material.shouldApplyUniforms=!0)}})}clearAppliedWeight(){this._binds.forEach(e=>{e.meshes.forEach(t=>{t.morphTargetInfluences&&(t.morphTargetInfluences[e.morphTargetIndex]=0)})}),this._materialValues.forEach(e=>{if(e.material[e.propertyName]!==void 0){if(e.type===dn.NUMBER){const t=e.defaultValue;e.material[e.propertyName]=t}else if(e.type===dn.VECTOR2){const t=e.defaultValue;e.material[e.propertyName].copy(t)}else if(e.type===dn.VECTOR3){const t=e.defaultValue;e.material[e.propertyName].copy(t)}else if(e.type===dn.VECTOR4){const t=e.defaultValue;e.material[e.propertyName].copy(t)}else if(e.type===dn.COLOR){const t=e.defaultValue;e.material[e.propertyName].copy(t)}typeof e.material.shouldApplyUniforms=="boolean"&&(e.material.shouldApplyUniforms=!0)}})}}var Ut;function kS(n,e,t){const i=n.parser.json.nodes[e].mesh;if(i==null)return null;const s=n.parser.json.meshes[i].primitives.length,r=[];return t.traverse(o=>{r.length<s&&o.isMesh&&r.push(o)}),r}function US(n){return At(this,void 0,void 0,function*(){const e=yield n.parser.getDependencies("node"),t=new Map;return e.forEach((i,s)=>{const r=kS(n,s,i);r!=null&&t.set(s,r)}),t})}function r5(n){return n[0]!=="_"?(console.warn(`renameMaterialProperty: Given property name "${n}" might be invalid`),n):(n=n.substring(1),/[A-Z]/.test(n[0])?n[0].toLowerCase()+n.substring(1):(console.warn(`renameMaterialProperty: Given property name "${n}" might be invalid`),n))}(function(n){var e,t,i,s,r,o;(e=n.BlendShapePresetName||(n.BlendShapePresetName={})).A="a",e.Angry="angry",e.Blink="blink",e.BlinkL="blink_l",e.BlinkR="blink_r",e.E="e",e.Fun="fun",e.I="i",e.Joy="joy",e.Lookdown="lookdown",e.Lookleft="lookleft",e.Lookright="lookright",e.Lookup="lookup",e.Neutral="neutral",e.O="o",e.Sorrow="sorrow",e.U="u",e.Unknown="unknown",(t=n.FirstPersonLookAtTypeName||(n.FirstPersonLookAtTypeName={})).BlendShape="BlendShape",t.Bone="Bone",(i=n.HumanoidBoneName||(n.HumanoidBoneName={})).Chest="chest",i.Head="head",i.Hips="hips",i.Jaw="jaw",i.LeftEye="leftEye",i.LeftFoot="leftFoot",i.LeftHand="leftHand",i.LeftIndexDistal="leftIndexDistal",i.LeftIndexIntermediate="leftIndexIntermediate",i.LeftIndexProximal="leftIndexProximal",i.LeftLittleDistal="leftLittleDistal",i.LeftLittleIntermediate="leftLittleIntermediate",i.LeftLittleProximal="leftLittleProximal",i.LeftLowerArm="leftLowerArm",i.LeftLowerLeg="leftLowerLeg",i.LeftMiddleDistal="leftMiddleDistal",i.LeftMiddleIntermediate="leftMiddleIntermediate",i.LeftMiddleProximal="leftMiddleProximal",i.LeftRingDistal="leftRingDistal",i.LeftRingIntermediate="leftRingIntermediate",i.LeftRingProximal="leftRingProximal",i.LeftShoulder="leftShoulder",i.LeftThumbDistal="leftThumbDistal",i.LeftThumbIntermediate="leftThumbIntermediate",i.LeftThumbProximal="leftThumbProximal",i.LeftToes="leftToes",i.LeftUpperArm="leftUpperArm",i.LeftUpperLeg="leftUpperLeg",i.Neck="neck",i.RightEye="rightEye",i.RightFoot="rightFoot",i.RightHand="rightHand",i.RightIndexDistal="rightIndexDistal",i.RightIndexIntermediate="rightIndexIntermediate",i.RightIndexProximal="rightIndexProximal",i.RightLittleDistal="rightLittleDistal",i.RightLittleIntermediate="rightLittleIntermediate",i.RightLittleProximal="rightLittleProximal",i.RightLowerArm="rightLowerArm",i.RightLowerLeg="rightLowerLeg",i.RightMiddleDistal="rightMiddleDistal",i.RightMiddleIntermediate="rightMiddleIntermediate",i.RightMiddleProximal="rightMiddleProximal",i.RightRingDistal="rightRingDistal",i.RightRingIntermediate="rightRingIntermediate",i.RightRingProximal="rightRingProximal",i.RightShoulder="rightShoulder",i.RightThumbDistal="rightThumbDistal",i.RightThumbIntermediate="rightThumbIntermediate",i.RightThumbProximal="rightThumbProximal",i.RightToes="rightToes",i.RightUpperArm="rightUpperArm",i.RightUpperLeg="rightUpperLeg",i.Spine="spine",i.UpperChest="upperChest",(s=n.MetaAllowedUserName||(n.MetaAllowedUserName={})).Everyone="Everyone",s.ExplicitlyLicensedPerson="ExplicitlyLicensedPerson",s.OnlyAuthor="OnlyAuthor",(r=n.MetaUssageName||(n.MetaUssageName={})).Allow="Allow",r.Disallow="Disallow",(o=n.MetaLicenseName||(n.MetaLicenseName={})).Cc0="CC0",o.CcBy="CC_BY",o.CcByNc="CC_BY_NC",o.CcByNcNd="CC_BY_NC_ND",o.CcByNcSa="CC_BY_NC_SA",o.CcByNd="CC_BY_ND",o.CcBySa="CC_BY_SA",o.Other="Other",o.RedistributionProhibited="Redistribution_Prohibited"})(Ut||(Ut={}));const o5=new C,a5=new C;function Ad(n,e){return n.matrixWorld.decompose(o5,e,a5),e}new gt;class l5{constructor(){this._blendShapeGroups={},this._blendShapePresetMap={},this._unknownGroupNames=[]}get expressions(){return Object.keys(this._blendShapeGroups)}get blendShapePresetMap(){return this._blendShapePresetMap}get unknownGroupNames(){return this._unknownGroupNames}getBlendShapeGroup(e){const t=this._blendShapePresetMap[e],i=t?this._blendShapeGroups[t]:this._blendShapeGroups[e];if(i)return i;console.warn(`no blend shape found by ${e}`)}registerBlendShapeGroup(e,t,i){this._blendShapeGroups[e]=i,t?this._blendShapePresetMap[t]=e:this._unknownGroupNames.push(e)}getValue(e){var t;const i=this.getBlendShapeGroup(e);return(t=i==null?void 0:i.weight)!==null&&t!==void 0?t:null}setValue(e,t){const i=this.getBlendShapeGroup(e);var s;i&&(i.weight=(s=t,Math.max(Math.min(s,1),0)))}getBlendShapeTrackName(e){const t=this.getBlendShapeGroup(e);return t?`${t.name}.weight`:null}update(){Object.keys(this._blendShapeGroups).forEach(e=>{this._blendShapeGroups[e].clearAppliedWeight()}),Object.keys(this._blendShapeGroups).forEach(e=>{this._blendShapeGroups[e].applyWeight()})}}class c5{import(e){var t;return At(this,void 0,void 0,function*(){const i=(t=e.parser.json.extensions)===null||t===void 0?void 0:t.VRM;if(!i)return null;const s=i.blendShapeMaster;if(!s)return null;const r=new l5,o=s.blendShapeGroups;if(!o)return r;const a={};return yield Promise.all(o.map(l=>At(this,void 0,void 0,function*(){const c=l.name;if(c===void 0)return void console.warn("VRMBlendShapeImporter: One of blendShapeGroups has no name");let h;l.presetName&&l.presetName!==Ut.BlendShapePresetName.Unknown&&!a[l.presetName]&&(h=l.presetName,a[l.presetName]=c);const u=new s5(c);e.scene.add(u),u.isBinary=l.isBinary||!1,l.binds&&l.binds.forEach(f=>At(this,void 0,void 0,function*(){if(f.mesh===void 0||f.index===void 0)return;const p=[];e.parser.json.nodes.forEach((y,m)=>{y.mesh===f.mesh&&p.push(m)});const _=f.index;yield Promise.all(p.map(y=>At(this,void 0,void 0,function*(){var m;const g=yield function(v,x){return At(this,void 0,void 0,function*(){const T=yield v.parser.getDependency("node",x);return kS(v,x,T)})}(e,y);g.every(v=>Array.isArray(v.morphTargetInfluences)&&_<v.morphTargetInfluences.length)?u.addBind({meshes:g,morphTargetIndex:_,weight:(m=f.weight)!==null&&m!==void 0?m:100}):console.warn(`VRMBlendShapeImporter: ${l.name} attempts to index ${_}th morph but not found.`)})))}));const d=l.materialValues;d&&d.forEach(f=>{if(f.materialName===void 0||f.propertyName===void 0||f.targetValue===void 0)return;const p=[];e.scene.traverse(_=>{if(_.material){const y=_.material;Array.isArray(y)?p.push(...y.filter(m=>m.name===f.materialName&&p.indexOf(m)===-1)):y.name===f.materialName&&p.indexOf(y)===-1&&p.push(y)}}),p.forEach(_=>{u.addMaterialValue({material:_,propertyName:r5(f.propertyName),targetValue:f.targetValue})})}),r.registerBlendShapeGroup(c,h,u)}))),r})}}const u5=Object.freeze(new C(0,0,-1)),h5=new gt;var xs;(function(n){n[n.Auto=0]="Auto",n[n.Both=1]="Both",n[n.ThirdPersonOnly=2]="ThirdPersonOnly",n[n.FirstPersonOnly=3]="FirstPersonOnly"})(xs||(xs={}));class t_{constructor(e,t){this.firstPersonFlag=t_._parseFirstPersonFlag(e),this.primitives=t}static _parseFirstPersonFlag(e){switch(e){case"Both":return xs.Both;case"ThirdPersonOnly":return xs.ThirdPersonOnly;case"FirstPersonOnly":return xs.FirstPersonOnly;default:return xs.Auto}}}class mr{constructor(e,t,i){this._meshAnnotations=[],this._firstPersonOnlyLayer=mr._DEFAULT_FIRSTPERSON_ONLY_LAYER,this._thirdPersonOnlyLayer=mr._DEFAULT_THIRDPERSON_ONLY_LAYER,this._initialized=!1,this._firstPersonBone=e,this._firstPersonBoneOffset=t,this._meshAnnotations=i}get firstPersonBone(){return this._firstPersonBone}get meshAnnotations(){return this._meshAnnotations}getFirstPersonWorldDirection(e){return e.copy(u5).applyQuaternion(Ad(this._firstPersonBone,h5))}get firstPersonOnlyLayer(){return this._firstPersonOnlyLayer}get thirdPersonOnlyLayer(){return this._thirdPersonOnlyLayer}getFirstPersonBoneOffset(e){return e.copy(this._firstPersonBoneOffset)}getFirstPersonWorldPosition(e){const t=this._firstPersonBoneOffset,i=new Be(t.x,t.y,t.z,1);return i.applyMatrix4(this._firstPersonBone.matrixWorld),e.set(i.x,i.y,i.z)}setup({firstPersonOnlyLayer:e=mr._DEFAULT_FIRSTPERSON_ONLY_LAYER,thirdPersonOnlyLayer:t=mr._DEFAULT_THIRDPERSON_ONLY_LAYER}={}){this._initialized||(this._initialized=!0,this._firstPersonOnlyLayer=e,this._thirdPersonOnlyLayer=t,this._meshAnnotations.forEach(i=>{i.firstPersonFlag===xs.FirstPersonOnly?i.primitives.forEach(s=>{s.layers.set(this._firstPersonOnlyLayer)}):i.firstPersonFlag===xs.ThirdPersonOnly?i.primitives.forEach(s=>{s.layers.set(this._thirdPersonOnlyLayer)}):i.firstPersonFlag===xs.Auto&&this._createHeadlessModel(i.primitives)}))}_excludeTriangles(e,t,i,s){let r=0;if(t!=null&&t.length>0)for(let o=0;o<e.length;o+=3){const a=e[o],l=e[o+1],c=e[o+2],h=t[a],u=i[a];if(h[0]>0&&s.includes(u[0])||h[1]>0&&s.includes(u[1])||h[2]>0&&s.includes(u[2])||h[3]>0&&s.includes(u[3]))continue;const d=t[l],f=i[l];if(d[0]>0&&s.includes(f[0])||d[1]>0&&s.includes(f[1])||d[2]>0&&s.includes(f[2])||d[3]>0&&s.includes(f[3]))continue;const p=t[c],_=i[c];p[0]>0&&s.includes(_[0])||p[1]>0&&s.includes(_[1])||p[2]>0&&s.includes(_[2])||p[3]>0&&s.includes(_[3])||(e[r++]=a,e[r++]=l,e[r++]=c)}return r}_createErasedMesh(e,t){const i=new ud(e.geometry.clone(),e.material);i.name=`${e.name}(erase)`,i.frustumCulled=e.frustumCulled,i.layers.set(this._firstPersonOnlyLayer);const s=i.geometry,r=s.getAttribute("skinIndex").array,o=[];for(let f=0;f<r.length;f+=4)o.push([r[f],r[f+1],r[f+2],r[f+3]]);const a=s.getAttribute("skinWeight").array,l=[];for(let f=0;f<a.length;f+=4)l.push([a[f],a[f+1],a[f+2],a[f+3]]);const c=s.getIndex();if(!c)throw new Error("The geometry doesn't have an index buffer");const h=Array.from(c.array),u=this._excludeTriangles(h,l,o,t),d=[];for(let f=0;f<u;f++)d[f]=h[f];return s.setIndex(d),e.onBeforeRender&&(i.onBeforeRender=e.onBeforeRender),i.bind(new hd(e.skeleton.bones,e.skeleton.boneInverses),new be),i}_createHeadlessModelForSkinnedMesh(e,t){const i=[];if(t.skeleton.bones.forEach((r,o)=>{this._isEraseTarget(r)&&i.push(o)}),!i.length)return t.layers.enable(this._thirdPersonOnlyLayer),void t.layers.enable(this._firstPersonOnlyLayer);t.layers.set(this._thirdPersonOnlyLayer);const s=this._createErasedMesh(t,i);e.add(s)}_createHeadlessModel(e){e.forEach(t=>{if(t.type==="SkinnedMesh"){const i=t;this._createHeadlessModelForSkinnedMesh(i.parent,i)}else this._isEraseTarget(t)&&t.layers.set(this._thirdPersonOnlyLayer)})}_isEraseTarget(e){return e===this._firstPersonBone||!!e.parent&&this._isEraseTarget(e.parent)}}mr._DEFAULT_FIRSTPERSON_ONLY_LAYER=9,mr._DEFAULT_THIRDPERSON_ONLY_LAYER=10;class d5{import(e,t){var i;return At(this,void 0,void 0,function*(){const s=(i=e.parser.json.extensions)===null||i===void 0?void 0:i.VRM;if(!s)return null;const r=s.firstPerson;if(!r)return null;const o=r.firstPersonBone;let a;if(a=o===void 0||o===-1?t.getBoneNode(Ut.HumanoidBoneName.Head):yield e.parser.getDependency("node",o),!a)return console.warn("VRMFirstPersonImporter: Could not find firstPersonBone of the VRM"),null;const l=r.firstPersonBoneOffset?new C(r.firstPersonBoneOffset.x,r.firstPersonBoneOffset.y,-r.firstPersonBoneOffset.z):new C(0,.06,0),c=[],h=yield US(e);return Array.from(h.entries()).forEach(([u,d])=>{const f=e.parser.json.nodes[u],p=r.meshAnnotations?r.meshAnnotations.find(_=>_.mesh===f.mesh):void 0;c.push(new t_(p==null?void 0:p.firstPersonFlag,d))}),new mr(a,l,c)})}}class f5{constructor(e,t){this.node=e,this.humanLimit=t}}function BS(n){return n.invert?n.invert():n.inverse(),n}const Rc=new C,Lc=new gt;class p5{constructor(e,t){this.restPose={},this.humanBones=this._createHumanBones(e),this.humanDescription=t,this.restPose=this.getPose()}getPose(){const e={};return Object.keys(this.humanBones).forEach(t=>{const i=this.getBoneNode(t);if(!i||e[t])return;Rc.set(0,0,0),Lc.identity();const s=this.restPose[t];(s==null?void 0:s.position)&&Rc.fromArray(s.position).negate(),(s==null?void 0:s.rotation)&&BS(Lc.fromArray(s.rotation)),Rc.add(i.position),Lc.premultiply(i.quaternion),e[t]={position:Rc.toArray(),rotation:Lc.toArray()}},{}),e}setPose(e){Object.keys(e).forEach(t=>{const i=e[t],s=this.getBoneNode(t);if(!s)return;const r=this.restPose[t];r&&(i.position&&(s.position.fromArray(i.position),r.position&&s.position.add(Rc.fromArray(r.position))),i.rotation&&(s.quaternion.fromArray(i.rotation),r.rotation&&s.quaternion.multiply(Lc.fromArray(r.rotation))))})}resetPose(){Object.entries(this.restPose).forEach(([e,t])=>{const i=this.getBoneNode(e);i&&((t==null?void 0:t.position)&&i.position.fromArray(t.position),(t==null?void 0:t.rotation)&&i.quaternion.fromArray(t.rotation))})}getBone(e){var t;return(t=this.humanBones[e][0])!==null&&t!==void 0?t:void 0}getBones(e){var t;return(t=this.humanBones[e])!==null&&t!==void 0?t:[]}getBoneNode(e){var t,i;return(i=(t=this.humanBones[e][0])===null||t===void 0?void 0:t.node)!==null&&i!==void 0?i:null}getBoneNodes(e){var t,i;return(i=(t=this.humanBones[e])===null||t===void 0?void 0:t.map(s=>s.node))!==null&&i!==void 0?i:[]}_createHumanBones(e){const t=Object.values(Ut.HumanoidBoneName).reduce((i,s)=>(i[s]=[],i),{});return e.forEach(i=>{t[i.name].push(i.bone)}),t}}class m5{import(e){var t;return At(this,void 0,void 0,function*(){const i=(t=e.parser.json.extensions)===null||t===void 0?void 0:t.VRM;if(!i)return null;const s=i.humanoid;if(!s)return null;const r=[];s.humanBones&&(yield Promise.all(s.humanBones.map(a=>At(this,void 0,void 0,function*(){if(!a.bone||a.node==null)return;const l=yield e.parser.getDependency("node",a.node);r.push({name:a.bone,bone:new f5(l,{axisLength:a.axisLength,center:a.center&&new C(a.center.x,a.center.y,a.center.z),max:a.max&&new C(a.max.x,a.max.y,a.max.z),min:a.min&&new C(a.min.x,a.min.y,a.min.z),useDefaultValues:a.useDefaultValues})})}))));const o={armStretch:s.armStretch,legStretch:s.legStretch,upperArmTwist:s.upperArmTwist,lowerArmTwist:s.lowerArmTwist,upperLegTwist:s.upperLegTwist,lowerLegTwist:s.lowerLegTwist,feetSpacing:s.feetSpacing,hasTranslationDoF:s.hasTranslationDoF};return new p5(r,o)})}}class HS{constructor(e,t,i){this.curve=[0,0,0,1,1,1,1,0],this.curveXRangeDegree=90,this.curveYRangeDegree=10,e!==void 0&&(this.curveXRangeDegree=e),t!==void 0&&(this.curveYRangeDegree=t),i!==void 0&&(this.curve=i)}map(e){const t=Math.min(Math.max(e,0),this.curveXRangeDegree)/this.curveXRangeDegree;return this.curveYRangeDegree*((i,s)=>{if(i.length<8)throw new Error("evaluateCurve: Invalid curve detected! (Array length must be 8 at least)");if(i.length%4!=0)throw new Error("evaluateCurve: Invalid curve detected! (Array length must be multiples of 4");let r;for(r=0;;r++){if(i.length<=4*r)return i[4*r-3];if(s<=i[4*r])break}const o=r-1;if(o<0)return i[4*o+5];const a=i[4*o],l=(s-a)/(i[4*r]-a);return((c,h,u,d,f)=>{const p=f*f*f,_=f*f;return c+(h-c)*(-2*p+3*_)+u*(p-2*_+f)+d*(p-_)})(i[4*o+1],i[4*r+1],i[4*o+3],i[4*r+2],l)})(this.curve,t)}}class zS{}class g5 extends zS{constructor(e,t,i,s){super(),this.type=Ut.FirstPersonLookAtTypeName.BlendShape,this._curveHorizontal=t,this._curveVerticalDown=i,this._curveVerticalUp=s,this._blendShapeProxy=e}name(){return Ut.FirstPersonLookAtTypeName.BlendShape}lookAt(e){const t=e.x,i=e.y;t<0?(this._blendShapeProxy.setValue(Ut.BlendShapePresetName.Lookup,0),this._blendShapeProxy.setValue(Ut.BlendShapePresetName.Lookdown,this._curveVerticalDown.map(-t))):(this._blendShapeProxy.setValue(Ut.BlendShapePresetName.Lookdown,0),this._blendShapeProxy.setValue(Ut.BlendShapePresetName.Lookup,this._curveVerticalUp.map(t))),i<0?(this._blendShapeProxy.setValue(Ut.BlendShapePresetName.Lookleft,0),this._blendShapeProxy.setValue(Ut.BlendShapePresetName.Lookright,this._curveHorizontal.map(-i))):(this._blendShapeProxy.setValue(Ut.BlendShapePresetName.Lookright,0),this._blendShapeProxy.setValue(Ut.BlendShapePresetName.Lookleft,this._curveHorizontal.map(i)))}}const _5=Object.freeze(new C(0,0,-1)),y5=new C,v5=new C,x5=new C,VS=new gt;class Pc{constructor(e,t){this.autoUpdate=!0,this._euler=new ir(0,0,0,Pc.EULER_ORDER),this.firstPerson=e,this.applyer=t}getLookAtWorldDirection(e){const t=Ad(this.firstPerson.firstPersonBone,VS);return e.copy(_5).applyEuler(this._euler).applyQuaternion(t)}lookAt(e){this._calcEuler(this._euler,e),this.applyer&&this.applyer.lookAt(this._euler)}update(e){this.target&&this.autoUpdate&&(this.lookAt(this.target.getWorldPosition(y5)),this.applyer&&this.applyer.lookAt(this._euler))}_calcEuler(e,t){const i=this.firstPerson.getFirstPersonWorldPosition(v5),s=x5.copy(t).sub(i).normalize();return s.applyQuaternion(BS(Ad(this.firstPerson.firstPersonBone,VS))),e.x=Math.atan2(s.y,Math.sqrt(s.x*s.x+s.z*s.z)),e.y=Math.atan2(-s.x,-s.z),e}}Pc.EULER_ORDER="YXZ";const ka=new ir(0,0,0,Pc.EULER_ORDER);class b5 extends zS{constructor(e,t,i,s,r){super(),this.type=Ut.FirstPersonLookAtTypeName.Bone,this._curveHorizontalInner=t,this._curveHorizontalOuter=i,this._curveVerticalDown=s,this._curveVerticalUp=r,this._leftEye=e.getBoneNode(Ut.HumanoidBoneName.LeftEye),this._rightEye=e.getBoneNode(Ut.HumanoidBoneName.RightEye)}lookAt(e){const t=e.x,i=e.y;this._leftEye&&(ka.x=t<0?-this._curveVerticalDown.map(-t):this._curveVerticalUp.map(t),ka.y=i<0?-this._curveHorizontalInner.map(-i):this._curveHorizontalOuter.map(i),this._leftEye.quaternion.setFromEuler(ka)),this._rightEye&&(ka.x=t<0?-this._curveVerticalDown.map(-t):this._curveVerticalUp.map(t),ka.y=i<0?-this._curveHorizontalOuter.map(-i):this._curveHorizontalInner.map(i),this._rightEye.quaternion.setFromEuler(ka))}}const n_=Math.PI/180;class T5{import(e,t,i,s){var r;const o=(r=e.parser.json.extensions)===null||r===void 0?void 0:r.VRM;if(!o)return null;const a=o.firstPerson;if(!a)return null;const l=this._importApplyer(a,i,s);return new Pc(t,l||void 0)}_importApplyer(e,t,i){const s=e.lookAtHorizontalInner,r=e.lookAtHorizontalOuter,o=e.lookAtVerticalDown,a=e.lookAtVerticalUp;switch(e.lookAtTypeName){case Ut.FirstPersonLookAtTypeName.Bone:return s===void 0||r===void 0||o===void 0||a===void 0?null:new b5(i,this._importCurveMapperBone(s),this._importCurveMapperBone(r),this._importCurveMapperBone(o),this._importCurveMapperBone(a));case Ut.FirstPersonLookAtTypeName.BlendShape:return r===void 0||o===void 0||a===void 0?null:new g5(t,this._importCurveMapperBlendShape(r),this._importCurveMapperBlendShape(o),this._importCurveMapperBlendShape(a));default:return null}}_importCurveMapperBone(e){return new HS(typeof e.xRange=="number"?n_*e.xRange:void 0,typeof e.yRange=="number"?n_*e.yRange:void 0,e.curve)}_importCurveMapperBlendShape(e){return new HS(typeof e.xRange=="number"?n_*e.xRange:void 0,e.yRange,e.curve)}}const i_=(n,e)=>{const t=(i=>{switch(i){case Lt:return["Linear","( value )"];case ri:return["sRGB","( value )"];case Fh:return["RGBE","( value )"];case Nm:return["RGBM","( value, 7.0 )"];case Fm:return["RGBM","( value, 16.0 )"];case Dm:return["RGBD","( value, 256.0 )"];case Nh:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+i)}})(e);return"vec4 "+n+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"},w5=2*Math.PI;var Yi,Ua,Nc,Ba,ji;(function(n){n[n.Off=0]="Off",n[n.Front=1]="Front",n[n.Back=2]="Back"})(Yi||(Yi={})),function(n){n[n.None=0]="None",n[n.Normal=1]="Normal",n[n.LitShadeRate=2]="LitShadeRate",n[n.UV=3]="UV"}(Ua||(Ua={})),function(n){n[n.FixedColor=0]="FixedColor",n[n.MixedLighting=1]="MixedLighting"}(Nc||(Nc={})),function(n){n[n.None=0]="None",n[n.WorldCoordinates=1]="WorldCoordinates",n[n.ScreenCoordinates=2]="ScreenCoordinates"}(Ba||(Ba={})),function(n){n[n.Opaque=0]="Opaque",n[n.Cutout=1]="Cutout",n[n.Transparent=2]="Transparent",n[n.TransparentWithZWrite=3]="TransparentWithZWrite"}(ji||(ji={}));class GS extends Cn{constructor(e={}){super(),this.isMToonMaterial=!0,this.cutoff=.5,this.color=new Be(1,1,1,1),this.shadeColor=new Be(.97,.81,.86,1),this.map=null,this.mainTex_ST=new Be(0,0,1,1),this.shadeTexture=null,this.normalMap=null,this.normalMapType=Ks,this.normalScale=new ie(1,1),this.receiveShadowRate=1,this.receiveShadowTexture=null,this.shadingGradeRate=1,this.shadingGradeTexture=null,this.shadeShift=0,this.shadeToony=.9,this.lightColorAttenuation=0,this.indirectLightIntensity=.1,this.rimTexture=null,this.rimColor=new Be(0,0,0,1),this.rimLightingMix=0,this.rimFresnelPower=1,this.rimLift=0,this.sphereAdd=null,this.emissionColor=new Be(0,0,0,1),this.emissiveMap=null,this.outlineWidthTexture=null,this.outlineWidth=.5,this.outlineScaledMaxDistance=1,this.outlineColor=new Be(0,0,0,1),this.outlineLightingMix=1,this.uvAnimMaskTexture=null,this.uvAnimScrollX=0,this.uvAnimScrollY=0,this.uvAnimRotation=0,this.shouldApplyUniforms=!0,this._debugMode=Ua.None,this._blendMode=ji.Opaque,this._outlineWidthMode=Ba.None,this._outlineColorMode=Nc.FixedColor,this._cullMode=Yi.Back,this._outlineCullMode=Yi.Front,this._isOutline=!1,this._uvAnimOffsetX=0,this._uvAnimOffsetY=0,this._uvAnimPhase=0,this.encoding=e.encoding||Lt,this.encoding!==Lt&&this.encoding!==ri&&console.warn("The specified color encoding does not work properly with MToonMaterial. You might want to use THREE.sRGBEncoding instead."),["mToonVersion","shadeTexture_ST","bumpMap_ST","receiveShadowTexture_ST","shadingGradeTexture_ST","rimTexture_ST","sphereAdd_ST","emissionMap_ST","outlineWidthTexture_ST","uvAnimMaskTexture_ST","srcBlend","dstBlend"].forEach(t=>{e[t]!==void 0&&delete e[t]}),e.fog=!0,e.lights=!0,e.clipping=!0,parseInt(us,10)<129&&(e.skinning=e.skinning||!1),parseInt(us,10)<131&&(e.morphTargets=e.morphTargets||!1,e.morphNormals=e.morphNormals||!1),e.uniforms=fa.merge([fe.common,fe.normalmap,fe.emissivemap,fe.fog,fe.lights,{cutoff:{value:.5},color:{value:new ge(1,1,1)},colorAlpha:{value:1},shadeColor:{value:new ge(.97,.81,.86)},mainTex_ST:{value:new Be(0,0,1,1)},shadeTexture:{value:null},receiveShadowRate:{value:1},receiveShadowTexture:{value:null},shadingGradeRate:{value:1},shadingGradeTexture:{value:null},shadeShift:{value:0},shadeToony:{value:.9},lightColorAttenuation:{value:0},indirectLightIntensity:{value:.1},rimTexture:{value:null},rimColor:{value:new ge(0,0,0)},rimLightingMix:{value:0},rimFresnelPower:{value:1},rimLift:{value:0},sphereAdd:{value:null},emissionColor:{value:new ge(0,0,0)},outlineWidthTexture:{value:null},outlineWidth:{value:.5},outlineScaledMaxDistance:{value:1},outlineColor:{value:new ge(0,0,0)},outlineLightingMix:{value:1},uvAnimMaskTexture:{value:null},uvAnimOffsetX:{value:0},uvAnimOffsetY:{value:0},uvAnimTheta:{value:0}}]),this.setValues(e),this._updateShaderCode(),this._applyUniforms()}get mainTex(){return this.map}set mainTex(e){this.map=e}get bumpMap(){return this.normalMap}set bumpMap(e){this.normalMap=e}get bumpScale(){return this.normalScale.x}set bumpScale(e){this.normalScale.set(e,e)}get emissionMap(){return this.emissiveMap}set emissionMap(e){this.emissiveMap=e}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.depthWrite=this._blendMode!==ji.Transparent,this.transparent=this._blendMode===ji.Transparent||this._blendMode===ji.TransparentWithZWrite,this._updateShaderCode()}get debugMode(){return this._debugMode}set debugMode(e){this._debugMode=e,this._updateShaderCode()}get outlineWidthMode(){return this._outlineWidthMode}set outlineWidthMode(e){this._outlineWidthMode=e,this._updateShaderCode()}get outlineColorMode(){return this._outlineColorMode}set outlineColorMode(e){this._outlineColorMode=e,this._updateShaderCode()}get cullMode(){return this._cullMode}set cullMode(e){this._cullMode=e,this._updateCullFace()}get outlineCullMode(){return this._outlineCullMode}set outlineCullMode(e){this._outlineCullMode=e,this._updateCullFace()}get zWrite(){return this.depthWrite?1:0}set zWrite(e){this.depthWrite=.5<=e}get isOutline(){return this._isOutline}set isOutline(e){this._isOutline=e,this._updateShaderCode(),this._updateCullFace()}updateVRMMaterials(e){this._uvAnimOffsetX=this._uvAnimOffsetX+e*this.uvAnimScrollX,this._uvAnimOffsetY=this._uvAnimOffsetY-e*this.uvAnimScrollY,this._uvAnimPhase=this._uvAnimPhase+e*this.uvAnimRotation,this._applyUniforms()}copy(e){return super.copy(e),this.cutoff=e.cutoff,this.color.copy(e.color),this.shadeColor.copy(e.shadeColor),this.map=e.map,this.mainTex_ST.copy(e.mainTex_ST),this.shadeTexture=e.shadeTexture,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(this.normalScale),this.receiveShadowRate=e.receiveShadowRate,this.receiveShadowTexture=e.receiveShadowTexture,this.shadingGradeRate=e.shadingGradeRate,this.shadingGradeTexture=e.shadingGradeTexture,this.shadeShift=e.shadeShift,this.shadeToony=e.shadeToony,this.lightColorAttenuation=e.lightColorAttenuation,this.indirectLightIntensity=e.indirectLightIntensity,this.rimTexture=e.rimTexture,this.rimColor.copy(e.rimColor),this.rimLightingMix=e.rimLightingMix,this.rimFresnelPower=e.rimFresnelPower,this.rimLift=e.rimLift,this.sphereAdd=e.sphereAdd,this.emissionColor.copy(e.emissionColor),this.emissiveMap=e.emissiveMap,this.outlineWidthTexture=e.outlineWidthTexture,this.outlineWidth=e.outlineWidth,this.outlineScaledMaxDistance=e.outlineScaledMaxDistance,this.outlineColor.copy(e.outlineColor),this.outlineLightingMix=e.outlineLightingMix,this.uvAnimMaskTexture=e.uvAnimMaskTexture,this.uvAnimScrollX=e.uvAnimScrollX,this.uvAnimScrollY=e.uvAnimScrollY,this.uvAnimRotation=e.uvAnimRotation,this.debugMode=e.debugMode,this.blendMode=e.blendMode,this.outlineWidthMode=e.outlineWidthMode,this.outlineColorMode=e.outlineColorMode,this.cullMode=e.cullMode,this.outlineCullMode=e.outlineCullMode,this.isOutline=e.isOutline,this}_applyUniforms(){this.uniforms.uvAnimOffsetX.value=this._uvAnimOffsetX,this.uniforms.uvAnimOffsetY.value=this._uvAnimOffsetY,this.uniforms.uvAnimTheta.value=w5*this._uvAnimPhase,this.shouldApplyUniforms&&(this.shouldApplyUniforms=!1,this.uniforms.cutoff.value=this.cutoff,this.uniforms.color.value.setRGB(this.color.x,this.color.y,this.color.z),this.uniforms.colorAlpha.value=this.color.w,this.uniforms.shadeColor.value.setRGB(this.shadeColor.x,this.shadeColor.y,this.shadeColor.z),this.uniforms.map.value=this.map,this.uniforms.mainTex_ST.value.copy(this.mainTex_ST),this.uniforms.shadeTexture.value=this.shadeTexture,this.uniforms.normalMap.value=this.normalMap,this.uniforms.normalScale.value.copy(this.normalScale),this.uniforms.receiveShadowRate.value=this.receiveShadowRate,this.uniforms.receiveShadowTexture.value=this.receiveShadowTexture,this.uniforms.shadingGradeRate.value=this.shadingGradeRate,this.uniforms.shadingGradeTexture.value=this.shadingGradeTexture,this.uniforms.shadeShift.value=this.shadeShift,this.uniforms.shadeToony.value=this.shadeToony,this.uniforms.lightColorAttenuation.value=this.lightColorAttenuation,this.uniforms.indirectLightIntensity.value=this.indirectLightIntensity,this.uniforms.rimTexture.value=this.rimTexture,this.uniforms.rimColor.value.setRGB(this.rimColor.x,this.rimColor.y,this.rimColor.z),this.uniforms.rimLightingMix.value=this.rimLightingMix,this.uniforms.rimFresnelPower.value=this.rimFresnelPower,this.uniforms.rimLift.value=this.rimLift,this.uniforms.sphereAdd.value=this.sphereAdd,this.uniforms.emissionColor.value.setRGB(this.emissionColor.x,this.emissionColor.y,this.emissionColor.z),this.uniforms.emissiveMap.value=this.emissiveMap,this.uniforms.outlineWidthTexture.value=this.outlineWidthTexture,this.uniforms.outlineWidth.value=this.outlineWidth,this.uniforms.outlineScaledMaxDistance.value=this.outlineScaledMaxDistance,this.uniforms.outlineColor.value.setRGB(this.outlineColor.x,this.outlineColor.y,this.outlineColor.z),this.uniforms.outlineLightingMix.value=this.outlineLightingMix,this.uniforms.uvAnimMaskTexture.value=this.uvAnimMaskTexture,this.encoding===ri&&(this.uniforms.color.value.convertSRGBToLinear(),this.uniforms.shadeColor.value.convertSRGBToLinear(),this.uniforms.rimColor.value.convertSRGBToLinear(),this.uniforms.emissionColor.value.convertSRGBToLinear(),this.uniforms.outlineColor.value.convertSRGBToLinear()),this._updateCullFace())}_updateShaderCode(){const e=this.outlineWidthTexture!==null,t=this.map!==null||this.shadeTexture!==null||this.receiveShadowTexture!==null||this.shadingGradeTexture!==null||this.rimTexture!==null||this.uvAnimMaskTexture!==null;this.defines={THREE_VRM_THREE_REVISION:parseInt(us,10),OUTLINE:this._isOutline,BLENDMODE_OPAQUE:this._blendMode===ji.Opaque,BLENDMODE_CUTOUT:this._blendMode===ji.Cutout,BLENDMODE_TRANSPARENT:this._blendMode===ji.Transparent||this._blendMode===ji.TransparentWithZWrite,MTOON_USE_UV:e||t,MTOON_UVS_VERTEX_ONLY:e&&!t,USE_SHADETEXTURE:this.shadeTexture!==null,USE_RECEIVESHADOWTEXTURE:this.receiveShadowTexture!==null,USE_SHADINGGRADETEXTURE:this.shadingGradeTexture!==null,USE_RIMTEXTURE:this.rimTexture!==null,USE_SPHEREADD:this.sphereAdd!==null,USE_OUTLINEWIDTHTEXTURE:this.outlineWidthTexture!==null,USE_UVANIMMASKTEXTURE:this.uvAnimMaskTexture!==null,DEBUG_NORMAL:this._debugMode===Ua.Normal,DEBUG_LITSHADERATE:this._debugMode===Ua.LitShadeRate,DEBUG_UV:this._debugMode===Ua.UV,OUTLINE_WIDTH_WORLD:this._outlineWidthMode===Ba.WorldCoordinates,OUTLINE_WIDTH_SCREEN:this._outlineWidthMode===Ba.ScreenCoordinates,OUTLINE_COLOR_FIXED:this._outlineColorMode===Nc.FixedColor,OUTLINE_COLOR_MIXED:this._outlineColorMode===Nc.MixedLighting};const i=(this.shadeTexture!==null?i_("shadeTextureTexelToLinear",this.shadeTexture.encoding)+`
`:"")+(this.sphereAdd!==null?i_("sphereAddTexelToLinear",this.sphereAdd.encoding)+`
`:"")+(this.rimTexture!==null?i_("rimTextureTexelToLinear",this.rimTexture.encoding)+`
`:"");this.vertexShader=`// #define PHONG

varying vec3 vViewPosition;

#ifndef FLAT_SHADED
  varying vec3 vNormal;
#endif

#include <common>

// #include <uv_pars_vertex>
#ifdef MTOON_USE_UV
  #ifdef MTOON_UVS_VERTEX_ONLY
    vec2 vUv;
  #else
    varying vec2 vUv;
  #endif

  uniform vec4 mainTex_ST;
#endif

#include <uv2_pars_vertex>
// #include <displacementmap_pars_vertex>
// #include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

#ifdef USE_OUTLINEWIDTHTEXTURE
  uniform sampler2D outlineWidthTexture;
#endif

uniform float outlineWidth;
uniform float outlineScaledMaxDistance;

void main() {

  // #include <uv_vertex>
  #ifdef MTOON_USE_UV
    vUv = uv;
    vUv.y = 1.0 - vUv.y; // uv.y is opposite from UniVRM's
    vUv = mainTex_ST.st + mainTex_ST.pq * vUv;
    vUv.y = 1.0 - vUv.y; // reverting the previous flip
  #endif

  #include <uv2_vertex>
  #include <color_vertex>

  #include <beginnormal_vertex>
  #include <morphnormal_vertex>
  #include <skinbase_vertex>
  #include <skinnormal_vertex>

  // we need this to compute the outline properly
  objectNormal = normalize( objectNormal );

  #include <defaultnormal_vertex>

  #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED
    vNormal = normalize( transformedNormal );
  #endif

  #include <begin_vertex>

  #include <morphtarget_vertex>
  #include <skinning_vertex>
  // #include <displacementmap_vertex>
  #include <project_vertex>
  #include <logdepthbuf_vertex>
  #include <clipping_planes_vertex>

  vViewPosition = - mvPosition.xyz;

  float outlineTex = 1.0;

  #ifdef OUTLINE
    #ifdef USE_OUTLINEWIDTHTEXTURE
      outlineTex = texture2D( outlineWidthTexture, vUv ).r;
    #endif

    #ifdef OUTLINE_WIDTH_WORLD
      float worldNormalLength = length( transformedNormal );
      vec3 outlineOffset = 0.01 * outlineWidth * outlineTex * worldNormalLength * objectNormal;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( outlineOffset + transformed, 1.0 );
    #endif

    #ifdef OUTLINE_WIDTH_SCREEN
      vec3 clipNormal = ( projectionMatrix * modelViewMatrix * vec4( objectNormal, 0.0 ) ).xyz;
      vec2 projectedNormal = normalize( clipNormal.xy );
      projectedNormal *= min( gl_Position.w, outlineScaledMaxDistance );
      projectedNormal.x *= projectionMatrix[ 0 ].x / projectionMatrix[ 1 ].y;
      gl_Position.xy += 0.01 * outlineWidth * outlineTex * projectedNormal.xy;
    #endif

    gl_Position.z += 1E-6 * gl_Position.w; // anti-artifact magic
  #endif

  #include <worldpos_vertex>
  // #include <envmap_vertex>
  #include <shadowmap_vertex>
  #include <fog_vertex>

}`,this.fragmentShader=i+`// #define PHONG

#ifdef BLENDMODE_CUTOUT
  uniform float cutoff;
#endif

uniform vec3 color;
uniform float colorAlpha;
uniform vec3 shadeColor;
#ifdef USE_SHADETEXTURE
  uniform sampler2D shadeTexture;
#endif

uniform float receiveShadowRate;
#ifdef USE_RECEIVESHADOWTEXTURE
  uniform sampler2D receiveShadowTexture;
#endif

uniform float shadingGradeRate;
#ifdef USE_SHADINGGRADETEXTURE
  uniform sampler2D shadingGradeTexture;
#endif

uniform float shadeShift;
uniform float shadeToony;
uniform float lightColorAttenuation;
uniform float indirectLightIntensity;

#ifdef USE_RIMTEXTURE
  uniform sampler2D rimTexture;
#endif
uniform vec3 rimColor;
uniform float rimLightingMix;
uniform float rimFresnelPower;
uniform float rimLift;

#ifdef USE_SPHEREADD
  uniform sampler2D sphereAdd;
#endif

uniform vec3 emissionColor;

uniform vec3 outlineColor;
uniform float outlineLightingMix;

#ifdef USE_UVANIMMASKTEXTURE
  uniform sampler2D uvAnimMaskTexture;
#endif

uniform float uvAnimOffsetX;
uniform float uvAnimOffsetY;
uniform float uvAnimTheta;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>

// #include <uv_pars_fragment>
#if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )
  varying vec2 vUv;
#endif

#include <uv2_pars_fragment>
#include <map_pars_fragment>
// #include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
// #include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
// #include <envmap_common_pars_fragment>
// #include <envmap_pars_fragment>
// #include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>

// #include <bsdfs>
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
    return RECIPROCAL_PI * diffuseColor;
}

#include <lights_pars_begin>

// #include <lights_phong_pars_fragment>
varying vec3 vViewPosition;

#ifndef FLAT_SHADED
  varying vec3 vNormal;
#endif

struct MToonMaterial {
  vec3 diffuseColor;
  vec3 shadeColor;
  float shadingGrade;
  float receiveShadow;
};

#define Material_LightProbeLOD( material ) (0)

#include <shadowmap_pars_fragment>
// #include <bumpmap_pars_fragment>

// #include <normalmap_pars_fragment>
#ifdef USE_NORMALMAP

  uniform sampler2D normalMap;
  uniform vec2 normalScale;

#endif

#ifdef OBJECTSPACE_NORMALMAP

  uniform mat3 normalMatrix;

#endif

#if ! defined ( USE_TANGENT ) && defined ( TANGENTSPACE_NORMALMAP )

  // Per-Pixel Tangent Space Normal Mapping
  // http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html

  // three-vrm specific change: it requires \`uv\` as an input in order to support uv scrolls

  // Temporary compat against shader change @ Three.js r126
  // See: #21205, #21307, #21299
  #if THREE_VRM_THREE_REVISION >= 126

    vec3 perturbNormal2Arb( vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {

      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
      vec2 st0 = dFdx( uv.st );
      vec2 st1 = dFdy( uv.st );

      vec3 N = normalize( surf_norm );

      vec3 q1perp = cross( q1, N );
      vec3 q0perp = cross( N, q0 );

      vec3 T = q1perp * st0.x + q0perp * st1.x;
      vec3 B = q1perp * st0.y + q0perp * st1.y;

      // three-vrm specific change: Workaround for the issue that happens when delta of uv = 0.0
      // TODO: Is this still required? Or shall I make a PR about it?
      if ( length( T ) == 0.0 || length( B ) == 0.0 ) {
        return surf_norm;
      }

      float det = max( dot( T, T ), dot( B, B ) );
      float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );

      return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );

    }

  #else

    vec3 perturbNormal2Arb( vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {

      // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988

      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
      vec2 st0 = dFdx( uv.st );
      vec2 st1 = dFdy( uv.st );

      float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude

      vec3 S = ( q0 * st1.t - q1 * st0.t ) * scale;
      vec3 T = ( - q0 * st1.s + q1 * st0.s ) * scale;

      // three-vrm specific change: Workaround for the issue that happens when delta of uv = 0.0
      // TODO: Is this still required? Or shall I make a PR about it?

      if ( length( S ) == 0.0 || length( T ) == 0.0 ) {
        return surf_norm;
      }

      S = normalize( S );
      T = normalize( T );
      vec3 N = normalize( surf_norm );

      #ifdef DOUBLE_SIDED

        // Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331

        bool frontFacing = dot( cross( S, T ), N ) > 0.0;

        mapN.xy *= ( float( frontFacing ) * 2.0 - 1.0 );

      #else

        mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );

      #endif

      mat3 tsn = mat3( S, T, N );
      return normalize( tsn * mapN );

    }

  #endif

#endif

// #include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

// == lighting stuff ===========================================================
float getLightIntensity(
  const in IncidentLight directLight,
  const in GeometricContext geometry,
  const in float shadow,
  const in float shadingGrade
) {
  float lightIntensity = dot( geometry.normal, directLight.direction );
  lightIntensity = 0.5 + 0.5 * lightIntensity;
  lightIntensity = lightIntensity * shadow;
  lightIntensity = lightIntensity * shadingGrade;
  lightIntensity = lightIntensity * 2.0 - 1.0;
  return shadeToony == 1.0
    ? step( shadeShift, lightIntensity )
    : smoothstep( shadeShift, shadeShift + ( 1.0 - shadeToony ), lightIntensity );
}

vec3 getLighting( const in vec3 lightColor ) {
  vec3 lighting = lightColor;
  lighting = mix(
    lighting,
    vec3( max( 0.001, max( lighting.x, max( lighting.y, lighting.z ) ) ) ),
    lightColorAttenuation
  );

  #ifndef PHYSICALLY_CORRECT_LIGHTS
    lighting *= PI;
  #endif

  return lighting;
}

vec3 getDiffuse(
  const in MToonMaterial material,
  const in float lightIntensity,
  const in vec3 lighting
) {
  #ifdef DEBUG_LITSHADERATE
    return vec3( BRDF_Lambert( lightIntensity * lighting ) );
  #endif

  return lighting * BRDF_Lambert( mix( material.shadeColor, material.diffuseColor, lightIntensity ) );
}

// == post correction ==========================================================
void postCorrection() {
  #include <tonemapping_fragment>
  #include <encodings_fragment>
  #include <fog_fragment>
  #include <premultiplied_alpha_fragment>
  #include <dithering_fragment>
}

// == main procedure ===========================================================
void main() {
  #include <clipping_planes_fragment>

  vec2 uv = vec2(0.5, 0.5);

  #if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )
    uv = vUv;

    float uvAnimMask = 1.0;
    #ifdef USE_UVANIMMASKTEXTURE
      uvAnimMask = texture2D( uvAnimMaskTexture, uv ).x;
    #endif

    uv = uv + vec2( uvAnimOffsetX, uvAnimOffsetY ) * uvAnimMask;
    float uvRotCos = cos( uvAnimTheta * uvAnimMask );
    float uvRotSin = sin( uvAnimTheta * uvAnimMask );
    uv = mat2( uvRotCos, uvRotSin, -uvRotSin, uvRotCos ) * ( uv - 0.5 ) + 0.5;
  #endif

  #ifdef DEBUG_UV
    gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
    #if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )
      gl_FragColor = vec4( uv, 0.0, 1.0 );
    #endif
    return;
  #endif

  vec4 diffuseColor = vec4( color, colorAlpha );
  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
  vec3 totalEmissiveRadiance = emissionColor;

  #include <logdepthbuf_fragment>

  // #include <map_fragment>
  #ifdef USE_MAP
    diffuseColor *= mapTexelToLinear( texture2D( map, uv ) );
  #endif

  #include <color_fragment>
  // #include <alphamap_fragment>

  // -- MToon: alpha -----------------------------------------------------------
  // #include <alphatest_fragment>
  #ifdef BLENDMODE_CUTOUT
    if ( diffuseColor.a <= cutoff ) { discard; }
    diffuseColor.a = 1.0;
  #endif

  #ifdef BLENDMODE_OPAQUE
    diffuseColor.a = 1.0;
  #endif

  #if defined( OUTLINE ) && defined( OUTLINE_COLOR_FIXED ) // omitting DebugMode
    gl_FragColor = vec4( outlineColor, diffuseColor.a );
    postCorrection();
    return;
  #endif

  // #include <specularmap_fragment>
  #include <normal_fragment_begin>

  #ifdef OUTLINE
    normal *= -1.0;
  #endif

  // #include <normal_fragment_maps>

  #ifdef OBJECTSPACE_NORMALMAP

    normal = texture2D( normalMap, uv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals

    #ifdef FLIP_SIDED

      normal = - normal;

    #endif

    #ifdef DOUBLE_SIDED

      // Temporary compat against shader change @ Three.js r126
      // See: #21205, #21307, #21299
      #if THREE_VRM_THREE_REVISION >= 126

        normal = normal * faceDirection;

      #else

        normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );

      #endif

    #endif

    normal = normalize( normalMatrix * normal );

  #elif defined( TANGENTSPACE_NORMALMAP )

    vec3 mapN = texture2D( normalMap, uv ).xyz * 2.0 - 1.0;
    mapN.xy *= normalScale;

    #ifdef USE_TANGENT

      normal = normalize( vTBN * mapN );

    #else

      // Temporary compat against shader change @ Three.js r126
      // See: #21205, #21307, #21299
      #if THREE_VRM_THREE_REVISION >= 126

        normal = perturbNormal2Arb( uv, -vViewPosition, normal, mapN, faceDirection );

      #else

        normal = perturbNormal2Arb( uv, -vViewPosition, normal, mapN );

      #endif

    #endif

  #endif

  // #include <emissivemap_fragment>
  #ifdef USE_EMISSIVEMAP
    totalEmissiveRadiance *= emissiveMapTexelToLinear( texture2D( emissiveMap, uv ) ).rgb;
  #endif

  #ifdef DEBUG_NORMAL
    gl_FragColor = vec4( 0.5 + 0.5 * normal, 1.0 );
    return;
  #endif

  // -- MToon: lighting --------------------------------------------------------
  // accumulation
  // #include <lights_phong_fragment>
  MToonMaterial material;

  material.diffuseColor = diffuseColor.rgb;

  material.shadeColor = shadeColor;
  #ifdef USE_SHADETEXTURE
    material.shadeColor *= shadeTextureTexelToLinear( texture2D( shadeTexture, uv ) ).rgb;
  #endif

  material.shadingGrade = 1.0;
  #ifdef USE_SHADINGGRADETEXTURE
    material.shadingGrade = 1.0 - shadingGradeRate * ( 1.0 - texture2D( shadingGradeTexture, uv ).r );
  #endif

  material.receiveShadow = receiveShadowRate;
  #ifdef USE_RECEIVESHADOWTEXTURE
    material.receiveShadow *= texture2D( receiveShadowTexture, uv ).a;
  #endif

  // #include <lights_fragment_begin>
  GeometricContext geometry;

  geometry.position = - vViewPosition;
  geometry.normal = normal;
  geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

  IncidentLight directLight;
  vec3 lightingSum = vec3( 0.0 );

  // since these variables will be used in unrolled loop, we have to define in prior
  float atten, shadow, lightIntensity;
  vec3 lighting;

  #if ( NUM_POINT_LIGHTS > 0 )
    PointLight pointLight;

    #if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
    PointLightShadow pointLightShadow;
    #endif

    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
      pointLight = pointLights[ i ];

      #if THREE_VRM_THREE_REVISION >= 132
        getPointLightInfo( pointLight, geometry, directLight );
      #else
        getPointDirectLightIrradiance( pointLight, geometry, directLight );
      #endif

      atten = 1.0;
      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
      pointLightShadow = pointLightShadows[ i ];
      atten = all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
      #endif

      shadow = 1.0 - material.receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );
      lightIntensity = getLightIntensity( directLight, geometry, shadow, material.shadingGrade );
      lighting = getLighting( directLight.color );
      reflectedLight.directDiffuse += getDiffuse( material, lightIntensity, lighting );
      lightingSum += lighting;
    }
    #pragma unroll_loop_end
  #endif

  #if ( NUM_SPOT_LIGHTS > 0 )
    SpotLight spotLight;

    #if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
    SpotLightShadow spotLightShadow;
    #endif

    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
      spotLight = spotLights[ i ];

      #if THREE_VRM_THREE_REVISION >= 132
        getSpotLightInfo( spotLight, geometry, directLight );
      #else
        getSpotDirectLightIrradiance( spotLight, geometry, directLight );
      #endif

      atten = 1.0;
      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
      spotLightShadow = spotLightShadows[ i ];
      atten = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
      #endif

      shadow = 1.0 - material.receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );
      lightIntensity = getLightIntensity( directLight, geometry, shadow, material.shadingGrade );
      lighting = getLighting( directLight.color );
      reflectedLight.directDiffuse += getDiffuse( material, lightIntensity, lighting );
      lightingSum += lighting;
    }
    #pragma unroll_loop_end
  #endif

  #if ( NUM_DIR_LIGHTS > 0 )
    DirectionalLight directionalLight;

    #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
    DirectionalLightShadow directionalLightShadow;
    #endif

    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
      directionalLight = directionalLights[ i ];

      #if THREE_VRM_THREE_REVISION >= 132
        getDirectionalLightInfo( directionalLight, geometry, directLight );
      #else
        getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
      #endif

      atten = 1.0;
      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
      directionalLightShadow = directionalLightShadows[ i ];
      atten = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
      #endif

      shadow = 1.0 - material.receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );
      lightIntensity = getLightIntensity( directLight, geometry, shadow, material.shadingGrade );
      lighting = getLighting( directLight.color );
      reflectedLight.directDiffuse += getDiffuse( material, lightIntensity, lighting );
      lightingSum += lighting;
    }
    #pragma unroll_loop_end
  #endif

  // #if defined( RE_IndirectDiffuse )
  vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
  irradiance += getLightProbeIrradiance( lightProbe, geometry );
  #if ( NUM_HEMI_LIGHTS > 0 )
    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
      irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
    }
    #pragma unroll_loop_end
  #endif
  // #endif

  // #include <lights_fragment_maps>
  #ifdef USE_LIGHTMAP
    vec4 lightMapTexel = texture2D( lightMap, vUv2 );
    vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
    #ifndef PHYSICALLY_CORRECT_LIGHTS
      lightMapIrradiance *= PI;
    #endif
    irradiance += lightMapIrradiance;
  #endif

  // #include <lights_fragment_end>
  // RE_IndirectDiffuse here
  reflectedLight.indirectDiffuse += indirectLightIntensity * irradiance * BRDF_Lambert( material.diffuseColor );

  // modulation
  #include <aomap_fragment>

  vec3 col = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;

  // The "comment out if you want to PBR absolutely" line
  #ifndef DEBUG_LITSHADERATE
    col = min(col, material.diffuseColor);
  #endif

  #if defined( OUTLINE ) && defined( OUTLINE_COLOR_MIXED )
    gl_FragColor = vec4(
      outlineColor.rgb * mix( vec3( 1.0 ), col, outlineLightingMix ),
      diffuseColor.a
    );
    postCorrection();
    return;
  #endif

  #ifdef DEBUG_LITSHADERATE
    gl_FragColor = vec4( col, diffuseColor.a );
    postCorrection();
    return;
  #endif

  // -- MToon: parametric rim lighting -----------------------------------------
  vec3 viewDir = normalize( vViewPosition );
  vec3 rimMix = mix( vec3( 1.0 ), lightingSum + indirectLightIntensity * irradiance, rimLightingMix );
  vec3 rim = rimColor * pow( saturate( 1.0 - dot( viewDir, normal ) + rimLift ), rimFresnelPower );
  #ifdef USE_RIMTEXTURE
    rim *= rimTextureTexelToLinear( texture2D( rimTexture, uv ) ).rgb;
  #endif
  col += rim;

  // -- MToon: additive matcap -------------------------------------------------
  #ifdef USE_SPHEREADD
    {
      vec3 x = normalize( vec3( viewDir.z, 0.0, -viewDir.x ) );
      vec3 y = cross( viewDir, x ); // guaranteed to be normalized
      vec2 sphereUv = 0.5 + 0.5 * vec2( dot( x, normal ), -dot( y, normal ) );
      vec3 matcap = sphereAddTexelToLinear( texture2D( sphereAdd, sphereUv ) ).xyz;
      col += matcap;
    }
  #endif

  // -- MToon: Emission --------------------------------------------------------
  col += totalEmissiveRadiance;

  // #include <envmap_fragment>

  // -- Almost done! -----------------------------------------------------------
  gl_FragColor = vec4( col, diffuseColor.a );
  postCorrection();
}`,this.needsUpdate=!0}_updateCullFace(){this.isOutline?this.outlineCullMode===Yi.Off?this.side=Bi:this.outlineCullMode===Yi.Front?this.side=Rt:this.outlineCullMode===Yi.Back&&(this.side=js):this.cullMode===Yi.Off?this.side=Bi:this.cullMode===Yi.Front?this.side=Rt:this.cullMode===Yi.Back&&(this.side=js)}}var On;(function(n){n[n.Opaque=0]="Opaque",n[n.Cutout=1]="Cutout",n[n.Transparent=2]="Transparent",n[n.TransparentWithZWrite=3]="TransparentWithZWrite"})(On||(On={}));class Cd extends Cn{constructor(e){super(),this.isVRMUnlitMaterial=!0,this.cutoff=.5,this.map=null,this.mainTex_ST=new Be(0,0,1,1),this._renderType=On.Opaque,this.shouldApplyUniforms=!0,e===void 0&&(e={}),e.fog=!0,e.clipping=!0,parseInt(us,10)<129&&(e.skinning=e.skinning||!1),parseInt(us,10)<131&&(e.morphTargets=e.morphTargets||!1,e.morphNormals=e.morphNormals||!1),e.uniforms=fa.merge([fe.common,fe.fog,{cutoff:{value:.5},mainTex_ST:{value:new Be(0,0,1,1)}}]),this.setValues(e),this._updateShaderCode(),this._applyUniforms()}get mainTex(){return this.map}set mainTex(e){this.map=e}get renderType(){return this._renderType}set renderType(e){this._renderType=e,this.depthWrite=this._renderType!==On.Transparent,this.transparent=this._renderType===On.Transparent||this._renderType===On.TransparentWithZWrite,this._updateShaderCode()}updateVRMMaterials(e){this._applyUniforms()}copy(e){return super.copy(e),this.cutoff=e.cutoff,this.map=e.map,this.mainTex_ST.copy(e.mainTex_ST),this.renderType=e.renderType,this}_applyUniforms(){this.shouldApplyUniforms&&(this.shouldApplyUniforms=!1,this.uniforms.cutoff.value=this.cutoff,this.uniforms.map.value=this.map,this.uniforms.mainTex_ST.value.copy(this.mainTex_ST))}_updateShaderCode(){this.defines={RENDERTYPE_OPAQUE:this._renderType===On.Opaque,RENDERTYPE_CUTOUT:this._renderType===On.Cutout,RENDERTYPE_TRANSPARENT:this._renderType===On.Transparent||this._renderType===On.TransparentWithZWrite},this.vertexShader=`#include <common>

// #include <uv_pars_vertex>
#ifdef USE_MAP
  varying vec2 vUv;
  uniform vec4 mainTex_ST;
#endif

#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

  // #include <uv_vertex>
  #ifdef USE_MAP
    vUv = vec2( mainTex_ST.p * uv.x + mainTex_ST.s, mainTex_ST.q * uv.y + mainTex_ST.t );
  #endif

  #include <uv2_vertex>
  #include <color_vertex>
  #include <skinbase_vertex>

  #ifdef USE_ENVMAP

  #include <beginnormal_vertex>
  #include <morphnormal_vertex>
  #include <skinnormal_vertex>
  #include <defaultnormal_vertex>

  #endif

  #include <begin_vertex>
  #include <morphtarget_vertex>
  #include <skinning_vertex>
  #include <project_vertex>
  #include <logdepthbuf_vertex>

  #include <worldpos_vertex>
  #include <clipping_planes_vertex>
  #include <envmap_vertex>
  #include <fog_vertex>

}`,this.fragmentShader=`#ifdef RENDERTYPE_CUTOUT
  uniform float cutoff;
#endif

#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
// #include <alphamap_pars_fragment>
// #include <aomap_pars_fragment>
// #include <lightmap_pars_fragment>
// #include <envmap_pars_fragment>
#include <fog_pars_fragment>
// #include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

// == main procedure ===========================================================
void main() {
  #include <clipping_planes_fragment>

  vec4 diffuseColor = vec4( 1.0 );

  #include <logdepthbuf_fragment>

  // #include <map_fragment>
  #ifdef USE_MAP
    diffuseColor *= mapTexelToLinear( texture2D( map, vUv ) );
  #endif

  #include <color_fragment>
  // #include <alphamap_fragment>

  // MToon: alpha
  // #include <alphatest_fragment>
  #ifdef RENDERTYPE_CUTOUT
    if ( diffuseColor.a <= cutoff ) { discard; }
    diffuseColor.a = 1.0;
  #endif

  #ifdef RENDERTYPE_OPAQUE
    diffuseColor.a = 1.0;
  #endif

  // #include <specularmap_fragment>

  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

  // accumulation (baked indirect lighting only)
  #ifdef USE_LIGHTMAP
    reflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;
  #else
    reflectedLight.indirectDiffuse += vec3( 1.0 );
  #endif

  // modulation
  // #include <aomap_fragment>

  reflectedLight.indirectDiffuse *= diffuseColor.rgb;
  vec3 outgoingLight = reflectedLight.indirectDiffuse;

  // #include <envmap_fragment>

  gl_FragColor = vec4( outgoingLight, diffuseColor.a );

  #include <premultiplied_alpha_fragment>
  #include <tonemapping_fragment>
  #include <encodings_fragment>
  #include <fog_fragment>
}`,this.needsUpdate=!0}}class S5{constructor(e={}){this._encoding=e.encoding||Lt,this._encoding!==Lt&&this._encoding!==ri&&console.warn("The specified color encoding might not work properly with VRMMaterialImporter. You might want to use THREE.sRGBEncoding instead."),this._requestEnvMap=e.requestEnvMap}convertGLTFMaterials(e){var t;return At(this,void 0,void 0,function*(){const i=(t=e.parser.json.extensions)===null||t===void 0?void 0:t.VRM;if(!i)return null;const s=i.materialProperties;if(!s)return null;const r=yield US(e),o={},a=[];return yield Promise.all(Array.from(r.entries()).map(([l,c])=>At(this,void 0,void 0,function*(){const h=e.parser.json.nodes[l],u=e.parser.json.meshes[h.mesh];yield Promise.all(c.map((d,f)=>At(this,void 0,void 0,function*(){const p=u.primitives[f];if(!p)return;const _=d.geometry,y=_.index?_.index.count:_.attributes.position.count/3;Array.isArray(d.material)||(d.material=[d.material],_.addGroup(0,y,0));const m=p.material;let g,v=s[m];v||(console.warn(`VRMMaterialImporter: There are no material definition for material #${m} on VRM extension.`),v={shader:"VRM_USE_GLTFSHADER"}),o[m]?g=o[m]:(g=yield this.createVRMMaterials(d.material[0],v,e),o[m]=g,a.push(g.surface),g.outline&&a.push(g.outline)),d.material[0]=g.surface,this._requestEnvMap&&g.surface.isMeshStandardMaterial&&this._requestEnvMap().then(x=>{g.surface.envMap=x,g.surface.needsUpdate=!0}),d.renderOrder=v.renderQueue||2e3,g.outline&&(d.material[1]=g.outline,_.addGroup(0,y,1))})))}))),a})}createVRMMaterials(e,t,i){return At(this,void 0,void 0,function*(){let s,r;if(t.shader==="VRM/MToon"){const o=yield this._extractMaterialProperties(e,t,i);["srcBlend","dstBlend","isFirstSetup"].forEach(a=>{o[a]!==void 0&&delete o[a]}),["mainTex","shadeTexture","emissionMap","sphereAdd","rimTexture"].forEach(a=>{o[a]!==void 0&&(o[a].encoding=this._encoding)}),o.encoding=this._encoding,s=new GS(o),o.outlineWidthMode!==Ba.None&&(o.isOutline=!0,r=new GS(o))}else if(t.shader==="VRM/UnlitTexture"){const o=yield this._extractMaterialProperties(e,t,i);o.renderType=On.Opaque,s=new Cd(o)}else if(t.shader==="VRM/UnlitCutout"){const o=yield this._extractMaterialProperties(e,t,i);o.renderType=On.Cutout,s=new Cd(o)}else if(t.shader==="VRM/UnlitTransparent"){const o=yield this._extractMaterialProperties(e,t,i);o.renderType=On.Transparent,s=new Cd(o)}else if(t.shader==="VRM/UnlitTransparentZWrite"){const o=yield this._extractMaterialProperties(e,t,i);o.renderType=On.TransparentWithZWrite,s=new Cd(o)}else t.shader!=="VRM_USE_GLTFSHADER"&&console.warn(`Unknown shader detected: "${t.shader}"`),s=this._convertGLTFMaterial(e.clone());return s.name=e.name,s.userData=JSON.parse(JSON.stringify(e.userData)),s.userData.vrmMaterialProperties=t,r&&(r.name=e.name+" (Outline)",r.userData=JSON.parse(JSON.stringify(e.userData)),r.userData.vrmMaterialProperties=t),{surface:s,outline:r}})}_renameMaterialProperty(e){return e[0]!=="_"?(console.warn(`VRMMaterials: Given property name "${e}" might be invalid`),e):(e=e.substring(1),/[A-Z]/.test(e[0])?e[0].toLowerCase()+e.substring(1):(console.warn(`VRMMaterials: Given property name "${e}" might be invalid`),e))}_convertGLTFMaterial(e){if(e.isMeshStandardMaterial){const t=e;t.map&&(t.map.encoding=this._encoding),t.emissiveMap&&(t.emissiveMap.encoding=this._encoding),this._encoding===Lt&&(t.color.convertLinearToSRGB(),t.emissive.convertLinearToSRGB())}if(e.isMeshBasicMaterial){const t=e;t.map&&(t.map.encoding=this._encoding),this._encoding===Lt&&t.color.convertLinearToSRGB()}return e}_extractMaterialProperties(e,t,i){const s=[],r={};if(t.textureProperties)for(const o of Object.keys(t.textureProperties)){const a=this._renameMaterialProperty(o),l=t.textureProperties[o];s.push(i.parser.getDependency("texture",l).then(c=>{r[a]=c}))}if(t.floatProperties)for(const o of Object.keys(t.floatProperties)){const a=this._renameMaterialProperty(o);r[a]=t.floatProperties[o]}if(t.vectorProperties)for(const o of Object.keys(t.vectorProperties)){let a=this._renameMaterialProperty(o);["_MainTex","_ShadeTexture","_BumpMap","_ReceiveShadowTexture","_ShadingGradeTexture","_RimTexture","_SphereAdd","_EmissionMap","_OutlineWidthTexture","_UvAnimMaskTexture"].some(l=>o===l)&&(a+="_ST"),r[a]=new Be(...t.vectorProperties[o])}return parseInt(us,10)<129&&(r.skinning=e.skinning||!1),parseInt(us,10)<131&&(r.morphTargets=e.morphTargets||!1,r.morphNormals=e.morphNormals||!1),Promise.all(s).then(()=>r)}}class E5{constructor(e){var t;this.ignoreTexture=(t=e==null?void 0:e.ignoreTexture)!==null&&t!==void 0&&t}import(e){var t;return At(this,void 0,void 0,function*(){const i=(t=e.parser.json.extensions)===null||t===void 0?void 0:t.VRM;if(!i)return null;const s=i.meta;if(!s)return null;let r;return this.ignoreTexture||s.texture==null||s.texture===-1||(r=yield e.parser.getDependency("texture",s.texture)),{allowedUserName:s.allowedUserName,author:s.author,commercialUssageName:s.commercialUssageName,contactInformation:s.contactInformation,licenseName:s.licenseName,otherLicenseUrl:s.otherLicenseUrl,otherPermissionUrl:s.otherPermissionUrl,reference:s.reference,sexualUssageName:s.sexualUssageName,texture:r!=null?r:void 0,title:s.title,version:s.version,violentUssageName:s.violentUssageName}})}}const M5=new be;function WS(n){return n.invert?n.invert():n.getInverse(M5.copy(n)),n}class A5{constructor(e){this._inverseCache=new be,this._shouldUpdateInverse=!0,this.matrix=e;const t={set:(i,s,r)=>(this._shouldUpdateInverse=!0,i[s]=r,!0)};this._originalElements=e.elements,e.elements=new Proxy(e.elements,t)}get inverse(){return this._shouldUpdateInverse&&(WS(this._inverseCache.copy(this.matrix)),this._shouldUpdateInverse=!1),this._inverseCache}revert(){this.matrix.elements=this._originalElements}}const C5=Object.freeze(new be),I5=Object.freeze(new gt),Ha=new C,XS=new C,R5=new C,L5=new gt,Zt=new be,Id=new be;class P5{constructor(e,t={}){var i,s,r,o,a,l;if(this._currentTail=new C,this._prevTail=new C,this._nextTail=new C,this._boneAxis=new C,this._centerSpacePosition=new C,this._center=null,this._parentWorldRotation=new gt,this._initialLocalMatrix=new be,this._initialLocalRotation=new gt,this._initialLocalChildPosition=new C,this.bone=e,this.bone.matrixAutoUpdate=!1,this.radius=(i=t.radius)!==null&&i!==void 0?i:.02,this.stiffnessForce=(s=t.stiffnessForce)!==null&&s!==void 0?s:1,this.gravityDir=t.gravityDir?new C().copy(t.gravityDir):new C().set(0,-1,0),this.gravityPower=(r=t.gravityPower)!==null&&r!==void 0?r:0,this.dragForce=(o=t.dragForce)!==null&&o!==void 0?o:.4,this.colliders=(a=t.colliders)!==null&&a!==void 0?a:[],this._centerSpacePosition.setFromMatrixPosition(this.bone.matrixWorld),this._initialLocalMatrix.copy(this.bone.matrix),this._initialLocalRotation.copy(this.bone.quaternion),this.bone.children.length===0)this._initialLocalChildPosition.copy(this.bone.position).normalize().multiplyScalar(.07);else{const c=this.bone.children[0];this._initialLocalChildPosition.copy(c.position)}this.bone.localToWorld(this._currentTail.copy(this._initialLocalChildPosition)),this._prevTail.copy(this._currentTail),this._nextTail.copy(this._currentTail),this._boneAxis.copy(this._initialLocalChildPosition).normalize(),this._centerSpaceBoneLength=Ha.copy(this._initialLocalChildPosition).applyMatrix4(this.bone.matrixWorld).sub(this._centerSpacePosition).length(),this.center=(l=t.center)!==null&&l!==void 0?l:null}get center(){return this._center}set center(e){var t;this._getMatrixCenterToWorld(Zt),this._currentTail.applyMatrix4(Zt),this._prevTail.applyMatrix4(Zt),this._nextTail.applyMatrix4(Zt),((t=this._center)===null||t===void 0?void 0:t.userData.inverseCacheProxy)&&(this._center.userData.inverseCacheProxy.revert(),delete this._center.userData.inverseCacheProxy),this._center=e,this._center&&(this._center.userData.inverseCacheProxy||(this._center.userData.inverseCacheProxy=new A5(this._center.matrixWorld))),this._getMatrixWorldToCenter(Zt),this._currentTail.applyMatrix4(Zt),this._prevTail.applyMatrix4(Zt),this._nextTail.applyMatrix4(Zt),Zt.multiply(this.bone.matrixWorld),this._centerSpacePosition.setFromMatrixPosition(Zt),this._centerSpaceBoneLength=Ha.copy(this._initialLocalChildPosition).applyMatrix4(Zt).sub(this._centerSpacePosition).length()}reset(){this.bone.quaternion.copy(this._initialLocalRotation),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this._getParentMatrixWorld(),this.bone.matrix),this._centerSpacePosition.setFromMatrixPosition(this.bone.matrixWorld),this.bone.localToWorld(this._currentTail.copy(this._initialLocalChildPosition)),this._prevTail.copy(this._currentTail),this._nextTail.copy(this._currentTail)}update(e){if(e<=0)return;this.bone.matrixWorld.multiplyMatrices(this._getParentMatrixWorld(),this.bone.matrix),this.bone.parent?Ad(this.bone.parent,this._parentWorldRotation):this._parentWorldRotation.copy(I5),this._getMatrixWorldToCenter(Zt),Zt.multiply(this.bone.matrixWorld),this._centerSpacePosition.setFromMatrixPosition(Zt),this._getMatrixWorldToCenter(Id),Id.multiply(this._getParentMatrixWorld());const t=this.stiffnessForce*e,i=XS.copy(this.gravityDir).multiplyScalar(this.gravityPower*e);this._nextTail.copy(this._currentTail).add(Ha.copy(this._currentTail).sub(this._prevTail).multiplyScalar(1-this.dragForce)).add(Ha.copy(this._boneAxis).applyMatrix4(this._initialLocalMatrix).applyMatrix4(Id).sub(this._centerSpacePosition).normalize().multiplyScalar(t)).add(i),this._nextTail.sub(this._centerSpacePosition).normalize().multiplyScalar(this._centerSpaceBoneLength).add(this._centerSpacePosition),this._collision(this._nextTail),this._prevTail.copy(this._currentTail),this._currentTail.copy(this._nextTail);const s=WS(Zt.copy(Id.multiply(this._initialLocalMatrix))),r=L5.setFromUnitVectors(this._boneAxis,Ha.copy(this._nextTail).applyMatrix4(s).normalize());this.bone.quaternion.copy(this._initialLocalRotation).multiply(r),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this._getParentMatrixWorld(),this.bone.matrix)}_collision(e){this.colliders.forEach(t=>{this._getMatrixWorldToCenter(Zt),Zt.multiply(t.matrixWorld);const i=Ha.setFromMatrixPosition(Zt),s=t.geometry.boundingSphere.radius,r=this.radius+s;if(e.distanceToSquared(i)<=r*r){const o=XS.subVectors(e,i).normalize(),a=R5.addVectors(i,o.multiplyScalar(r));e.copy(a.sub(this._centerSpacePosition).normalize().multiplyScalar(this._centerSpaceBoneLength).add(this._centerSpacePosition))}})}_getMatrixCenterToWorld(e){return this._center?e.copy(this._center.matrixWorld):e.identity(),e}_getMatrixWorldToCenter(e){return this._center?e.copy(this._center.userData.inverseCacheProxy.inverse):e.identity(),e}_getParentMatrixWorld(){return this.bone.parent?this.bone.parent.matrixWorld:C5}}class N5{constructor(e,t){this.colliderGroups=[],this.springBoneGroupList=[],this.colliderGroups=e,this.springBoneGroupList=t}setCenter(e){this.springBoneGroupList.forEach(t=>{t.forEach(i=>{i.center=e})})}lateUpdate(e){this.springBoneGroupList.forEach(t=>{t.forEach(i=>{i.update(e)})})}reset(){this.springBoneGroupList.forEach(e=>{e.forEach(t=>{t.reset()})})}}const F5=new C,D5=new li({visible:!1});class O5{import(e){var t;return At(this,void 0,void 0,function*(){const i=(t=e.parser.json.extensions)===null||t===void 0?void 0:t.VRM;if(!i)return null;const s=i.secondaryAnimation;if(!s)return null;const r=yield this._importColliderMeshGroups(e,s),o=yield this._importSpringBoneGroupList(e,s,r);return new N5(r,o)})}_createSpringBone(e,t={}){return new P5(e,t)}_importSpringBoneGroupList(e,t,i){return At(this,void 0,void 0,function*(){const s=t.boneGroups||[],r=[];return yield Promise.all(s.map(o=>At(this,void 0,void 0,function*(){if(o.stiffiness===void 0||o.gravityDir===void 0||o.gravityDir.x===void 0||o.gravityDir.y===void 0||o.gravityDir.z===void 0||o.gravityPower===void 0||o.dragForce===void 0||o.hitRadius===void 0||o.colliderGroups===void 0||o.bones===void 0||o.center===void 0)return;const a=o.stiffiness,l=new C(o.gravityDir.x,o.gravityDir.y,-o.gravityDir.z),c=o.gravityPower,h=o.dragForce,u=o.hitRadius,d=[];o.colliderGroups.forEach(p=>{d.push(...i[p].colliders)});const f=[];yield Promise.all(o.bones.map(p=>At(this,void 0,void 0,function*(){const _=yield e.parser.getDependency("node",p),y=o.center!==-1?yield e.parser.getDependency("node",o.center):null;_&&_.traverse(m=>{const g=this._createSpringBone(m,{radius:u,stiffnessForce:a,gravityDir:l,gravityPower:c,dragForce:h,colliders:d,center:y});f.push(g)})}))),r.push(f)}))),r})}_importColliderMeshGroups(e,t){return At(this,void 0,void 0,function*(){const i=t.colliderGroups;if(i===void 0)return[];const s=[];return i.forEach(r=>At(this,void 0,void 0,function*(){if(r.node===void 0||r.colliders===void 0)return;const o=yield e.parser.getDependency("node",r.node),a=[];r.colliders.forEach(c=>{if(c.offset===void 0||c.offset.x===void 0||c.offset.y===void 0||c.offset.z===void 0||c.radius===void 0)return;const h=F5.set(c.offset.x,c.offset.y,-c.offset.z),u=this._createColliderMesh(c.radius,h);o.add(u),a.push(u)});const l={node:r.node,colliders:a};s.push(l)})),s})}_createColliderMesh(e,t){const i=new Vt(new Ng(e,8,4),D5);return i.position.copy(t),i.name="vrmColliderSphere",i.geometry.computeBoundingSphere(),i}}class k5{constructor(e={}){this._metaImporter=e.metaImporter||new E5,this._blendShapeImporter=e.blendShapeImporter||new c5,this._lookAtImporter=e.lookAtImporter||new T5,this._humanoidImporter=e.humanoidImporter||new m5,this._firstPersonImporter=e.firstPersonImporter||new d5,this._materialImporter=e.materialImporter||new S5,this._springBoneImporter=e.springBoneImporter||new O5}import(e){return At(this,void 0,void 0,function*(){if(e.parser.json.extensions===void 0||e.parser.json.extensions.VRM===void 0)throw new Error("Could not find VRM extension on the GLTF");const t=e.scene;t.updateMatrixWorld(!1),t.traverse(h=>{h.isMesh&&(h.frustumCulled=!1)});const i=(yield this._metaImporter.import(e))||void 0,s=(yield this._materialImporter.convertGLTFMaterials(e))||void 0,r=(yield this._humanoidImporter.import(e))||void 0,o=r&&(yield this._firstPersonImporter.import(e,r))||void 0,a=(yield this._blendShapeImporter.import(e))||void 0,l=o&&a&&r&&(yield this._lookAtImporter.import(e,o,a,r))||void 0,c=(yield this._springBoneImporter.import(e))||void 0;return new s_({scene:e.scene,meta:i,materials:s,humanoid:r,firstPerson:o,blendShapeProxy:a,lookAt:l,springBoneManager:c})})}}class s_{constructor(e){this.scene=e.scene,this.humanoid=e.humanoid,this.blendShapeProxy=e.blendShapeProxy,this.firstPerson=e.firstPerson,this.lookAt=e.lookAt,this.materials=e.materials,this.springBoneManager=e.springBoneManager,this.meta=e.meta}static from(e,t={}){return At(this,void 0,void 0,function*(){return yield new k5(t).import(e)})}update(e){this.lookAt&&this.lookAt.update(e),this.blendShapeProxy&&this.blendShapeProxy.update(),this.springBoneManager&&this.springBoneManager.lateUpdate(e),this.materials&&this.materials.forEach(t=>{t.updateVRMMaterials&&t.updateVRMMaterials(e)})}dispose(){var e,t;const i=this.scene;i&&i.traverse(ZU),(t=(e=this.meta)===null||e===void 0?void 0:e.texture)===null||t===void 0||t.dispose()}}new ie;new ar(-1,1,-1,1,-1,1);const U5=new li({color:16777215,side:Bi}),B5=new Vt(new nd(2,2),U5),H5=new od;H5.add(B5);new C;new li({color:16711935,wireframe:!0,transparent:!0,depthTest:!1});new C;var z5=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},qS={exports:{}};(function(n,e){(function(t,i){n.exports=i()})(z5,function(){var t=function(){function i(f){return o.appendChild(f.dom),f}function s(f){for(var p=0;p<o.children.length;p++)o.children[p].style.display=p===f?"block":"none";r=f}var r=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(f){f.preventDefault(),s(++r%o.children.length)},!1);var a=(performance||Date).now(),l=a,c=0,h=i(new t.Panel("FPS","#0ff","#002")),u=i(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=i(new t.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:o,addPanel:i,showPanel:s,begin:function(){a=(performance||Date).now()},end:function(){c++;var f=(performance||Date).now();if(u.update(f-a,200),f>l+1e3&&(h.update(1e3*c/(f-l),100),l=f,c=0,d)){var p=performance.memory;d.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return f},update:function(){a=this.end()},domElement:o,setMode:s}};return t.Panel=function(i,s,r){var o=1/0,a=0,l=Math.round,c=l(window.devicePixelRatio||1),h=80*c,u=48*c,d=3*c,f=2*c,p=3*c,_=15*c,y=74*c,m=30*c,g=document.createElement("canvas");g.width=h,g.height=u,g.style.cssText="width:80px;height:48px";var v=g.getContext("2d");return v.font="bold "+9*c+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=r,v.fillRect(0,0,h,u),v.fillStyle=s,v.fillText(i,d,f),v.fillRect(p,_,y,m),v.fillStyle=r,v.globalAlpha=.9,v.fillRect(p,_,y,m),{dom:g,update:function(x,T){o=Math.min(o,x),a=Math.max(a,x),v.fillStyle=r,v.globalAlpha=1,v.fillRect(0,0,h,_),v.fillStyle=s,v.fillText(l(x)+" "+i+" ("+l(o)+"-"+l(a)+")",d,f),v.drawImage(g,p+c,_,y-c,m,p,_,y-c,m),v.fillRect(p+y-c,_,c,m),v.fillStyle=r,v.globalAlpha=.9,v.fillRect(p+y-c,_,c,l((1-x/T)*m))}}},t})})(qS);var V5=qS.exports,YS={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},r_={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},G5=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],Rd={CSS:{},springs:{}};function $i(n,e,t){return Math.min(Math.max(n,e),t)}function Fc(n,e){return n.indexOf(e)>-1}function o_(n,e){return n.apply(null,e)}var Ee={arr:function(n){return Array.isArray(n)},obj:function(n){return Fc(Object.prototype.toString.call(n),"Object")},pth:function(n){return Ee.obj(n)&&n.hasOwnProperty("totalLength")},svg:function(n){return n instanceof SVGElement},inp:function(n){return n instanceof HTMLInputElement},dom:function(n){return n.nodeType||Ee.svg(n)},str:function(n){return typeof n=="string"},fnc:function(n){return typeof n=="function"},und:function(n){return typeof n=="undefined"},nil:function(n){return Ee.und(n)||n===null},hex:function(n){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n)},rgb:function(n){return/^rgb/.test(n)},hsl:function(n){return/^hsl/.test(n)},col:function(n){return Ee.hex(n)||Ee.rgb(n)||Ee.hsl(n)},key:function(n){return!YS.hasOwnProperty(n)&&!r_.hasOwnProperty(n)&&n!=="targets"&&n!=="keyframes"}};function jS(n){var e=/\(([^)]+)\)/.exec(n);return e?e[1].split(",").map(function(t){return parseFloat(t)}):[]}function $S(n,e){var t=jS(n),i=$i(Ee.und(t[0])?1:t[0],.1,100),s=$i(Ee.und(t[1])?100:t[1],.1,100),r=$i(Ee.und(t[2])?10:t[2],.1,100),o=$i(Ee.und(t[3])?0:t[3],.1,100),a=Math.sqrt(s/i),l=r/(2*Math.sqrt(s*i)),c=l<1?a*Math.sqrt(1-l*l):0,h=1,u=l<1?(l*a+-o)/c:-o+a;function d(p){var _=e?e*p/1e3:p;return l<1?_=Math.exp(-_*l*a)*(h*Math.cos(c*_)+u*Math.sin(c*_)):_=(h+u*_)*Math.exp(-_*a),p===0||p===1?p:1-_}function f(){var p=Rd.springs[n];if(p)return p;for(var _=1/6,y=0,m=0;;)if(y+=_,d(y)===1){if(m++,m>=16)break}else m=0;var g=y*_*1e3;return Rd.springs[n]=g,g}return e?d:f}function W5(n){return n===void 0&&(n=10),function(e){return Math.ceil($i(e,1e-6,1)*n)*(1/n)}}var X5=function(){var n=11,e=1/(n-1);function t(h,u){return 1-3*u+3*h}function i(h,u){return 3*u-6*h}function s(h){return 3*h}function r(h,u,d){return((t(u,d)*h+i(u,d))*h+s(u))*h}function o(h,u,d){return 3*t(u,d)*h*h+2*i(u,d)*h+s(u)}function a(h,u,d,f,p){var _,y,m=0;do y=u+(d-u)/2,_=r(y,f,p)-h,_>0?d=y:u=y;while(Math.abs(_)>1e-7&&++m<10);return y}function l(h,u,d,f){for(var p=0;p<4;++p){var _=o(u,d,f);if(_===0)return u;var y=r(u,d,f)-h;u-=y/_}return u}function c(h,u,d,f){if(!(0<=h&&h<=1&&0<=d&&d<=1))return;var p=new Float32Array(n);if(h!==u||d!==f)for(var _=0;_<n;++_)p[_]=r(_*e,h,d);function y(m){for(var g=0,v=1,x=n-1;v!==x&&p[v]<=m;++v)g+=e;--v;var T=(m-p[v])/(p[v+1]-p[v]),S=g+T*e,b=o(S,h,d);return b>=.001?l(m,S,h,d):b===0?S:a(m,g,g+e,h,d)}return function(m){return h===u&&d===f||m===0||m===1?m:r(y(m),u,f)}}return c}(),QS=function(){var n={linear:function(){return function(i){return i}}},e={Sine:function(){return function(i){return 1-Math.cos(i*Math.PI/2)}},Circ:function(){return function(i){return 1-Math.sqrt(1-i*i)}},Back:function(){return function(i){return i*i*(3*i-2)}},Bounce:function(){return function(i){for(var s,r=4;i<((s=Math.pow(2,--r))-1)/11;);return 1/Math.pow(4,3-r)-7.5625*Math.pow((s*3-2)/22-i,2)}},Elastic:function(i,s){i===void 0&&(i=1),s===void 0&&(s=.5);var r=$i(i,1,10),o=$i(s,.1,2);return function(a){return a===0||a===1?a:-r*Math.pow(2,10*(a-1))*Math.sin((a-1-o/(Math.PI*2)*Math.asin(1/r))*(Math.PI*2)/o)}}},t=["Quad","Cubic","Quart","Quint","Expo"];return t.forEach(function(i,s){e[i]=function(){return function(r){return Math.pow(r,s+2)}}}),Object.keys(e).forEach(function(i){var s=e[i];n["easeIn"+i]=s,n["easeOut"+i]=function(r,o){return function(a){return 1-s(r,o)(1-a)}},n["easeInOut"+i]=function(r,o){return function(a){return a<.5?s(r,o)(a*2)/2:1-s(r,o)(a*-2+2)/2}},n["easeOutIn"+i]=function(r,o){return function(a){return a<.5?(1-s(r,o)(1-a*2))/2:(s(r,o)(a*2-1)+1)/2}}}),n}();function a_(n,e){if(Ee.fnc(n))return n;var t=n.split("(")[0],i=QS[t],s=jS(n);switch(t){case"spring":return $S(n,e);case"cubicBezier":return o_(X5,s);case"steps":return o_(W5,s);default:return o_(i,s)}}function KS(n){try{var e=document.querySelectorAll(n);return e}catch{return}}function Ld(n,e){for(var t=n.length,i=arguments.length>=2?arguments[1]:void 0,s=[],r=0;r<t;r++)if(r in n){var o=n[r];e.call(i,o,r,n)&&s.push(o)}return s}function Pd(n){return n.reduce(function(e,t){return e.concat(Ee.arr(t)?Pd(t):t)},[])}function JS(n){return Ee.arr(n)?n:(Ee.str(n)&&(n=KS(n)||n),n instanceof NodeList||n instanceof HTMLCollection?[].slice.call(n):[n])}function l_(n,e){return n.some(function(t){return t===e})}function c_(n){var e={};for(var t in n)e[t]=n[t];return e}function u_(n,e){var t=c_(n);for(var i in n)t[i]=e.hasOwnProperty(i)?e[i]:n[i];return t}function Nd(n,e){var t=c_(n);for(var i in e)t[i]=Ee.und(n[i])?e[i]:n[i];return t}function q5(n){var e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(n);return e?"rgba("+e[1]+",1)":n}function Y5(n){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,t=n.replace(e,function(a,l,c,h){return l+l+c+c+h+h}),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),s=parseInt(i[1],16),r=parseInt(i[2],16),o=parseInt(i[3],16);return"rgba("+s+","+r+","+o+",1)"}function j5(n){var e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(n)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(n),t=parseInt(e[1],10)/360,i=parseInt(e[2],10)/100,s=parseInt(e[3],10)/100,r=e[4]||1;function o(d,f,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?d+(f-d)*6*p:p<1/2?f:p<2/3?d+(f-d)*(2/3-p)*6:d}var a,l,c;if(i==0)a=l=c=s;else{var h=s<.5?s*(1+i):s+i-s*i,u=2*s-h;a=o(u,h,t+1/3),l=o(u,h,t),c=o(u,h,t-1/3)}return"rgba("+a*255+","+l*255+","+c*255+","+r+")"}function $5(n){if(Ee.rgb(n))return q5(n);if(Ee.hex(n))return Y5(n);if(Ee.hsl(n))return j5(n)}function bs(n){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(n);if(e)return e[1]}function Q5(n){if(Fc(n,"translate")||n==="perspective")return"px";if(Fc(n,"rotate")||Fc(n,"skew"))return"deg"}function h_(n,e){return Ee.fnc(n)?n(e.target,e.id,e.total):n}function Qi(n,e){return n.getAttribute(e)}function d_(n,e,t){var i=bs(e);if(l_([t,"deg","rad","turn"],i))return e;var s=Rd.CSS[e+t];if(!Ee.und(s))return s;var r=100,o=document.createElement(n.tagName),a=n.parentNode&&n.parentNode!==document?n.parentNode:document.body;a.appendChild(o),o.style.position="absolute",o.style.width=r+t;var l=r/o.offsetWidth;a.removeChild(o);var c=l*parseFloat(e);return Rd.CSS[e+t]=c,c}function ZS(n,e,t){if(e in n.style){var i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),s=n.style[e]||getComputedStyle(n).getPropertyValue(i)||"0";return t?d_(n,s,t):s}}function f_(n,e){if(Ee.dom(n)&&!Ee.inp(n)&&(!Ee.nil(Qi(n,e))||Ee.svg(n)&&n[e]))return"attribute";if(Ee.dom(n)&&l_(G5,e))return"transform";if(Ee.dom(n)&&e!=="transform"&&ZS(n,e))return"css";if(n[e]!=null)return"object"}function eE(n){if(!!Ee.dom(n)){for(var e=n.style.transform||"",t=/(\w+)\(([^)]*)\)/g,i=new Map,s;s=t.exec(e);)i.set(s[1],s[2]);return i}}function K5(n,e,t,i){var s=Fc(e,"scale")?1:0+Q5(e),r=eE(n).get(e)||s;return t&&(t.transforms.list.set(e,r),t.transforms.last=e),i?d_(n,r,i):r}function p_(n,e,t,i){switch(f_(n,e)){case"transform":return K5(n,e,i,t);case"css":return ZS(n,e,t);case"attribute":return Qi(n,e);default:return n[e]||0}}function m_(n,e){var t=/^(\*=|\+=|-=)/.exec(n);if(!t)return n;var i=bs(n)||0,s=parseFloat(e),r=parseFloat(n.replace(t[0],""));switch(t[0][0]){case"+":return s+r+i;case"-":return s-r+i;case"*":return s*r+i}}function tE(n,e){if(Ee.col(n))return $5(n);if(/\s/g.test(n))return n;var t=bs(n),i=t?n.substr(0,n.length-t.length):n;return e?i+e:i}function g_(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function J5(n){return Math.PI*2*Qi(n,"r")}function Z5(n){return Qi(n,"width")*2+Qi(n,"height")*2}function eB(n){return g_({x:Qi(n,"x1"),y:Qi(n,"y1")},{x:Qi(n,"x2"),y:Qi(n,"y2")})}function nE(n){for(var e=n.points,t=0,i,s=0;s<e.numberOfItems;s++){var r=e.getItem(s);s>0&&(t+=g_(i,r)),i=r}return t}function tB(n){var e=n.points;return nE(n)+g_(e.getItem(e.numberOfItems-1),e.getItem(0))}function iE(n){if(n.getTotalLength)return n.getTotalLength();switch(n.tagName.toLowerCase()){case"circle":return J5(n);case"rect":return Z5(n);case"line":return eB(n);case"polyline":return nE(n);case"polygon":return tB(n)}}function nB(n){var e=iE(n);return n.setAttribute("stroke-dasharray",e),e}function iB(n){for(var e=n.parentNode;Ee.svg(e)&&Ee.svg(e.parentNode);)e=e.parentNode;return e}function sE(n,e){var t=e||{},i=t.el||iB(n),s=i.getBoundingClientRect(),r=Qi(i,"viewBox"),o=s.width,a=s.height,l=t.viewBox||(r?r.split(" "):[0,0,o,a]);return{el:i,viewBox:l,x:l[0]/1,y:l[1]/1,w:o,h:a,vW:l[2],vH:l[3]}}function sB(n,e){var t=Ee.str(n)?KS(n)[0]:n,i=e||100;return function(s){return{property:s,el:t,svg:sE(t),totalLength:iE(t)*(i/100)}}}function rB(n,e,t){function i(h){h===void 0&&(h=0);var u=e+h>=1?e+h:0;return n.el.getPointAtLength(u)}var s=sE(n.el,n.svg),r=i(),o=i(-1),a=i(1),l=t?1:s.w/s.vW,c=t?1:s.h/s.vH;switch(n.property){case"x":return(r.x-s.x)*l;case"y":return(r.y-s.y)*c;case"angle":return Math.atan2(a.y-o.y,a.x-o.x)*180/Math.PI}}function rE(n,e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,i=tE(Ee.pth(n)?n.totalLength:n,e)+"";return{original:i,numbers:i.match(t)?i.match(t).map(Number):[0],strings:Ee.str(n)||e?i.split(t):[]}}function __(n){var e=n?Pd(Ee.arr(n)?n.map(JS):JS(n)):[];return Ld(e,function(t,i,s){return s.indexOf(t)===i})}function oE(n){var e=__(n);return e.map(function(t,i){return{target:t,id:i,total:e.length,transforms:{list:eE(t)}}})}function oB(n,e){var t=c_(e);if(/^spring/.test(t.easing)&&(t.duration=$S(t.easing)),Ee.arr(n)){var i=n.length,s=i===2&&!Ee.obj(n[0]);s?n={value:n}:Ee.fnc(e.duration)||(t.duration=e.duration/i)}var r=Ee.arr(n)?n:[n];return r.map(function(o,a){var l=Ee.obj(o)&&!Ee.pth(o)?o:{value:o};return Ee.und(l.delay)&&(l.delay=a?0:e.delay),Ee.und(l.endDelay)&&(l.endDelay=a===r.length-1?e.endDelay:0),l}).map(function(o){return Nd(o,t)})}function aB(n){for(var e=Ld(Pd(n.map(function(r){return Object.keys(r)})),function(r){return Ee.key(r)}).reduce(function(r,o){return r.indexOf(o)<0&&r.push(o),r},[]),t={},i=function(r){var o=e[r];t[o]=n.map(function(a){var l={};for(var c in a)Ee.key(c)?c==o&&(l.value=a[c]):l[c]=a[c];return l})},s=0;s<e.length;s++)i(s);return t}function lB(n,e){var t=[],i=e.keyframes;i&&(e=Nd(aB(i),e));for(var s in e)Ee.key(s)&&t.push({name:s,tweens:oB(e[s],n)});return t}function cB(n,e){var t={};for(var i in n){var s=h_(n[i],e);Ee.arr(s)&&(s=s.map(function(r){return h_(r,e)}),s.length===1&&(s=s[0])),t[i]=s}return t.duration=parseFloat(t.duration),t.delay=parseFloat(t.delay),t}function uB(n,e){var t;return n.tweens.map(function(i){var s=cB(i,e),r=s.value,o=Ee.arr(r)?r[1]:r,a=bs(o),l=p_(e.target,n.name,a,e),c=t?t.to.original:l,h=Ee.arr(r)?r[0]:c,u=bs(h)||bs(l),d=a||u;return Ee.und(o)&&(o=c),s.from=rE(h,d),s.to=rE(m_(o,h),d),s.start=t?t.end:0,s.end=s.start+s.delay+s.duration+s.endDelay,s.easing=a_(s.easing,s.duration),s.isPath=Ee.pth(r),s.isPathTargetInsideSVG=s.isPath&&Ee.svg(e.target),s.isColor=Ee.col(s.from.original),s.isColor&&(s.round=1),t=s,s})}var aE={css:function(n,e,t){return n.style[e]=t},attribute:function(n,e,t){return n.setAttribute(e,t)},object:function(n,e,t){return n[e]=t},transform:function(n,e,t,i,s){if(i.list.set(e,t),e===i.last||s){var r="";i.list.forEach(function(o,a){r+=a+"("+o+") "}),n.style.transform=r}}};function lE(n,e){var t=oE(n);t.forEach(function(i){for(var s in e){var r=h_(e[s],i),o=i.target,a=bs(r),l=p_(o,s,a,i),c=a||bs(l),h=m_(tE(r,c),l),u=f_(o,s);aE[u](o,s,h,i.transforms,!0)}})}function hB(n,e){var t=f_(n.target,e.name);if(t){var i=uB(e,n),s=i[i.length-1];return{type:t,property:e.name,animatable:n,tweens:i,duration:s.end,delay:i[0].delay,endDelay:s.endDelay}}}function dB(n,e){return Ld(Pd(n.map(function(t){return e.map(function(i){return hB(t,i)})})),function(t){return!Ee.und(t)})}function cE(n,e){var t=n.length,i=function(r){return r.timelineOffset?r.timelineOffset:0},s={};return s.duration=t?Math.max.apply(Math,n.map(function(r){return i(r)+r.duration})):e.duration,s.delay=t?Math.min.apply(Math,n.map(function(r){return i(r)+r.delay})):e.delay,s.endDelay=t?s.duration-Math.max.apply(Math,n.map(function(r){return i(r)+r.duration-r.endDelay})):e.endDelay,s}var uE=0;function fB(n){var e=u_(YS,n),t=u_(r_,n),i=lB(t,n),s=oE(n.targets),r=dB(s,i),o=cE(r,t),a=uE;return uE++,Nd(e,{id:a,children:[],animatables:s,animations:r,duration:o.duration,delay:o.delay,endDelay:o.endDelay})}var Ti=[],hE=function(){var n;function e(){!n&&(!dE()||!ht.suspendWhenDocumentHidden)&&Ti.length>0&&(n=requestAnimationFrame(t))}function t(s){for(var r=Ti.length,o=0;o<r;){var a=Ti[o];a.paused?(Ti.splice(o,1),r--):(a.tick(s),o++)}n=o>0?requestAnimationFrame(t):void 0}function i(){!ht.suspendWhenDocumentHidden||(dE()?n=cancelAnimationFrame(n):(Ti.forEach(function(s){return s._onDocumentVisibility()}),hE()))}return typeof document!="undefined"&&document.addEventListener("visibilitychange",i),e}();function dE(){return!!document&&document.hidden}function ht(n){n===void 0&&(n={});var e=0,t=0,i=0,s,r=0,o=null;function a(g){var v=window.Promise&&new Promise(function(x){return o=x});return g.finished=v,v}var l=fB(n);a(l);function c(){var g=l.direction;g!=="alternate"&&(l.direction=g!=="normal"?"normal":"reverse"),l.reversed=!l.reversed,s.forEach(function(v){return v.reversed=l.reversed})}function h(g){return l.reversed?l.duration-g:g}function u(){e=0,t=h(l.currentTime)*(1/ht.speed)}function d(g,v){v&&v.seek(g-v.timelineOffset)}function f(g){if(l.reversePlayback)for(var x=r;x--;)d(g,s[x]);else for(var v=0;v<r;v++)d(g,s[v])}function p(g){for(var v=0,x=l.animations,T=x.length;v<T;){var S=x[v],b=S.animatable,M=S.tweens,N=M.length-1,P=M[N];N&&(P=Ld(M,function($){return g<$.end})[0]||P);for(var L=$i(g-P.start-P.delay,0,P.duration)/P.duration,V=isNaN(L)?1:P.easing(L),O=P.to.strings,H=P.round,Q=[],q=P.to.numbers.length,Y=void 0,te=0;te<q;te++){var me=void 0,we=P.to.numbers[te],pe=P.from.numbers[te]||0;P.isPath?me=rB(P.value,V*we,P.isPathTargetInsideSVG):me=pe+V*(we-pe),H&&(P.isColor&&te>2||(me=Math.round(me*H)/H)),Q.push(me)}var Se=O.length;if(!Se)Y=Q[0];else{Y=O[0];for(var ne=0;ne<Se;ne++){O[ne];var he=O[ne+1],ve=Q[ne];isNaN(ve)||(he?Y+=ve+he:Y+=ve+" ")}}aE[S.type](b.target,S.property,Y,b.transforms),S.currentValue=Y,v++}}function _(g){l[g]&&!l.passThrough&&l[g](l)}function y(){l.remaining&&l.remaining!==!0&&l.remaining--}function m(g){var v=l.duration,x=l.delay,T=v-l.endDelay,S=h(g);l.progress=$i(S/v*100,0,100),l.reversePlayback=S<l.currentTime,s&&f(S),!l.began&&l.currentTime>0&&(l.began=!0,_("begin")),!l.loopBegan&&l.currentTime>0&&(l.loopBegan=!0,_("loopBegin")),S<=x&&l.currentTime!==0&&p(0),(S>=T&&l.currentTime!==v||!v)&&p(v),S>x&&S<T?(l.changeBegan||(l.changeBegan=!0,l.changeCompleted=!1,_("changeBegin")),_("change"),p(S)):l.changeBegan&&(l.changeCompleted=!0,l.changeBegan=!1,_("changeComplete")),l.currentTime=$i(S,0,v),l.began&&_("update"),g>=v&&(t=0,y(),l.remaining?(e=i,_("loopComplete"),l.loopBegan=!1,l.direction==="alternate"&&c()):(l.paused=!0,l.completed||(l.completed=!0,_("loopComplete"),_("complete"),!l.passThrough&&"Promise"in window&&(o(),a(l)))))}return l.reset=function(){var g=l.direction;l.passThrough=!1,l.currentTime=0,l.progress=0,l.paused=!0,l.began=!1,l.loopBegan=!1,l.changeBegan=!1,l.completed=!1,l.changeCompleted=!1,l.reversePlayback=!1,l.reversed=g==="reverse",l.remaining=l.loop,s=l.children,r=s.length;for(var v=r;v--;)l.children[v].reset();(l.reversed&&l.loop!==!0||g==="alternate"&&l.loop===1)&&l.remaining++,p(l.reversed?l.duration:0)},l._onDocumentVisibility=u,l.set=function(g,v){return lE(g,v),l},l.tick=function(g){i=g,e||(e=i),m((i+(t-e))*ht.speed)},l.seek=function(g){m(h(g))},l.pause=function(){l.paused=!0,u()},l.play=function(){!l.paused||(l.completed&&l.reset(),l.paused=!1,Ti.push(l),u(),hE())},l.reverse=function(){c(),l.completed=!l.reversed,u()},l.restart=function(){l.reset(),l.play()},l.remove=function(g){var v=__(g);pE(v,l)},l.reset(),l.autoplay&&l.play(),l}function fE(n,e){for(var t=e.length;t--;)l_(n,e[t].animatable.target)&&e.splice(t,1)}function pE(n,e){var t=e.animations,i=e.children;fE(n,t);for(var s=i.length;s--;){var r=i[s],o=r.animations;fE(n,o),!o.length&&!r.children.length&&i.splice(s,1)}!t.length&&!i.length&&e.pause()}function pB(n){for(var e=__(n),t=Ti.length;t--;){var i=Ti[t];pE(e,i)}}function mB(n,e){e===void 0&&(e={});var t=e.direction||"normal",i=e.easing?a_(e.easing):null,s=e.grid,r=e.axis,o=e.from||0,a=o==="first",l=o==="center",c=o==="last",h=Ee.arr(n),u=parseFloat(h?n[0]:n),d=h?parseFloat(n[1]):0,f=bs(h?n[1]:n)||0,p=e.start||0+(h?u:0),_=[],y=0;return function(m,g,v){if(a&&(o=0),l&&(o=(v-1)/2),c&&(o=v-1),!_.length){for(var x=0;x<v;x++){if(!s)_.push(Math.abs(o-x));else{var T=l?(s[0]-1)/2:o%s[0],S=l?(s[1]-1)/2:Math.floor(o/s[0]),b=x%s[0],M=Math.floor(x/s[0]),N=T-b,P=S-M,L=Math.sqrt(N*N+P*P);r==="x"&&(L=-N),r==="y"&&(L=-P),_.push(L)}y=Math.max.apply(Math,_)}i&&(_=_.map(function(O){return i(O/y)*y})),t==="reverse"&&(_=_.map(function(O){return r?O<0?O*-1:-O:Math.abs(y-O)}))}var V=h?(d-u)/y:u;return p+V*(Math.round(_[g]*100)/100)+f}}function gB(n){n===void 0&&(n={});var e=ht(n);return e.duration=0,e.add=function(t,i){var s=Ti.indexOf(e),r=e.children;s>-1&&Ti.splice(s,1);function o(d){d.passThrough=!0}for(var a=0;a<r.length;a++)o(r[a]);var l=Nd(t,u_(r_,n));l.targets=l.targets||n.targets;var c=e.duration;l.autoplay=!1,l.direction=e.direction,l.timelineOffset=Ee.und(i)?c:m_(i,c),o(e),e.seek(l.timelineOffset);var h=ht(l);o(h),r.push(h);var u=cE(r,n);return e.delay=u.delay,e.endDelay=u.endDelay,e.duration=u.duration,e.seek(0),e.reset(),e.autoplay&&e.play(),e},e}ht.version="3.2.1";ht.speed=1;ht.suspendWhenDocumentHidden=!0;ht.running=Ti;ht.remove=pB;ht.get=p_;ht.set=lE;ht.convertPx=d_;ht.path=sB;ht.setDashoffset=nB;ht.stagger=mB;ht.timeline=gB;ht.easing=a_;ht.penner=QS;ht.random=function(n,e){return Math.floor(Math.random()*(e-n+1))+n};function Dc(){var n={"[\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D\u5341\u767E\u5343\u4E07\u5104\u5146]":"M","[\u4E00-\u9FA0\u3005\u3006\u30F5\u30F6]":"H","[\u3041-\u3093]":"I","[\u30A1-\u30F4\u30FC\uFF71-\uFF9D\uFF9E\uFF70]":"K","[a-zA-Z\uFF41-\uFF5A\uFF21-\uFF3A]":"A","[0-9\uFF10-\uFF19]":"N"};this.chartype_=[];for(var e in n){var t=new RegExp;t.compile(e),this.chartype_.push([t,n[e]])}return this.BIAS__=.22520113688288682,this.BC1__={IH:-.23848626837817805,II:.32697243008996096,IK:-.010095752335862922,NH:.21727530565338304,OH:-.10089986761975575,OO:.13433286358813376},this.BC2__={AA:-1.2150931385052766,HH:-.43298652939827054,HI:-.09793298636342958,IH:.14590310223095676,II:-.6625603313165289,IO:.45843674644599386,KI:.15781506553541869,KK:-1.1956897560492934,KM:-.22093713680158006,NH:.11571381334313575,NN:-.9391107580152266,OH:.11313200037786794,OI:.032043808217449454,OO:-1.1228293018442108},this.BC3__={HH:.090632595183653,IO:.061425386387191604,KK:.016982736109307103},this.BP1__={BB:.030241123724748596,OB:-.023182912087779915,OO:.01455325433693936,UB:.028185906235397896},this.BP2__={OB:.132681095724194,UB:.00493130630746727,UU:-.014689170693780477},this.BQ1__={BII:-.010083907026208023,OII:.02515251035662344},this.BQ2__={BHH:.04341735161117498,BHI:.045457771888541616,BIH:-.14470309077292448,OHH:-.08026119156093003,OKK:-.1977664321038111,UII:-.06621219963330052},this.BQ3__={BHH:-.014898424180164977,BHI:.013890054125675377,BIH:.005757328548683403,OHH:.10079747274055155,UOH:-.1191250236143603},this.BQ4__={BAA:-.1264775422541678,BHH:-.28209502190319147,BII:-.3700712166856941,BOO:-.03541373866319149,OHI:-.10249592883314612,OIH:-.08938538374702867,UHH:-.07125565381822344},this.BW1__={"\u3001\u3068":.00485838884952779,\u3044\u308B:.04617579463120338,\u3046\u3057:-.22072249944143948,\u304B\u3089:.18188199901588142,\u3053\u3068:.23719058565400888,\u3057\u305F:.031515899622947006,\u3057\u3066:.1778925642903061,\u3057\u3087:.14278547537084638,\u305D\u3053:.10958177701368547,\u305D\u3057:-.12268428845315281,\u305F\u3061:.12833363650281956,\u3063\u305F:.2354907023842744,\u3064\u3044:-.038507788030877975,\u3066\u3044:.15503016203179423,\u3066\u304D:.025032613497468166,\u3066\u304F:-.03466697469321477,\u3066\u3057:-.07850319327879143,\u3067\u3082:.05889146660562902,\u3069\u3053:.1229224597028895,\u306A\u3044:.6901299739841869,\u306A\u3063:.050460448267941195,\u306B\u3057:.16927152179892996,\u307E\u305B:.15640043672788773,\u307E\u308B:-.3913393363485558,\u3088\u3046:.2050706170370288,\u3088\u3063:-.031759037859465065,\u3092\u3057:.04573189095673898,\u540C\u6642:-.33308946737473155,\u672C\u5F53:-.34218099454695616},this.BW2__={"\u2014\u2014":-1.2401205264908466,"\u2500\u2500":-.630117933831758,\u3044\u3046:-.41205046190487077,\u3044\u305F:.09548262290350316,\u3044\u306F:-.32152414179508565,\u304B\u3089:-.3546817205018059,\u3053\u3068:-.8616591802035096,\u3053\u306E:-.4459967252633165,\u3055\u305B:.07585377120157781,\u3055\u308C:.9917213664650857,\u3057\u3044:-.0642684860126085,\u3057\u305F:.2787203528684824,\u305D\u306E:-.5916599303287282,\u305F\u3061:-.38208193680219577,\u3063\u305F:.1591428863194103,\u3063\u3068:-.40801501262844353,\u3066\u3044:.7284065897951145,\u3066\u304F:.009824676245964784,\u3066\u306F:-.21867316408099918,\u3066\u3082:-.05679045629506635,\u3067\u3042:.16567658274283686,\u3067\u3044:.13735555300668092,\u3067\u304D:-.004887605934430344,\u3067\u3057:-.24722296365219953,\u3067\u3059:-.390087199803737,\u3068\u3044:.4249947522855389,\u3068\u3053:-.08660220590898753,\u306A\u3044:-.17994387867482803,\u306B\u304A:-.1010687738997673,\u306B\u3057:.2847117712911703,\u306B\u306A:.00988842094504979,\u306B\u3088:-.43406653745741763,\u306B\u5BFE:-.9967640050611577,\u306B\u95A2:-.6167481808776553,\u306E\u304B:.01464439737106634,\u306E\u306B:-.17113000695588004,\u307E\u3057:-.05089424418663534,\u307E\u3067:-.3023416744888755,\u307E\u308C:.2249438860313934,\u3082\u306E:-1.360647564126872,\u308C\u305F:.039853495913072,\u308C\u3070:.3115389590257928,\u308D\u3046:.36940990058585266,\u308F\u308C:.039785092481029516,\u3092\u901A:-.7767316482612519,\u3093\u3060:.07295123616271888,\u3093\u306A:-.4906819807291365,\u30CD\u30ED:.11841103137430385,\u6642\u306B:-.04808864228157312},this.BW3__={th:.014785593763562262,\u3042\u308B:.1331037501692543,\u3044\u3044:.31008839068298116,\u3044\u3063:.16431525298342703,\u3044\u308B:.34800382728849666,"\u3046\u3002":.07053434317628932,\u3046\u3068:.31866167883069907,\u3046\u306B:-.029900648298729925,\u304B\u3063:-.22874121413214865,\u304B\u3089:.5057680093403812,\u304C\u3089:-.22728955724406427,\u304D\u305F:.024906818600566014,\u3053\u3068:.8301218873906064,\u3053\u306E:.18255375382191694,\u3053\u308D:-.13558223779783019,\u3057\u3044:-.16777409122776613,\u3057\u3066:.015263140575872008,\u3057\u307E:.03551192653245554,"\u3059\u3002":-.5318327902403177,\u3059\u308B:.3975205783088912,\u305D\u306E:.13649861240561154,"\u305F\u3002":.648969704196735,\u305F\u3044:-.2823659950826378,\u305F\u306E:.025206978381667973,\u3063\u305F:-.21211073549548098,\u3066\u3044:.6251496287127615,\u3066\u304F:.009875591008665897,\u3066\u306E:-.04041417590759684,\u3067\u3059:.09517443481454739,\u3068\u3044:.06710965705095939,\u3068\u3082:-.04029385690503242,\u306A\u3044:.33144951132192346,"\u306B\u3001":-.12208499196741522,\u306B\u306F:.1946225131352,\u306E\u3082:-.09300211276779506,\u306E\u5B50:-.16195040731855131,\u307E\u3057:.18749985797178725,\u307E\u3059:.4331034262233852,\u307E\u3067:.1732882331616623,\u3082\u306E:.3094561861458994,\u3089\u308C:.5893587926686884,\u308C\u305F:.0048681592398596655,\u308C\u3066:.09362549868355244,\u308C\u3070:-.1672382997822637,\u308F\u308C:-.14133229841030695},this.TC1__={HII:.03950960190884111,IHI:.020527356955372597,III:.06654487279907766,KKK:.06349136141414029,OII:-.031868820246557406},this.TC2__={AAA:-.01600591881827301,HHH:-.029378849325844603,IHI:-.07110614659022238,IIH:-.01617035277664804,III:-.20594747316963274,KKI:.17714469717145875,OII:-.3714631687170236},this.TC3__={HHI:-.006324897174967177,HIH:-.02015858428614767,HII:-.10604638049997367,IHH:.11542307660916047,IHI:-.11537969241996533,IIH:-.2697566255720448,IIK:-.03955047777939628,IKK:.15300450748074307},this.TC4__={AAA:.32091550379474476,HHI:.11440645382177995,HIH:.05580929361901696,HII:-.034065041329023577,HIO:-.01030181531224085,IIH:-.05262018261968932,III:.10566636150434548,IIO:.005567086261816015,IOO:.03109780928752455,KKK:.19068665054756295},this.TQ1__={BHII:-.005844330114442904,BIII:.060696986793574936,OHII:.08381147641489471},this.TQ2__={BIIH:-.06220959097166443,BOHI:-.010577156786422341,OKHH:-.004877467278671398},this.TQ3__={BHIH:.006289097459807247,BHII:-.01605541964362671,BIHI:.024502536390263376,OAAA:.1640975801597747,OHHI:.08421016618378288,OHII:.1609541978653504,OIII:-.0056052911877949915,OIKK:-.03336670954475708,OKKK:.0625872850134237,OOHI:-.03386856743003464,OOII:-.09804896802638609},this.TQ4__={BHHH:-.19557578215931978,BHIH:.07227899769125704,BIII:-.19875665931320666,OHIH:-.6132846532718886,OHII:.0073237247315630465,OIHI:-.24284706152466545,OIII:-.11468853766020784},this.TW1__={\u306B\u3064\u3044:-.11623407099710713,\u306B\u3088\u3063:-.004921495919448952},this.TW2__={\u3057\u3087\u3046:.11736167747307898,\u305D\u3057\u3066:-.10587994014558691,\u3068\u3057\u3066:-.10148181720164659,\u307E\u308B\u3067:-.004857992220036397,\u3088\u3063\u3066:-.06106915715722373,\u30E9\u30B0\u30A4:.004874873407300121},this.TW3__={\u3068\u3057\u3066:-.08618672540194437,\u306B\u3064\u3044:-.044954250244913355,\u306B\u3068\u3063:-.1982932374482013,"\u306E\u3067\u3001":-.13246253852223708},this.TW4__={\u3044\u3046\u3053:.13506328593550318,"\u3057\u305F\u3002":-.12834388188812307,\u3057\u3066\u3044:.10322794990586326,\u3066\u3044\u308B:.05693902361235212,\u3068\u3044\u3046:.03551571889357873,\u307E\u3057\u305F:.49706159063499633,\u307E\u305B\u3093:.30057524560441756,\u3088\u3046\u3068:-.2567441638606044,\u3088\u3046\u306B:.08309574400066155},this.UC1__={A:.010156669149885798,I:-.008571172628247211,O:-.06873021994092306},this.UC2__={H:.34932452180126466,I:-.015687705712196773,K:.08971465602179736,M:.27319336124300997,O:-.0816628483369048},this.UC3__={I:.08371628945944345,M:-.4796466036234481,O:1.0911901974166283},this.UC4__={H:.0663741234422061,I:.032845000847053954,M:-.15638593137367923,O:.7853187020732736},this.UC5__={H:.13596051078311455,I:-.07896324823867357},this.UC6__={A:.033968993675558334,H:-.015643629982255495,I:.04452334552336498,O:.08617490706834542},this.UP1__={B:.009246267463356645,O:.0403252446097051,U:-.04516547668414343},this.UP2__={O:-.02123327464425744},this.UP3__={O:.05400561799098465},this.UQ1__={BK:.039034585991110975,OH:-.009731797066766646,OI:.0157160707877272,OK:-.01076204277677242,UI:-.053615085727519635},this.UQ2__={OH:-.10856293030493244,OK:.05944455936521592},this.UQ3__={BH:-.247047298009339,BI:.394208612797646,BK:-.0058290976988708615,BO:.056086836682142975},this.UW1__={B1:.018105810208910382,i:.004946755130047433,"\u3001":-.02777526189838834,\u304C:-.06866028643738298,\u3053:.05853852806144273,\u3057:-.010637833861056059,\u3063:.01045313487063675,\u3068:-.01920152451835982,\u306B:-.13465933626070342,\u306E:-.005610962116700646,\u306F:-.15094814131442158,\u3082:-.041580553635757286,\u3084:-.0098980433841668,\u3088:.09483200455145908,\u308B:.05782408628361303,\u3092:-.06480685769467537,\u30FC:.016203640645197158},this.UW2__={"\u3001":-.05593716276231778,"\u3002":-.031738034837723056,"\u300D":.1066623872015924,\u3044:.00995927931407218,\u3046:-.013845031111581923,\u304A:-.009887729550118494,\u304B:.18113638014991276,\u304C:-.11288002491272736,\u304F:-.06392749330128274,\u3053:.2216296827795169,\u3055:.04004718094908757,\u3057:.13716382860877638,\u3059:-.026090438087067024,\u305D:-.05958619811816992,\u305F:.02088672929144276,\u3060:.11611864520977425,\u3063:.05071186866446647,\u3066:-.07641978752988528,\u3068:-.1617697816760843,\u306A:.017725253098804766,\u306B:-.19583720954807687,\u306E:.005280408300918342,\u306F:-.16583007737131603,\u307E:.015742977125139935,\u3082:-.08534354771854774,\u3088:.0786807023382153,\u308A:-.042152274863661,\u308B:-.13862747171796458,\u308C:.03618024437415664,\u3092:-.25567952871980176,\u3093:.21368356221248083,\u4E0D:-.1603614824390156,\u5927:-.31524207130817977,\u5C0F:-.12976577209782142,\u898B:-.26537350265591314},this.UW3__={d:.12433623481840968,e:.07019352965291331,i:-.28951833750199724,s:.07927262098653556,y:.029893323178321773,"\u3001":.6254240819543564,\u3042:-.4504315533728965,\u3046:.2797398370000238,\u3048:.14066336325934564,\u304A:-.5354249500905506,\u304B:-.15967315696317042,\u304C:.33241232593651343,\u304F:.11640393156335943,\u3053:-.44323306448851035,\u3054:-.194886865861015,\u3055:-.13214430661859372,\u3057:-.055734867050514725,\u305B:.32861188600632507,\u305D:-.573360302459194,\u305F:.00628084477595966,\u3061:-.031016646716852683,\u3063:-.009740271487860726,\u3064:-.07693292540999878,\u3066:.6469373119411537,\u3067:.05631098238267572,\u3068:.12921676820941724,\u3069:-.11593197232924046,\u306A:-.35446808222188947,\u306B:.17894308086797012,\u306E:.34962889282436177,\u306F:.5819819380605722,\u307B:-.3055995652575915,\u307E:-.5491043731187487,\u307F:-.010187140672554069,\u3082:.14435269861292555,\u3088:-.11981759986462115,\u308A:.08408495596098593,\u308B:.5417657735761062,\u308C:.28713292997261525,\u308F:-.15263181238897242,\u3092:.7655772624914965,\u30B0:.04077803285486024,\u30CB:-.024725575380353606,\u30CD:.34811388323224446,\u30EB:.009882207253744273,\u30F3:.07940007767892635,\u4E8C:.41310866547585806,\u4EBA:.1802960153799593,\u4F55:.4114886775766756,\u5927:.009818838766569457,\u5F53:-.32892885754291634,\u5F7C:.06367210171639835,\u6570:.10642282655589906,\u7684:.7836608072322091,\u79C1:.4337382218562517,\u7ACB:-.06189162474332259,\u7B2C:.009765150863586758,\u898B:.009780696755950596},this.UW4__={e:-.26241347443103025,n:-.07043624034923457,r:-.05174757508939543,"\u3001":.16534915089036276,\u3042:.603454676046833,\u3044:-.33782388440806793,\u3046:-.10041222243216878,\u3048:-.46012258051344634,\u304A:.08177933290536007,\u304B:.042756554155529744,\u304C:.6472156106472131,\u304D:-.412647521838882,\u304F:-.3904189382427503,\u3051:-.4373694978590952,\u3053:.11971486995369958,\u3055:.09473325990273215,\u3057:-.07405432648145821,\u3058:-.07814318435561417,\u305D:.4140401163327643,\u305F:.5005120062904972,\u3060:.5175859755007981,\u3061:-.32757825436164695,\u3063:-.6388090573219343,\u3064:-.21213356619208382,\u3066:.3189830847771864,\u3067:.7548790708963414,\u3068:.3978483696995798,\u306A:.5347804691508483,\u306B:.6218509819144875,\u306E:.858983818932583,\u306F:.9537590975495559,\u3070:.017967849736232246,\u3073:-.09391181857809118,\u3078:.37799889890659155,\u307B:.1481226415164236,\u307E:.2351332150044544,\u3081:-.4288931992371047,\u3082:.18698587166826777,\u3083:-.18894731215972296,\u3084:.18777123466555484,\u3087:-.26980073191275783,\u3088:.2577372231795072,\u3089:-.4078750071226102,\u308A:-.8858217164981679,\u308B:-1.1570270191745182,\u308C:-.15783908494305104,\u308D:-.33551488818625197,\u308F:-.0075555247504103095,\u3092:1.759694053887214,\u3093:-.02578137808071669,\u30BD:.17371020657951847,\u30C3:-.08359187788579188,\u30C9:.10155250329870884,\u30CB:-.13628238659090972,\u30E9:.014834805312977447,\u30EB:-.014596613928525988,\u30F3:-.10443848315440722,\u30FC:-.5309140925665897,\u4EBA:.22936106874668577,\u5B50:-.04089576692098599,\u5BFE:-.18339524187952347,\u7684:.2739804197294529,\u8005:.024864512127211243},this.UW5__={a:.010179122517861593,h:.11342004850022312,o:.13864114348404827,t:-.06194846739390849,"\u3001":-.040769958221064474,"\u3002":.0764164113870031,\u3042:.06886919872017679,\u3044:.01603012917330838,\u304B:.07684025169358082,\u304C:-.03322453345943609,\u304D:.1863415532170791,\u3055:-.15249439853060662,\u3057:-.018745999550093317,\u305F:.015809063975165197,\u3061:.13469363305086202,\u3064:.026609177144296267,\u3066:-.0465637503886467,\u3067:-.030324895992921888,\u3068:.11905842485781214,\u306A:-.059856730513047206,\u306B:-.14166916444330552,\u3082:-.042507616269688735,\u3083:.17410553608770116,\u308A:-.00504704403212485,\u308B:.1001629922725702,\u308C:.09626881001130859,\u3092:-.0610369012797255,\u30F3:.1702022709387065,\u30FC:.08569801150852382,\u5EA6:-.06119725357207652,\u7684:-.3184003489974112},this.UW6__={"\u3001":-.05619324630475547,\u3042:-.01011865446823839,\u3044:.00492327870578099,\u304B:.010776371652764537,\u305F:-.005078260775586424,\u3060:.005120430216730338,\u3063:.014769316557906188,\u3066:-.2205200359076286,\u3068:-.08328953464389319,\u306E:-.036939222540452614,\u306F:-.04565922334729253,\u3082:-.010294320384416675,\u308C:-.005165653787238134},this}Dc.prototype.ctype_=function(n){for(var e in this.chartype_)if(n.match(this.chartype_[e][0]))return this.chartype_[e][1];return"O"};Dc.prototype.ts_=function(n){return n||0};Dc.prototype.segment=function(n){if(n==null||n==null||n=="")return[];var e=[],t=["B3","B2","B1"],i=["O","O","O"],s=n.split("");for(c=0;c<s.length;++c)t.push(s[c]),i.push(this.ctype_(s[c]));t.push("E1"),t.push("E2"),t.push("E3"),i.push("O"),i.push("O"),i.push("O");for(var r=t[3],o="U",a="U",l="U",c=4;c<t.length-3;++c){var h=this.BIAS__,u=t[c-3],d=t[c-2],f=t[c-1],p=t[c],_=t[c+1],y=t[c+2],m=i[c-3],g=i[c-2],v=i[c-1],x=i[c],T=i[c+1],S=i[c+2];h+=this.ts_(this.UP1__[o]),h+=this.ts_(this.UP2__[a]),h+=this.ts_(this.UP3__[l]),h+=this.ts_(this.BP1__[o+a]),h+=this.ts_(this.BP2__[a+l]),h+=this.ts_(this.UW1__[u]),h+=this.ts_(this.UW2__[d]),h+=this.ts_(this.UW3__[f]),h+=this.ts_(this.UW4__[p]),h+=this.ts_(this.UW5__[_]),h+=this.ts_(this.UW6__[y]),h+=this.ts_(this.BW1__[d+f]),h+=this.ts_(this.BW2__[f+p]),h+=this.ts_(this.BW3__[p+_]),h+=this.ts_(this.TW1__[u+d+f]),h+=this.ts_(this.TW2__[d+f+p]),h+=this.ts_(this.TW3__[f+p+_]),h+=this.ts_(this.TW4__[p+_+y]),h+=this.ts_(this.UC1__[m]),h+=this.ts_(this.UC2__[g]),h+=this.ts_(this.UC3__[v]),h+=this.ts_(this.UC4__[x]),h+=this.ts_(this.UC5__[T]),h+=this.ts_(this.UC6__[S]),h+=this.ts_(this.BC1__[g+v]),h+=this.ts_(this.BC2__[v+x]),h+=this.ts_(this.BC3__[x+T]),h+=this.ts_(this.TC1__[m+g+v]),h+=this.ts_(this.TC2__[g+v+x]),h+=this.ts_(this.TC3__[v+x+T]),h+=this.ts_(this.TC4__[x+T+S]),h+=this.ts_(this.UQ1__[o+m]),h+=this.ts_(this.UQ2__[a+g]),h+=this.ts_(this.UQ3__[l+v]),h+=this.ts_(this.BQ1__[a+g+v]),h+=this.ts_(this.BQ2__[a+v+x]),h+=this.ts_(this.BQ3__[l+g+v]),h+=this.ts_(this.BQ4__[l+v+x]),h+=this.ts_(this.TQ1__[a+m+g+v]),h+=this.ts_(this.TQ2__[a+g+v+x]),h+=this.ts_(this.TQ3__[l+m+g+v]),h+=this.ts_(this.TQ4__[l+g+v+x]);var b="O";h>0&&(e.push(r),r="",b="B"),o=a,a=l,l=b,r+=t[c]}return e.push(r),e};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mE={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const de=function(n,e){if(!n)throw za(e)},za=function(n){return new Error("Firebase Database ("+mE.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gE=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)==55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)==56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},_B=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=n[t++];e[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{const r=n[t++],o=n[t++];e[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return e.join("")},y_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const r=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,h=r>>2,u=(r&3)<<4|a>>4;let d=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(d=64)),i.push(t[h],t[u],t[d],t[f])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(gE(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):_B(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const r=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const u=s<n.length?t[n.charAt(s)]:64;if(++s,r==null||a==null||c==null||u==null)throw Error();const d=r<<2|a>>4;if(i.push(d),c!==64){const f=a<<4&240|c>>2;if(i.push(f),u!==64){const p=c<<6&192|u;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},yB=function(n){const e=gE(n);return y_.encodeByteArray(e,!0)},v_=function(n){try{return y_.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vB(n){return _E(void 0,n)}function _E(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!xB(t)||(n[t]=_E(n[t],e[t]));return n}function xB(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bn(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function x_(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(bn())}function bB(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function yE(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function TB(){const n=bn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function vE(){return mE.NODE_ADMIN===!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wB="FirebaseError";class eo extends Error{constructor(e,t,i){super(t);this.code=e,this.customData=i,this.name=wB,Object.setPrototypeOf(this,eo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,kc.prototype.create)}}class kc{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},s=`${this.service}/${e}`,r=this.errors[e],o=r?SB(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new eo(s,a,i)}}function SB(n,e){return n.replace(EB,(t,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const EB=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uc(n){return JSON.parse(n)}function Gt(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xE=function(n){let e={},t={},i={},s="";try{const r=n.split(".");e=Uc(v_(r[0])||""),t=Uc(v_(r[1])||""),s=r[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:s}},MB=function(n){const e=xE(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},AB=function(n){const e=xE(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wi(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function to(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function b_(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Fd(n,e,t){const i={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=e.call(t,n[s],s,n));return i}function Dd(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const s of t){if(!i.includes(s))return!1;const r=n[s],o=e[s];if(bE(r)&&bE(o)){if(!Dd(r,o))return!1}else if(r!==o)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function bE(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Va(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CB{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if(typeof e=="string")for(let u=0;u<16;u++)i[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)i[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const d=i[u-3]^i[u-8]^i[u-14]^i[u-16];i[u]=(d<<1|d>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,h;for(let u=0;u<80;u++){u<40?u<20?(c=a^r&(o^a),h=1518500249):(c=r^o^a,h=1859775393):u<60?(c=r&o|a&(r|o),h=2400959708):(c=r^o^a,h=3395469782);const d=(s<<5|s>>>27)+c+l+h+i[u]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=s,s=d}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const i=t-this.blockSize;let s=0;const r=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(r[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<t;)if(r[o]=e[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}}function IB(n,e){const t=new RB(n,e);return t.subscribe.bind(t)}class RB{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let s;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");LB(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:i},s.next===void 0&&(s.next=T_),s.error===void 0&&(s.error=T_),s.complete===void 0&&(s.complete=T_);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console!="undefined"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function LB(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function T_(){}function Od(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PB=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);if(s>=55296&&s<=56319){const r=s-55296;i++,de(i<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(i)-56320;s=65536+(r<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},kd=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(n){return n&&n._delegate?n._delegate:n}class no{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const io="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NB{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new Oc;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(DB(e))try{this.getOrInitializeService({instanceIdentifier:io})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=io){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=io){return this.instances.has(e)}getOptions(e=io){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(e,t){var i;const s=this.normalizeInstanceIdentifier(t),r=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;r.add(e),this.onInitCallbacks.set(s,r);const o=this.instances.get(s);return o&&e(o,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(!!i)for(const s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:FB(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=io){return this.component?this.component.multipleInstances?e:io:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function FB(n){return n===io?void 0:n}function DB(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OB{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new NB(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ct;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ct||(ct={}));const kB={debug:ct.DEBUG,verbose:ct.VERBOSE,info:ct.INFO,warn:ct.WARN,error:ct.ERROR,silent:ct.SILENT},UB=ct.INFO,BB={[ct.DEBUG]:"log",[ct.VERBOSE]:"log",[ct.INFO]:"info",[ct.WARN]:"warn",[ct.ERROR]:"error"},HB=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),s=BB[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class w_{constructor(e){this.name=e,this._logLevel=UB,this._logHandler=HB,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ct))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?kB[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ct.DEBUG,...e),this._logHandler(this,ct.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ct.VERBOSE,...e),this._logHandler(this,ct.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ct.INFO,...e),this._logHandler(this,ct.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ct.WARN,...e),this._logHandler(this,ct.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ct.ERROR,...e),this._logHandler(this,ct.ERROR,...e)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zB{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(VB(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function VB(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const S_="@firebase/app",TE="0.7.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E_=new w_("@firebase/app"),GB="@firebase/app-compat",WB="@firebase/analytics-compat",XB="@firebase/analytics",qB="@firebase/app-check-compat",YB="@firebase/app-check",jB="@firebase/auth",$B="@firebase/auth-compat",QB="@firebase/database",KB="@firebase/database-compat",JB="@firebase/functions",ZB="@firebase/functions-compat",e6="@firebase/installations",t6="@firebase/installations-compat",n6="@firebase/messaging",i6="@firebase/messaging-compat",s6="@firebase/performance",r6="@firebase/performance-compat",o6="@firebase/remote-config",a6="@firebase/remote-config-compat",l6="@firebase/storage",c6="@firebase/storage-compat",u6="@firebase/firestore",h6="@firebase/firestore-compat",d6="firebase",f6="9.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wE="[DEFAULT]",p6={[S_]:"fire-core",[GB]:"fire-core-compat",[XB]:"fire-analytics",[WB]:"fire-analytics-compat",[YB]:"fire-app-check",[qB]:"fire-app-check-compat",[jB]:"fire-auth",[$B]:"fire-auth-compat",[QB]:"fire-rtdb",[KB]:"fire-rtdb-compat",[JB]:"fire-fn",[ZB]:"fire-fn-compat",[e6]:"fire-iid",[t6]:"fire-iid-compat",[n6]:"fire-fcm",[i6]:"fire-fcm-compat",[s6]:"fire-perf",[r6]:"fire-perf-compat",[o6]:"fire-rc",[a6]:"fire-rc-compat",[l6]:"fire-gcs",[c6]:"fire-gcs-compat",[u6]:"fire-fst",[h6]:"fire-fst-compat","fire-js":"fire-js",[d6]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ud=new Map,M_=new Map;function m6(n,e){try{n.container.addComponent(e)}catch(t){E_.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ga(n){const e=n.name;if(M_.has(e))return E_.debug(`There were multiple attempts to register component ${e}.`),!1;M_.set(e,n);for(const t of Ud.values())m6(t,n);return!0}function Bd(n,e){return n.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g6={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function."},Hd=new kc("app","Firebase",g6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _6{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new no("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Hd.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wa=f6;function y6(n,e={}){typeof e!="object"&&(e={name:e});const t=Object.assign({name:wE,automaticDataCollectionEnabled:!1},e),i=t.name;if(typeof i!="string"||!i)throw Hd.create("bad-app-name",{appName:String(i)});const s=Ud.get(i);if(s){if(Dd(n,s.options)&&Dd(t,s.config))return s;throw Hd.create("duplicate-app",{appName:i})}const r=new OB(i);for(const a of M_.values())r.addComponent(a);const o=new _6(n,t,r);return Ud.set(i,o),o}function A_(n=wE){const e=Ud.get(n);if(!e)throw Hd.create("no-app",{appName:n});return e}function Ki(n,e,t){var i;let s=(i=p6[n])!==null&&i!==void 0?i:n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${s}" with version "${e}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),E_.warn(a.join(" "));return}Ga(new no(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v6(n){Ga(new no("platform-logger",e=>new zB(e),"PRIVATE")),Ki(S_,TE,n),Ki(S_,TE,"esm2017"),Ki("fire-js","")}v6("");var x6="firebase",b6="9.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ki(x6,b6,"app");/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function C_(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(n);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(n,i[s])&&(t[i[s]]=n[i[s]]);return t}function SE(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const T6=SE,EE=new kc("auth","Firebase",SE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ME=new w_("@firebase/auth");function zd(n,...e){ME.logLevel<=ct.ERROR&&ME.error(`Auth (${Wa}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ji(n,...e){throw I_(n,...e)}function Zi(n,...e){return I_(n,...e)}function AE(n,e,t){const i=Object.assign(Object.assign({},T6()),{[e]:t});return new kc("auth","Firebase",i).create(e,{appName:n.name})}function w6(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Ji(n,"argument-error"),AE(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function I_(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return EE.create(n,...e)}function Ne(n,e,...t){if(!n)throw I_(e,...t)}function Ts(n){const e="INTERNAL ASSERTION FAILED: "+n;throw zd(e),new Error(e)}function ws(n,e){n||Ts(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CE=new Map;function Ss(n){ws(n instanceof Function,"Expected a class definition");let e=CE.get(n);return e?(ws(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,CE.set(n,e),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S6(n,e){const t=Bd(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),r=t.getOptions();if(Dd(r,e!=null?e:{}))return s;Ji(s,"already-initialized")}return t.initialize({options:e})}function E6(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(Ss);(e==null?void 0:e.errorMap)&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R_(){var n;return typeof self!="undefined"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function M6(){return IE()==="http:"||IE()==="https:"}function IE(){var n;return typeof self!="undefined"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A6(){return typeof navigator!="undefined"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(M6()||bB()||"connection"in navigator)?navigator.onLine:!0}function C6(){if(typeof navigator=="undefined")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(e,t){this.shortDelay=e,this.longDelay=t,ws(t>e,"Short delay should be less than long delay!"),this.isMobile=x_()||yE()}get(){return A6()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L_(n,e){ws(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P_{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self!="undefined"&&"fetch"in self)return self.fetch;Ts("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self!="undefined"&&"Headers"in self)return self.Headers;Ts("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self!="undefined"&&"Response"in self)return self.Response;Ts("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I6={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R6=new Bc(3e4,6e4);function L6(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Hc(n,e,t,i,s={}){return RE(n,s,()=>{let r={},o={};i&&(e==="GET"?o=i:r={body:JSON.stringify(i)});const a=Va(Object.assign({key:n.config.apiKey},o)).slice(1),l=new(P_.headers());return l.set("Content-Type","application/json"),l.set("X-Client-Version",n._getSdkClientVersion()),n.languageCode&&l.set("X-Firebase-Locale",n.languageCode),P_.fetch()(LE(n,n.config.apiHost,t,a),Object.assign({method:e,headers:l,referrerPolicy:"no-referrer"},r))})}async function RE(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},I6),e);try{const s=new N6(n),r=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw N_(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw N_(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw N_(n,"email-already-in-use",o);const h=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw AE(n,h,c);Ji(n,h)}}catch(s){if(s instanceof eo)throw s;Ji(n,"network-request-failed")}}async function P6(n,e,t,i,s={}){const r=await Hc(n,e,t,i,s);return"mfaPendingCredential"in r&&Ji(n,"multi-factor-auth-required",{_serverResponse:r}),r}function LE(n,e,t,i){const s=`${e}${t}?${i}`;return n.config.emulator?L_(n.config,s):`${n.config.apiScheme}://${s}`}class N6{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Zi(this.auth,"timeout")),R6.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function N_(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const s=Zi(n,e,i);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F6(n,e){return Hc(n,"POST","/v1/accounts:delete",e)}async function D6(n,e){return Hc(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(n){if(!!n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function O6(n,e=!1){const t=Wt(n),i=await t.getIdToken(e),s=D_(i);Ne(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const r=typeof s.firebase=="object"?s.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:zc(F_(s.auth_time)),issuedAtTime:zc(F_(s.iat)),expirationTime:zc(F_(s.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function F_(n){return Number(n)*1e3}function D_(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return zd("JWT malformed, contained fewer than 3 sections"),null;try{const s=v_(t);return s?JSON.parse(s):(zd("Failed to decode base64 JWT payload"),null)}catch(s){return zd("Caught error parsing JWT payload as JSON",s),null}}function k6(n){const e=D_(n);return Ne(e,"internal-error"),Ne(typeof e.exp!="undefined","internal-error"),Ne(typeof e.iat!="undefined","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xa(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof eo&&U6(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function U6({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B6{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PE{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=zc(this.lastLoginAt),this.creationTime=zc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vd(n){var e;const t=n.auth,i=await n.getIdToken(),s=await Xa(n,D6(t,{idToken:i}));Ne(s==null?void 0:s.users.length,t,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const o=((e=r.providerUserInfo)===null||e===void 0?void 0:e.length)?V6(r.providerUserInfo):[],a=z6(n.providerData,o),l=n.isAnonymous,c=!(n.email&&r.passwordHash)&&!(a==null?void 0:a.length),h=l?c:!1,u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new PE(r.createdAt,r.lastLoginAt),isAnonymous:h};Object.assign(n,u)}async function H6(n){const e=Wt(n);await Vd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function z6(n,e){return[...n.filter(i=>!e.some(s=>s.providerId===i.providerId)),...e]}function V6(n){return n.map(e=>{var{providerId:t}=e,i=C_(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G6(n,e){const t=await RE(n,{},()=>{const i=Va({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:r}=n.config,o=LE(n,s,"/v1/token",`key=${r}`);return P_.fetch()(o,{method:"POST",headers:{"X-Client-Version":n._getSdkClientVersion(),"Content-Type":"application/x-www-form-urlencoded"},body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ne(e.idToken,"internal-error"),Ne(typeof e.idToken!="undefined","internal-error"),Ne(typeof e.refreshToken!="undefined","internal-error");const t="expiresIn"in e&&typeof e.expiresIn!="undefined"?Number(e.expiresIn):k6(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Ne(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:s,expiresIn:r}=await G6(e,t);this.updateTokensAndExpiration(i,s,Number(r))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:s,expirationTime:r}=t,o=new Vc;return i&&(Ne(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),s&&(Ne(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),r&&(Ne(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Vc,this.toJSON())}_performRefresh(){return Ts("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gr(n,e){Ne(typeof n=="string"||typeof n=="undefined","internal-error",{appName:e})}class so{constructor(e){var{uid:t,auth:i,stsTokenManager:s}=e,r=C_(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new B6(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.metadata=new PE(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Xa(this,this.stsTokenManager.getToken(this.auth,e));return Ne(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return O6(this,e)}reload(){return H6(this)}_assign(e){this!==e&&(Ne(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new so(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){Ne(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await Vd(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Xa(this,F6(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,s,r,o,a,l,c,h;const u=(i=t.displayName)!==null&&i!==void 0?i:void 0,d=(s=t.email)!==null&&s!==void 0?s:void 0,f=(r=t.phoneNumber)!==null&&r!==void 0?r:void 0,p=(o=t.photoURL)!==null&&o!==void 0?o:void 0,_=(a=t.tenantId)!==null&&a!==void 0?a:void 0,y=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,m=(c=t.createdAt)!==null&&c!==void 0?c:void 0,g=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:v,emailVerified:x,isAnonymous:T,providerData:S,stsTokenManager:b}=t;Ne(v&&b,e,"internal-error");const M=Vc.fromJSON(this.name,b);Ne(typeof v=="string",e,"internal-error"),gr(u,e.name),gr(d,e.name),Ne(typeof x=="boolean",e,"internal-error"),Ne(typeof T=="boolean",e,"internal-error"),gr(f,e.name),gr(p,e.name),gr(_,e.name),gr(y,e.name),gr(m,e.name),gr(g,e.name);const N=new so({uid:v,auth:e,email:d,emailVerified:x,displayName:u,isAnonymous:T,photoURL:p,phoneNumber:f,tenantId:_,stsTokenManager:M,createdAt:m,lastLoginAt:g});return S&&Array.isArray(S)&&(N.providerData=S.map(P=>Object.assign({},P))),y&&(N._redirectEventId=y),N}static async _fromIdTokenResponse(e,t,i=!1){const s=new Vc;s.updateFromServerResponse(t);const r=new so({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:i});return await Vd(r),r}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}NE.type="NONE";const FE=NE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gd(n,e,t){return`firebase:${n}:${e}:${t}`}class qa{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:s,name:r}=this.auth;this.fullUserKey=Gd(this.userKey,s.apiKey,r),this.fullPersistenceKey=Gd("persistence",s.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?so._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new qa(Ss(FE),e,i);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let r=s[0]||Ss(FE);const o=Gd(i,e.config.apiKey,e.name);let a=null;for(const c of t)try{const h=await c._get(o);if(h){const u=so._fromJSON(e,h);c!==r&&(a=u),r=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!r._shouldAllowMigration||!l.length?new qa(r,e,i):(r=l[0],a&&await r._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==r)try{await c._remove(o)}catch{}})),new qa(r,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DE(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(UE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(OE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(HE(e))return"Blackberry";if(zE(e))return"Webos";if(O_(e))return"Safari";if((e.includes("chrome/")||kE(e))&&!e.includes("edge/"))return"Chrome";if(BE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function OE(n=bn()){return/firefox\//i.test(n)}function O_(n=bn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function kE(n=bn()){return/crios\//i.test(n)}function UE(n=bn()){return/iemobile/i.test(n)}function BE(n=bn()){return/android/i.test(n)}function HE(n=bn()){return/blackberry/i.test(n)}function zE(n=bn()){return/webos/i.test(n)}function Wd(n=bn()){return/iphone|ipad|ipod/i.test(n)}function W6(n=bn()){var e;return Wd(n)&&!!((e=window.navigator)===null||e===void 0?void 0:e.standalone)}function X6(){return TB()&&document.documentMode===10}function VE(n=bn()){return Wd(n)||BE(n)||zE(n)||HE(n)||/windows phone/i.test(n)||UE(n)}function q6(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GE(n,e=[]){let t;switch(n){case"Browser":t=DE(bn());break;case"Worker":t=`${DE(bn())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Wa}/${i}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y6{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new WE(this),this.idTokenSubscription=new WE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=EE,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ss(t)),this._initializationPromise=this.queue(async()=>{var i,s;this._deleted||(this.persistenceManager=await qa.create(this,e),!this._deleted&&(((i=this._popupRedirectResolver)===null||i===void 0?void 0:i._shouldInitProactively)&&await this._popupRedirectResolver._initialize(this),await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)))}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e)}}async initializeCurrentUser(e){var t;let i=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,r=i==null?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);(!s||s===r)&&(o==null?void 0:o.user)&&(i=o.user)}return i?i._redirectEventId?(Ne(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)):this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Vd(e)}catch(t){if(t.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=C6()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Wt(e):null;return t&&Ne(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&Ne(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Ss(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new kc("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ss(e)||this._popupRedirectResolver;Ne(t,this,"argument-error"),this.redirectPersistenceManager=await qa.create(this,[Ss(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,s){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return Ne(o,this,"internal-error"),o.then(()=>r(this.currentUser)),typeof t=="function"?e.addObserver(t,i,s):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ne(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=GE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getSdkClientVersion(){return this.clientVersion}}function Xd(n){return Wt(n)}class WE{constructor(e){this.auth=e,this.observer=null,this.addObserver=IB(t=>this.observer=t)}get next(){return Ne(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XE{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ts("not implemented")}_getIdTokenResponse(e){return Ts("not implemented")}_linkToIdToken(e,t){return Ts("not implemented")}_getReauthenticationResolver(e){return Ts("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ya(n,e){return P6(n,"POST","/v1/accounts:signInWithIdp",L6(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j6="http://localhost";class ro extends XE{constructor(){super(...arguments);this.pendingToken=null}static _fromParams(e){const t=new ro(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ji("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:s}=t,r=C_(t,["providerId","signInMethod"]);if(!i||!s)return null;const o=new ro(i,s);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ya(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Ya(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ya(e,t)}buildRequest(){const e={requestUri:j6,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Va(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc extends k_{constructor(){super(...arguments);this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi extends Gc{constructor(){super("facebook.com")}static credential(e){return ro._fromParams({providerId:hi.PROVIDER_ID,signInMethod:hi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return hi.credentialFromTaggedObject(e)}static credentialFromError(e){return hi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return hi.credential(e.oauthAccessToken)}catch{return null}}}hi.FACEBOOK_SIGN_IN_METHOD="facebook.com";hi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di extends Gc{constructor(){super("google.com");this.addScope("profile")}static credential(e,t){return ro._fromParams({providerId:di.PROVIDER_ID,signInMethod:di.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return di.credentialFromTaggedObject(e)}static credentialFromError(e){return di.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return di.credential(t,i)}catch{return null}}}di.GOOGLE_SIGN_IN_METHOD="google.com";di.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r extends Gc{constructor(){super("github.com")}static credential(e){return ro._fromParams({providerId:_r.PROVIDER_ID,signInMethod:_r.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _r.credentialFromTaggedObject(e)}static credentialFromError(e){return _r.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _r.credential(e.oauthAccessToken)}catch{return null}}}_r.GITHUB_SIGN_IN_METHOD="github.com";_r.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi extends Gc{constructor(){super("twitter.com")}static credential(e,t){return ro._fromParams({providerId:fi.PROVIDER_ID,signInMethod:fi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return fi.credentialFromTaggedObject(e)}static credentialFromError(e){return fi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return fi.credential(t,i)}catch{return null}}}fi.TWITTER_SIGN_IN_METHOD="twitter.com";fi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,s=!1){const r=await so._fromIdTokenResponse(e,i,s),o=qE(i);return new ja({user:r,providerId:o,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const s=qE(i);return new ja({user:e,providerId:s,_tokenResponse:i,operationType:t})}}function qE(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qd extends eo{constructor(e,t,i,s){var r;super(t.code,t.message);this.operationType=i,this.user=s,Object.setPrototypeOf(this,qd.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,s){return new qd(e,t,i,s)}}function YE(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?qd._fromErrorAndOperation(n,r,e,i):r})}async function $6(n,e,t=!1){const i=await Xa(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ja._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q6(n,e,t=!1){const{auth:i}=n,s="reauthenticate";try{const r=await Xa(n,YE(i,s,e,n),t);Ne(r.idToken,i,"internal-error");const o=D_(r.idToken);Ne(o,i,"internal-error");const{sub:a}=o;return Ne(n.uid===a,i,"user-mismatch"),ja._forOperation(n,s,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&Ji(i,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jE(n,e,t=!1){const i="signIn",s=await YE(n,i,e),r=await ja._fromIdTokenResponse(n,i,s);return t||await n._updateCurrentUser(r.user),r}async function U_(n,e){return jE(Xd(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K6(n,e){return Hc(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B_(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const i=Wt(n),r={idToken:await i.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Xa(i,K6(i.auth,r));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const a=i.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),await i._updateTokensIfNecessary(o)}function J6(n,e,t,i){return Wt(n).onAuthStateChanged(e,t,i)}function Z6(n){return Wt(n).signOut()}const Yd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $E{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Yd,"1"),this.storage.removeItem(Yd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e8(){const n=bn();return O_(n)||Wd(n)}const t8=1e3,n8=10;class QE extends $E{constructor(){super(()=>window.localStorage,"LOCAL");this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=e8()&&q6(),this.fallbackToPolling=VE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),s=this.localCache[t];i!==s&&e(t,s,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(i);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}const s=()=>{const o=this.storage.getItem(i);!t&&this.localCache[i]===o||this.notifyListeners(i,o)},r=this.storage.getItem(i);X6()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,n8):s()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},t8)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}QE.type="LOCAL";const i8=QE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KE extends $E{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}KE.type="SESSION";const JE=KE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s8(n){return Promise.all(n.map(async e=>{try{const t=await e;return{fulfilled:!0,value:t}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const i=new jd(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:s,data:r}=t.data,o=this.handlersMap[s];if(!(o==null?void 0:o.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,r)),l=await s8(a);t.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}jd.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H_(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r8{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const s=typeof MessageChannel!="undefined"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,o;return new Promise((a,l)=>{const c=H_("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},i);o={messageChannel:s,onMessage(u){const d=u;if(d.data.eventId===c)switch(d.data.status){case"ack":clearTimeout(h),r=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(d.data.response);break;default:clearTimeout(h),clearTimeout(r),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function es(){return window}function o8(n){es().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZE(){return typeof es().WorkerGlobalScope!="undefined"&&typeof es().importScripts=="function"}async function a8(){if(!(navigator==null?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function l8(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function c8(){return ZE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eM="firebaseLocalStorageDb",u8=1,$d="firebaseLocalStorage",tM="fbase_key";class Wc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Qd(n,e){return n.transaction([$d],e?"readwrite":"readonly").objectStore($d)}function h8(){const n=indexedDB.deleteDatabase(eM);return new Wc(n).toPromise()}function z_(){const n=indexedDB.open(eM,u8);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore($d,{keyPath:tM})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains($d)?e(i):(i.close(),await h8(),e(await z_()))})})}async function nM(n,e,t){const i=Qd(n,!0).put({[tM]:e,value:t});return new Wc(i).toPromise()}async function d8(n,e){const t=Qd(n,!1).get(e),i=await new Wc(t).toPromise();return i===void 0?null:i.value}function iM(n,e){const t=Qd(n,!0).delete(e);return new Wc(t).toPromise()}const f8=800,p8=3;class sM{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await z_(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>p8)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ZE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=jd._getInstance(c8()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await a8(),!this.activeServiceWorker)return;this.sender=new r8(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);!i||((e=i[0])===null||e===void 0?void 0:e.fulfilled)&&((t=i[0])===null||t===void 0?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||l8()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await z_();return await nM(e,Yd,"1"),await iM(e,Yd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>nM(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>d8(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>iM(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const r=Qd(s,!1).getAll();return new Wc(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;for(const{fbase_key:s,value:r}of e)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),f8)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}sM.type="LOCAL";const m8=sM;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g8(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function _8(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=s=>{const r=Zi("internal-error");r.customData=s,t(r)},i.type="text/javascript",i.charset="UTF-8",g8().appendChild(i)})}function y8(n){return`__${n}${Math.floor(Math.random()*1e6)}`}new Bc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rM(n,e){return e?Ss(e):(Ne(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_ extends XE{constructor(e){super("custom","custom");this.params=e}_getIdTokenResponse(e){return Ya(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ya(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ya(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function v8(n){return jE(n.auth,new V_(n),n.bypassAuthState)}function x8(n){const{auth:e,user:t}=n;return Ne(t,e,"internal-error"),Q6(t,new V_(n),n.bypassAuthState)}async function b8(n){const{auth:e,user:t}=n;return Ne(t,e,"internal-error"),$6(t,new V_(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e,t,i,s,r=!1){this.auth=e,this.resolver=i,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:s,tenantId:r,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:i,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return v8;case"linkViaPopup":case"linkViaRedirect":return b8;case"reauthViaPopup":case"reauthViaRedirect":return x8;default:Ji(this.auth,"internal-error")}}resolve(e){ws(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ws(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T8=new Bc(2e3,1e4);async function G_(n,e,t){const i=Xd(n);w6(n,e,k_);const s=rM(i,t);return new oo(i,"signInViaPopup",e,s).executeNotNull()}class oo extends oM{constructor(e,t,i,s,r){super(e,t,s,r);this.provider=i,this.authWindow=null,this.pollId=null,oo.currentPopupAction&&oo.currentPopupAction.cancel(),oo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ne(e,this.auth,"internal-error"),e}async onExecution(){ws(this.filter.length===1,"Popup operations only handle one event");const e=H_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Zi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Zi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,oo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0?void 0:i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Zi(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,T8.get())};e()}}oo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w8="pendingRedirect",W_=new Map;class S8 extends oM{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i);this.eventId=null}async execute(){let e=W_.get(this.auth._key());if(!e){try{const i=await E8(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}W_.set(this.auth._key(),e)}return this.bypassAuthState||W_.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function E8(n,e){const t=A8(e),i=M8(n);if(!await i._isAvailable())return!1;const s=await i._get(t)==="true";return await i._remove(t),s}function M8(n){return Ss(n._redirectPersistence)}function A8(n){return Gd(w8,n.config.apiKey,n.name)}async function C8(n,e,t=!1){const i=Xd(n),s=rM(i,e),o=await new S8(i,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I8=10*60*1e3;class R8{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!L8(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!lM(e)){const s=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(Zi(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=I8&&this.cachedEventUids.clear(),this.cachedEventUids.has(aM(e))}saveEventToCache(e){this.cachedEventUids.add(aM(e)),this.lastProcessedEventTime=Date.now()}}function aM(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function lM({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function L8(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lM(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P8(n,e={}){return Hc(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N8=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,F8=/^https?/;async function D8(n){if(n.config.emulator)return;const{authorizedDomains:e}=await P8(n);for(const t of e)try{if(O8(t))return}catch{}Ji(n,"unauthorized-domain")}function O8(n){const e=R_(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!F8.test(t))return!1;if(N8.test(n))return i===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k8=new Bc(3e4,6e4);function cM(){const n=es().___jsl;if(n==null?void 0:n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function U8(n){return new Promise((e,t)=>{var i,s,r;function o(){cM(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{cM(),t(Zi(n,"network-request-failed"))},timeout:k8.get()})}if((s=(i=es().gapi)===null||i===void 0?void 0:i.iframes)===null||s===void 0?void 0:s.Iframe)e(gapi.iframes.getContext());else if((r=es().gapi)===null||r===void 0?void 0:r.load)o();else{const a=y8("iframefcb");return es()[a]=()=>{gapi.load?o():t(Zi(n,"network-request-failed"))},_8(`https://apis.google.com/js/api.js?onload=${a}`)}}).catch(e=>{throw Kd=null,e})}let Kd=null;function B8(n){return Kd=Kd||U8(n),Kd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H8=new Bc(5e3,15e3),z8="__/auth/iframe",V8="emulator/auth/iframe",G8={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},W8=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function X8(n){const e=n.config;Ne(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?L_(e,V8):`https://${n.config.authDomain}/${z8}`,i={apiKey:e.apiKey,appName:n.name,v:Wa},s=W8.get(n.config.apiHost);s&&(i.eid=s);const r=n._getFrameworks();return r.length&&(i.fw=r.join(",")),`${t}?${Va(i).slice(1)}`}async function q8(n){const e=await B8(n),t=es().gapi;return Ne(t,n,"internal-error"),e.open({where:document.body,url:X8(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:G8,dontclear:!0},i=>new Promise(async(s,r)=>{await i.restyle({setHideOnLeave:!1});const o=Zi(n,"network-request-failed"),a=es().setTimeout(()=>{r(o)},H8.get());function l(){es().clearTimeout(a),s(i)}i.ping(l).then(l,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y8={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},j8=500,$8=600,Q8="_blank",K8="http://localhost";class uM{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function J8(n,e,t,i=j8,s=$8){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const l=Object.assign(Object.assign({},Y8),{width:i.toString(),height:s.toString(),top:r,left:o}),c=bn().toLowerCase();t&&(a=kE(c)?Q8:t),OE(c)&&(e=e||K8,l.scrollbars="yes");const h=Object.entries(l).reduce((d,[f,p])=>`${d}${f}=${p},`,"");if(W6(c)&&a!=="_self")return Z8(e||"",a),new uM(null);const u=window.open(e||"",a,h);Ne(u,n,"popup-blocked");try{u.focus()}catch{}return new uM(u)}function Z8(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eH="__/auth/handler",tH="emulator/auth/handler";function hM(n,e,t,i,s,r){Ne(n.config.authDomain,n,"auth-domain-config-required"),Ne(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Wa,eventId:s};if(e instanceof k_){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",b_(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[l,c]of Object.entries(r||{}))o[l]=c}if(e instanceof Gc){const l=e.getScopes().filter(c=>c!=="");l.length>0&&(o.scopes=l.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const l of Object.keys(a))a[l]===void 0&&delete a[l];return`${nH(n)}?${Va(a).slice(1)}`}function nH({config:n}){return n.emulator?L_(n,tH):`https://${n.authDomain}/${eH}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X_="webStorageSupport";class iH{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=JE,this._completeRedirectFn=C8}async _openPopup(e,t,i,s){var r;ws((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const o=hM(e,t,i,R_(),s);return J8(e,o,H_())}async _openRedirect(e,t,i,s){return await this._originValidation(e),o8(hM(e,t,i,R_(),s)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:r}=this.eventManagers[t];return s?Promise.resolve(s):(ws(r,"If manager is not set, promise should be"),r)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i}async initAndGetManager(e){const t=await q8(e),i=new R8(e);return t.register("authEvent",s=>(Ne(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(X_,{type:X_},s=>{var r;const o=(r=s==null?void 0:s[0])===null||r===void 0?void 0:r[X_];o!==void 0&&t(!!o),Ji(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=D8(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return VE()||O_()||Wd()}}const sH=iH;var dM="@firebase/auth",fM="0.19.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rH{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{var s;e(((s=i)===null||s===void 0?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ne(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oH(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function aH(n){Ga(new no("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),{apiKey:s,authDomain:r}=i.options;return(o=>{Ne(s&&!s.includes(":"),"invalid-api-key",{appName:o.name}),Ne(!(r==null?void 0:r.includes(":")),"argument-error",{appName:o.name});const a={apiKey:s,authDomain:r,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:GE(n)},l=new Y6(o,a);return E6(l,t),l})(i)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),Ga(new no("auth-internal",e=>{const t=Xd(e.getProvider("auth").getImmediate());return(i=>new rH(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ki(dM,fM,oH(n)),Ki(dM,fM,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lH(n=A_()){const e=Bd(n,"auth");return e.isInitialized()?e.getImmediate():S6(n,{popupRedirectResolver:sH,persistence:[m8,i8,JE]})}aH("Browser");const pM="@firebase/database",mM="0.12.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gM="";function cH(n){gM=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uH{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Gt(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Uc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hH{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return wi(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _M=function(n){try{if(typeof window!="undefined"&&typeof window[n]!="undefined"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new uH(e)}}catch{}return new hH},ao=_M("localStorage"),q_=_M("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $a=new w_("@firebase/database"),yM=function(){let n=1;return function(){return n++}}(),vM=function(n){const e=PB(n),t=new CB;t.update(e);const i=t.digest();return y_.encodeByteArray(i)},Xc=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Xc.apply(null,i):typeof i=="object"?e+=Gt(i):e+=i,e+=" "}return e};let lo=null,xM=!0;const dH=function(n,e){de(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?($a.logLevel=ct.VERBOSE,lo=$a.log.bind($a),e&&q_.set("logging_enabled",!0)):typeof n=="function"?lo=n:(lo=null,q_.remove("logging_enabled"))},Tn=function(...n){if(xM===!0&&(xM=!1,lo===null&&q_.get("logging_enabled")===!0&&dH(!0)),lo){const e=Xc.apply(null,n);lo(e)}},qc=function(n){return function(...e){Tn(n,...e)}},Y_=function(...n){const e="FIREBASE INTERNAL ERROR: "+Xc(...n);$a.error(e)},co=function(...n){const e=`FIREBASE FATAL ERROR: ${Xc(...n)}`;throw $a.error(e),new Error(e)},kn=function(...n){const e="FIREBASE WARNING: "+Xc(...n);$a.warn(e)},fH=function(){typeof window!="undefined"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&kn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},j_=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},pH=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},uo="[MIN_NAME]",yr="[MAX_NAME]",Qa=function(n,e){if(n===e)return 0;if(n===uo||e===yr)return-1;if(e===uo||n===yr)return 1;{const t=wM(n),i=wM(e);return t!==null?i!==null?t-i==0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},mH=function(n,e){return n===e?0:n<e?-1:1},Yc=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Gt(e))},$_=function(n){if(typeof n!="object"||n===null)return Gt(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=Gt(e[i]),t+=":",t+=$_(n[e[i]]);return t+="}",t},bM=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function Un(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const TM=function(n){de(!j_(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let s,r,o,a,l;n===0?(r=0,o=0,s=1/n==-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-i-t))));const c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();const h=c.join("");let u="";for(l=0;l<64;l+=8){let d=parseInt(h.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),u=u+d}return u.toLowerCase()},gH=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},_H=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function yH(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}const vH=new RegExp("^-?(0*)\\d{1,10}$"),xH=-2147483648,bH=2147483647,wM=function(n){if(vH.test(n)){const e=Number(n);if(e>=xH&&e<=bH)return e}return null},Ka=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw kn("Exception was thrown by user callback.",t),e},Math.floor(0))}},TH=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},jc=function(n,e){const t=setTimeout(n,e);return typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wH{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){kn(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SH{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Tn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',kn(e)}}class Q_{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Q_.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K_="5",SM="v",EM="s",MM="r",AM="f",CM=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,IM="ls",EH="p",J_="ac",RM="websocket",LM="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MH{constructor(e,t,i,s,r=!1,o="",a=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ao.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ao.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function AH(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function PM(n,e,t){de(typeof e=="string","typeof type must == string"),de(typeof t=="object","typeof params must == object");let i;if(e===RM)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===LM)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);AH(n)&&(t.ns=n.namespace);const s=[];return Un(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CH{constructor(){this.counters_={}}incrementCounter(e,t=1){wi(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return vB(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z_={},e0={};function t0(n){const e=n.toString();return Z_[e]||(Z_[e]=new CH),Z_[e]}function IH(n,e){const t=n.toString();return e0[t]||(e0[t]=e()),e0[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RH{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Ka(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NM="start",LH="close",PH="pLPCommand",NH="pRTLPCB",FM="id",DM="pw",OM="ser",FH="cb",DH="seg",OH="ts",kH="d",UH="dframe",kM=1870,UM=30,BH=kM-UM,HH=25e3,zH=3e4;class Ja{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=qc(e),this.stats_=t0(t),this.urlFn=l=>(this.appCheckToken&&(l[J_]=this.appCheckToken),PM(t,LM,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new RH(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(zH)),pH(()=>{if(this.isClosed_)return;this.scriptTagHolder=new n0((...r)=>{const[o,a,l,c,h]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===NM)this.id=a,this.password=l;else if(o===LH)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[NM]="t",i[OM]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[FH]=this.scriptTagHolder.uniqueCallbackIdentifier),i[SM]=K_,this.transportSessionId&&(i[EM]=this.transportSessionId),this.lastSessionId&&(i[IM]=this.lastSessionId),this.applicationId&&(i[EH]=this.applicationId),this.appCheckToken&&(i[J_]=this.appCheckToken),typeof location!="undefined"&&location.hostname&&CM.test(location.hostname)&&(i[MM]=AM);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ja.forceAllow_=!0}static forceDisallow(){Ja.forceDisallow_=!0}static isAvailable(){return Ja.forceAllow_?!0:!Ja.forceDisallow_&&typeof document!="undefined"&&document.createElement!=null&&!gH()&&!_H()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Gt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=yB(t),s=bM(i,BH);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[UH]="t",i[FM]=e,i[DM]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Gt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class n0{constructor(e,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=yM(),window[PH+this.uniqueCallbackIdentifier]=e,window[NH+this.uniqueCallbackIdentifier]=t,this.myIFrame=n0.createIFrame_();let r="";if(this.myIFrame.src&&this.myIFrame.src.substr(0,"javascript:".length)==="javascript:"){const a=document.domain;r='<script>document.domain="'+a+'";<\/script>'}const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Tn("frame writing exception"),a.stack&&Tn(a.stack),Tn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Tn("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[FM]=this.myID,e[DM]=this.myPW,e[OM]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+UM+i.length<=kM;){const o=this.pendingSegs.shift();i=i+"&"+DH+s+"="+o.seg+"&"+OH+s+"="+o.ts+"&"+kH+s+"="+o.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(HH)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Tn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VH=16384,GH=45e3;let Jd=null;typeof MozWebSocket!="undefined"?Jd=MozWebSocket:typeof WebSocket!="undefined"&&(Jd=WebSocket);class Si{constructor(e,t,i,s,r,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=qc(this.connId),this.stats_=t0(t),this.connURL=Si.connectionURL_(t,o,a,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,s){const r={};return r[SM]=K_,typeof location!="undefined"&&location.hostname&&CM.test(location.hostname)&&(r[MM]=AM),t&&(r[EM]=t),i&&(r[IM]=i),s&&(r[J_]=s),PM(e,RM,r)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ao.set("previous_websocket_failure",!0);try{if(!vE()){const i={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new Jd(this.connURL,[],i)}}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Si.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator!="undefined"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&Jd!==null&&!Si.forceDisallow_}static previouslyFailed(){return ao.isInMemoryStorage||ao.get("previous_websocket_failure")===!0}markConnectionHealthy(){ao.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=Uc(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(de(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=Gt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=bM(t,VH);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(GH))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Si.responsesRequiredToBeHealthy=2;Si.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Ja,Si]}initTransports_(e){const t=Si&&Si.isAvailable();let i=t&&!Si.previouslyFailed();if(e.webSocketOnly&&(t||kn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Si];else{const s=this.transports_=[];for(const r of i0.ALL_TRANSPORTS)r&&r.isAvailable()&&s.push(r)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WH=6e4,XH=5e3,qH=10*1024,YH=100*1024,s0="t",BM="d",jH="s",HM="r",$H="e",zM="o",VM="a",GM="n",WM="p",QH="h";class KH{constructor(e,t,i,s,r,o,a,l,c,h){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=qc("c:"+this.id+":"),this.transportManager_=new i0(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=jc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>YH?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>qH?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(s0 in e){const t=e[s0];t===VM?this.upgradeIfSecondaryHealthy_():t===HM?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===zM&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Yc("t",e),i=Yc("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:WM,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:VM,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:GM,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Yc("t",e),i=Yc("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Yc(s0,e);if(BM in e){const i=e[BM];if(t===QH)this.onHandshake_(i);else if(t===GM){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===jH?this.onConnectionShutdown_(i):t===HM?this.onReset_(i):t===$H?Y_("Server Error: "+i):t===zM?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Y_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),K_!==i&&kn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),jc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(WH))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):jc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(XH))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:WM,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ao.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XM{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qM{constructor(e){this.allowedEvents_=e,this.listeners_={},de(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){de(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd extends qM{constructor(){super(["online"]);this.online_=!0,typeof window!="undefined"&&typeof window.addEventListener!="undefined"&&!x_()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Zd}getInitialEvent(e){return de(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YM=32,jM=768;class at{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ze(){return new at("")}function ze(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function vr(n){return n.pieces_.length-n.pieceNum_}function dt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new at(n.pieces_,e)}function $M(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function JH(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function QM(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function KM(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new at(e,0)}function Xt(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof at)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new at(t,0)}function Ve(n){return n.pieceNum_>=n.pieces_.length}function Rn(n,e){const t=ze(n),i=ze(e);if(t===null)return e;if(t===i)return Rn(dt(n),dt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function r0(n,e){if(vr(n)!==vr(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Ei(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(vr(n)>vr(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class ZH{constructor(e,t){this.errorPrefix_=t,this.parts_=QM(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=kd(this.parts_[i]);JM(this)}}function ez(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=kd(e),JM(n)}function tz(n){const e=n.parts_.pop();n.byteLength_-=kd(e),n.parts_.length>0&&(n.byteLength_-=1)}function JM(n){if(n.byteLength_>jM)throw new Error(n.errorPrefix_+"has a key path longer than "+jM+" bytes ("+n.byteLength_+").");if(n.parts_.length>YM)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+YM+") or object contains a cycle "+ho(n))}function ho(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0 extends qM{constructor(){super(["visible"]);let e,t;typeof document!="undefined"&&typeof document.addEventListener!="undefined"&&(typeof document.hidden!="undefined"?(t="visibilitychange",e="hidden"):typeof document.mozHidden!="undefined"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden!="undefined"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden!="undefined"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new o0}getInitialEvent(e){return de(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $c=1e3,nz=60*5*1e3,iz=3*1e3,ZM=30*1e3,sz=1.3,rz=3e4,oz="server_kill",e1=3;class Es extends XM{constructor(e,t,i,s,r,o,a,l){super();if(this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Es.nextPersistentConnectionId_++,this.log_=qc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=$c,this.maxReconnectDelay_=nz,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!vE())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");o0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Zd.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const s=++this.requestNumber_,r={r:s,a:e,b:t};this.log_(Gt(r)),de(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new Oc,i={p:e._path.toString(),q:e._queryObject},s={action:"g",request:i,onComplete:o=>{const a=o.d;o.s==="ok"?(this.onDataUpdate_(i.p,a,!1,null),t.resolve(a)):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const o=this.outstandingGets_[r];o===void 0||s!==o||(delete this.outstandingGets_[r],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),this.log_("get "+r+" timed out on connection"),t.reject(new Error("Client is offline.")))},iz),this.connected_&&this.sendGet_(r),t.promise}listen(e,t,i,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),de(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),de(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+i+" for "+s);const r={p:i},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const l=a.d,c=a.s;Es.warnOnListenWarnings_(l,t),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&wi(e,"w")){const i=to(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();kn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||AB(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=ZM)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=MB(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,s=>{const r=s.s,o=s.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),de(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,t)}sendUnlisten_(e,t,i,s){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";s&&(r.q=i,r.t=s),this.sendRequest(o,r)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,s){const r={p:t,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,i,s){this.putInternal("p",e,t,i,s)}merge(e,t,i,s){this.putInternal("m",e,t,i,s)}putInternal(e,t,i,s,r){this.initConnection_();const o={p:t,d:i};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const r=i.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Gt(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Y_("Unrecognized action received from server: "+Gt(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){de(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=$c,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=$c,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>rz&&(this.reconnectDelay_=$c),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*sz)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Es.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,i())},c=function(u){de(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(u)};this.realtime_={close:l,sendRequest:c};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[u,d]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Tn("getToken() completed but was canceled"):(Tn("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=d&&d.token,a=new KH(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,f=>{kn(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(oz)},r))}catch(u){this.log_("Failed to get token: "+u),o||(this.repoInfo_.nodeAdmin&&kn(u),l())}}}interrupt(e){Tn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Tn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],b_(this.interruptReasons_)&&(this.reconnectDelay_=$c,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(r=>$_(r)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const i=new at(e).toString();let s;if(this.listens.has(i)){const r=this.listens.get(i);s=r.get(t),r.delete(t),r.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,t){Tn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=e1&&(this.reconnectDelay_=ZM,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Tn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=e1&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+gM.replace(/\./g,"-")]=1,x_()?e["framework.cordova"]=1:yE()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Zd.getInstance().currentlyOnline();return b_(this.interruptReasons_)&&e}}Es.nextPersistentConnectionId_=0;Es.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ge{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ge(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new Ge(uo,e),s=new Ge(uo,t);return this.compare(i,s)!==0}minPost(){return Ge.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tf;class t1 extends ef{static get __EMPTY_NODE(){return tf}static set __EMPTY_NODE(e){tf=e}compare(e,t){return Qa(e.name,t.name)}isDefinedOn(e){throw za("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ge.MIN}maxPost(){return new Ge(yr,tf)}makePost(e,t){return de(typeof e=="string","KeyIndex indexValue must always be a string."),new Ge(e,tf)}toString(){return".key"}}const fo=new t1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class en{constructor(e,t,i,s,r){this.key=e,this.value=t,this.color=i!=null?i:en.RED,this.left=s!=null?s:Bn.EMPTY_NODE,this.right=r!=null?r:Bn.EMPTY_NODE}copy(e,t,i,s,r){return new en(e!=null?e:this.key,t!=null?t:this.value,i!=null?i:this.color,s!=null?s:this.left,r!=null?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const r=i(e,s.key);return r<0?s=s.copy(null,null,null,s.left.insert(e,t,i),null):r===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Bn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,s;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return Bn.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,en.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,en.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}en.RED=!0;en.BLACK=!1;class az{copy(e,t,i,s,r){return this}insert(e,t,i){return new en(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Bn{constructor(e,t=Bn.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Bn(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,en.BLACK,null,null))}remove(e){return new Bn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,en.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new nf(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new nf(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new nf(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new nf(this.root_,null,this.comparator_,!0,e)}}Bn.EMPTY_NODE=new az;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lz(n,e){return Qa(n.name,e.name)}function a0(n,e){return Qa(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let l0;function cz(n){l0=n}const n1=function(n){return typeof n=="number"?"number:"+TM(n):"string:"+n},i1=function(n){if(n.isLeafNode()){const e=n.val();de(typeof e=="string"||typeof e=="number"||typeof e=="object"&&wi(e,".sv"),"Priority must be a string or number.")}else de(n===l0||n.isEmpty(),"priority of unexpected type.");de(n===l0||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let s1;class tn{constructor(e,t=tn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,de(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),i1(this.priorityNode_)}static set __childrenNodeConstructor(e){s1=e}static get __childrenNodeConstructor(){return s1}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new tn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:tn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ve(e)?this:ze(e)===".priority"?this.priorityNode_:tn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:tn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=ze(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:(de(i!==".priority"||vr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,tn.__childrenNodeConstructor.EMPTY_NODE.updateChild(dt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+n1(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=TM(this.value_):e+=this.value_,this.lazyHash_=vM(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===tn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof tn.__childrenNodeConstructor?-1:(de(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,s=tn.VALUE_TYPE_ORDER.indexOf(t),r=tn.VALUE_TYPE_ORDER.indexOf(i);return de(s>=0,"Unknown leaf type: "+t),de(r>=0,"Unknown leaf type: "+i),s===r?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}tn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r1,o1;function uz(n){r1=n}function hz(n){o1=n}class dz extends ef{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?Qa(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ge.MIN}maxPost(){return new Ge(yr,new tn("[PRIORITY-POST]",o1))}makePost(e,t){const i=r1(e);return new Ge(t,new tn("[PRIORITY-POST]",i))}toString(){return".priority"}}const vt=new dz;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fz=Math.log(2);class pz{constructor(e){const t=r=>parseInt(Math.log(r)/fz,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const sf=function(n,e,t,i){n.sort(e);const s=function(l,c){const h=c-l;let u,d;if(h===0)return null;if(h===1)return u=n[l],d=t?t(u):u,new en(d,u.node,en.BLACK,null,null);{const f=parseInt(h/2,10)+l,p=s(l,f),_=s(f+1,c);return u=n[f],d=t?t(u):u,new en(d,u.node,en.BLACK,p,_)}},r=function(l){let c=null,h=null,u=n.length;const d=function(p,_){const y=u-p,m=u;u-=p;const g=s(y+1,m),v=n[y],x=t?t(v):v;f(new en(x,v.node,_,null,g))},f=function(p){c?(c.left=p,c=p):(h=p,c=p)};for(let p=0;p<l.count;++p){const _=l.nextBitIsOne(),y=Math.pow(2,l.count-(p+1));_?d(y,en.BLACK):(d(y,en.BLACK),d(y,en.RED))}return h},o=new pz(n.length),a=r(o);return new Bn(i||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let c0;const Za={};class Ms{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return de(Za&&vt,"ChildrenNode.ts has not been loaded"),c0=c0||new Ms({".priority":Za},{".priority":vt}),c0}get(e){const t=to(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Bn?t:null}hasIndex(e){return wi(this.indexSet_,e.toString())}addIndex(e,t){de(e!==fo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator(Ge.Wrap);let o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=sf(i,e.getCompare()):a=Za;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const h=Object.assign({},this.indexes_);return h[l]=a,new Ms(h,c)}addToIndexes(e,t){const i=Fd(this.indexes_,(s,r)=>{const o=to(this.indexSet_,r);if(de(o,"Missing index implementation for "+r),s===Za)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(Ge.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),sf(a,o.getCompare())}else return Za;else{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new Ge(e.name,a))),l.insert(e,e.node)}});return new Ms(i,this.indexSet_)}removeFromIndexes(e,t){const i=Fd(this.indexes_,s=>{if(s===Za)return s;{const r=t.get(e.name);return r?s.remove(new Ge(e.name,r)):s}});return new Ms(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qc;class Ce{constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&i1(this.priorityNode_),this.children_.isEmpty()&&de(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Qc||(Qc=new Ce(new Bn(a0),null,Ms.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Qc}updatePriority(e){return this.children_.isEmpty()?this:new Ce(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Qc:t}}getChild(e){const t=ze(e);return t===null?this:this.getImmediateChild(t).getChild(dt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(de(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new Ge(e,t);let s,r;t.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));const o=s.isEmpty()?Qc:this.priorityNode_;return new Ce(s,o,r)}}updateChild(e,t){const i=ze(e);if(i===null)return t;{de(ze(e)!==".priority"||vr(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(dt(e),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,s=0,r=!0;if(this.forEachChild(vt,(o,a)=>{t[o]=a.val(e),i++,r&&Ce.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):r=!1}),!e&&r&&s<2*i){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+n1(this.getPriority().val())+":"),this.forEachChild(vt,(t,i)=>{const s=i.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":vM(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const s=this.resolveIndex_(i);if(s){const r=s.getPredecessorKey(new Ge(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ge(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ge(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,Ge.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)<0;)s.getNext(),r=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,Ge.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)>0;)s.getNext(),r=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Kc?-1:0}withIndex(e){if(e===fo||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Ce(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===fo||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(vt),s=t.getIterator(vt);let r=i.getNext(),o=s.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=i.getNext(),o=s.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===fo?null:this.indexMap_.get(e.toString())}}Ce.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class mz extends Ce{constructor(){super(new Bn(a0),Ce.EMPTY_NODE,Ms.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ce.EMPTY_NODE}isEmpty(){return!1}}const Kc=new mz;Object.defineProperties(Ge,{MIN:{value:new Ge(uo,Ce.EMPTY_NODE)},MAX:{value:new Ge(yr,Kc)}});t1.__EMPTY_NODE=Ce.EMPTY_NODE;tn.__childrenNodeConstructor=Ce;cz(Kc);hz(Kc);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gz=!0;function qt(n,e=null){if(n===null)return Ce.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),de(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new tn(t,qt(e))}if(!(n instanceof Array)&&gz){const t=[];let i=!1;if(Un(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=qt(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new Ge(o,l)))}}),t.length===0)return Ce.EMPTY_NODE;const r=sf(t,lz,o=>o.name,a0);if(i){const o=sf(t,vt.getCompare());return new Ce(r,qt(e),new Ms({".priority":o},{".priority":vt}))}else return new Ce(r,qt(e),Ms.Default)}else{let t=Ce.EMPTY_NODE;return Un(n,(i,s)=>{if(wi(n,i)&&i.substring(0,1)!=="."){const r=qt(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(qt(e))}}uz(qt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0 extends ef{constructor(e){super();this.indexPath_=e,de(!Ve(e)&&ze(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?Qa(e.name,t.name):r}makePost(e,t){const i=qt(e),s=Ce.EMPTY_NODE.updateChild(this.indexPath_,i);return new Ge(t,s)}maxPost(){const e=Ce.EMPTY_NODE.updateChild(this.indexPath_,Kc);return new Ge(yr,e)}toString(){return QM(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _z extends ef{compare(e,t){const i=e.node.compareTo(t.node);return i===0?Qa(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ge.MIN}maxPost(){return Ge.MAX}makePost(e,t){const i=qt(e);return new Ge(t,i)}toString(){return".value"}}const a1=new _z;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l1="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",yz=function(){let n=0;const e=[];return function(t){const i=t===n;n=t;let s;const r=new Array(8);for(s=7;s>=0;s--)r[s]=l1.charAt(t%64),t=Math.floor(t/64);de(t===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=l1.charAt(e[s]);return de(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c1(n){return{type:"value",snapshotNode:n}}function el(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Jc(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Zc(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function vz(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h0{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){de(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(Jc(t,a)):de(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(el(t,i)):o.trackChildChange(Zc(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(vt,(s,r)=>{t.hasChild(s)||i.trackChildChange(Jc(s,r))}),t.isLeafNode()||t.forEachChild(vt,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(Zc(s,r,o))}else i.trackChildChange(el(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Ce.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu{constructor(e){this.indexedFilter_=new h0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=eu.getStartPost_(e),this.endPost_=eu.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,i,s,r,o){return this.matches(new Ge(t,i))||(i=Ce.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=Ce.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(Ce.EMPTY_NODE);const r=this;return t.forEachChild(vt,(o,a)=>{r.matches(new Ge(o,a))||(s=s.updateImmediateChild(o,Ce.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xz{constructor(e){this.rangedFilter_=new eu(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new Ge(t,i))||(i=Ce.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=Ce.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=Ce.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();let l;if(this.reverse_?l=this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:l=this.index_.compare(a,this.rangedFilter_.getEndPost())<=0,l)s=s.updateImmediateChild(a.name,a.node),o++;else break}}else{s=t.withIndex(this.index_),s=s.updatePriority(Ce.EMPTY_NODE);let r,o,a,l;if(this.reverse_){l=s.getReverseIterator(this.index_),r=this.rangedFilter_.getEndPost(),o=this.rangedFilter_.getStartPost();const u=this.index_.getCompare();a=(d,f)=>u(f,d)}else l=s.getIterator(this.index_),r=this.rangedFilter_.getStartPost(),o=this.rangedFilter_.getEndPost(),a=this.index_.getCompare();let c=0,h=!1;for(;l.hasNext();){const u=l.getNext();!h&&a(r,u)<=0&&(h=!0),h&&c<this.limit_&&a(u,o)<=0?c++:s=s.updateImmediateChild(u.name,Ce.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){const u=this.index_.getCompare();o=(d,f)=>u(f,d)}else o=this.index_.getCompare();const a=e;de(a.numChildren()===this.limit_,"");const l=new Ge(t,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const u=a.getImmediateChild(t);let d=s.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=s.getChildAfterChild(this.index_,d,this.reverse_);const f=d==null?1:o(d,l);if(h&&!i.isEmpty()&&f>=0)return r!=null&&r.trackChildChange(Zc(t,i,u)),a.updateImmediateChild(t,i);{r!=null&&r.trackChildChange(Jc(t,u));const _=a.updateImmediateChild(t,Ce.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r!=null&&r.trackChildChange(el(d.name,d.node)),_.updateImmediateChild(d.name,d.node)):_}}else return i.isEmpty()?e:h&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Jc(c.name,c.node)),r.trackChildChange(el(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(c.name,Ce.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=vt}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return de(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return de(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:uo}hasEnd(){return this.endSet_}getIndexEndValue(){return de(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return de(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:yr}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return de(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===vt}copy(){const e=new d0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function bz(n){return n.loadsAllData()?new h0(n.getIndex()):n.hasLimit()?new xz(n):new eu(n)}function Tz(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function wz(n,e,t){const i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Sz(n,e){const t=n.copy();return t.index_=e,t}function u1(n){const e={};if(n.isDefault())return e;let t;return n.index_===vt?t="$priority":n.index_===a1?t="$value":n.index_===fo?t="$key":(de(n.index_ instanceof u0,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Gt(t),n.startSet_&&(e.startAt=Gt(n.indexStartValue_),n.startNameSet_&&(e.startAt+=","+Gt(n.indexStartName_))),n.endSet_&&(e.endAt=Gt(n.indexEndValue_),n.endNameSet_&&(e.endAt+=","+Gt(n.indexEndName_))),n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function h1(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_)),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_)),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==vt&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rf extends XM{constructor(e,t,i,s){super();this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=qc("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(de(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=rf.getListenId_(e,i),a={};this.listens_[o]=a;const l=u1(e._queryParams);this.restRequest_(r+".json",l,(c,h)=>{let u=h;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(r,u,!1,i),to(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",s(d,null)}})}unlisten(e,t){const i=rf.getListenId_(e,t);delete this.listens_[i]}get(e){const t=u1(e._queryParams),i=e._path.toString(),s=new Oc;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Va(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Uc(a.responseText)}catch{kn("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&kn("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ez{constructor(){this.rootNode_=Ce.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function of(){return{value:null,children:new Map}}function d1(n,e,t){if(Ve(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=ze(e);n.children.has(i)||n.children.set(i,of());const s=n.children.get(i);e=dt(e),d1(s,e,t)}}function f0(n,e,t){n.value!==null?t(e,n.value):Mz(n,(i,s)=>{const r=new at(e.toString()+"/"+i);f0(s,r,t)})}function Mz(n,e){n.children.forEach((t,i)=>{e(i,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Az{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Un(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f1=10*1e3,Cz=30*1e3,Iz=5*60*1e3;class Rz{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Az(e);const i=f1+(Cz-f1)*Math.random();jc(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;Un(e,(s,r)=>{r>0&&wi(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),jc(this.reportStats_.bind(this),Math.floor(Math.random()*2*Iz))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mi;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Mi||(Mi={}));function p1(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function p0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function m0(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Mi.ACK_USER_WRITE,this.source=p1()}operationForChild(e){if(Ve(this.path)){if(this.affectedTree.value!=null)return de(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new at(e));return new af(Ze(),t,this.revert)}}else return de(ze(this.path)===e,"operationForChild called for unrelated child."),new af(dt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(e,t){this.source=e,this.path=t,this.type=Mi.LISTEN_COMPLETE}operationForChild(e){return Ve(this.path)?new tu(this.source,Ze()):new tu(this.source,dt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Mi.OVERWRITE}operationForChild(e){return Ve(this.path)?new po(this.source,Ze(),this.snap.getImmediateChild(e)):new po(this.source,dt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Mi.MERGE}operationForChild(e){if(Ve(this.path)){const t=this.children.subtree(new at(e));return t.isEmpty()?null:t.value?new po(this.source,Ze(),t.value):new nu(this.source,Ze(),t)}else return de(ze(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new nu(this.source,dt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ve(e))return this.isFullyInitialized()&&!this.filtered_;const t=ze(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lz{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Pz(n,e,t,i){const s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(vz(o.childName,o.snapshotNode))}),iu(n,s,"child_removed",e,i,t),iu(n,s,"child_added",e,i,t),iu(n,s,"child_moved",r,i,t),iu(n,s,"child_changed",e,i,t),iu(n,s,"value",e,i,t),s}function iu(n,e,t,i,s,r){const o=i.filter(a=>a.type===t);o.sort((a,l)=>Fz(n,a,l)),o.forEach(a=>{const l=Nz(n,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function Nz(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Fz(n,e,t){if(e.childName==null||t.childName==null)throw za("Should only compare child_ events.");const i=new Ge(e.childName,e.snapshotNode),s=new Ge(t.childName,t.snapshotNode);return n.index_.compare(i,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lf(n,e){return{eventCache:n,serverCache:e}}function su(n,e,t,i){return lf(new xr(e,t,i),n.serverCache)}function m1(n,e,t,i){return lf(n.eventCache,new xr(e,t,i))}function cf(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function mo(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g0;const Dz=()=>(g0||(g0=new Bn(mH)),g0);class _t{constructor(e,t=Dz()){this.value=e,this.children=t}static fromObject(e){let t=new _t(null);return Un(e,(i,s)=>{t=t.set(new at(i),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ze(),value:this.value};if(Ve(e))return null;{const i=ze(e),s=this.children.get(i);if(s!==null){const r=s.findRootMostMatchingPathAndValue(dt(e),t);return r!=null?{path:Xt(new at(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ve(e))return this;{const t=ze(e),i=this.children.get(t);return i!==null?i.subtree(dt(e)):new _t(null)}}set(e,t){if(Ve(e))return new _t(t,this.children);{const i=ze(e),r=(this.children.get(i)||new _t(null)).set(dt(e),t),o=this.children.insert(i,r);return new _t(this.value,o)}}remove(e){if(Ve(e))return this.children.isEmpty()?new _t(null):new _t(null,this.children);{const t=ze(e),i=this.children.get(t);if(i){const s=i.remove(dt(e));let r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new _t(null):new _t(this.value,r)}else return this}}get(e){if(Ve(e))return this.value;{const t=ze(e),i=this.children.get(t);return i?i.get(dt(e)):null}}setTree(e,t){if(Ve(e))return t;{const i=ze(e),r=(this.children.get(i)||new _t(null)).setTree(dt(e),t);let o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new _t(this.value,o)}}fold(e){return this.fold_(Ze(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(Xt(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Ze(),t)}findOnPath_(e,t,i){const s=this.value?i(t,this.value):!1;if(s)return s;if(Ve(e))return null;{const r=ze(e),o=this.children.get(r);return o?o.findOnPath_(dt(e),Xt(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ze(),t)}foreachOnPath_(e,t,i){if(Ve(e))return this;{this.value&&i(t,this.value);const s=ze(e),r=this.children.get(s);return r?r.foreachOnPath_(dt(e),Xt(t,s),i):new _t(null)}}foreach(e){this.foreach_(Ze(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(Xt(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(e){this.writeTree_=e}static empty(){return new Ai(new _t(null))}}function ru(n,e,t){if(Ve(e))return new Ai(new _t(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let r=i.value;const o=Rn(s,e);return r=r.updateChild(o,t),new Ai(n.writeTree_.set(s,r))}else{const s=new _t(t),r=n.writeTree_.setTree(e,s);return new Ai(r)}}}function g1(n,e,t){let i=n;return Un(t,(s,r)=>{i=ru(i,Xt(e,s),r)}),i}function _1(n,e){if(Ve(e))return Ai.empty();{const t=n.writeTree_.setTree(e,new _t(null));return new Ai(t)}}function _0(n,e){return go(n,e)!=null}function go(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Rn(t.path,e)):null}function y1(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(vt,(i,s)=>{e.push(new Ge(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new Ge(i,s.value))}),e}function br(n,e){if(Ve(e))return n;{const t=go(n,e);return t!=null?new Ai(new _t(t)):new Ai(n.writeTree_.subtree(e))}}function y0(n){return n.writeTree_.isEmpty()}function tl(n,e){return v1(Ze(),n.writeTree_,e)}function v1(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(de(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=v1(Xt(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(Xt(n,".priority"),i)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uf(n,e){return S1(e,n)}function Oz(n,e,t,i,s){de(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=ru(n.visibleWrites,e,t)),n.lastWriteId=i}function kz(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function Uz(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);de(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&Bz(a,i.path)?s=!1:Ei(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return Hz(n),!0;if(i.snap)n.visibleWrites=_1(n.visibleWrites,i.path);else{const a=i.children;Un(a,l=>{n.visibleWrites=_1(n.visibleWrites,Xt(i.path,l))})}return!0}else return!1}function Bz(n,e){if(n.snap)return Ei(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Ei(Xt(n.path,t),e))return!0;return!1}function Hz(n){n.visibleWrites=x1(n.allWrites,zz,Ze()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function zz(n){return n.visible}function x1(n,e,t){let i=Ai.empty();for(let s=0;s<n.length;++s){const r=n[s];if(e(r)){const o=r.path;let a;if(r.snap)Ei(t,o)?(a=Rn(t,o),i=ru(i,a,r.snap)):Ei(o,t)&&(a=Rn(o,t),i=ru(i,Ze(),r.snap.getChild(a)));else if(r.children){if(Ei(t,o))a=Rn(t,o),i=g1(i,a,r.children);else if(Ei(o,t))if(a=Rn(o,t),Ve(a))i=g1(i,Ze(),r.children);else{const l=to(r.children,ze(a));if(l){const c=l.getChild(dt(a));i=ru(i,Ze(),c)}}}else throw za("WriteRecord should have .snap or .children")}}return i}function b1(n,e,t,i,s){if(!i&&!s){const r=go(n.visibleWrites,e);if(r!=null)return r;{const o=br(n.visibleWrites,e);if(y0(o))return t;if(t==null&&!_0(o,Ze()))return null;{const a=t||Ce.EMPTY_NODE;return tl(o,a)}}}else{const r=br(n.visibleWrites,e);if(!s&&y0(r))return t;if(!s&&t==null&&!_0(r,Ze()))return null;{const o=function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(Ei(c.path,e)||Ei(e,c.path))},a=x1(n.allWrites,o,e),l=t||Ce.EMPTY_NODE;return tl(a,l)}}}function Vz(n,e,t){let i=Ce.EMPTY_NODE;const s=go(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(vt,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){const r=br(n.visibleWrites,e);return t.forEachChild(vt,(o,a)=>{const l=tl(br(r,new at(o)),a);i=i.updateImmediateChild(o,l)}),y1(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const r=br(n.visibleWrites,e);return y1(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Gz(n,e,t,i,s){de(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=Xt(e,t);if(_0(n.visibleWrites,r))return null;{const o=br(n.visibleWrites,r);return y0(o)?s.getChild(t):tl(o,s.getChild(t))}}function Wz(n,e,t,i){const s=Xt(e,t),r=go(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){const o=br(n.visibleWrites,s);return tl(o,i.getNode().getImmediateChild(t))}else return null}function Xz(n,e){return go(n.visibleWrites,e)}function qz(n,e,t,i,s,r,o){let a;const l=br(n.visibleWrites,e),c=go(l,Ze());if(c!=null)a=c;else if(t!=null)a=tl(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],u=o.getCompare(),d=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let f=d.getNext();for(;f&&h.length<s;)u(f,i)!==0&&h.push(f),f=d.getNext();return h}else return[]}function Yz(){return{visibleWrites:Ai.empty(),allWrites:[],lastWriteId:-1}}function hf(n,e,t,i){return b1(n.writeTree,n.treePath,e,t,i)}function v0(n,e){return Vz(n.writeTree,n.treePath,e)}function T1(n,e,t,i){return Gz(n.writeTree,n.treePath,e,t,i)}function df(n,e){return Xz(n.writeTree,Xt(n.treePath,e))}function jz(n,e,t,i,s,r){return qz(n.writeTree,n.treePath,e,t,i,s,r)}function x0(n,e,t){return Wz(n.writeTree,n.treePath,e,t)}function w1(n,e){return S1(Xt(n.treePath,e),n.writeTree)}function S1(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $z{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;de(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),de(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,Zc(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,Jc(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,el(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,Zc(i,e.snapshotNode,s.oldSnap));else throw za("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qz{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const E1=new Qz;class b0{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new xr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return x0(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:mo(this.viewCache_),r=jz(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kz(n){return{filter:n}}function Jz(n,e){de(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),de(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Zz(n,e,t,i,s){const r=new $z;let o,a;if(t.type===Mi.OVERWRITE){const c=t;c.source.fromUser?o=T0(n,e,c.path,c.snap,i,s,r):(de(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!Ve(c.path),o=ff(n,e,c.path,c.snap,i,s,a,r))}else if(t.type===Mi.MERGE){const c=t;c.source.fromUser?o=tV(n,e,c.path,c.children,i,s,r):(de(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=w0(n,e,c.path,c.children,i,s,a,r))}else if(t.type===Mi.ACK_USER_WRITE){const c=t;c.revert?o=sV(n,e,c.path,i,s,r):o=nV(n,e,c.path,c.affectedTree,i,s,r)}else if(t.type===Mi.LISTEN_COMPLETE)o=iV(n,e,t.path,i,r);else throw za("Unknown operation type: "+t.type);const l=r.getChanges();return eV(e,o,l),{viewCache:o,changes:l}}function eV(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=cf(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(c1(cf(e)))}}function M1(n,e,t,i,s,r){const o=e.eventCache;if(df(i,t)!=null)return e;{let a,l;if(Ve(t))if(de(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=mo(e),h=c instanceof Ce?c:Ce.EMPTY_NODE,u=v0(i,h);a=n.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{const c=hf(i,mo(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{const c=ze(t);if(c===".priority"){de(vr(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const u=T1(i,t,h,l);u!=null?a=n.filter.updatePriority(h,u):a=o.getNode()}else{const h=dt(t);let u;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const d=T1(i,t,o.getNode(),l);d!=null?u=o.getNode().getImmediateChild(c).updateChild(h,d):u=o.getNode().getImmediateChild(c)}else u=x0(i,c,e.serverCache);u!=null?a=n.filter.updateChild(o.getNode(),c,u,h,s,r):a=o.getNode()}}return su(e,a,o.isFullyInitialized()||Ve(t),n.filter.filtersNodes())}}function ff(n,e,t,i,s,r,o,a){const l=e.serverCache;let c;const h=o?n.filter:n.filter.getIndexedFilter();if(Ve(t))c=h.updateFullNode(l.getNode(),i,null);else if(h.filtersNodes()&&!l.isFiltered()){const f=l.getNode().updateChild(t,i);c=h.updateFullNode(l.getNode(),f,null)}else{const f=ze(t);if(!l.isCompleteForPath(t)&&vr(t)>1)return e;const p=dt(t),y=l.getNode().getImmediateChild(f).updateChild(p,i);f===".priority"?c=h.updatePriority(l.getNode(),y):c=h.updateChild(l.getNode(),f,y,p,E1,null)}const u=m1(e,c,l.isFullyInitialized()||Ve(t),h.filtersNodes()),d=new b0(s,u,r);return M1(n,u,t,s,d,a)}function T0(n,e,t,i,s,r,o){const a=e.eventCache;let l,c;const h=new b0(s,e,r);if(Ve(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),l=su(e,c,!0,n.filter.filtersNodes());else{const u=ze(t);if(u===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),i),l=su(e,c,a.isFullyInitialized(),a.isFiltered());else{const d=dt(t),f=a.getNode().getImmediateChild(u);let p;if(Ve(d))p=i;else{const _=h.getCompleteChild(u);_!=null?$M(d)===".priority"&&_.getChild(KM(d)).isEmpty()?p=_:p=_.updateChild(d,i):p=Ce.EMPTY_NODE}if(f.equals(p))l=e;else{const _=n.filter.updateChild(a.getNode(),u,p,d,h,o);l=su(e,_,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function A1(n,e){return n.eventCache.isCompleteForChild(e)}function tV(n,e,t,i,s,r,o){let a=e;return i.foreach((l,c)=>{const h=Xt(t,l);A1(e,ze(h))&&(a=T0(n,a,h,c,s,r,o))}),i.foreach((l,c)=>{const h=Xt(t,l);A1(e,ze(h))||(a=T0(n,a,h,c,s,r,o))}),a}function C1(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function w0(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;Ve(t)?c=i:c=new _t(null).setTree(t,i);const h=e.serverCache.getNode();return c.children.inorderTraversal((u,d)=>{if(h.hasChild(u)){const f=e.serverCache.getNode().getImmediateChild(u),p=C1(n,f,d);l=ff(n,l,new at(u),p,s,r,o,a)}}),c.children.inorderTraversal((u,d)=>{const f=!e.serverCache.isCompleteForChild(u)&&d.value===void 0;if(!h.hasChild(u)&&!f){const p=e.serverCache.getNode().getImmediateChild(u),_=C1(n,p,d);l=ff(n,l,new at(u),_,s,r,o,a)}}),l}function nV(n,e,t,i,s,r,o){if(df(s,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(Ve(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return ff(n,e,t,l.getNode().getChild(t),s,r,a,o);if(Ve(t)){let c=new _t(null);return l.getNode().forEachChild(fo,(h,u)=>{c=c.set(new at(h),u)}),w0(n,e,t,c,s,r,a,o)}else return e}else{let c=new _t(null);return i.foreach((h,u)=>{const d=Xt(t,h);l.isCompleteForPath(d)&&(c=c.set(h,l.getNode().getChild(d)))}),w0(n,e,t,c,s,r,a,o)}}function iV(n,e,t,i,s){const r=e.serverCache,o=m1(e,r.getNode(),r.isFullyInitialized()||Ve(t),r.isFiltered());return M1(n,o,t,i,E1,s)}function sV(n,e,t,i,s,r){let o;if(df(i,t)!=null)return e;{const a=new b0(i,e,s),l=e.eventCache.getNode();let c;if(Ve(t)||ze(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=hf(i,mo(e));else{const u=e.serverCache.getNode();de(u instanceof Ce,"serverChildren would be complete if leaf node"),h=v0(i,u)}h=h,c=n.filter.updateFullNode(l,h,r)}else{const h=ze(t);let u=x0(i,h,e.serverCache);u==null&&e.serverCache.isCompleteForChild(h)&&(u=l.getImmediateChild(h)),u!=null?c=n.filter.updateChild(l,h,u,dt(t),a,r):e.eventCache.getNode().hasChild(h)?c=n.filter.updateChild(l,h,Ce.EMPTY_NODE,dt(t),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=hf(i,mo(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||df(i,Ze())!=null,su(e,c,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new h0(i.getIndex()),r=bz(i);this.processor_=Kz(r);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(Ce.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(Ce.EMPTY_NODE,a.getNode(),null),h=new xr(l,o.isFullyInitialized(),s.filtersNodes()),u=new xr(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=lf(u,h),this.eventGenerator_=new Lz(this.query_)}get query(){return this.query_}}function oV(n){return n.viewCache_.serverCache.getNode()}function aV(n){return cf(n.viewCache_)}function lV(n,e){const t=mo(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Ve(e)&&!t.getImmediateChild(ze(e)).isEmpty())?t.getChild(e):null}function I1(n){return n.eventRegistrations_.length===0}function cV(n,e){n.eventRegistrations_.push(e)}function R1(n,e,t){const i=[];if(t){de(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function L1(n,e,t,i){e.type===Mi.MERGE&&e.source.queryId!==null&&(de(mo(n.viewCache_),"We should always have a full cache before handling merges"),de(cf(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=Zz(n.processor_,s,e,t,i);return Jz(n.processor_,r.viewCache),de(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,P1(n,r.changes,r.viewCache.eventCache.getNode(),null)}function uV(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(vt,(r,o)=>{i.push(el(r,o))}),t.isFullyInitialized()&&i.push(c1(t.getNode())),P1(n,i,t.getNode(),e)}function P1(n,e,t,i){const s=i?[i]:n.eventRegistrations_;return Pz(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pf;class N1{constructor(){this.views=new Map}}function hV(n){de(!pf,"__referenceConstructor has already been defined"),pf=n}function dV(){return de(pf,"Reference.ts has not been loaded"),pf}function fV(n){return n.views.size===0}function S0(n,e,t,i){const s=e.source.queryId;if(s!==null){const r=n.views.get(s);return de(r!=null,"SyncTree gave us an op for an invalid query."),L1(r,e,t,i)}else{let r=[];for(const o of n.views.values())r=r.concat(L1(o,e,t,i));return r}}function F1(n,e,t,i,s){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=hf(t,s?i:null),l=!1;a?l=!0:i instanceof Ce?(a=v0(t,i),l=!1):(a=Ce.EMPTY_NODE,l=!1);const c=lf(new xr(a,l,!1),new xr(i,s,!1));return new rV(e,c)}return o}function pV(n,e,t,i,s,r){const o=F1(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),cV(o,t),uV(o,t)}function mV(n,e,t,i){const s=e._queryIdentifier,r=[];let o=[];const a=wr(n);if(s==="default")for(const[l,c]of n.views.entries())o=o.concat(R1(c,t,i)),I1(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{const l=n.views.get(s);l&&(o=o.concat(R1(l,t,i)),I1(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!wr(n)&&r.push(new(dV())(e._repo,e._path)),{removed:r,events:o}}function D1(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Tr(n,e){let t=null;for(const i of n.views.values())t=t||lV(i,e);return t}function O1(n,e){if(e._queryParams.loadsAllData())return mf(n);{const i=e._queryIdentifier;return n.views.get(i)}}function k1(n,e){return O1(n,e)!=null}function wr(n){return mf(n)!=null}function mf(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gf;function gV(n){de(!gf,"__referenceConstructor has already been defined"),gf=n}function _V(){return de(gf,"Reference.ts has not been loaded"),gf}let yV=1;class U1{constructor(e){this.listenProvider_=e,this.syncPointTree_=new _t(null),this.pendingWriteTree_=Yz(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function E0(n,e,t,i,s){return Oz(n.pendingWriteTree_,e,t,i,s),s?au(n,new po(p1(),e,t)):[]}function _o(n,e,t=!1){const i=kz(n.pendingWriteTree_,e);if(Uz(n.pendingWriteTree_,e)){let r=new _t(null);return i.snap!=null?r=r.set(Ze(),!0):Un(i.children,o=>{r=r.set(new at(o),!0)}),au(n,new af(i.path,r,t))}else return[]}function ou(n,e,t){return au(n,new po(p0(),e,t))}function vV(n,e,t){const i=_t.fromObject(t);return au(n,new nu(p0(),e,i))}function xV(n,e){return au(n,new tu(p0(),e))}function bV(n,e,t){const i=A0(n,t);if(i){const s=C0(i),r=s.path,o=s.queryId,a=Rn(r,e),l=new tu(m0(o),a);return I0(n,r,l)}else return[]}function M0(n,e,t,i){const s=e._path,r=n.syncPointTree_.get(s);let o=[];if(r&&(e._queryIdentifier==="default"||k1(r,e))){const a=mV(r,e,t,i);fV(r)&&(n.syncPointTree_=n.syncPointTree_.remove(s));const l=a.removed;o=a.events;const c=l.findIndex(u=>u._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(s,(u,d)=>wr(d));if(c&&!h){const u=n.syncPointTree_.subtree(s);if(!u.isEmpty()){const d=EV(u);for(let f=0;f<d.length;++f){const p=d[f],_=p.query,y=V1(n,p);n.listenProvider_.startListening(lu(_),yf(n,_),y.hashFn,y.onComplete)}}}if(!h&&l.length>0&&!i)if(c){const u=null;n.listenProvider_.stopListening(lu(e),u)}else l.forEach(u=>{const d=n.queryToTagMap.get(vf(u));n.listenProvider_.stopListening(lu(u),d)});MV(n,l)}return o}function TV(n,e,t,i){const s=A0(n,i);if(s!=null){const r=C0(s),o=r.path,a=r.queryId,l=Rn(o,e),c=new po(m0(a),l,t);return I0(n,o,c)}else return[]}function wV(n,e,t,i){const s=A0(n,i);if(s){const r=C0(s),o=r.path,a=r.queryId,l=Rn(o,e),c=_t.fromObject(t),h=new nu(m0(a),l,c);return I0(n,o,h)}else return[]}function B1(n,e,t){const i=e._path;let s=null,r=!1;n.syncPointTree_.foreachOnPath(i,(u,d)=>{const f=Rn(u,i);s=s||Tr(d,f),r=r||wr(d)});let o=n.syncPointTree_.get(i);o?(r=r||wr(o),s=s||Tr(o,Ze())):(o=new N1,n.syncPointTree_=n.syncPointTree_.set(i,o));let a;s!=null?a=!0:(a=!1,s=Ce.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((d,f)=>{const p=Tr(f,Ze());p&&(s=s.updateImmediateChild(d,p))}));const l=k1(o,e);if(!l&&!e._queryParams.loadsAllData()){const u=vf(e);de(!n.queryToTagMap.has(u),"View does not exist, but we have a tag");const d=AV();n.queryToTagMap.set(u,d),n.tagToQueryMap.set(d,u)}const c=uf(n.pendingWriteTree_,i);let h=pV(o,e,t,c,s,a);if(!l&&!r){const u=O1(o,e);h=h.concat(CV(n,e,u))}return h}function _f(n,e,t){const i=!0,s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=Rn(o,e),c=Tr(a,l);if(c)return c});return b1(s,e,r,t,i)}function SV(n,e){const t=e._path;let i=null;n.syncPointTree_.foreachOnPath(t,(c,h)=>{const u=Rn(c,t);i=i||Tr(h,u)});let s=n.syncPointTree_.get(t);s?i=i||Tr(s,Ze()):(s=new N1,n.syncPointTree_=n.syncPointTree_.set(t,s));const r=i!=null,o=r?new xr(i,!0,!1):null,a=uf(n.pendingWriteTree_,e._path),l=F1(s,e,a,r?o.getNode():Ce.EMPTY_NODE,r);return aV(l)}function au(n,e){return H1(e,n.syncPointTree_,null,uf(n.pendingWriteTree_,Ze()))}function H1(n,e,t,i){if(Ve(n.path))return z1(n,e,t,i);{const s=e.get(Ze());t==null&&s!=null&&(t=Tr(s,Ze()));let r=[];const o=ze(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const c=t?t.getImmediateChild(o):null,h=w1(i,o);r=r.concat(H1(a,l,c,h))}return s&&(r=r.concat(S0(s,n,i,t))),r}}function z1(n,e,t,i){const s=e.get(Ze());t==null&&s!=null&&(t=Tr(s,Ze()));let r=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,c=w1(i,o),h=n.operationForChild(o);h&&(r=r.concat(z1(h,a,l,c)))}),s&&(r=r.concat(S0(s,n,i,t))),r}function V1(n,e){const t=e.query,i=yf(n,t);return{hashFn:()=>(oV(e)||Ce.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?bV(n,t._path,i):xV(n,t._path);{const r=yH(s,t);return M0(n,t,null,r)}}}}function yf(n,e){const t=vf(e);return n.queryToTagMap.get(t)}function vf(n){return n._path.toString()+"$"+n._queryIdentifier}function A0(n,e){return n.tagToQueryMap.get(e)}function C0(n){const e=n.indexOf("$");return de(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new at(n.substr(0,e))}}function I0(n,e,t){const i=n.syncPointTree_.get(e);de(i,"Missing sync point for query tag that we're tracking");const s=uf(n.pendingWriteTree_,e);return S0(i,t,s,null)}function EV(n){return n.fold((e,t,i)=>{if(t&&wr(t))return[mf(t)];{let s=[];return t&&(s=D1(t)),Un(i,(r,o)=>{s=s.concat(o)}),s}})}function lu(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(_V())(n._repo,n._path):n}function MV(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=vf(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function AV(){return yV++}function CV(n,e,t){const i=e._path,s=yf(n,e),r=V1(n,t),o=n.listenProvider_.startListening(lu(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)de(!wr(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,h,u)=>{if(!Ve(c)&&h&&wr(h))return[mf(h).query];{let d=[];return h&&(d=d.concat(D1(h).map(f=>f.query))),Un(u,(f,p)=>{d=d.concat(p)}),d}});for(let c=0;c<l.length;++c){const h=l[c];n.listenProvider_.stopListening(lu(h),yf(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R0{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new R0(t)}node(){return this.node_}}class L0{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Xt(this.path_,e);return new L0(this.syncTree_,t)}node(){return _f(this.syncTree_,this.path_)}}const IV=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},G1=function(n,e,t){if(!n||typeof n!="object")return n;if(de(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return RV(n[".sv"],e,t);if(typeof n[".sv"]=="object")return LV(n[".sv"],e);de(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},RV=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:de(!1,"Unexpected server value: "+n)}},LV=function(n,e,t){n.hasOwnProperty("increment")||de(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&de(!1,"Unexpected increment value: "+i);const s=e.node();if(de(s!==null&&typeof s!="undefined","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return typeof o!="number"?i:o+i},PV=function(n,e,t,i){return N0(e,new L0(t,n),i)},P0=function(n,e,t){return N0(n,new R0(e),t)};function N0(n,e,t){const i=n.getPriority().val(),s=G1(i,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=G1(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new tn(a,qt(s)):n}else{const o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new tn(s))),o.forEachChild(vt,(a,l)=>{const c=N0(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function xf(n,e){let t=e instanceof at?e:new at(e),i=n,s=ze(t);for(;s!==null;){const r=to(i.node.children,s)||{children:{},childCount:0};i=new F0(s,i,r),t=dt(t),s=ze(t)}return i}function yo(n){return n.node.value}function D0(n,e){n.node.value=e,O0(n)}function W1(n){return n.node.childCount>0}function NV(n){return yo(n)===void 0&&!W1(n)}function bf(n,e){Un(n.node.children,(t,i)=>{e(new F0(t,n,i))})}function X1(n,e,t,i){t&&!i&&e(n),bf(n,s=>{X1(s,e,!0,i)}),t&&i&&e(n)}function FV(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function cu(n){return new at(n.parent===null?n.name:cu(n.parent)+"/"+n.name)}function O0(n){n.parent!==null&&DV(n.parent,n.name,n)}function DV(n,e,t){const i=NV(t),s=wi(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,O0(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,O0(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OV=/[\[\].#$\/\u0000-\u001F\u007F]/,kV=/[\[\].#$\u0000-\u001F\u007F]/,k0=10*1024*1024,U0=function(n){return typeof n=="string"&&n.length!==0&&!OV.test(n)},q1=function(n){return typeof n=="string"&&n.length!==0&&!kV.test(n)},UV=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),q1(n)},B0=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!j_(n)||n&&typeof n=="object"&&wi(n,".sv")},H0=function(n,e,t,i){i&&e===void 0||Tf(Od(n,"value"),e,t)},Tf=function(n,e,t){const i=t instanceof at?new ZH(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ho(i));if(typeof e=="function")throw new Error(n+"contains a function "+ho(i)+" with contents = "+e.toString());if(j_(e))throw new Error(n+"contains "+e.toString()+" "+ho(i));if(typeof e=="string"&&e.length>k0/3&&kd(e)>k0)throw new Error(n+"contains a string greater than "+k0+" utf8 bytes "+ho(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(Un(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!U0(o)))throw new Error(n+" contains an invalid key ("+o+") "+ho(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);ez(i,o),Tf(n,a,i),tz(i)}),s&&r)throw new Error(n+' contains ".value" child '+ho(i)+" in addition to actual children.")}},BV=function(n,e,t,i){if(!(i&&t===void 0)&&!U0(t))throw new Error(Od(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},z0=function(n,e,t,i){if(!(i&&t===void 0)&&!q1(t))throw new Error(Od(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},HV=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),z0(n,e,t,i)},V0=function(n,e){if(ze(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},zV=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!U0(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!UV(t))throw new Error(Od(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VV{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function G0(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();t!==null&&!r0(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function W0(n,e,t){G0(n,t),Y1(n,i=>r0(i,e))}function ts(n,e,t){G0(n,t),Y1(n,i=>Ei(i,e)||Ei(e,i))}function Y1(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];if(s){const r=s.path;e(r)?(GV(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function GV(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();lo&&Tn("event: "+t.toString()),Ka(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WV="repo_interrupt",XV=25;class qV{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new VV,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=of(),this.transactionQueueTree_=new F0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function YV(n,e,t){if(n.stats_=t0(n.repoInfo_),n.forceRestClient_||TH())n.server_=new rf(n.repoInfo_,(i,s,r,o)=>{$1(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Q1(n,!0),0);else{if(typeof t!="undefined"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Gt(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Es(n.repoInfo_,e,(i,s,r,o)=>{$1(n,i,s,r,o)},i=>{Q1(n,i)},i=>{jV(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=IH(n.repoInfo_,()=>new Rz(n.stats_,n.server_)),n.infoData_=new Ez,n.infoSyncTree_=new U1({startListening:(i,s,r,o)=>{let a=[];const l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=ou(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),X0(n,"connected",!1),n.serverSyncTree_=new U1({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,l)=>{const c=o(a,l);ts(n.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function j1(n){const t=n.infoData_.getNode(new at(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function wf(n){return IV({timestamp:j1(n)})}function $1(n,e,t,i,s){n.dataUpdateCount++;const r=new at(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){const l=Fd(t,c=>qt(c));o=wV(n.serverSyncTree_,r,l,s)}else{const l=qt(t);o=TV(n.serverSyncTree_,r,l,s)}else if(i){const l=Fd(t,c=>qt(c));o=vV(n.serverSyncTree_,r,l)}else{const l=qt(t);o=ou(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=Ef(n,r)),ts(n.eventQueue_,a,o)}function Q1(n,e){X0(n,"connected",e),e===!1&&KV(n)}function jV(n,e){Un(e,(t,i)=>{X0(n,t,i)})}function X0(n,e,t){const i=new at("/.info/"+e),s=qt(t);n.infoData_.updateSnapshot(i,s);const r=ou(n.infoSyncTree_,i,s);ts(n.eventQueue_,i,r)}function q0(n){return n.nextWriteId_++}function $V(n,e){const t=SV(n.serverSyncTree_,e);return t!=null?Promise.resolve(t):n.server_.get(e).then(i=>{const s=qt(i).withIndex(e._queryParams.getIndex()),r=ou(n.serverSyncTree_,e._path,s);return W0(n.eventQueue_,e._path,r),Promise.resolve(s)},i=>(uu(n,"get for query "+Gt(e)+" failed: "+i),Promise.reject(new Error(i))))}function QV(n,e,t,i,s){uu(n,"set",{path:e.toString(),value:t,priority:i});const r=wf(n),o=qt(t,i),a=_f(n.serverSyncTree_,e),l=P0(o,a,r),c=q0(n),h=E0(n.serverSyncTree_,e,l,c,!0);G0(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(d,f)=>{const p=d==="ok";p||kn("set at "+e+" failed: "+d);const _=_o(n.serverSyncTree_,c,!p);ts(n.eventQueue_,e,_),e7(n,s,d,f)});const u=eA(n,e);Ef(n,u),ts(n.eventQueue_,u,[])}function KV(n){uu(n,"onDisconnectEvents");const e=wf(n),t=of();f0(n.onDisconnect_,Ze(),(s,r)=>{const o=PV(s,r,n.serverSyncTree_,e);d1(t,s,o)});let i=[];f0(t,Ze(),(s,r)=>{i=i.concat(ou(n.serverSyncTree_,s,r));const o=eA(n,s);Ef(n,o)}),n.onDisconnect_=of(),ts(n.eventQueue_,Ze(),i)}function JV(n,e,t){let i;ze(e._path)===".info"?i=B1(n.infoSyncTree_,e,t):i=B1(n.serverSyncTree_,e,t),W0(n.eventQueue_,e._path,i)}function Y0(n,e,t){let i;ze(e._path)===".info"?i=M0(n.infoSyncTree_,e,t):i=M0(n.serverSyncTree_,e,t),W0(n.eventQueue_,e._path,i)}function ZV(n){n.persistentConnection_&&n.persistentConnection_.interrupt(WV)}function uu(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Tn(t,...e)}function e7(n,e,t,i){e&&Ka(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,e(o)}})}function t7(n,e,t,i,s,r){uu(n,"transaction on "+e);const o={path:e,update:t,onComplete:i,status:null,order:yM(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=j0(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Tf("transaction failed: Data returned ",l,o.path),o.status=0;const c=xf(n.transactionQueueTree_,e),h=yo(c)||[];h.push(o),D0(c,h);let u;typeof l=="object"&&l!==null&&wi(l,".priority")?(u=to(l,".priority"),de(B0(u),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):u=(_f(n.serverSyncTree_,e)||Ce.EMPTY_NODE).getPriority().val();const d=wf(n),f=qt(l,u),p=P0(f,a,d);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=p,o.currentWriteId=q0(n);const _=E0(n.serverSyncTree_,e,p,o.currentWriteId,o.applyLocally);ts(n.eventQueue_,e,_),Sf(n,n.transactionQueueTree_)}}function j0(n,e,t){return _f(n.serverSyncTree_,e,t)||Ce.EMPTY_NODE}function Sf(n,e=n.transactionQueueTree_){if(e||Mf(n,e),yo(e)){const t=J1(n,e);de(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&n7(n,cu(e),t)}else W1(e)&&bf(e,t=>{Sf(n,t)})}function n7(n,e,t){const i=t.map(c=>c.currentWriteId),s=j0(n,e,i);let r=s;const o=s.hash();for(let c=0;c<t.length;c++){const h=t[c];de(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const u=Rn(e,h.path);r=r.updateChild(u,h.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{uu(n,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){const u=[];for(let d=0;d<t.length;d++)t[d].status=2,h=h.concat(_o(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&u.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Mf(n,xf(n.transactionQueueTree_,e)),Sf(n,n.transactionQueueTree_),ts(n.eventQueue_,e,h);for(let d=0;d<u.length;d++)Ka(u[d])}else{if(c==="datastale")for(let u=0;u<t.length;u++)t[u].status===3?t[u].status=4:t[u].status=0;else{kn("transaction at "+l.toString()+" failed: "+c);for(let u=0;u<t.length;u++)t[u].status=4,t[u].abortReason=c}Ef(n,e)}},o)}function Ef(n,e){const t=K1(n,e),i=cu(t),s=J1(n,t);return i7(n,s,i),i}function i7(n,e,t){if(e.length===0)return;const i=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=Rn(t,l.path);let h=!1,u;if(de(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,u=l.abortReason,s=s.concat(_o(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=XV)h=!0,u="maxretry",s=s.concat(_o(n.serverSyncTree_,l.currentWriteId,!0));else{const d=j0(n,l.path,o);l.currentInputSnapshot=d;const f=e[a].update(d.val());if(f!==void 0){Tf("transaction failed: Data returned ",f,l.path);let p=qt(f);typeof f=="object"&&f!=null&&wi(f,".priority")||(p=p.updatePriority(d.getPriority()));const y=l.currentWriteId,m=wf(n),g=P0(p,d,m);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=g,l.currentWriteId=q0(n),o.splice(o.indexOf(y),1),s=s.concat(E0(n.serverSyncTree_,l.path,g,l.currentWriteId,l.applyLocally)),s=s.concat(_o(n.serverSyncTree_,y,!0))}else h=!0,u="nodata",s=s.concat(_o(n.serverSyncTree_,l.currentWriteId,!0))}ts(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(u),!1,null))))}Mf(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Ka(i[a]);Sf(n,n.transactionQueueTree_)}function K1(n,e){let t,i=n.transactionQueueTree_;for(t=ze(e);t!==null&&yo(i)===void 0;)i=xf(i,t),e=dt(e),t=ze(e);return i}function J1(n,e){const t=[];return Z1(n,e,t),t.sort((i,s)=>i.order-s.order),t}function Z1(n,e,t){const i=yo(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);bf(e,s=>{Z1(n,s,t)})}function Mf(n,e){const t=yo(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,D0(e,t.length>0?t:void 0)}bf(e,i=>{Mf(n,i)})}function eA(n,e){const t=cu(K1(n,e)),i=xf(n.transactionQueueTree_,e);return FV(i,s=>{$0(n,s)}),$0(n,i),X1(i,s=>{$0(n,s)}),t}function $0(n,e){const t=yo(e);if(t){const i=[];let s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(de(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(de(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(_o(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?D0(e,void 0):t.length=r+1,ts(n.eventQueue_,cu(e),s);for(let o=0;o<i.length;o++)Ka(i[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s7(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function r7(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):kn(`Invalid query segment '${t}' in query '${n}'`)}return e}const tA=function(n,e){const t=o7(n),i=t.namespace;t.domain==="firebase.com"&&co(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&co("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||fH();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new MH(t.host,t.secure,i,e,s,"",i!==t.subdomain),path:new at(t.pathString)}},o7=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let h=n.indexOf("/");h===-1&&(h=n.length);let u=n.indexOf("?");u===-1&&(u=n.length),e=n.substring(0,Math.min(h,u)),h<u&&(s=s7(n.substring(h,u)));const d=r7(n.substring(Math.min(n.length,u)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const f=e.slice(0,c);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),t=e.substring(p+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nA{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Gt(this.snapshot.exportVal())}}class iA{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sA{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return de(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return Ve(this._path)?null:$M(this._path)}get ref(){return new Ci(this._repo,this._path)}get _queryIdentifier(){const e=h1(this._queryParams),t=$_(e);return t==="{}"?"default":t}get _queryObject(){return h1(this._queryParams)}isEqual(e){if(e=Wt(e),!(e instanceof nl))return!1;const t=this._repo===e._repo,i=r0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+JH(this._path)}}function a7(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function rA(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===fo){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==uo)throw new Error(i);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==yr)throw new Error(i);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===vt){if(e!=null&&!B0(e)||t!=null&&!B0(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(de(n.getIndex()instanceof u0||n.getIndex()===a1,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function l7(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Ci extends nl{constructor(e,t){super(e,t,new d0,!1)}get parent(){const e=KM(this._path);return e===null?null:new Ci(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class vo{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new at(e),i=il(this.ref,e);return new vo(this._node.getChild(t),i,vt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new vo(s,il(this.ref,i),vt)))}hasChild(e){const t=new at(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function nn(n,e){return n=Wt(n),n._checkNotDeleted("ref"),e!==void 0?il(n._root,e):n._root}function il(n,e){return n=Wt(n),ze(n._path)===null?HV("child","path",e,!1):z0("child","path",e,!1),new Ci(n._repo,Xt(n._path,e))}function c7(n,e){n=Wt(n),V0("push",n._path),H0("push",e,n._path,!0);const t=j1(n._repo),i=yz(t),s=il(n,i),r=il(n,i);let o;return e!=null?o=u7(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function u7(n,e){n=Wt(n),V0("set",n._path),H0("set",e,n._path,!1);const t=new Oc;return QV(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function xo(n){return n=Wt(n),$V(n._repo,n).then(e=>new vo(e,new Ci(n._repo,n._path),n._queryParams.getIndex()))}class Af{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const i=t._queryParams.getIndex();return new nA("value",this,new vo(e.snapshotNode,new Ci(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new iA(this,e,t):null}matches(e){return e instanceof Af?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Cf{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new iA(this,e,t):null}createEvent(e,t){de(e.childName!=null,"Child events should have a childName.");const i=il(new Ci(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new nA(e.type,this,new vo(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Cf?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function h7(n,e,t,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){const l=t,c=(h,u)=>{Y0(n._repo,n,a),l(h,u)};c.userCallback=t.userCallback,c.context=t.context,t=c}const o=new sA(t,r||void 0),a=e==="value"?new Af(o):new Cf(e,o);return JV(n._repo,n,a),()=>Y0(n._repo,n,a)}function If(n,e,t,i){return h7(n,"value",e,t,i)}function Q0(n,e,t){let i=null;const s=t?new sA(t):null;e==="value"?i=new Af(s):e&&(i=new Cf(e,s)),Y0(n._repo,n,i)}class K0{}class d7 extends K0{constructor(e,t){super();this._value=e,this._key=t}_apply(e){H0("startAt",this._value,e._path,!0);const t=wz(e._queryParams,this._value,this._key);if(l7(t),rA(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new nl(e._repo,e._path,t,e._orderByCalled)}}function oA(n=null,e){return BV("startAt","key",e,!0),new d7(n,e)}class f7 extends K0{constructor(e){super();this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new nl(e._repo,e._path,Tz(e._queryParams,this._limit),e._orderByCalled)}}function sl(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new f7(n)}class p7 extends K0{constructor(e){super();this._path=e}_apply(e){a7(e,"orderByChild");const t=new at(this._path);if(Ve(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new u0(t),s=Sz(e._queryParams,i);return rA(s),new nl(e._repo,e._path,s,!0)}}function Rf(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return z0("orderByChild","path",n,!1),new p7(n)}function rl(n,...e){let t=Wt(n);for(const i of e)t=i._apply(t);return t}hV(Ci);gV(Ci);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m7="FIREBASE_DATABASE_EMULATOR_HOST",J0={};let g7=!1;function _7(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||co("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Tn("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=tA(r,s),a=o.repoInfo,l,c;typeof process!="undefined"&&(c=process.env[m7]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=tA(r,s),a=o.repoInfo):l=!o.repoInfo.secure;const h=s&&l?new Q_(Q_.OWNER):new SH(n.name,n.options,e);zV("Invalid Firebase Database URL",o),Ve(o.path)||co("Database URL must point to the root of a Firebase Database (not including a child path).");const u=v7(a,n,h,new wH(n.name,t));return new x7(u,n)}function y7(n,e){const t=J0[e];(!t||t[n.key]!==n)&&co(`Database ${e}(${n.repoInfo_}) has already been deleted.`),ZV(n),delete t[n.key]}function v7(n,e,t,i){let s=J0[e.name];s||(s={},J0[e.name]=s);let r=s[n.toURLString()];return r&&co("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new qV(n,g7,t,i),s[n.toURLString()]=r,r}class x7{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(YV(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ci(this._repo,Ze())),this._rootInternal}_delete(){return this._rootInternal!==null&&(y7(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&co("Cannot call "+e+" on a deleted database.")}}function b7(n=A_(),e){return Bd(n,"database").getImmediate({identifier:e})}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T7(n){cH(Wa),Ga(new no("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return _7(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),Ki(pM,mM,n),Ki(pM,mM,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w7{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Lf(n,e,t){var i;if(n=Wt(n),V0("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const s=(i=t==null?void 0:t.applyLocally)!==null&&i!==void 0?i:!0,r=new Oc,o=(l,c,h)=>{let u=null;l?r.reject(l):(u=new vo(h,new Ci(n._repo,n._path),vt),r.resolve(new w7(c,u)))},a=If(n,()=>{});return t7(n._repo,n._path,e,o,a,s),r.promise}Es.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Es.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};T7();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aA="firebasestorage.googleapis.com",lA="storageBucket",S7=2*60*1e3,E7=10*60*1e3;class Ct extends eo{constructor(e,t){super(Z0(e),`Firebase Storage: ${t} (${Z0(e)})`);this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ct.prototype)}_codeEquals(e){return Z0(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function Z0(n){return"storage/"+n}function ey(){const n="An unknown error occurred, please check the error payload for server response.";return new Ct("unknown",n)}function M7(n){return new Ct("object-not-found","Object '"+n+"' does not exist.")}function A7(n){return new Ct("quota-exceeded","Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function C7(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ct("unauthenticated",n)}function I7(){return new Ct("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}function R7(n){return new Ct("unauthorized","User does not have permission to access '"+n+"'.")}function L7(){return new Ct("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function cA(){return new Ct("canceled","User canceled the upload/download.")}function P7(n){return new Ct("invalid-url","Invalid URL '"+n+"'.")}function N7(n){return new Ct("invalid-default-bucket","Invalid default bucket '"+n+"'.")}function F7(){return new Ct("no-default-bucket","No default bucket found. Did you set the '"+lA+"' property when initializing the app?")}function uA(){return new Ct("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function D7(){return new Ct("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}function O7(){return new Ct("no-download-url","The given file does not have any download URLs.")}function ty(n){return new Ct("invalid-argument",n)}function hA(){return new Ct("app-deleted","The Firebase app was deleted.")}function k7(n){return new Ct("invalid-root-operation","The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function hu(n,e){return new Ct("invalid-format","String does not match format '"+n+"': "+e)}function du(n){throw new Ct("internal-error","Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=Zn.makeFromUrl(e,t)}catch{return new Zn(e,"")}if(i.path==="")return i;throw N7(e)}static makeFromUrl(e,t){let i=null;const s="([A-Za-z0-9.\\-_]+)";function r(x){x.path.charAt(x.path.length-1)==="/"&&(x.path_=x.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(x){x.path_=decodeURIComponent(x.path)}const h="v[A-Za-z0-9_]+",u=t.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${u}/${h}/b/${s}/o${d}`,"i"),p={bucket:1,path:3},_=t===aA?"(?:storage.googleapis.com|storage.cloud.google.com)":t,y="([^?#]*)",m=new RegExp(`^https?://${_}/${s}/${y}`,"i"),v=[{regex:a,indices:l,postModify:r},{regex:f,indices:p,postModify:c},{regex:m,indices:{bucket:1,path:2},postModify:c}];for(let x=0;x<v.length;x++){const T=v[x],S=T.regex.exec(e);if(S){const b=S[T.indices.bucket];let M=S[T.indices.path];M||(M=""),i=new Zn(b,M),T.postModify(i);break}}if(i==null)throw P7(e);return i}}class U7{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B7(n,e,t){let i=1,s=null,r=null,o=!1,a=0;function l(){return a===2}let c=!1;function h(...y){c||(c=!0,e.apply(null,y))}function u(y){s=setTimeout(()=>{s=null,n(f,l())},y)}function d(){r&&clearTimeout(r)}function f(y,...m){if(c){d();return}if(y){d(),h.call(null,y,...m);return}if(l()||o){d(),h.call(null,y,...m);return}i<64&&(i*=2);let v;a===1?(a=2,v=0):v=(i+Math.random())*1e3,u(v)}let p=!1;function _(y){p||(p=!0,d(),!c&&(s!==null?(y||(a=2),clearTimeout(s),u(0)):y||(a=1)))}return u(0),r=setTimeout(()=>{o=!0,_(!0)},t),_}function H7(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z7(n){return n!==void 0}function V7(n){return typeof n=="function"}function G7(n){return typeof n=="object"&&!Array.isArray(n)}function Pf(n){return typeof n=="string"||n instanceof String}function dA(n){return ny()&&n instanceof Blob}function ny(){return typeof Blob!="undefined"}function fA(n,e,t,i){if(i<e)throw ty(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw ty(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fu(n,e,t){let i=e;return t==null&&(i=`https://${e}`),`${t}://${i}/v0${n}`}function pA(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const s=e(i)+"="+e(n[i]);t=t+s+"&"}return t=t.slice(0,-1),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bo;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(bo||(bo={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W7{constructor(e,t,i,s,r,o,a,l,c,h,u){this.url_=e,this.method_=t,this.headers_=i,this.body_=s,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=h,this.connectionFactory_=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((d,f)=>{this.resolve_=d,this.reject_=f,this.start_()})}start_(){const e=(i,s)=>{if(s){i(!1,new Nf(!1,null,!0));return}const r=this.connectionFactory_();this.pendingConnection_=r;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&r.addUploadProgressListener(o),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(o),this.pendingConnection_=null;const a=r.getErrorCode()===bo.NO_ERROR,l=r.getStatus();if(!a||this.isRetryStatusCode_(l)){const h=r.getErrorCode()===bo.ABORT;i(!1,new Nf(!1,null,h));return}const c=this.successCodes_.indexOf(l)!==-1;i(!0,new Nf(c,r))})},t=(i,s)=>{const r=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());z7(l)?r(l):r()}catch(l){o(l)}else if(a!==null){const l=ey();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?hA():cA();o(l)}else{const l=L7();o(l)}};this.canceled_?t(!1,new Nf(!1,null,!0)):this.backoffId_=B7(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&H7(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const t=e>=500&&e<600,s=[408,429].indexOf(e)!==-1,r=this.additionalRetryCodes_.indexOf(e)!==-1;return t||s||r}}class Nf{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function X7(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function q7(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e!=null?e:"AppManager")}function Y7(n,e){e&&(n["X-Firebase-GMPID"]=e)}function j7(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function $7(n,e,t,i,s,r){const o=pA(n.urlParams),a=n.url+o,l=Object.assign({},n.headers);return Y7(l,e),X7(l,t),q7(l,r),j7(l,i),new W7(a,n.method,l,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q7(){return typeof BlobBuilder!="undefined"?BlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:void 0}function K7(...n){const e=Q7();if(e!==void 0){const t=new e;for(let i=0;i<n.length;i++)t.append(n[i]);return t.getBlob()}else{if(ny())return new Blob(n);throw new Ct("unsupported-environment","This browser doesn't seem to support creating Blobs")}}function J7(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z7(n){return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ns={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class iy{constructor(e,t){this.data=e,this.contentType=t||null}}function e9(n,e){switch(n){case ns.RAW:return new iy(mA(e));case ns.BASE64:case ns.BASE64URL:return new iy(gA(n,e));case ns.DATA_URL:return new iy(n9(e),i9(e))}throw ey()}function mA(n){const e=[];for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);if(i<=127)e.push(i);else if(i<=2047)e.push(192|i>>6,128|i&63);else if((i&64512)==55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)==56320))e.push(239,191,189);else{const r=i,o=n.charCodeAt(++t);i=65536|(r&1023)<<10|o&1023,e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}else(i&64512)==56320?e.push(239,191,189):e.push(224|i>>12,128|i>>6&63,128|i&63)}return new Uint8Array(e)}function t9(n){let e;try{e=decodeURIComponent(n)}catch{throw hu(ns.DATA_URL,"Malformed data URL.")}return mA(e)}function gA(n,e){switch(n){case ns.BASE64:{const s=e.indexOf("-")!==-1,r=e.indexOf("_")!==-1;if(s||r)throw hu(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case ns.BASE64URL:{const s=e.indexOf("+")!==-1,r=e.indexOf("/")!==-1;if(s||r)throw hu(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=Z7(e)}catch{throw hu(n,"Invalid character found")}const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i}class _A{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw hu(ns.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=t[1]||null;i!=null&&(this.base64=s9(i,";base64"),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=e.substring(e.indexOf(",")+1)}}function n9(n){const e=new _A(n);return e.base64?gA(ns.BASE64,e.rest):t9(e.rest)}function i9(n){return new _A(n).contentType}function s9(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e,t){let i=0,s="";dA(e)?(this.data_=e,i=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),i=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),i=e.length),this.size_=i,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(dA(this.data_)){const i=this.data_,s=J7(i,e,t);return s===null?null:new Sr(s)}else{const i=new Uint8Array(this.data_.buffer,e,t-e);return new Sr(i,!0)}}static getBlob(...e){if(ny()){const t=e.map(i=>i instanceof Sr?i.data_:i);return new Sr(K7.apply(null,t))}else{const t=e.map(o=>Pf(o)?e9(ns.RAW,o).data:o.data_);let i=0;t.forEach(o=>{i+=o.byteLength});const s=new Uint8Array(i);let r=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[r++]=o[a]}),new Sr(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yA(n){let e;try{e=JSON.parse(n)}catch{return null}return G7(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r9(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function o9(n,e){const t=e.split("/").filter(i=>i.length>0).join("/");return n.length===0?t:n+"/"+t}function vA(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a9(n,e){return e}class Ln{constructor(e,t,i,s){this.server=e,this.local=t||e,this.writable=!!i,this.xform=s||a9}}let Ff=null;function l9(n){return!Pf(n)||n.length<2?n:vA(n)}function xA(){if(Ff)return Ff;const n=[];n.push(new Ln("bucket")),n.push(new Ln("generation")),n.push(new Ln("metageneration")),n.push(new Ln("name","fullPath",!0));function e(r,o){return l9(o)}const t=new Ln("name");t.xform=e,n.push(t);function i(r,o){return o!==void 0?Number(o):o}const s=new Ln("size");return s.xform=i,n.push(s),n.push(new Ln("timeCreated")),n.push(new Ln("updated")),n.push(new Ln("md5Hash",null,!0)),n.push(new Ln("cacheControl",null,!0)),n.push(new Ln("contentDisposition",null,!0)),n.push(new Ln("contentEncoding",null,!0)),n.push(new Ln("contentLanguage",null,!0)),n.push(new Ln("contentType",null,!0)),n.push(new Ln("metadata","customMetadata",!0)),Ff=n,Ff}function c9(n,e){function t(){const i=n.bucket,s=n.fullPath,r=new Zn(i,s);return e._makeStorageReference(r)}Object.defineProperty(n,"ref",{get:t})}function u9(n,e,t){const i={};i.type="file";const s=t.length;for(let r=0;r<s;r++){const o=t[r];i[o.local]=o.xform(i,e[o.server])}return c9(i,n),i}function bA(n,e,t){const i=yA(e);return i===null?null:u9(n,i,t)}function h9(n,e,t,i){const s=yA(e);if(s===null||!Pf(s.downloadTokens))return null;const r=s.downloadTokens;if(r.length===0)return null;const o=encodeURIComponent;return r.split(",").map(c=>{const h=n.bucket,u=n.fullPath,d="/b/"+o(h)+"/o/"+o(u),f=fu(d,t,i),p=pA({alt:"media",token:c});return f+p})[0]}function TA(n,e){const t={},i=e.length;for(let s=0;s<i;s++){const r=e[s];r.writable&&(t[r.server]=n[r.local])}return JSON.stringify(t)}class ol{constructor(e,t,i,s){this.url=e,this.method=t,this.handler=i,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function As(n){if(!n)throw ey()}function sy(n,e){function t(i,s){const r=bA(n,s,e);return As(r!==null),r}return t}function d9(n,e){function t(i,s){const r=bA(n,s,e);return As(r!==null),h9(r,s,n.host,n._protocol)}return t}function pu(n){function e(t,i){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=I7():s=C7():t.getStatus()===402?s=A7(n.bucket):t.getStatus()===403?s=R7(n.path):s=i,s.serverResponse=i.serverResponse,s}return e}function wA(n){const e=pu(n);function t(i,s){let r=e(i,s);return i.getStatus()===404&&(r=M7(n.path)),r.serverResponse=s.serverResponse,r}return t}function f9(n,e,t){const i=e.fullServerUrl(),s=fu(i,n.host,n._protocol),r="GET",o=n.maxOperationRetryTime,a=new ol(s,r,sy(n,t),o);return a.errorHandler=wA(e),a}function p9(n,e,t){const i=e.fullServerUrl(),s=fu(i,n.host,n._protocol),r="GET",o=n.maxOperationRetryTime,a=new ol(s,r,d9(n,t),o);return a.errorHandler=wA(e),a}function m9(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function SA(n,e,t){const i=Object.assign({},t);return i.fullPath=n.path,i.size=e.size(),i.contentType||(i.contentType=m9(null,e)),i}function g9(n,e,t,i,s){const r=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let v="";for(let x=0;x<2;x++)v=v+Math.random().toString().slice(2);return v}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=SA(e,i,s),h=TA(c,t),u="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,d=`\r
--`+l+"--",f=Sr.getBlob(u,i,d);if(f===null)throw uA();const p={name:c.fullPath},_=fu(r,n.host,n._protocol),y="POST",m=n.maxUploadRetryTime,g=new ol(_,y,sy(n,t),m);return g.urlParams=p,g.headers=o,g.body=f.uploadData(),g.errorHandler=pu(e),g}class Df{constructor(e,t,i,s){this.current=e,this.total=t,this.finalized=!!i,this.metadata=s||null}}function ry(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{As(!1)}return As(!!t&&(e||["active"]).indexOf(t)!==-1),t}function _9(n,e,t,i,s){const r=e.bucketOnlyServerUrl(),o=SA(e,i,s),a={name:o.fullPath},l=fu(r,n.host,n._protocol),c="POST",h={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${i.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},u=TA(o,t),d=n.maxUploadRetryTime;function f(_){ry(_);let y;try{y=_.getResponseHeader("X-Goog-Upload-URL")}catch{As(!1)}return As(Pf(y)),y}const p=new ol(l,c,f,d);return p.urlParams=a,p.headers=h,p.body=u,p.errorHandler=pu(e),p}function y9(n,e,t,i){const s={"X-Goog-Upload-Command":"query"};function r(c){const h=ry(c,["active","final"]);let u=null;try{u=c.getResponseHeader("X-Goog-Upload-Size-Received")}catch{As(!1)}u||As(!1);const d=Number(u);return As(!isNaN(d)),new Df(d,i.size(),h==="final")}const o="POST",a=n.maxUploadRetryTime,l=new ol(t,o,r,a);return l.headers=s,l.errorHandler=pu(e),l}const EA=256*1024;function v9(n,e,t,i,s,r,o,a){const l=new Df(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=i.size()),i.size()!==l.total)throw D7();const c=l.total-l.current;let h=c;s>0&&(h=Math.min(h,s));const u=l.current,d=u+h,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`},_=i.slice(u,d);if(_===null)throw uA();function y(x,T){const S=ry(x,["active","final"]),b=l.current+h,M=i.size();let N;return S==="final"?N=sy(e,r)(x,T):N=null,new Df(b,M,S==="final",N)}const m="POST",g=e.maxUploadRetryTime,v=new ol(t,m,y,g);return v.headers=p,v.body=_.uploadData(),v.progressCallback=a||null,v.errorHandler=pu(n),v}const Hn={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function oy(n){switch(n){case"running":case"pausing":case"canceling":return Hn.RUNNING;case"paused":return Hn.PAUSED;case"success":return Hn.SUCCESS;case"canceled":return Hn.CANCELED;case"error":return Hn.ERROR;default:return Hn.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x9{constructor(e,t,i){if(V7(e)||t!=null||i!=null)this.next=e,this.error=t!=null?t:void 0,this.complete=i!=null?i:void 0;else{const r=e;this.next=r.next,this.error=r.error,this.complete=r.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function al(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}class b9{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=bo.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=bo.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=bo.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,i,s){if(this.sent_)throw du("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const r in s)s.hasOwnProperty(r)&&this.xhr_.setRequestHeader(r,s[r].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw du("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw du("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw du("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw du("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class T9 extends b9{initXhr(){this.xhr_.responseType="text"}}function ll(){return new T9}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w9{constructor(e,t,i=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=i,this._mappings=xA(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=s=>{this._request=void 0,this._chunkMultiplier=1,s._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=s,this._transition("error"))},this._metadataErrorHandler=s=>{this._request=void 0,s._codeEquals("canceled")?this.completeTransitions_():(this._error=s,this._transition("error"))},this._promise=new Promise((s,r)=>{this._resolve=s,this._reject=r,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,i])=>{switch(this._state){case"running":e(t,i);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{const i=_9(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(i,ll,e,t);this._request=s,s.getPromise().then(r=>{this._request=void 0,this._uploadUrl=r,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,i)=>{const s=y9(this._ref.storage,this._ref._location,e,this._blob),r=this._ref.storage._makeRequest(s,ll,t,i);this._request=r,r.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=EA*this._chunkMultiplier,t=new Df(this._transferred,this._blob.size()),i=this._uploadUrl;this._resolveToken((s,r)=>{let o;try{o=v9(this._ref._location,this._ref.storage,i,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}const a=this._ref.storage._makeRequest(o,ll,s,r);this._request=a,a.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){EA*this._chunkMultiplier<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const i=f9(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(i,ll,e,t);this._request=s,s.getPromise().then(r=>{this._request=void 0,this._metadata=r,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const i=g9(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(i,ll,e,t);this._request=s,s.getPromise().then(r=>{this._request=void 0,this._metadata=r,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":this._state=e,this._request!==void 0&&this._request.cancel();break;case"pausing":this._state=e,this._request!==void 0&&this._request.cancel();break;case"running":const t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=cA(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=oy(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,i,s){const r=new x9(t||void 0,i||void 0,s||void 0);return this._addObserver(r),()=>{this._removeObserver(r)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(oy(this._state)){case Hn.SUCCESS:al(this._resolve.bind(null,this.snapshot))();break;case Hn.CANCELED:case Hn.ERROR:const t=this._reject;al(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(oy(this._state)){case Hn.RUNNING:case Hn.PAUSED:e.next&&al(e.next.bind(e,this.snapshot))();break;case Hn.SUCCESS:e.complete&&al(e.complete.bind(e))();break;case Hn.CANCELED:case Hn.ERROR:e.error&&al(e.error.bind(e,this._error))();break;default:e.error&&al(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e,t){this._service=e,t instanceof Zn?this._location=t:this._location=Zn.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new To(e,t)}get root(){const e=new Zn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return vA(this._location.path)}get storage(){return this._service}get parent(){const e=r9(this._location.path);if(e===null)return null;const t=new Zn(this._location.bucket,e);return new To(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw k7(e)}}function S9(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new w9(n,new Sr(e),t)}function E9(n){n._throwIfRoot("getDownloadURL");const e=p9(n.storage,n._location,xA());return n.storage.makeRequestWithTokens(e,ll).then(t=>{if(t===null)throw O7();return t})}function M9(n,e){const t=o9(n._location.path,e),i=new Zn(n._location.bucket,t);return new To(n.storage,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A9(n){return/^[A-Za-z]+:\/\//.test(n)}function C9(n,e){return new To(n,e)}function MA(n,e){if(n instanceof ay){const t=n;if(t._bucket==null)throw F7();const i=new To(t,t._bucket);return e!=null?MA(i,e):i}else return e!==void 0?M9(n,e):n}function I9(n,e){if(e&&A9(e)){if(n instanceof ay)return C9(n,e);throw ty("To use ref(service, url), the first argument must be a Storage instance.")}else return MA(n,e)}function AA(n,e){const t=e==null?void 0:e[lA];return t==null?null:Zn.makeFromBucketSpec(t,n)}class ay{constructor(e,t,i,s,r){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=s,this._firebaseVersion=r,this._bucket=null,this._host=aA,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=S7,this._maxUploadRetryTime=E7,this._requests=new Set,s!=null?this._bucket=Zn.makeFromBucketSpec(s,this._host):this._bucket=AA(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Zn.makeFromBucketSpec(this._url,e):this._bucket=AA(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){fA("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){fA("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new To(this,e)}_makeRequest(e,t,i,s){if(this._deleted)return new U7(hA());{const r=$7(e,this._appId,i,s,t,this._firebaseVersion);return this._requests.add(r),r.getPromise().then(()=>this._requests.delete(r),()=>this._requests.delete(r)),r}}async makeRequestWithTokens(e,t){const[i,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,s).getPromise()}}const CA="@firebase/storage",IA="0.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RA="storage";function R9(n,e,t){return n=Wt(n),S9(n,e,t)}function LA(n){return n=Wt(n),E9(n)}function ly(n,e){return n=Wt(n),I9(n,e)}function L9(n=A_(),e){return n=Wt(n),Bd(n,RA).getImmediate({identifier:e})}function P9(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new ay(t,i,s,e,Wa)}function N9(){Ga(new no(RA,P9,"PUBLIC").setMultipleInstances(!0)),Ki(CA,IA,""),Ki(CA,IA,"esm2017")}N9();const F9={apiKey:"AIzaSyDTVxDJj7rqG9L-Clvba2Tao9B0hkcxjcE",authDomain:"milchchan.firebaseapp.com",databaseURL:"https://milchchan.firebaseio.com",projectId:"milchchan",storageBucket:"milchchan.appspot.com",messagingSenderId:"355698971889",appId:"1:355698971889:web:e3653c5c31bd7289cd4550",measurementId:"G-3998FJYNWX"},cy=y6(F9),Ii=lH(cy),sn=b7(cy),uy=L9(cy),PA=decodeURIComponent(window.location.hash.substring(1))==="debug",rn="bot",Mt=new ot({antialias:!0,alpha:!0,preserveDrawingBuffer:!0});Mt.setClearColor(16777215,0);Mt.toneMappingExposure=1;Mt.toneMapping=tT;Mt.outputEncoding=ri;const D9=60,O9=5,is=new vn(D9,Mt.domElement.width/Mt.domElement.height,.1,1e3);is.position.set(0,1.5,O9);const on=new kU(is,Mt.domElement);on.enabled=!1;on.enableKeys=!1;on.screenSpacePanning=!1;on.enableDamping=!0;on.minPolarAngle=30*Math.PI/180;on.maxPolarAngle=150*Math.PI/180;on.minAzimuthAngle=-45*Math.PI/180;on.maxAzimuthAngle=45*Math.PI/180;on.minDistance=.75;on.maxDistance=5;on.target.set(0,2.5,1);on.update();const pi=new od,hy=new Hg(16777215),k9=new iS(14154751,8295592,.7);hy.intensity=.9;hy.position.set(0,10,10).normalize();pi.add(hy);pi.add(k9);const xt=new Qe;is.add(xt);const Ri=new zU(Mt);var cl=new Oa(new ie(Mt.domElement.width,Mt.domElement.height),1.5,.4,.85),dy=new qi(qU),U9=new qi(YU);new qi(jU);var NA=new qi(Jg),fy=new qi($U),FA=new qi(QU),py=new qi(KU),DA=new qi(JU);cl.renderToScreen=!0;cl.threshold=.5;cl.strength=.25;cl.radius=0;dy.uniforms.hue.value=-.025;dy.uniforms.saturation.value=.25;U9.uniforms.contrast.value=-.1;FA.uniforms.mulRGB.value=new C(.95,.95,.95);FA.uniforms.powRGB.value=new C(1,1,1);py.uniforms.amount.value=1e-4;py.uniforms.angle.value=0;fy.uniforms.darkness.value=.25;fy.uniforms.offset.value=0;NA.renderToScreen=!0;DA.uniforms.resolution.value.set(1/(Mt.domElement.width*window.devicePixelRatio),1/(Mt.domElement.height*window.devicePixelRatio));Ri.setSize(Mt.domElement.width,Mt.domElement.height);Ri.setPixelRatio(window.devicePixelRatio);Ri.addPass(new VU(pi,is));Ri.addPass(cl);Ri.addPass(dy);Ri.addPass(py);Ri.addPass(fy);Ri.addPass(NA);const Cs=new V5;Cs.domElement.style.position="fixed";Cs.domElement.style.top="auto";Cs.domElement.style.bottom="0";Cs.domElement.style.left="auto";Cs.domElement.style.right="0";PA||Cs.domElement.classList.add("is-hidden");const B9=new mS,Is=new aU,zn=new ie;let ft=null,Li=[],ul=0;const OA=2;let hl=0;const H9=5;let mu=0;const z9=10;let bt=null,fn=null,It=null,Fe=null,Of=0;window.addEventListener("load",n=>{"serviceWorker"in navigator&&(navigator.serviceWorker.register("sw.js").then(t=>{t.onupdatefound=function(){t.update()}}).catch(t=>{console.error(t.code,t.message)}),navigator.serviceWorker.addEventListener("message",t=>{navigator.serviceWorker.controller!==null&&"command"in t.data&&t.data.command==="caches"&&navigator.serviceWorker.controller.postMessage({command:"clear",caches:t.data.caches})}));const e=Gx({data(){return{isDebug:PA,isDarkMode:!1,isMuted:!0,isLoading:!1,isRevealed:!1,isOverlayed:!1,isUpdating:!1,isBlinded:!1,isPopup:!1,isExpanded:!1,isLearning:!1,isAnimating:!1,isHangingOn:!1,isSubmitting:!1,isStared:!1,mode:null,feedQueue:[],sequenceQueue:[],progress:null,user:null,input:"",animatedInputLength:0,maxInputLength:100,inputHasError:!1,messages:[],maxMessages:10,word:null,words:[],tags:[],maxTags:10,scrollTimeoutID:void 0,stars:-1,animatedStars:0,screenshot:null,notifications:[],notificationHeight:0,animatedNotificationHeight:0,recentImages:[],backgroundImagesQueue:[],backgroundImages:[],preloadImages:[],isUploading:!1,animations:null,currentAnimations:[],blendShapeAnimations:[],insetTop:0,insetBottom:0,text:[],popupTextHeight:0,animatedPopupTextHeight:0,tickerWidth:0,animatedTickerWidth:0,message:null,states:{},character:null,wordDictionary:{},reverseWordDictionary:{},attributes:["\u540D\u524D","\u6240\u5C5E","\u6642\u9593","\u5834\u6240","\u3059\u308B\u4E8B","\u751F\u304D\u7269","\u98DF\u3079\u7269","\u98F2\u307F\u7269","\u805E\u304F\u3082\u306E","\u898B\u308B\u3082\u306E","\u8AAD\u3080\u3082\u306E","\u4F7F\u3046\u7269","\u8EAB\u306B\u3064\u3051\u308B\u3082\u306E","\u4E57\u308A\u7269","\u90E8\u4F4D","\u75C5\u6C17"]}},watch:{isMuted(t){try{localStorage.setItem("character",JSON.stringify({mute:t}))}catch{localStorage.removeItem("character")}},words:{handler:()=>{e.$nextTick(()=>{for(const t of document.body.querySelectorAll(".container>.wrap>.frame .clip")){let i=0;for(const s of t.querySelectorAll(":scope .ticker-wrap .ticker .item"))i+=s.getBoundingClientRect().width;i>0&&(e.tickerWidth=Math.min(i/2,document.body.querySelector(".container>.wrap>.frame .level").getBoundingClientRect().width),t.querySelector(":scope .ticker-wrap .ticker").style.width=i+"px")}})},deep:!0},tickerWidth(t){const i=this,s={width:this.animatedTickerWidth};ht({targets:s,width:t,round:1,duration:500,easing:"linear",update:()=>{i.animatedTickerWidth=s.width}})},backgroundImages:{handler:()=>{e.$nextTick(()=>{const t=document.body.querySelectorAll("#app>.background>div");if(t.length>1){const i=t.length-1,s=15;let r=0,o=null;for(const a of t){const l=[];for(let h=0;h<t.length;h++)h===r?l.push({visibility:"visible"}):l.push({visibility:"hidden"});const c=a.animate(l,{fill:"forwards",easing:"steps("+i+")",duration:1e3/s*t.length,iterations:1/0});o===null?o=c.startTime:c.startTime=o,r++}}})},deep:!0},text:{handler:()=>{e.$nextTick(()=>{e.isPopup&&(e.popupTextHeight=e.$refs.popupText.getBoundingClientRect().height)})},deep:!0},popupTextHeight(t){const i={height:this.animatedPopupTextHeight};ht({targets:i,height:t,round:1,duration:500,easing:"linear",update:()=>{this.animatedPopupTextHeight=i.height}})},notifications:{handler:()=>{e.$nextTick(()=>{e.notificationHeight=e.$refs.notifications.getBoundingClientRect().height})},deep:!0},notificationHeight(t){const i={height:this.animatedNotificationHeight};ht({targets:i,height:t,round:1,duration:500,easing:"linear",update:()=>{this.animatedNotificationHeight=i.height}})},stars(t){const i={count:this.animatedStars};ht({targets:i,count:t,round:1,duration:500,easing:"linear",update:()=>{this.animatedStars=i.count}})},input:{handler:()=>{e.$nextTick(()=>{const t={count:e.animatedInputLength};ht({targets:t,count:e.input.length,round:1,duration:500,easing:"linear",update:()=>{e.animatedInputLength=t.count}})})},deep:!0}},methods:{signIn:async function(t){if(t===di.PROVIDER_ID){const i=new di;try{const s=await G_(Ii,i),r=i.credentialFromResult(Ii,s);for(const o of s.user.providerData){try{await B_(this.user,{displayName:o.displayName,photoURL:o.photoURL})}catch(a){console.error(a.code,a.message)}break}try{localStorage.setItem("credential",JSON.stringify({providerId:r.providerId,accessToken:r.accessToken,idToken:r.idToken}))}catch{localStorage.removeItem("credential")}}catch(s){console.error(s.code,s.message)}}else if(t===hi.PROVIDER_ID){const i=new hi;i.addScope("public_profile");try{const s=await G_(Ii,i),r=i.credentialFromResult(Ii,s);for(const o of s.user.providerData){try{await B_(this.user,{displayName:o.displayName,photoURL:o.photoURL})}catch(a){console.error(a.code,a.message)}break}try{localStorage.setItem("credential",JSON.stringify({providerId:r.providerId,accessToken:r.accessToken}))}catch{localStorage.removeItem("credential")}}catch(s){console.error(s.code,s.message)}}else if(t===fi.PROVIDER_ID){const i=new fi;try{const s=await G_(Ii,i),r=i.credentialFromResult(Ii,s);for(const o of s.user.providerData){const a=o.photoURL.replace(/_normal\.jpg$/,".jpg");try{await B_(this.user,{displayName:o.displayName,photoURL:a})}catch(l){console.error(l.code,l.message)}break}try{localStorage.setItem("credential",JSON.stringify({providerId:r.providerId,accessToken:r.accessToken,secret:r.secret}))}catch{localStorage.removeItem("credential")}}catch(s){console.error(s.code,s.message)}}},signOut:async function(t){try{await Z6(Ii),localStorage.removeItem("credential"),"serviceWorker"in navigator&&navigator.serviceWorker.controller!==null&&navigator.serviceWorker.controller.postMessage({command:"caches"})}catch(i){console.error(i.code,i.message)}},refresh:function(t){this.isBlinded=!0,mu=0},send:async function(t){if(this.isDebug)if(this.input.length>0){let i=[],s=[];for(const r of this.input.split(/\s/))this.backgroundImages.some(o=>o.id===r)?i.push(r):s.push(r);if(i.length>0&&s.length>0){for(const r of i)Lf(nn(sn,rn+"/images/"+r),o=>(o.tags=s,o));this.isLearning=!1}else this.input.length<=this.maxInputLength&&(this.learn({name:this.input}),this.input="",this.isLearning=!1)}else for(const i of this.backgroundImages){this.input=i.id;break}else if(this.input.length>0&&this.input.length<=this.maxInputLength){this.learn({name:this.input}),this.input="",this.isLearning=!1;return}else this.shake(this.$refs.input)},change:function(t){this.input.length<=this.maxInputLength?this.inputHasError=!1:this.inputHasError=!0},upload:async function(t){function i(){let a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");for(let l=0,c=a.length;l<c;l++)switch(a[l]){case"x":a[l]=Math.floor(Math.random()*16).toString(16);break;case"y":a[l]=(Math.floor(Math.random()*4)+8).toString(16);break}return a.join("")}const s=this,r=[],o=[];for(const a of t.target.files)r.push(a);this.isUploading=!0;for(const a of r.sort((l,c)=>l.name>c.name?1:l.name<c.name?-1:0)){const l=R9(ly(uy,`images/${i()}`),a);try{await new Promise(function(c,h){l.on("state_changed",u=>{s.progress=u.bytesTransferred/u.totalBytes/r.length+o.length/r.length},u=>{h(u)},()=>{c(l.snapshot.ref)})})}catch(c){this.notify({text:c.message,accent:this.character.accent,image:this.character.image}),console.error(c)}o.push(l.snapshot.ref.fullPath)}c7(nn(sn,rn+"/images"),{paths:o,timestamp:Math.floor(new Date/1e3)}),this.progress=null,this.isUploading=!1},check:function(t){for(const i of this.word.attributes)i===t.target.dataset.attribute&&(i.value=t.target.checked)},share:async function(t){const i=this,s=Math.floor(new Date/1e3);t.name in this.wordDictionary&&delete this.wordDictionary[t.name],Object.keys(this.reverseWordDictionary).forEach(o=>{this.reverseWordDictionary[o].words.some(a=>a===t.name)&&delete this.reverseWordDictionary[o]}),this.isSubmitting=!0;try{const o=await Lf(nn(sn,rn+"/words/"+t.name),a=>{if(a){let l=!1;for(const c of t.attributes)if(c.name in a.attributes){if(a.attributes[c.name]>0){if(!c.value){l=!0;break}}else if(c.value){l=!0;break}}else{l=!0;break}if(l){let c=!0;const h={attributes:{}};for(const u of t.attributes)u.value?(u.name in a.attributes&&a.attributes[u.name]>0?h.attributes[u.name]=a.attributes[u.name]:h.attributes[u.name]=s-1,c=!1):h.attributes[u.name]=0;return c?null:(h.timestamp=s,h)}else return}else{a={attributes:{},timestamp:s};for(const l of t.attributes)l.value?a.attributes[l.name]=s:a.attributes[l.name]=0}return a});if(o.committed){if(o.snapshot.exists()){const a=o.snapshot.val();let l=[];for(const c in a.attributes)typeof a.attributes[c]=="number"&&a.attributes[c]>0&&this.attributes.includes(c)&&l.push(a.attributes[c]);if(l.length===1&&l[0]===a.timestamp){let c=function(h){var u=arguments;return h.replace(/\{(\d)\}/g,function(d,f){return u[parseInt(f)+1]})};var r=c;Lf(nn(sn,rn+"/stars"),h=>(h||0)+1);for(const h of this.prepare(this.character.sequences.filter(u=>u.name==="Learned")))h.type==="Message"&&this.notify({text:c(h.text,t.name),accent:this.character.accent,image:this.character.image});this.isStared=!0,window.setTimeout(()=>{i.isStared=!1},3e3),this.isMuted||this.$refs.twinkle.play()}}else Lf(nn(sn,rn+"/stars"),a=>{if(a)return a-1});this.word=null}}catch(o){this.notify({text:o.message,accent:this.character.accent,image:this.character.image}),console.error(o)}this.isSubmitting=!1},learn:async function(t){function i(o){var a=arguments;return o.replace(/\{(\d)\}/g,function(l,c){return a[parseInt(c)+1]})}const s=[],r=[];if("attributes"in t)for(const o of this.attributes)o in t.attributes&&(t.attributes[o]>0?r.push({name:o,value:!0}):r.push({name:o,value:!1}));else{const o=await xo(nn(sn,rn+"/words/"+t.name));if(o.exists()){const a=o.val();for(const l of this.attributes)l in a.attributes&&(a.attributes[l]>0?r.push({name:l,value:!0}):r.push({name:l,value:!1}))}else for(const a of this.attributes)r.push({name:a,value:!1})}this.word={name:t.name,attributes:r};for(const o of this.prepare(this.character.sequences.filter(a=>a.name==="Learn")))o.type==="Message"?s.push({type:o.type,speed:o.speed,duration:o.duration,text:i(o.text,t.name)}):s.push(o);s.length>0&&this.sequenceQueue.push(s)},activate:async function(t=[]){hl=mu=0,await this.talk(t)||this.talk()},talk:async function(t=[]){let i=this.character.sequences.filter(o=>o.name==="Activate"),s=[];if(this.isLoading=!0,t.length>0){let o=function(f){function p(m,g){return m=Math.ceil(m),g=Math.floor(g),Math.floor(Math.random()*(g-m))+m}let _=[].concat(f),y=f.length;for(;y>1;){const m=p(0,y);y--;const g=_[y];_[y]=_[m],_[m]=g}return _};var r=o;const a=Math.floor(new Date/1e3),l=60*60,c=Object.assign({},this.states),h=new Dc,u=[],d=[];for(const f of t){if(!(f in this.wordDictionary)||a-this.wordDictionary[f].timestamp>=l){const p=await xo(nn(sn,rn+"/words/"+f));if(this.wordDictionary[f]={attributes:[],timestamp:a},p.exists()){const _=p.val();for(let y in _.attributes)typeof _.attributes[y]=="number"&&_.attributes[y]>0&&this.attributes.includes(y)&&this.wordDictionary[f].attributes.push(y)}}for(const p of this.wordDictionary[f].attributes)u.includes(p)||u.push(p)}for(const f of o(i)){const p=this.prepare([f]);let _=!1;for(const y of p){if(y.type=="Message"){for(const m of Array.isArray(y.text)?y.text:h.segment(y.text))if(Array.isArray(m)){for(const g of p)if(g.type=="Message"){const v=await this.generate(g.text,t);if(v===null){_=!0;break}else{let x,T;[x,T]=v,s.push({type:g.type,speed:g.speed,duration:g.duration,text:x})}}else s.push(g);if(_)break;return s.length>0&&this.sequenceQueue.push(s),this.isLoading=!1,!0}else if(m.length>1&&!d.includes(m)){if(!(m in this.wordDictionary)||a-this.wordDictionary[m].timestamp>=l){const g=await xo(nn(sn,rn+"/words/"+m));if(this.wordDictionary[m]={attributes:[],timestamp:a},g.exists()){const v=g.val();for(const x in v.attributes)typeof v.attributes[x]=="number"&&v.attributes[x]>0&&this.attributes.includes(x)&&this.wordDictionary[m].attributes.push(x)}}for(const g of this.wordDictionary[m].attributes)if(u.includes(g)){for(const v of p)if(v.type=="Message"){const x=await this.generate(v.text,t);if(x===null){_=!0;break}else{let T,S;[T,S]=x,s.push({type:v.type,speed:v.speed,duration:v.duration,text:T})}}else s.push(v);if(_)break;return s.length>0&&this.sequenceQueue.push(s),this.isLoading=!1,!0}d.push(m)}}if(_){s.splice(0);break}}this.states=c}return this.isLoading=!1,!1}for(const o of this.prepare(i))if(o.type==="Message"){const a=await this.generate(o.text);if(a===null)return this.isLoading=!1,!1;{let l,c;[l,c]=a,s.push({type:o.type,speed:o.speed,duration:o.duration,text:l})}}else s.push(o);return s.length>0?(this.sequenceQueue.push(s),this.isLoading=!1,!0):(this.isLoading=!1,!1)},generate:async function(t,i=[]){function s(x){const T=Math.random();let S=0,b=0;for(let M of x){if(S<=T&&T<S+M)break;S+=M,b++}return b}function r(x){let T=[],S=Number.MIN_VALUE,b=0;for(let M=0;M<x.length;M++)x[M]>S&&(S=x[M]);for(let M=0;M<x.length;M++)b+=Math.exp(x[M]-S);for(let M=0;M<x.length;M++)T.push(Math.exp(x[M]-S)/b);return T}const o=Math.floor(new Date/1e3),a=60*60;let l=new Dc,c=Array.isArray(t)?t:l.segment(t),h={},u=[],d=new RegExp("[.#$\\[\\]]"),f={},p="",_=0;const y=Math.pow(10,-6),m=10;let g=[{sequence:[],score:1}];for(const x of i){if(!(x in this.wordDictionary)||o-this.wordDictionary[x].timestamp>=a){const T=await xo(nn(sn,rn+"/words/"+x));if(this.wordDictionary[x]={attributes:[],timestamp:o},T.exists()){const S=T.val();for(const b in S.attributes)typeof S.attributes[b]=="number"&&S.attributes[b]>0&&this.attributes.includes(b)&&this.wordDictionary[x].attributes.push(b)}}for(const T of this.wordDictionary[x].attributes)T in h?h[T].push(x):h[T]=[x]}for(const x of c){if(!u.includes(x)){if(Array.isArray(x)){let T=[],S=[];for(const b of x)if(b in h){for(const M of h[b])if(!T.includes(M)){let N=!0;T.push(M);for(const P of this.tags)if(M===P.name){S.push(P.score),N=!1;break}N&&S.push(y)}}else{if(!(b in this.reverseWordDictionary)||o-this.reverseWordDictionary[b].timestamp>=a){const M=await xo(rl(nn(sn,rn+"/words"),Rf(`attributes/${b}`),sl(100),oA(1)));if(this.reverseWordDictionary[b]={words:[],timestamp:o},M.exists()){const N=M.val();for(const P in N)this.reverseWordDictionary[b].words.push(P)}}for(const M of this.reverseWordDictionary[b].words)if(c.includes(M)&&!T.includes(M)){let N=!0;T.push(M);for(const P of this.tags)if(M==P.name){S.push(P.score),N=!1;break}N&&S.push(y)}}if(T.length>0&&S.length>0){const b=r(S);let M=[];for(let N=0;N<g.length;N++)for(let P=0;P<b.length;P++){let L=[].concat(g[N].sequence);L.push({index:_,term:T[P]}),M.push({sequence:L,score:g[N].score*b[P]})}g.splice(0);for(const N of this.take(M.sort((P,L)=>L.score-P.score),m))g.push(N)}}else if(!d.test(x)){let T=[],S=[];if(!(x in this.wordDictionary)||o-this.wordDictionary[x].timestamp>=a){const b=await xo(nn(sn,rn+"/words/"+x));if(this.wordDictionary[x]={attributes:[],timestamp:o},b.exists()){const M=b.val();for(const N in M.attributes)typeof M.attributes[N]=="number"&&M.attributes[N]>0&&this.attributes.includes(N)&&this.wordDictionary[x].attributes.push(N)}}for(const b of this.wordDictionary[x].attributes)if(b in h){for(const M of h[b])if(!T.includes(M)){let N=!0;T.push(M);for(const P of this.tags)if(M===P.name){S.push(P.score),N=!1;break}N&&S.push(y)}}else{if(!(b in this.reverseWordDictionary)||o-this.reverseWordDictionary[b].timestamp>=a){const M=await xo(rl(nn(sn,rn+"/words"),Rf(`attributes/${b}`),sl(100),oA(1)));if(this.reverseWordDictionary[b]={words:[],timestamp:o},M.exists()){const N=M.val();for(let P in N)this.reverseWordDictionary[b].words.push(P)}}for(const M of this.reverseWordDictionary[b].words)if(c.includes(M)&&!T.includes(M)){let N=!0;T.push(M);for(const P of this.tags)if(M==P.name){S.push(P.score),N=!1;break}N&&S.push(y)}}if(T.length>0&&S.length>0){const b=r(S);let M=[];for(let N=0;N<g.length;N++)for(let P=0;P<b.length;P++){let L=[].concat(g[N].sequence);L.push({index:_,term:T[P]}),M.push({sequence:L,score:g[N].score*b[P]})}g.splice(0);for(const N of this.take(M.sort((P,L)=>L.score-P.score),m))g.push(N)}}u.push(x)}_++}const v=g[s(r(g.map(x=>x.score)))];for(let x=0;x<c.length;x++){const T=JSON.stringify(c[x]);if(T in f)typeof f[T]=="undefined"?p+=c[x]:p+=f[T];else{let S=!0;for(let b=0;b<v.sequence.length;b++)if(v.sequence[b].index==x){T==v.sequence[b].term?f[T]=void 0:(f[T]=v.sequence[b].term,p+=v.sequence[b].term,S=!1);break}if(S){if(Array.isArray(c[x]))return null;p+=c[x]}}}return[p,f]},notify:function(t,i=3e3){const s=this;t.id=window.setTimeout(r=>{for(let o=0;o<s.notifications.length;o++)if(s.notifications[o].id===r.id){s.notifications.splice(o,1);break}},i,t),this.notifications.unshift(t)},blinded:async function(){if(this.backgroundImagesQueue.length==0){let s=function(r){function o(c,h){return c=Math.ceil(c),h=Math.floor(h),Math.floor(Math.random()*(h-c))+c}let a=[].concat(r),l=r.length;for(;l>1;){const c=o(0,l);l--;const h=a[l];a[l]=a[c],a[c]=h}return a};var i=s;for(const r of s(this.recentImages))this.backgroundImagesQueue.push(r)}const t=this.backgroundImagesQueue.shift();this.preloadImages.splice(0),this.backgroundImages.splice(0);for(const s of t.paths)try{this.preloadImages.push({id:t.id,url:await LA(ly(uy,s)),timestamp:t.timestamp})}catch(r){this.notify({text:r.message,accent:this.character.accent,image:this.character.image}),console.error(r)}"tags"in t&&this.talk(t.tags.filter(s=>s.indexOf(this.character.name)===-1))},load:function(t){let i=!0;for(let s of this.preloadImages)s.url==t?s.isLoaded=!0:"isLoaded"in s||(i=!1);if(i){let s=0;for(const r of this.preloadImages)r.isLoaded&&(this.backgroundImages.push({index:s,id:r.id,url:r.url,timestamp:r.timestamp}),s++);this.preloadImages.splice(0),this.isBlinded=!1}},error:function(t){let i=!0;for(let s of this.preloadImages)s.url==t?s.isLoaded=!0:"isLoaded"in s||(i=!1);if(i){let s=0;for(const r of this.preloadImages)r.isLoaded&&(this.backgroundImages.push({index:s,id:r.id,url:r.url,timestamp:r.timestamp}),s++);this.preloadImages.splice(0),this.isBlinded=!1}},update:async function(t,i){this.isUpdating=!0;try{const s=await new Promise(r=>{const o=Math.pow(10,-6);let a=[],l=[],c=[],h={};const u=new Date().getTime()-12*60*60*1e3,d=10;let f={},p=[],_=o;for(const y in t)if("tags"in t[y]&&t[y].tags.length>0){let m=[];a.push({tokens:t[y].tags,timestamp:t[y].timestamp});for(const g of t[y].tags)m.includes(g)||(g in h?h[g]+=1:h[g]=1,m.push(g))}for(const y in h)h[y]=Math.log(a.length/(h[y]+o));for(const y of a)y.timestamp*1e3>u&&l.push(y);if(l.length<d){const y=Math.max(a.length-d,0);l.splice(0);for(let m=a.length-1;m>=y;m--)l.unshift(a[m])}for(const y of l){let m={};for(const g of y.tokens)g in m?m[g]+=1:m[g]=1;for(const g in m)m[g]/=y.tokens.length,g in f||(f[g]=0);c.push(m)}for(const y in f)for(const m of c)if(y in m){const g=m[y]*h[y];g>f[y]&&(f[y]=g)}for(const y in f)y.length>1&&y!="..."&&p.push({term:y,value:f[y]});p.sort((y,m)=>m.value-y.value),p.length>i&&p.splice(i);for(const y of p)y.value>_&&(_=y.value);for(const y of p)y.value/=_;p.sort((y,m)=>y.term>m.term?1:y.term<m.term?-1:0),r(p)});this.tags.splice(0);for(let r=0;r<s.length;r++)this.tags.push({index:r,name:s[r].term,score:s[r].value})}catch(s){this.notify({text:s.message,accent:this.character.accent,image:this.character.image}),console.error(s)}this.isUpdating=!1},shake:function(t){t.animate([{transform:"translate3d(0, 0, 0)"},{transform:"translate3d(8px, 0, 0)"},{transform:"translate3d(-8px, 0, 0)"},{transform:"translate3d(7px, 0, 0)"},{transform:"translate3d(-7px, 0, 0)"},{transform:"translate3d(6px, 0, 0)"},{transform:"translate3d(-6px, 0, 0)"},{transform:"translate3d(5px, 0, 0)"},{transform:"translate3d(-5px, 0, 0)"},{transform:"translate3d(4px, 0, 0)"},{transform:"translate3d(-4px, 0, 0)"},{transform:"translate3d(3px, 0, 0)"},{transform:"translate3d(-3px, 0, 0)"},{transform:"translate3d(2px, 0, 0)"},{transform:"translate3d(-2px, 0, 0)"},{transform:"translate3d(1px, 0, 0)"},{transform:"translate3d(-1px, 0, 0)"},{transform:"translate3d(0, 0, 0)"}],{duration:1e3,iterations:1})},scrollToTop(){this.$nextTick(()=>{window.scroll(0,0)})},scrollToEnd:function(){typeof this.scrollTimeoutID=="number"&&clearTimeout(this.scrollTimeoutID),this.scrollTimeoutID=setTimeout(function(){window.scrollTo(0,document.body.scrollHeight)},500)},formatDate:function(t){return moment.locale(window.navigator.language),moment(t).format("LT")},animationStart:function(t){this.isAnimating=!0},animationEnd:function(t){const i=this;this.$nextTick(()=>{i.notificationHeight=i.$refs.notifications.getBoundingClientRect().height}),this.isPopup||(this.message=null),this.isAnimating=!1},tickerUpdated:function(t){const i=this;this.$nextTick(()=>{for(const s of document.body.querySelectorAll(".container>.wrap>.frame .clip")){let r=0;for(const o of s.querySelectorAll(":scope .ticker-wrap .ticker .item"))r+=o.getBoundingClientRect().width;r>0&&(i.tickerWidth=Math.min(r/2,document.body.querySelector(".container>.wrap>.frame .level").getBoundingClientRect().width),s.querySelector(":scope .ticker-wrap .ticker").style.width=r+"px")}})},arrange:function(t,i){let s=[],r=[];for(const o of t)r.length<i?r.push(o):(s.push(r),r=[o]);return s.push(r),s},take:function(t,i){if(t.length>i){let s=[].concat(t);return s.splice(i),s}return t},prepare:function(t,i=null,s=null){function r(l,c){return l=Math.ceil(l),c=Math.floor(c),Math.floor(Math.random()*(c-l))+l}let o=[],a=[];for(const l of t){let c=i;i===null&&l.name in this.states&&(c=this.states[l.name]),c!==null&&"state"in l&&l.state!==null&&new RegExp(l.state).test(c)&&o.push(l)}if(o.length===0){for(const l of t)(!("state"in l)||l.state===null)&&o.push(l);i=null}if(o.length>0){let l=[];for(const c of o[r(0,o.length)].sequence)i!==null&&(this.states[c.name]=i),l.push(c);for(;l.length>0;){const c=l.shift();if(c.type=="Sequence"){if(!("sequence"in c)){let h=[],u=[];for(const d of s===null?this.character.sequences:s){let f=this.getSequenceStack(d,c);if(f.length>0){let p=[];do{let _=f.pop();if(f.length>0){let y=[];for(const m of f[f.length-1].sequence)if(m.type=="Sequence"){if("sequence"in m){let g=!0;for(const v of p)if(v===m){g=!1;break}g&&y.push(m)}if(m===_)break}for(;y.length>0;)p.push(y.pop())}if("sequence"in _){let y=!0;for(const m of p)if(m===_){y=!1;break}y&&p.push(_)}}while(f.length>0);for(;p.length>0;)h.push(p.pop())}else h.push(d)}if("state"in c){this.states[c.name]=c.state;for(const d of h)if(d.name==c.name){if(!new RegExp(d.state).test(c.state))continue;u.push(d)}}else for(const d of h)if(d.name==c.name){if("state"in d&&(!(d.name in this.states)||!new RegExp(d.state).test(this.states[d.name])))continue;u.push(d)}if(u.length>0){let d=0;for(const f of u[r(0,u.length)].sequence)l.splice(d,0,f),d++}}}else a.push(c)}}return a},getSequenceStack:function(t,i){let s=[];if(s.push(t),s[s.length-1]!==i){if("sequence"in t){for(const r of t.sequence)if(r.type=="Sequence"){let o=this.getSequenceStack(r,i);if(o.length>0&&o[o.length-1]===i){let a=[];do a.push(o.pop());while(o.length>0);do s.push(a.pop());while(a.length>0);return s}}}s.pop()}return s},animate:function(){requestAnimationFrame(this.animate),Cs.begin();const t=B9.getDelta();if(Mt.domElement.width!==Mt.domElement.clientWidth||Mt.domElement.height!==Mt.domElement.clientHeight){const s=Mt.domElement.clientWidth,r=Mt.domElement.clientHeight;cl.setSize(s,r),DA.uniforms.resolution.value.set(1/(s*window.devicePixelRatio),1/(r*window.devicePixelRatio)),Mt.setPixelRatio(window.devicePixelRatio),Mt.setSize(s,r,!1),is.aspect=s/r,is.updateProjectionMatrix(),Ri.setPixelRatio(window.devicePixelRatio),Ri.setSize(s,r)}if(ft){let s=function(u,d){return u=Math.ceil(u),d=Math.floor(d),Math.floor(Math.random()*(d-u))+u};var i=s;let r=!1,o=!1,a=null,l=[];if(bt===null&&(bt={time:0,duration:.5,base:{x:xt.position.x,y:xt.position.y},source:{x:xt.position.x,y:xt.position.y},target:{x:xt.position.x+s(-1,1)*.1,y:xt.position.y+s(-1,1)*.1}}),bt.time+=t,bt.time>=bt.duration)xt.position.x=bt.target.x,xt.position.y=bt.target.y,bt.base?bt={time:0,duration:.5,source:{x:xt.position.x,y:xt.position.y},target:{x:bt.base.x,y:bt.base.y}}:bt=null;else{const u=bt.time/bt.duration;xt.position.x=bt.source.x+(bt.target.x-bt.source.x)*u,xt.position.y=bt.source.y+(bt.target.y-bt.source.y)*u}let c=Math.max(0,Math.min(-xt.position.y,1)),h=!0;this.currentAnimations.length>0&&ul<this.currentAnimations.length&&(a=this.currentAnimations[ul],ul+=OA,r=!0);for(let u=this.blendShapeAnimations.length-1;u>=0;u--){let d=this.blendShapeAnimations[u];l.includes(d.name)||(d.time<=d.duration&&(d.time+=t,d.time>=d.duration?(d.name=="blink"?(ft.blendShapeProxy.setValue(d.name,.1*c+(1-.1)*Math.abs(Math.sin(d.end/2*Math.PI))),h=!1):ft.blendShapeProxy.setValue(d.name,Math.abs(Math.sin(d.end/2*Math.PI))),this.blendShapeAnimations.splice(u,1)):d.name=="blink"?(ft.blendShapeProxy.setValue(d.name,.1*c+(1-.1)*Math.abs(Math.sin((d.time/d.duration*(d.end-d.start)+d.start)/2*Math.PI))),h=!1):ft.blendShapeProxy.setValue(d.name,Math.abs(Math.sin((d.time/d.duration*(d.end-d.start)+d.start)/2*Math.PI))),o=!0),l.push(d.name))}if(h&&ft.blendShapeProxy.setValue("blink",.1*c),this.sequenceQueue.length>0&&Array.isArray(this.sequenceQueue[0])?hl=0:(hl+=t,this.isLoading||(mu+=t),this.sequenceQueue.length==0&&(mu>=z9?(this.recentImages.length>0&&(this.isBlinded=!0),hl=mu=0):(hl>=H9||a===null)&&(this.sequenceQueue.push({sequences:this.prepare(this.character.sequences.filter(u=>u.name==="Idle"))}),hl=0))),this.sequenceQueue.length>0){const u=Array.isArray(this.sequenceQueue[0])?this.sequenceQueue[0]:this.sequenceQueue[0].sequences;if(u.length>0){if(u[0].type=="Animation")if("name"in u[0])if(u[0].name in this.animations){let d=!1;if("dependencies"in u[0]){for(const f of this.currentAnimations)if(u[0].dependencies.includes(f.name)){d=!0;break}}if(!d||!r){this.currentAnimations.splice(0);for(let f of this.animations[u[0].name])this.currentAnimations.push(f);u.shift(),ul=0,a=this.currentAnimations[ul],ul+=OA}}else{let d=!1;if("dependencies"in u[0]){for(const f of this.blendShapeAnimations)if(u[0].dependencies.includes(f.name)){d=!0;break}}if(!d||!o){let f=[];for(this.blendShapeAnimations.unshift({name:u[0].name,time:0,duration:u[0].duration,start:u[0].start,end:u[0].end}),u.shift();u.length>0;){if(d=!1,"dependencies"in u[0]){for(const p of this.blendShapeAnimations)if(u[0].dependencies.includes(p.name)){d=!0;break}}if(d||u[0].type!="Animation"||u[0].name in this.animations)break;this.blendShapeAnimations.unshift({name:u[0].name,time:0,duration:u[0].duration,start:u[0].start,end:u[0].end}),u.shift()}for(let p=this.blendShapeAnimations.length-1;p>=0;p--){let _=this.blendShapeAnimations[p];f.includes(_.name)||(ft.blendShapeProxy.setValue(_.name,Math.abs(Math.sin(_.start/2*Math.PI))),f.push(_.name))}}}else u.shift();else if(u[0].type=="Message"&&this.message===null&&!r&&!o&&("character"in u[0]?this.message={time:0,duration:u[0].duration,type:{elapsed:-1,speed:u[0].speed,reverse:!1,buffer:"",count:0},character:u[0].character,text:u[0].text}:this.message={time:0,duration:u[0].duration,type:{elapsed:-1,speed:u[0].speed,reverse:!1,buffer:"",count:0},character:{name:this.character.name,accent:this.character.accent,image:this.character.image},text:u[0].text},u.shift(),!this.isMuted)){const d=this.message.text;new Promise(async f=>{try{const p=await fetch("https://ai.milchchan.com/api/synthesize?text="+encodeURIComponent(d),{mode:"cors",method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(p.ok)this.$refs.player.src=URL.createObjectURL(await p.blob()),this.message!==null&&d===this.message.text&&(this.$refs.player.currentTime=0,this.$refs.player.play());else throw new Error(p.statusText)}catch(p){console.error(p)}f()})}}else this.message===null&&!r&&!o&&this.sequenceQueue.shift()}if(this.message!==null){if(this.message.type.reverse)if(this.message.type.count>0){if(this.message.type.elapsed+=t*2,this.message.type.elapsed>=1/this.message.type.speed){if(this.message.type.count-1<this.message.text.length){let d=Math.floor(this.message.text.length/2);this.message.type.buffer.length<=d&&this.message.type.count>0&&(this.message.type.count-=1),this.message.type.buffer.length>0&&(this.message.type.buffer=this.message.type.buffer.substring(0,this.message.type.buffer.length-1))}this.message.type.elapsed=0}}else this.isPopup=!1;else if(this.message.type.buffer.length<this.message.text.length){if(this.message.type.elapsed>=0?this.message.type.elapsed+=t:this.isAnimating||(this.isPopup?this.message.type.elapsed=t:this.isPopup=!0),this.message.type.elapsed>=1/this.message.type.speed){let u=this.message.type.buffer.length,d=Math.floor(this.message.text.length/2),f=this.message.text.length;this.message.type.count>=d&&(this.message.type.buffer+=this.message.text.charAt(u)),this.message.type.count<f&&(this.message.type.count+=1),this.message.type.elapsed=0}}else this.message.time+=t,this.message.time>=this.message.duration&&(this.message.type.reverse=!0);if(this.message.text.length===this.message.type.buffer.length){const u=this.message.text.split("");this.text.splice(0);for(let d=0;d<u.length;d++)this.text.push({key:d,value:u[d]})}else{let u=new Array,d="";for(let f=0;f<this.message.text.length;f++)u.indexOf(this.message.text.charAt(f))==-1&&this.message.text.charAt(f)!=`
`&&this.message.text.charAt(f).match(/\s/)==null&&u.push(this.message.text.charAt(f));if(u.length>0)for(let f=0;f<this.message.type.count;f++)this.message.text.charAt(f)==`
`?d+=`
`:d+=u[~~s(0,u.length)];if(d.length>this.message.type.buffer.length){const f=(this.message.type.buffer+d.substring(this.message.type.buffer.length,d.length)).split("");this.text.splice(0);for(let p=0;p<f.length;p++)this.text.push({key:p,value:f[p]})}else if(this.text.length!==this.message.type.buffer.length){const f=this.message.type.buffer.split("");this.text.splice(0);for(let p=0;p<f.length;p++)this.text.push({key:p,value:f[p]})}}}if(a)for(let u of a.animations){switch(u.bone){case"chest":case"head":case"hips":case"jaw":case"leftEye":case"leftFoot":case"leftHand":case"leftIndexDistal":case"leftIndexIntermediate":case"leftIndexProximal":case"leftLittleDistal":case"leftLittleIntermediate":case"leftLittleProximal":case"leftLowerArm":case"leftLowerLeg":case"leftMiddleDistal":case"leftMiddleIntermediate":case"leftMiddleProximal":case"leftRingDistal":case"leftRingIntermediate":case"leftRingProximal":case"leftShoulder":case"leftThumbDistal":case"leftThumbIntermediate":case"leftThumbProximal":case"leftToes":case"leftUpperArm":case"leftUpperLeg":case"neck":case"rightEye":case"rightFoot":case"rightHand":case"rightIndexDistal":case"rightIndexIntermediate":case"rightIndexProximal":case"rightLittleDistal":case"rightLittleIntermediate":case"rightLittleProximal":case"rightLowerArm":case"rightLowerLeg":case"rightMiddleDistal":case"rightMiddleIntermediate":case"rightMiddleProximal":case"rightRingDistal":case"rightRingIntermediate":case"rightRingProximal":case"rightShoulder":case"rightThumbDistal":case"rightThumbIntermediate":case"rightThumbProximal":case"rightToes":case"rightUpperArm":case"rightUpperLeg":case"spine":case"upperChest":break;case"eye.L":u.bone="leftEye";break;case"foot.L":u.bone="leftFoot";break;case"hand.L":u.bone="leftHand";break;case"f_index.03.L":u.bone="leftIndexDistal";break;case"f_index.02.L":u.bone="leftIndexIntermediate";break;case"f_index.01.L":u.bone="leftIndexProximal";break;case"f_pinky.03.L":u.bone="leftLittleDistal";break;case"f_pinky.02.L":u.bone="leftLittleIntermediate";break;case"f_pinky.01.L":u.bone="leftLittleProximal";break;case"lower_arm.L":u.bone="leftLowerArm";break;case"shin.L":u.bone="leftLowerLeg";break;case"f_middle.03.L":u.bone="leftMiddleDistal";break;case"f_middle.02.L":u.bone="leftMiddleIntermediate";break;case"f_middle.01.L":u.bone="leftMiddleProximal";break;case"f_ring.03.L":u.bone="leftRingDistal";break;case"f_ring.02.L":u.bone="leftRingIntermediate";break;case"f_ring.01.L":u.bone="leftRingProximal";break;case"shoulder.L":u.bone="leftShoulder";break;case"thumb_distal.L":u.bone="leftThumbDistal";break;case"thumb_intermediate.L":u.bone="leftThumbIntermediate";break;case"thumb_proximal.L":u.bone="leftThumbProximal";break;case"toe.L":u.bone="leftToes";break;case"upper_arm.L":u.bone="leftUpperArm";break;case"thigh.L":u.bone="leftUpperLeg";break;case"eye.R":u.bone="rightEye";break;case"foot.R":u.bone="rightFoot";break;case"hand.R":u.bone="rightHand";break;case"f_index.03.R":u.bone="rightIndexDistal";break;case"f_index.02.R":u.bone="rightIndexIntermediate";break;case"f_index.01.R":u.bone="rightIndexProximal";break;case"f_pinky.03.R":u.bone="rightLittleDistal";break;case"f_pinky.02.R":u.bone="rightLittleIntermediate";break;case"f_pinky.01.R":u.bone="rightLittleProximal";break;case"lower_arm.R":u.bone="rightLowerArm";break;case"shin.R":u.bone="rightLowerLeg";break;case"f_middle.03.R":u.bone="rightMiddleDistal";break;case"f_middle.02.R":u.bone="rightMiddleIntermediate";break;case"f_middle.01.R":u.bone="rightMiddleProximal";break;case"f_ring.03.R":u.bone="rightRingDistal";break;case"f_ring.02.R":u.bone="rightRingIntermediate";break;case"f_ring.01.R":u.bone="rightRingProximal";break;case"shoulder.R":u.bone="rightShoulder";break;case"thumb_distal.R":u.bone="rightThumbDistal";break;case"thumb_intermediate.R":u.bone="rightThumbIntermediate";break;case"thumb_proximal.R":u.bone="rightThumbProximal";break;case"toe.R":u.bone="rightToes";break;case"upper_arm.R":u.bone="rightUpperArm";break;case"thigh.R":u.bone="rightUpperLeg";break;case"upper_chest":u.bone="upperChest";break;default:u.bone=null}if(u.bone&&u.rotation.length==4)try{ft.humanoid.getBoneNode(u.bone).position.set(u.position[0],u.position[1],-u.position[2]),ft.humanoid.getBoneNode(u.bone).quaternion.set(-u.rotation[0],-u.rotation[1],u.rotation[2],u.rotation[3])}catch(d){this.notify({text:d.message,accent:this.character.accent,image:this.character.image}),console.error(d)}}if(Li.length>0){const u={};let d=0;if(It===null){if(Fe!==null)if(Fe.time-=t,Fe.time<=0){for(const f in Fe.bones)u[f]={direction:Fe.bones[f].direction,force:Fe.bones[f].base};Fe=null}else for(const f in Fe.bones)u[f]={direction:Fe.bones[f].direction,force:Fe.bones[f].base+Fe.bones[f].source+Fe.time/Fe.duration*(Fe.bones[f].target-Fe.bones[f].source-Fe.bones[f].base)}}else if(Fe===null){let f=null,p=0;for(const _ of ft.springBoneManager.springBoneGroupList)for(const y of _)p===It.index&&(f=y.bone.getWorldPosition(new C)),p++;if(f!==null){const _=.25;p=0,Fe={time:0,duration:.5,center:f,bones:{}};for(const y of ft.springBoneManager.springBoneGroupList)for(const m of y)f.distanceTo(m.bone.getWorldPosition(new C))<=_&&(Fe.bones[p]={direction:new C(It.direction.x,It.direction.y,0),base:m.gravityPower-Li[p].gravityPower,source:0,target:-Math.min(.01*It.distance*Math.cos(f.distanceTo(m.bone.getWorldPosition(new C))/_),5)},u[p]={direction:Fe.bones[p].direction,force:Fe.bones[p].source}),p++}}else if(Fe.time+=t,Fe.time>=Fe.duration){const f=.25;let p=0;for(const _ in Fe.bones)u[_]={direction:Fe.bones[_].direction,force:Fe.bones[_].target};Fe.time=0;for(const _ of ft.springBoneManager.springBoneGroupList)for(const y of _)p in Fe.bones&&(Fe.bones[p].direction=new C(It.direction.x,It.direction.y,0),Fe.bones[p].source=Fe.bones[p].target,Fe.bones[p].target=-Math.min(.01*It.distance*Math.cos(Fe.center.distanceTo(y.bone.getWorldPosition(new C))/f),5)),p++}else for(const f in Fe.bones)u[f]={direction:Fe.bones[f].direction,force:Fe.bones[f].base+Fe.bones[f].source+Fe.time/Fe.duration*(Fe.bones[f].target-Fe.bones[f].source-Fe.bones[f].base)};if(fn===null){let f=0;fn={time:0,duration:1,direction:new C(1,0,0),force:.01*(Math.random()-.5),sources:{}};for(const p of ft.springBoneManager.springBoneGroupList)for(const _ of p)f in u||(fn.sources[f]=_.gravityPower-Li[f].gravityPower),f++}else if(fn.time+=t,fn.time>=fn.duration){for(const f in fn.sources)f in u||(u[f]={direction:fn.direction,force:fn.force});fn=null}else for(const f in fn.sources)f in u||(u[f]={direction:fn.direction,force:fn.sources[f]+fn.time/fn.duration*(fn.force-fn.sources[f])});for(const f of ft.springBoneManager.springBoneGroupList)for(const p of f){if(d in u){const _=new C(Li[d].gravityDir.x+u[d].direction.x,Li[d].gravityDir.y+u[d].direction.y,Li[d].gravityDir.z+u[d].direction.z);p.gravityDir=_.normalize(),p.gravityPower=Li[d].gravityPower+u[d].force}d++}}ft.update(t)}on.update(),Ri.render(t),Cs.end()}},updated:function(){this.insetTop=this.$refs.indicator.getBoundingClientRect().height,this.insetBottom=this.$refs.blank.getBoundingClientRect().height;for(const t of document.body.querySelectorAll(".container>.wrap>.frame .clip")){let i=0;for(const s of t.querySelectorAll(":scope .ticker-wrap .ticker .item"))i+=s.getBoundingClientRect().width;i>0&&(this.tickerWidth=Math.min(i/2,document.body.querySelector(".container>.wrap>.frame .level").getBoundingClientRect().width),t.querySelector(":scope .ticker-wrap .ticker").style.width=i+"px")}},mounted:async function(){function t(c,h){const u=Math.random();let d=0,f=0;for(let p of c){const _=h(p);if(d<=u&&u<d+_)break;d+=_,f++}return c[f]}const i=this,s=localStorage.getItem("character"),r=localStorage.getItem("credential");let o=null;const a=[{path:"/assets/milch.json",probability:.9},{path:"/assets/merku.json",probability:.1}],l=new xS;if(s)try{const c=JSON.parse(s);c!==null&&(this.isMuted=c.mute)}catch{localStorage.removeItem("character")}if(r)try{o=JSON.parse(r)}catch{localStorage.removeItem("credential")}this.$refs.three.appendChild(Mt.domElement),this.$refs.three.after(Cs.domElement),this.animate(),this.insetTop=this.$refs.indicator.getBoundingClientRect().height,this.insetBottom=this.$refs.blank.getBoundingClientRect().height;try{const c=await fetch(t(a,h=>h.probability).path,{mode:"cors",method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(c.ok)this.character=await c.json();else throw new Error(c.statusText)}catch(c){this.notify({text:c.message,accent:this.character.accent,image:this.character.image}),console.error(c)}if(this.sequenceQueue.push(this.prepare(this.character.sequences.filter(c=>c.name==="Start"))),l.crossOrigin="anonymous",l.load(await LA(ly(uy,this.character.model)),c=>{s_.from(c).then(async h=>{const u={idle1:"/assets/animation-idle1.json",idle2:"/assets/animation-idle2.json",jump:"/assets/animation-jump.json",lose:"/assets/animation-lose.json",win:"/assets/animation-win.json"};let d={};try{for(let f in u){const p=await fetch(encodeURI(u[f]),{mode:"cors",method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(p.ok){const _=await p.json();d[f]=_.data}else throw new Error(p.statusText)}i.animations=d,ft=h,pi.add(h.scene),h.scene.rotation.y=Math.PI,h.lookAt.target=xt,Li.splice(0);for(const f of ft.springBoneManager.springBoneGroupList)for(const p of f)Li.push({gravityDir:p.gravityDir.clone(),gravityPower:p.gravityPower});i.progress=null}catch(f){i.notify({text:f.message,accent:i.character.accent,image:i.character.image}),console.error(f)}})},c=>i.progress=c.loaded/c.total,c=>console.error(c)),o!==null){if(o.providerId===di.PROVIDER_ID)try{U_(Ii,di.credential(o.idToken))}catch(c){i.notify({text:c.message,accent:this.character.accent,image:this.character.image}),console.error(c.code,c.message)}else if(o.providerId===hi.PROVIDER_ID)try{U_(Ii,hi.credential(o.accessToken))}catch(c){i.notify({text:c.message,accent:this.character.accent,image:this.character.image}),console.error(c.code,c.message)}else if(o.providerId===fi.PROVIDER_ID)try{U_(Ii,fi.credential(o.accessToken,o.secret))}catch(c){i.notify({text:c.message,accent:this.character.accent,image:this.character.image}),console.error(c.code,c.message)}}J6(Ii,c=>{c?i.user=c:(i.user=null,i.stars=0)}),If(rl(nn(sn,rn+"/images"),sl(100)),c=>{if(c.exists()){const h=c.val();let u=!1;for(const d in h){const f=i.recentImages.findIndex(p=>p.id===d);if(f>=0)if(i.recentImages[f].timestamp<h[d].timestamp)i.recentImages.splice(f,1);else continue;h[d].id=d,i.recentImages.push(h[d]),u=!0}u&&(i.recentImages.sort((d,f)=>f.timestamp-d.timestamp),i.recentImages.length>100&&i.recentImages.splice(100,i.recentImages.length-100),i.update(i.recentImages,i.maxTags),i.isBlinded=!0)}}),If(nn(sn,rn+"/stars"),c=>{const h=c.val();h===null?i.stars=0:i.stars=h}),If(rl(nn(sn,rn+"/words"),Rf("timestamp"),sl(10)),c=>{if(c.exists()){const h=c.val();let u=!1;for(const d in h){const f=i.words.findIndex(p=>p.name===d&&"timestamp"in p);if(f>=0)if(i.words[f].timestamp<h[d].timestamp)d in i.wordDictionary&&delete i.wordDictionary[d],Object.keys(i.reverseWordDictionary).forEach(p=>{i.reverseWordDictionary[p].words.some(_=>_===d)&&delete i.reverseWordDictionary[p]}),i.words.splice(f,1);else continue;i.words.push({name:d,timestamp:h[d].timestamp}),u=!0}if(u){for(let d=i.words.length-1;d>=0;d--)"timestamp"in i.words[d]||i.words.splice(d,1);i.words.length>10&&i.words.splice(10,i.words.length-10),i.words.sort((d,f)=>f.timestamp-d.timestamp);for(const d of i.prepare(i.character.sequences.filter(f=>f.name==="Alert"),10))d.type==="Message"&&i.words.splice(0,0,{name:d.text,image:i.character.image})}}})},unmounted:function(){ft!==null&&(pi.remove(ft.scene),ft=null),Q0(rl(nn(sn,rn+"/images"),sl(100))),Q0(nn(sn,rn+"/stars")),Q0(rl(nn(sn,rn+"/words"),Rf("timestamp"),sl(10)))}}).mount("#app");window.addEventListener("resize",t=>{e.insetTop=e.$refs.indicator.getBoundingClientRect().height,e.insetBottom=e.$refs.blank.getBoundingClientRect().height,e.$nextTick(()=>{for(const i of document.body.querySelectorAll(".container>.wrap>.frame .clip")){let s=0;for(const r of i.querySelectorAll(":scope .ticker-wrap .ticker .item"))s+=r.getBoundingClientRect().width;s>0&&(e.tickerWidth=Math.min(s/2,document.body.querySelector(".container>.wrap>.frame .level").getBoundingClientRect().width),i.querySelector(":scope .ticker-wrap .ticker").style.width=s+"px")}})}),window.addEventListener("click",t=>{const i=e.$refs.three,s=t.clientX-i.offsetLeft-(window.innerWidth-i.offsetWidth),r=t.clientY-i.offsetTop-(window.innerHeight-i.offsetHeight),o=i.offsetWidth,a=i.offsetHeight;zn.x=s/o*2-1,zn.y=-(r/a)*2+1,Is.setFromCamera(zn,is);const l=Is.intersectObjects(pi.children,!0);for(let c of l){if(c.object.name==="face")break;if(c.object.name.indexOf("breast")>=0)break}}),window.addEventListener("dblclick",t=>{const i=e.$refs.three,s=t.clientX-i.offsetLeft-(window.innerWidth-i.offsetWidth),r=t.clientY-i.offsetTop-(window.innerHeight-i.offsetHeight),o=i.offsetWidth,a=i.offsetHeight;zn.x=s/o*2-1,zn.y=-(r/a)*2+1,Is.setFromCamera(zn,is),Is.intersectObjects(pi.children,!0).length>0&&e.activate()}),window.addEventListener("keydown",t=>{t.ctrlKey&&(on.enabled=!0)}),window.addEventListener("keyup",t=>{on.enabled=!1}),window.addEventListener("mousedown",t=>{if(!on.enabled&&t.button===0){let i=Number.MAX_SAFE_INTEGER,s=null;const r=e.$refs.three,o=t.clientX-r.offsetLeft-(window.innerWidth-r.offsetWidth),a=t.clientY-r.offsetTop-(window.innerHeight-r.offsetHeight),l=r.offsetWidth,c=r.offsetHeight;zn.x=o/l*2-1,zn.y=-(a/c)*2+1,Is.setFromCamera(zn,is);for(let h of Is.intersectObjects(pi.children,!0))h.distance<i&&(s=h,i=h.distance);if(s!==null){let h=0;It={point:{x:o,y:a},direction:{x:0,y:0},distance:0,index:-1},i=Number.MAX_SAFE_INTEGER;for(const u of ft.springBoneManager.springBoneGroupList)for(const d of u){const f=d.bone.getWorldPosition(new C).distanceTo(s.point);f<i&&(It.index=h,i=f),h++}e.character!==null&&e.sequenceQueue.push(e.prepare(e.character.sequences.filter(u=>u.name==="TouchStart"),s.object.name))}}}),window.addEventListener("mousemove",t=>{const i=e.$refs.three,s=t.clientX-i.offsetLeft-(window.innerWidth-i.offsetWidth),r=t.clientY-i.offsetTop-(window.innerHeight-i.offsetHeight),o=i.offsetWidth,a=i.offsetHeight;if(zn.x=s/o*2-1,zn.y=-(r/a)*2+1,!on.enabled&&t.button===0&&(bt={time:0,duration:.5,source:{x:xt.position.x,y:xt.position.y},target:{x:(s-.5*o)/o*10,y:(r-.5*a)/a*-10}},It!==null)){const l=new ie(It.point.x-s,r-It.point.y);It.direction=l.normalize(),It.distance=Math.sqrt((It.point.x-s)*(It.point.x-s)+(It.point.y-r)*(It.point.y-r))}}),window.addEventListener("mouseup",t=>{!on.enabled&&t.button===0&&(It=null,e.character!==null&&e.sequenceQueue.push(e.prepare(e.character.sequences.filter(i=>i.name==="TouchEnd"))))}),window.addEventListener("touchstart",t=>{t.stopPropagation();const i=e.$refs.three,s=t.changedTouches[0].clientX-i.offsetLeft-(window.innerWidth-i.offsetWidth),r=t.changedTouches[0].clientY-i.offsetTop-(window.innerHeight-i.offsetHeight),o=i.offsetWidth,a=i.offsetHeight;if(zn.x=s/o*2-1,zn.y=-(r/a)*2+1,Is.setFromCamera(zn,is),Of==0){Of++,setTimeout(()=>{Of=0},500);let l=Number.MAX_SAFE_INTEGER,c=null;for(let h of Is.intersectObjects(pi.children,!0))h.distance<l&&(c=h,l=h.distance);if(c!==null){let h=0;It={point:{x:s,y:r},direction:{x:0,y:0},distance:0,index:-1},l=Number.MAX_SAFE_INTEGER;for(const u of ft.springBoneManager.springBoneGroupList)for(const d of u){const f=d.bone.getWorldPosition(new C).distanceTo(c.point);f<l&&(It.index=h,l=f),h++}e.character!==null&&e.sequenceQueue.push(e.prepare(e.character.sequences.filter(u=>u.name==="TouchStart"),c.object.name))}bt={time:0,duration:.5,source:{x:xt.position.x,y:xt.position.y},target:{x:(s-.5*o)/o*10,y:(r-.5*a)/a*-10}}}else Is.intersectObjects(pi.children,!0).length>0&&e.activate(),Of=0}),window.addEventListener("touchmove",t=>{t.stopPropagation();const i=e.$refs.three,s=t.changedTouches[0].clientX-i.offsetLeft-(window.innerWidth-i.offsetWidth),r=t.changedTouches[0].clientY-i.offsetTop-(window.innerHeight-i.offsetHeight),o=i.offsetWidth,a=i.offsetHeight;bt={time:0,duration:.5,source:{x:xt.position.x,y:xt.position.y},target:{x:(s-.5*o)/o*10,y:(r-.5*a)/a*-10}}}),window.addEventListener("touchend",t=>{t.stopPropagation();const i=e.$refs.three,s=t.changedTouches[0].clientX-i.offsetLeft-(window.innerWidth-i.offsetWidth),r=t.changedTouches[0].clientY-i.offsetTop-(window.innerHeight-i.offsetHeight),o=i.offsetWidth,a=i.offsetHeight;bt={time:0,duration:.5,source:{x:xt.position.x,y:xt.position.y},target:{x:(s-.5*o)/o*10,y:(r-.5*a)/a*-10}},e.character!==null&&e.sequenceQueue.push(e.prepare(e.character.sequences.filter(l=>l.name==="TouchEnd")))}),window.addEventListener("touchcancel",t=>{t.stopPropagation()}),window.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy"},!1),window.addEventListener("drop",t=>{t.stopPropagation(),t.preventDefault();for(let i of t.dataTransfer.files){const s=i.name.toLowerCase();if(s.endsWith(".vrm")){let r=new FileReader;r.addEventListener("load",o=>{const a=new xS;a.crossOrigin="anonymous",a.load(o.target.result,l=>{s_.from(l).then(c=>{ft!==null&&pi.remove(ft.scene),ft=c,pi.add(c.scene),c.scene.rotation.y=Math.PI,c.lookAt.target=xt,Li.splice(0);for(const h of ft.springBoneManager.springBoneGroupList)for(const u of h)Li.push({gravityDir:u.gravityDir.clone(),gravityPower:u.gravityPower});e.progress=null})},l=>e.progress=l.loaded/l.total,l=>console.error(l))}),r.readAsDataURL(i)}else if(s.endsWith(".json")){let r=new FileReader;r.addEventListener("load",o=>{try{e.character=JSON.parse(o.target.result)}catch(a){e.notify({text:error.message,accent:e.character.accent,image:e.character.image}),console.error(a);return}e.sequenceQueue.splice(0),e.sequenceQueue.push(e.prepare(e.character.sequences.filter(a=>a.name==="Start")))}),r.readAsText(i)}}},!1),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{t.matches?e.isDarkMode=!0:e.isDarkMode=!1})});
